# Comparing `tmp/freqtrade-2023.5.tar.gz` & `tmp/freqtrade-2023.5.1.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "freqtrade-2023.5.tar", last modified: Sun May 28 18:36:08 2023, max compression
+gzip compressed data, was "freqtrade-2023.5.1.tar", last modified: Thu Jun  8 20:46:37 2023, max compression
```

## Comparing `freqtrade-2023.5.tar` & `freqtrade-2023.5.1.tar`

### file list

```diff
@@ -1,416 +1,416 @@
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.912543 freqtrade-2023.5/
--rw-r--r--   0 runner    (1001) docker     (123)    35141 2023-05-28 18:36:04.000000 freqtrade-2023.5/LICENSE
--rw-r--r--   0 runner    (1001) docker     (123)      277 2023-05-28 18:36:04.000000 freqtrade-2023.5/MANIFEST.in
--rw-r--r--   0 runner    (1001) docker     (123)    12539 2023-05-28 18:36:08.912543 freqtrade-2023.5/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)    11477 2023-05-28 18:36:04.000000 freqtrade-2023.5/README.md
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.832542 freqtrade-2023.5/freqtrade/
--rw-r--r--   0 runner    (1001) docker     (123)      810 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/__init__.py
--rwxr-xr-x   0 runner    (1001) docker     (123)      206 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/__main__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.836542 freqtrade-2023.5/freqtrade/commands/
--rw-r--r--   0 runner    (1001) docker     (123)     1741 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/commands/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2171 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/commands/analyze_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)    21033 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/commands/arguments.py
--rw-r--r--   0 runner    (1001) docker     (123)     8813 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/commands/build_config_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)    22324 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/commands/cli_options.py
--rw-r--r--   0 runner    (1001) docker     (123)     9009 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/commands/data_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     1672 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/commands/db_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     6530 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/commands/deploy_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     3634 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/commands/hyperopt_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     9277 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/commands/list_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     4513 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/commands/optimize_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     1360 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/commands/pairlist_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     1162 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/commands/plot_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)     1852 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/commands/strategy_utils_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)      936 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/commands/trade_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)      416 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/commands/webserver_commands.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.840542 freqtrade-2023.5/freqtrade/configuration/
--rw-r--r--   0 runner    (1001) docker     (123)      299 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/configuration/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      723 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/configuration/config_setup.py
--rw-r--r--   0 runner    (1001) docker     (123)    17385 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/configuration/config_validation.py
--rw-r--r--   0 runner    (1001) docker     (123)    24880 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/configuration/configuration.py
--rw-r--r--   0 runner    (1001) docker     (123)     7035 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/configuration/deprecated_settings.py
--rw-r--r--   0 runner    (1001) docker     (123)     3592 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/configuration/directory_operations.py
--rw-r--r--   0 runner    (1001) docker     (123)     1814 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/configuration/environment_vars.py
--rw-r--r--   0 runner    (1001) docker     (123)     3851 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/configuration/load_config.py
--rw-r--r--   0 runner    (1001) docker     (123)     6263 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/configuration/timerange.py
--rw-r--r--   0 runner    (1001) docker     (123)    29286 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/constants.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.840542 freqtrade-2023.5/freqtrade/data/
--rw-r--r--   0 runner    (1001) docker     (123)      152 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/data/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    16153 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/data/btanalysis.py
--rw-r--r--   0 runner    (1001) docker     (123)    13517 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/data/converter.py
--rw-r--r--   0 runner    (1001) docker     (123)    21145 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/data/dataprovider.py
--rw-r--r--   0 runner    (1001) docker     (123)    12843 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/data/entryexitanalysis.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.840542 freqtrade-2023.5/freqtrade/data/history/
--rw-r--r--   0 runner    (1001) docker     (123)      465 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/data/history/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4903 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/data/history/featherdatahandler.py
--rw-r--r--   0 runner    (1001) docker     (123)     6094 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/data/history/hdf5datahandler.py
--rw-r--r--   0 runner    (1001) docker     (123)    21512 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/data/history/history_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    17490 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/data/history/idatahandler.py
--rw-r--r--   0 runner    (1001) docker     (123)     5580 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/data/history/jsondatahandler.py
--rw-r--r--   0 runner    (1001) docker     (123)     4798 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/data/history/parquetdatahandler.py
--rw-r--r--   0 runner    (1001) docker     (123)    12466 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/data/metrics.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.840542 freqtrade-2023.5/freqtrade/edge/
--rw-r--r--   0 runner    (1001) docker     (123)       59 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/edge/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    20869 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/edge/edge_positioning.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.844542 freqtrade-2023.5/freqtrade/enums/
--rw-r--r--   0 runner    (1001) docker     (123)      861 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/enums/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      238 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/enums/backteststate.py
--rw-r--r--   0 runner    (1001) docker     (123)      798 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/enums/candletype.py
--rw-r--r--   0 runner    (1001) docker     (123)      640 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/enums/exitchecktuple.py
--rw-r--r--   0 runner    (1001) docker     (123)      619 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/enums/exittype.py
--rw-r--r--   0 runner    (1001) docker     (123)      210 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/enums/hyperoptstate.py
--rw-r--r--   0 runner    (1001) docker     (123)      237 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/enums/marginmode.py
--rw-r--r--   0 runner    (1001) docker     (123)      261 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/enums/marketstatetype.py
--rw-r--r--   0 runner    (1001) docker     (123)      100 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/enums/ordertypevalue.py
--rw-r--r--   0 runner    (1001) docker     (123)      177 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/enums/pricetype.py
--rw-r--r--   0 runner    (1001) docker     (123)      976 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/enums/rpcmessagetype.py
--rw-r--r--   0 runner    (1001) docker     (123)      592 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/enums/runmode.py
--rw-r--r--   0 runner    (1001) docker     (123)      626 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/enums/signaltype.py
--rw-r--r--   0 runner    (1001) docker     (123)      202 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/enums/state.py
--rw-r--r--   0 runner    (1001) docker     (123)      220 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/enums/tradingmode.py
--rw-r--r--   0 runner    (1001) docker     (123)     2068 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exceptions.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.848542 freqtrade-2023.5/freqtrade/exchange/
--rw-r--r--   0 runner    (1001) docker     (123)     1540 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exchange/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     9455 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exchange/binance.py
--rw-r--r--   0 runner    (1001) docker     (123)   632547 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exchange/binance_leverage_tiers.json
--rw-r--r--   0 runner    (1001) docker     (123)     1621 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exchange/bitpanda.py
--rw-r--r--   0 runner    (1001) docker     (123)      517 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exchange/bittrex.py
--rw-r--r--   0 runner    (1001) docker     (123)      547 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exchange/bitvavo.py
--rw-r--r--   0 runner    (1001) docker     (123)     8304 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exchange/bybit.py
--rw-r--r--   0 runner    (1001) docker     (123)     2975 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exchange/check_exchange.py
--rw-r--r--   0 runner    (1001) docker     (123)      564 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exchange/coinbasepro.py
--rw-r--r--   0 runner    (1001) docker     (123)     6112 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exchange/common.py
--rw-r--r--   0 runner    (1001) docker     (123)   131874 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exchange/exchange.py
--rw-r--r--   0 runner    (1001) docker     (123)    10553 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exchange/exchange_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     5035 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exchange/gate.py
--rw-r--r--   0 runner    (1001) docker     (123)      517 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exchange/hitbtc.py
--rw-r--r--   0 runner    (1001) docker     (123)      827 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exchange/huobi.py
--rw-r--r--   0 runner    (1001) docker     (123)     9717 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exchange/kraken.py
--rw-r--r--   0 runner    (1001) docker     (123)     2120 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exchange/kucoin.py
--rw-r--r--   0 runner    (1001) docker     (123)     8695 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exchange/okx.py
--rw-r--r--   0 runner    (1001) docker     (123)      725 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/exchange/types.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.852542 freqtrade-2023.5/freqtrade/freqai/
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.852542 freqtrade-2023.5/freqtrade/freqai/RL/
--rw-r--r--   0 runner    (1001) docker     (123)     4496 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/RL/Base3ActionRLEnv.py
--rw-r--r--   0 runner    (1001) docker     (123)     5021 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/RL/Base4ActionRLEnv.py
--rw-r--r--   0 runner    (1001) docker     (123)     5644 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/RL/Base5ActionRLEnv.py
--rw-r--r--   0 runner    (1001) docker     (123)    15138 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/RL/BaseEnvironment.py
--rw-r--r--   0 runner    (1001) docker     (123)    20053 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/RL/BaseReinforcementLearningModel.py
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/RL/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.852542 freqtrade-2023.5/freqtrade/freqai/base_models/
--rw-r--r--   0 runner    (1001) docker     (123)     4320 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/base_models/BaseClassifierModel.py
--rw-r--r--   0 runner    (1001) docker     (123)     5700 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/base_models/BasePyTorchClassifier.py
--rw-r--r--   0 runner    (1001) docker     (123)     2985 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/base_models/BasePyTorchModel.py
--rw-r--r--   0 runner    (1001) docker     (123)     1768 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/base_models/BasePyTorchRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)     4054 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/base_models/BaseRegressionModel.py
--rw-r--r--   0 runner    (1001) docker     (123)     2572 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/base_models/BaseTensorFlowModel.py
--rw-r--r--   0 runner    (1001) docker     (123)     3466 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/base_models/FreqaiMultiOutputClassifier.py
--rw-r--r--   0 runner    (1001) docker     (123)     2502 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/base_models/FreqaiMultiOutputRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)    30241 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/data_drawer.py
--rw-r--r--   0 runner    (1001) docker     (123)    65930 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/data_kitchen.py
--rw-r--r--   0 runner    (1001) docker     (123)    44639 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/freqai_interface.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.860542 freqtrade-2023.5/freqtrade/freqai/prediction_models/
--rw-r--r--   0 runner    (1001) docker     (123)     2083 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/prediction_models/CatboostClassifier.py
--rw-r--r--   0 runner    (1001) docker     (123)     2866 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/prediction_models/CatboostClassifierMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (123)     2048 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/prediction_models/CatboostRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)     2834 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/prediction_models/CatboostRegressorMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (123)     1920 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/prediction_models/LightGBMClassifier.py
--rw-r--r--   0 runner    (1001) docker     (123)     2698 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/prediction_models/LightGBMClassifierMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (123)     1837 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/prediction_models/LightGBMRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)     2692 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/prediction_models/LightGBMRegressorMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (123)     3634 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/prediction_models/PyTorchMLPClassifier.py
--rw-r--r--   0 runner    (1001) docker     (123)     3320 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/prediction_models/PyTorchMLPRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)     5635 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/prediction_models/PyTorchTransformerRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)     6732 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/prediction_models/ReinforcementLearner.py
--rw-r--r--   0 runner    (1001) docker     (123)     2981 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/prediction_models/ReinforcementLearner_multiproc.py
--rw-r--r--   0 runner    (1001) docker     (123)     3338 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/prediction_models/XGBoostClassifier.py
--rw-r--r--   0 runner    (1001) docker     (123)     3345 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/prediction_models/XGBoostRFClassifier.py
--rw-r--r--   0 runner    (1001) docker     (123)     1844 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/prediction_models/XGBoostRFRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)     2104 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/prediction_models/XGBoostRegressor.py
--rw-r--r--   0 runner    (1001) docker     (123)     2596 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/prediction_models/XGBoostRegressorMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/prediction_models/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.860542 freqtrade-2023.5/freqtrade/freqai/tensorboard/
--rw-r--r--   0 runner    (1001) docker     (123)     2166 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/tensorboard/TensorboardCallback.py
--rw-r--r--   0 runner    (1001) docker     (123)      587 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/tensorboard/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      690 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/tensorboard/base_tensorboard.py
--rw-r--r--   0 runner    (1001) docker     (123)     1926 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/tensorboard/tensorboard.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.860542 freqtrade-2023.5/freqtrade/freqai/torch/
--rw-r--r--   0 runner    (1001) docker     (123)     2028 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/torch/PyTorchDataConvertor.py
--rw-r--r--   0 runner    (1001) docker     (123)     3762 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/torch/PyTorchMLPModel.py
--rw-r--r--   0 runner    (1001) docker     (123)     8903 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/torch/PyTorchModelTrainer.py
--rw-r--r--   0 runner    (1001) docker     (123)     2026 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/torch/PyTorchTrainerInterface.py
--rw-r--r--   0 runner    (1001) docker     (123)     3613 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/torch/PyTorchTransformerModel.py
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/torch/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      666 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/torch/datasets.py
--rw-r--r--   0 runner    (1001) docker     (123)     7382 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqai/utils.py
--rw-r--r--   0 runner    (1001) docker     (123)    95442 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/freqtradebot.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.864542 freqtrade-2023.5/freqtrade/leverage/
--rw-r--r--   0 runner    (1001) docker     (123)       63 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/leverage/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1257 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/leverage/interest.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.864542 freqtrade-2023.5/freqtrade/loggers/
--rw-r--r--   0 runner    (1001) docker     (123)     4942 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/loggers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      460 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/loggers/buffering_handler.py
--rw-r--r--   0 runner    (1001) docker     (123)      714 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/loggers/std_err_stream_handler.py
--rwxr-xr-x   0 runner    (1001) docker     (123)     2094 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/main.py
--rw-r--r--   0 runner    (1001) docker     (123)     9450 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/misc.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.864542 freqtrade-2023.5/freqtrade/mixins/
--rw-r--r--   0 runner    (1001) docker     (123)       70 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/mixins/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1265 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/mixins/logging_mixin.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.864542 freqtrade-2023.5/freqtrade/optimize/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1519 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/backtest_caching.py
--rw-r--r--   0 runner    (1001) docker     (123)    64916 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/backtesting.py
--rw-r--r--   0 runner    (1001) docker     (123)      856 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/bt_progress.py
--rw-r--r--   0 runner    (1001) docker     (123)     1823 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/edge_cli.py
--rw-r--r--   0 runner    (1001) docker     (123)    28627 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/hyperopt.py
--rw-r--r--   0 runner    (1001) docker     (123)     3676 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/hyperopt_auto.py
--rw-r--r--   0 runner    (1001) docker     (123)     4525 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/hyperopt_epoch_filters.py
--rw-r--r--   0 runner    (1001) docker     (123)     8554 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/hyperopt_interface.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.868543 freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/
--rw-r--r--   0 runner    (1001) docker     (123)     1102 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_calmar.py
--rw-r--r--   0 runner    (1001) docker     (123)     1237 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown.py
--rw-r--r--   0 runner    (1001) docker     (123)     1470 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown_relative.py
--rw-r--r--   0 runner    (1001) docker     (123)      746 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_onlyprofit.py
--rw-r--r--   0 runner    (1001) docker     (123)      931 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_profit_drawdown.py
--rw-r--r--   0 runner    (1001) docker     (123)     1095 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe.py
--rw-r--r--   0 runner    (1001) docker     (123)     2108 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe_daily.py
--rw-r--r--   0 runner    (1001) docker     (123)     1965 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_short_trade_dur.py
--rw-r--r--   0 runner    (1001) docker     (123)     1109 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino.py
--rw-r--r--   0 runner    (1001) docker     (123)     2566 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino_daily.py
--rw-r--r--   0 runner    (1001) docker     (123)      951 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/hyperopt_loss_interface.py
--rw-r--r--   0 runner    (1001) docker     (123)    23094 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/hyperopt_tools.py
--rw-r--r--   0 runner    (1001) docker     (123)    45232 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/optimize_reports.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.868543 freqtrade-2023.5/freqtrade/optimize/space/
--rw-r--r--   0 runner    (1001) docker     (123)      127 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/space/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     1391 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/optimize/space/decimalspace.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.868543 freqtrade-2023.5/freqtrade/persistence/
--rw-r--r--   0 runner    (1001) docker     (123)      284 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/persistence/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)      154 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/persistence/base.py
--rw-r--r--   0 runner    (1001) docker     (123)     6441 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/persistence/key_value_store.py
--rw-r--r--   0 runner    (1001) docker     (123)    15663 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/persistence/migrations.py
--rw-r--r--   0 runner    (1001) docker     (123)     2926 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/persistence/models.py
--rw-r--r--   0 runner    (1001) docker     (123)     3103 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/persistence/pairlock.py
--rw-r--r--   0 runner    (1001) docker     (123)     6366 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/persistence/pairlock_middleware.py
--rw-r--r--   0 runner    (1001) docker     (123)    72288 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/persistence/trade_model.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.868543 freqtrade-2023.5/freqtrade/plot/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plot/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    26157 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plot/plotting.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.872542 freqtrade-2023.5/freqtrade/plugins/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.872542 freqtrade-2023.5/freqtrade/plugins/pairlist/
--rw-r--r--   0 runner    (1001) docker     (123)     5739 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/pairlist/AgeFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     7375 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/pairlist/IPairList.py
--rw-r--r--   0 runner    (1001) docker     (123)     2258 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/pairlist/OffsetFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     3259 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/pairlist/PerformanceFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     2957 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/pairlist/PrecisionFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     5426 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/pairlist/PriceFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     3180 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/pairlist/ProducerPairList.py
--rw-r--r--   0 runner    (1001) docker     (123)     8104 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/pairlist/RemotePairList.py
--rw-r--r--   0 runner    (1001) docker     (123)     2874 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/pairlist/ShuffleFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     2505 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/pairlist/SpreadFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     2369 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/pairlist/StaticPairList.py
--rw-r--r--   0 runner    (1001) docker     (123)     5005 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/pairlist/VolatilityFilter.py
--rw-r--r--   0 runner    (1001) docker     (123)    10935 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/pairlist/VolumePairList.py
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/pairlist/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2347 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/pairlist/pairlist_helpers.py
--rw-r--r--   0 runner    (1001) docker     (123)     5402 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/pairlist/rangestabilityfilter.py
--rw-r--r--   0 runner    (1001) docker     (123)     6881 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/pairlistmanager.py
--rw-r--r--   0 runner    (1001) docker     (123)     2872 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/protectionmanager.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.876543 freqtrade-2023.5/freqtrade/plugins/protections/
--rw-r--r--   0 runner    (1001) docker     (123)      105 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/protections/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2707 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/protections/cooldown_period.py
--rw-r--r--   0 runner    (1001) docker     (123)     4268 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/protections/iprotection.py
--rw-r--r--   0 runner    (1001) docker     (123)     3607 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/protections/low_profit_pairs.py
--rw-r--r--   0 runner    (1001) docker     (123)     3544 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/protections/max_drawdown_protection.py
--rw-r--r--   0 runner    (1001) docker     (123)     3691 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/plugins/protections/stoploss_guard.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.876543 freqtrade-2023.5/freqtrade/resolvers/
--rw-r--r--   0 runner    (1001) docker     (123)      512 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/resolvers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2618 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/resolvers/exchange_resolver.py
--rw-r--r--   0 runner    (1001) docker     (123)     1799 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/resolvers/freqaimodel_resolver.py
--rw-r--r--   0 runner    (1001) docker     (123)     1727 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/resolvers/hyperopt_resolver.py
--rw-r--r--   0 runner    (1001) docker     (123)    10493 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/resolvers/iresolver.py
--rw-r--r--   0 runner    (1001) docker     (123)     1794 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/resolvers/pairlist_resolver.py
--rw-r--r--   0 runner    (1001) docker     (123)     1377 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/resolvers/protection_resolver.py
--rw-r--r--   0 runner    (1001) docker     (123)    13615 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/resolvers/strategy_resolver.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.884543 freqtrade-2023.5/freqtrade/rpc/
--rw-r--r--   0 runner    (1001) docker     (123)      111 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.884543 freqtrade-2023.5/freqtrade/rpc/api_server/
--rw-r--r--   0 runner    (1001) docker     (123)       47 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     5388 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/api_auth.py
--rw-r--r--   0 runner    (1001) docker     (123)     9537 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/api_backtest.py
--rw-r--r--   0 runner    (1001) docker     (123)    10836 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/api_schemas.py
--rw-r--r--   0 runner    (1001) docker     (123)    14352 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/api_v1.py
--rw-r--r--   0 runner    (1001) docker     (123)     4200 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/api_ws.py
--rw-r--r--   0 runner    (1001) docker     (123)     1583 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/deps.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.884543 freqtrade-2023.5/freqtrade/rpc/api_server/ui/
--rw-r--r--   0 runner    (1001) docker     (123)      753 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/ui/fallback_file.html
--rw-r--r--   0 runner    (1001) docker     (123)   126794 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/ui/favicon.ico
--rw-r--r--   0 runner    (1001) docker     (123)     2100 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/uvicorn_threaded.py
--rw-r--r--   0 runner    (1001) docker     (123)     2163 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/web_ui.py
--rw-r--r--   0 runner    (1001) docker     (123)     7693 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/webserver.py
--rw-r--r--   0 runner    (1001) docker     (123)      342 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/webserver_bgwork.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.884543 freqtrade-2023.5/freqtrade/rpc/api_server/ws/
--rw-r--r--   0 runner    (1001) docker     (123)      419 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/ws/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     7570 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/ws/channel.py
--rw-r--r--   0 runner    (1001) docker     (123)      898 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/ws/message_stream.py
--rw-r--r--   0 runner    (1001) docker     (123)     2292 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/ws/proxy.py
--rw-r--r--   0 runner    (1001) docker     (123)     1678 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/ws/serializer.py
--rw-r--r--   0 runner    (1001) docker     (123)      257 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/ws/types.py
--rw-r--r--   0 runner    (1001) docker     (123)     1775 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/api_server/ws_schemas.py
--rw-r--r--   0 runner    (1001) docker     (123)     1944 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/discord.py
--rw-r--r--   0 runner    (1001) docker     (123)    14652 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/external_message_consumer.py
--rw-r--r--   0 runner    (1001) docker     (123)     7243 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/fiat_convert.py
--rw-r--r--   0 runner    (1001) docker     (123)    57320 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/rpc.py
--rw-r--r--   0 runner    (1001) docker     (123)     5294 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/rpc_manager.py
--rw-r--r--   0 runner    (1001) docker     (123)     3061 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/rpc_types.py
--rw-r--r--   0 runner    (1001) docker     (123)    79414 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/telegram.py
--rw-r--r--   0 runner    (1001) docker     (123)     4738 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/rpc/webhook.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.884543 freqtrade-2023.5/freqtrade/strategy/
--rw-r--r--   0 runner    (1001) docker     (123)      650 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/strategy/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     8240 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/strategy/hyper.py
--rw-r--r--   0 runner    (1001) docker     (123)     5671 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/strategy/informative_decorator.py
--rw-r--r--   0 runner    (1001) docker     (123)    65823 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/strategy/interface.py
--rw-r--r--   0 runner    (1001) docker     (123)    12586 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/strategy/parameters.py
--rw-r--r--   0 runner    (1001) docker     (123)     6781 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/strategy/strategy_helper.py
--rw-r--r--   0 runner    (1001) docker     (123)     1568 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/strategy/strategy_wrapper.py
--rw-r--r--   0 runner    (1001) docker     (123)     9774 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/strategy/strategyupdater.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.888543 freqtrade-2023.5/freqtrade/templates/
--rw-r--r--   0 runner    (1001) docker     (123)    12781 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/FreqaiExampleHybridStrategy.py
--rw-r--r--   0 runner    (1001) docker     (123)    12688 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/FreqaiExampleStrategy.py
--rw-r--r--   0 runner    (1001) docker     (123)     2167 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/base_config.json.j2
--rw-r--r--   0 runner    (1001) docker     (123)     6167 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/base_strategy.py.j2
--rw-r--r--   0 runner    (1001) docker     (123)     1917 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/sample_hyperopt_loss.py
--rw-r--r--   0 runner    (1001) docker     (123)    16719 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/sample_strategy.py
--rw-r--r--   0 runner    (1001) docker     (123)    14583 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/strategy_analysis_example.ipynb
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.892543 freqtrade-2023.5/freqtrade/templates/strategy_subtemplates/
--rw-r--r--   0 runner    (1001) docker     (123)      261 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/strategy_subtemplates/buy_trend_full.j2
--rw-r--r--   0 runner    (1001) docker     (123)      101 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/strategy_subtemplates/buy_trend_minimal.j2
--rw-r--r--   0 runner    (1001) docker     (123)     7747 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/strategy_subtemplates/indicators_full.j2
--rw-r--r--   0 runner    (1001) docker     (123)      464 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/strategy_subtemplates/indicators_minimal.j2
--rw-r--r--   0 runner    (1001) docker     (123)      506 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/strategy_subtemplates/plot_config_full.j2
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/strategy_subtemplates/plot_config_minimal.j2
--rw-r--r--   0 runner    (1001) docker     (123)      262 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/strategy_subtemplates/sell_trend_full.j2
--rw-r--r--   0 runner    (1001) docker     (123)      103 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/strategy_subtemplates/sell_trend_minimal.j2
--rw-r--r--   0 runner    (1001) docker     (123)    15312 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/strategy_subtemplates/strategy_methods_advanced.j2
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/strategy_subtemplates/strategy_methods_empty.j2
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.892543 freqtrade-2023.5/freqtrade/templates/subtemplates/
--rw-r--r--   0 runner    (1001) docker     (123)      261 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/subtemplates/exchange_binance.j2
--rw-r--r--   0 runner    (1001) docker     (123)      483 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/subtemplates/exchange_bittrex.j2
--rw-r--r--   0 runner    (1001) docker     (123)      271 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/subtemplates/exchange_gateio.j2
--rw-r--r--   0 runner    (1001) docker     (123)      244 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/subtemplates/exchange_generic.j2
--rw-r--r--   0 runner    (1001) docker     (123)      260 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/subtemplates/exchange_huobi.j2
--rw-r--r--   0 runner    (1001) docker     (123)      413 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/subtemplates/exchange_kraken.j2
--rw-r--r--   0 runner    (1001) docker     (123)      291 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/subtemplates/exchange_kucoin.j2
--rw-r--r--   0 runner    (1001) docker     (123)      291 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/templates/subtemplates/exchange_okex.j2
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.892543 freqtrade-2023.5/freqtrade/util/
--rw-r--r--   0 runner    (1001) docker     (123)      442 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/util/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2718 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/util/binance_mig.py
--rw-r--r--   0 runner    (1001) docker     (123)     1846 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/util/datetime_helpers.py
--rw-r--r--   0 runner    (1001) docker     (123)      337 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/util/ft_precise.py
--rw-r--r--   0 runner    (1001) docker     (123)      458 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/util/gc_setup.py
--rw-r--r--   0 runner    (1001) docker     (123)      580 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/util/periodic_cache.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.892543 freqtrade-2023.5/freqtrade/vendor/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/vendor/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.892543 freqtrade-2023.5/freqtrade/vendor/qtpylib/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/vendor/qtpylib/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    19870 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/vendor/qtpylib/indicators.py
--rw-r--r--   0 runner    (1001) docker     (123)    14830 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/wallets.py
--rw-r--r--   0 runner    (1001) docker     (123)     8487 2023-05-28 18:36:04.000000 freqtrade-2023.5/freqtrade/worker.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.832542 freqtrade-2023.5/freqtrade.egg-info/
--rw-r--r--   0 runner    (1001) docker     (123)    12539 2023-05-28 18:36:08.000000 freqtrade-2023.5/freqtrade.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (123)    13938 2023-05-28 18:36:08.000000 freqtrade-2023.5/freqtrade.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-05-28 18:36:08.000000 freqtrade-2023.5/freqtrade.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (123)       50 2023-05-28 18:36:08.000000 freqtrade-2023.5/freqtrade.egg-info/entry_points.txt
--rw-r--r--   0 runner    (1001) docker     (123)        1 2023-05-28 18:36:08.000000 freqtrade-2023.5/freqtrade.egg-info/not-zip-safe
--rw-r--r--   0 runner    (1001) docker     (123)     1697 2023-05-28 18:36:08.000000 freqtrade-2023.5/freqtrade.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (123)       16 2023-05-28 18:36:08.000000 freqtrade-2023.5/freqtrade.egg-info/top_level.txt
--rw-r--r--   0 runner    (1001) docker     (123)     1727 2023-05-28 18:36:04.000000 freqtrade-2023.5/pyproject.toml
--rw-r--r--   0 runner    (1001) docker     (123)     1227 2023-05-28 18:36:08.912543 freqtrade-2023.5/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (123)     2291 2023-05-28 18:36:04.000000 freqtrade-2023.5/setup.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.896543 freqtrade-2023.5/tests/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.900543 freqtrade-2023.5/tests/commands/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/commands/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     4444 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/commands/test_build_config.py
--rw-r--r--   0 runner    (1001) docker     (123)    52582 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/commands/test_commands.py
--rw-r--r--   0 runner    (1001) docker     (123)   124669 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/conftest.py
--rw-r--r--   0 runner    (1001) docker     (123)    14607 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/conftest_trades.py
--rw-r--r--   0 runner    (1001) docker     (123)    10612 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/conftest_trades_usdt.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.900543 freqtrade-2023.5/tests/data/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/data/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    19274 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/data/test_btanalysis.py
--rw-r--r--   0 runner    (1001) docker     (123)    12997 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/data/test_converter.py
--rw-r--r--   0 runner    (1001) docker     (123)    21704 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/data/test_datahandler.py
--rw-r--r--   0 runner    (1001) docker     (123)    19077 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/data/test_dataprovider.py
--rw-r--r--   0 runner    (1001) docker     (123)     8496 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/data/test_entryexitanalysis.py
--rw-r--r--   0 runner    (1001) docker     (123)    26738 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/data/test_history.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.904543 freqtrade-2023.5/tests/edge/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/edge/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    20687 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/edge/test_edge.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.904543 freqtrade-2023.5/tests/exchange/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/exchange/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    21890 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/exchange/test_binance.py
--rw-r--r--   0 runner    (1001) docker     (123)     2717 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/exchange/test_bitpanda.py
--rw-r--r--   0 runner    (1001) docker     (123)     3199 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/exchange/test_bybit.py
--rw-r--r--   0 runner    (1001) docker     (123)    30479 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/exchange/test_ccxt_compat.py
--rw-r--r--   0 runner    (1001) docker     (123)   221081 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/exchange/test_exchange.py
--rw-r--r--   0 runner    (1001) docker     (123)     3556 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/exchange/test_exchange_utils.py
--rw-r--r--   0 runner    (1001) docker     (123)     3959 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/exchange/test_gate.py
--rw-r--r--   0 runner    (1001) docker     (123)     4979 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/exchange/test_huobi.py
--rw-r--r--   0 runner    (1001) docker     (123)    10785 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/exchange/test_kraken.py
--rw-r--r--   0 runner    (1001) docker     (123)     6641 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/exchange/test_kucoin.py
--rw-r--r--   0 runner    (1001) docker     (123)    22177 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/exchange/test_okx.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.904543 freqtrade-2023.5/tests/optimize/
--rw-r--r--   0 runner    (1001) docker     (123)     2276 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/optimize/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2073 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/optimize/conftest.py
--rw-r--r--   0 runner    (1001) docker     (123)    43247 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/optimize/test_backtest_detail.py
--rw-r--r--   0 runner    (1001) docker     (123)    82511 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/optimize/test_backtesting.py
--rw-r--r--   0 runner    (1001) docker     (123)     7655 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/optimize/test_backtesting_adjust_position.py
--rw-r--r--   0 runner    (1001) docker     (123)     4236 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/optimize/test_edge_cli.py
--rw-r--r--   0 runner    (1001) docker     (123)    44215 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/optimize/test_hyperopt.py
--rw-r--r--   0 runner    (1001) docker     (123)    12797 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/optimize/test_hyperopt_tools.py
--rw-r--r--   0 runner    (1001) docker     (123)     5541 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/optimize/test_hyperoptloss.py
--rw-r--r--   0 runner    (1001) docker     (123)    20838 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/optimize/test_optimize_reports.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.908543 freqtrade-2023.5/tests/persistence/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/persistence/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2942 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/persistence/test_key_value_store.py
--rw-r--r--   0 runner    (1001) docker     (123)    16218 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/persistence/test_migrations.py
--rw-r--r--   0 runner    (1001) docker     (123)    99825 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/persistence/test_persistence.py
--rw-r--r--   0 runner    (1001) docker     (123)     6514 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/persistence/test_trade_fromjson.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.908543 freqtrade-2023.5/tests/plugins/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/plugins/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)    65213 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/plugins/test_pairlist.py
--rw-r--r--   0 runner    (1001) docker     (123)     5604 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/plugins/test_pairlocks.py
--rw-r--r--   0 runner    (1001) docker     (123)    19094 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/plugins/test_protections.py
--rw-r--r--   0 runner    (1001) docker     (123)     6300 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/plugins/test_remotepairlist.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.908543 freqtrade-2023.5/tests/rpc/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/rpc/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     7356 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/rpc/test_fiat_convert.py
--rw-r--r--   0 runner    (1001) docker     (123)    44020 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/rpc/test_rpc.py
--rw-r--r--   0 runner    (1001) docker     (123)    71301 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/rpc/test_rpc_apiserver.py
--rw-r--r--   0 runner    (1001) docker     (123)    14480 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/rpc/test_rpc_emc.py
--rw-r--r--   0 runner    (1001) docker     (123)     9666 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/rpc/test_rpc_manager.py
--rw-r--r--   0 runner    (1001) docker     (123)    94365 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/rpc/test_rpc_telegram.py
--rw-r--r--   0 runner    (1001) docker     (123)    17192 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/rpc/test_rpc_webhook.py
-drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:08.912543 freqtrade-2023.5/tests/strategy/
--rw-r--r--   0 runner    (1001) docker     (123)        0 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/strategy/__init__.py
--rw-r--r--   0 runner    (1001) docker     (123)     2230 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/strategy/test_default_strategy.py
--rw-r--r--   0 runner    (1001) docker     (123)    40824 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/strategy/test_interface.py
--rw-r--r--   0 runner    (1001) docker     (123)    13011 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/strategy/test_strategy_helpers.py
--rw-r--r--   0 runner    (1001) docker     (123)    18658 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/strategy/test_strategy_loading.py
--rw-r--r--   0 runner    (1001) docker     (123)     9004 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/test_arguments.py
--rw-r--r--   0 runner    (1001) docker     (123)     1761 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/test_binance_mig.py
--rw-r--r--   0 runner    (1001) docker     (123)    58618 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/test_configuration.py
--rw-r--r--   0 runner    (1001) docker     (123)     4395 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/test_directory_operations.py
--rw-r--r--   0 runner    (1001) docker     (123)   235594 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/test_freqtradebot.py
--rw-r--r--   0 runner    (1001) docker     (123)      880 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/test_indicators.py
--rw-r--r--   0 runner    (1001) docker     (123)    20485 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/test_integration.py
--rw-r--r--   0 runner    (1001) docker     (123)     8293 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/test_main.py
--rw-r--r--   0 runner    (1001) docker     (123)     9552 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/test_misc.py
--rw-r--r--   0 runner    (1001) docker     (123)    19996 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/test_plotting.py
--rw-r--r--   0 runner    (1001) docker     (123)     6787 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/test_strategy_updater.py
--rw-r--r--   0 runner    (1001) docker     (123)      414 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/test_talib.py
--rw-r--r--   0 runner    (1001) docker     (123)     3539 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/test_timerange.py
--rw-r--r--   0 runner    (1001) docker     (123)    15063 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/test_wallets.py
--rw-r--r--   0 runner    (1001) docker     (123)     6719 2023-05-28 18:36:04.000000 freqtrade-2023.5/tests/test_worker.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.383418 freqtrade-2023.5.1/
+-rw-r--r--   0 runner    (1001) docker     (123)    35141 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (123)      277 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/MANIFEST.in
+-rw-r--r--   0 runner    (1001) docker     (123)    12541 2023-06-08 20:46:37.383418 freqtrade-2023.5.1/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)    11477 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/README.md
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.327417 freqtrade-2023.5.1/freqtrade/
+-rw-r--r--   0 runner    (1001) docker     (123)      812 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/__init__.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)      206 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/__main__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.331417 freqtrade-2023.5.1/freqtrade/commands/
+-rw-r--r--   0 runner    (1001) docker     (123)     1741 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2171 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/analyze_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21033 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/arguments.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8813 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/build_config_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)    22324 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/cli_options.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9009 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/data_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1672 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/db_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6530 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/deploy_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3634 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/hyperopt_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9277 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/list_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4513 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/optimize_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1360 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/pairlist_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1162 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/plot_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1852 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/strategy_utils_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)      936 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/trade_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)      416 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/commands/webserver_commands.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.331417 freqtrade-2023.5.1/freqtrade/configuration/
+-rw-r--r--   0 runner    (1001) docker     (123)      299 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/configuration/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      723 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/configuration/config_setup.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17385 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/configuration/config_validation.py
+-rw-r--r--   0 runner    (1001) docker     (123)    24880 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/configuration/configuration.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7035 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/configuration/deprecated_settings.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3592 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/configuration/directory_operations.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1814 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/configuration/environment_vars.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3851 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/configuration/load_config.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6263 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/configuration/timerange.py
+-rw-r--r--   0 runner    (1001) docker     (123)    29286 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/constants.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.331417 freqtrade-2023.5.1/freqtrade/data/
+-rw-r--r--   0 runner    (1001) docker     (123)      152 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    16153 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/btanalysis.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13517 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/converter.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21145 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/dataprovider.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12843 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/entryexitanalysis.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.335417 freqtrade-2023.5.1/freqtrade/data/history/
+-rw-r--r--   0 runner    (1001) docker     (123)      465 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/history/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4903 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/history/featherdatahandler.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6094 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/history/hdf5datahandler.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21512 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/history/history_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17490 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/history/idatahandler.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5580 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/history/jsondatahandler.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4798 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/history/parquetdatahandler.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12466 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/data/metrics.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.335417 freqtrade-2023.5.1/freqtrade/edge/
+-rw-r--r--   0 runner    (1001) docker     (123)       59 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/edge/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20869 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/edge/edge_positioning.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.335417 freqtrade-2023.5.1/freqtrade/enums/
+-rw-r--r--   0 runner    (1001) docker     (123)      861 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      238 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/backteststate.py
+-rw-r--r--   0 runner    (1001) docker     (123)      798 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/candletype.py
+-rw-r--r--   0 runner    (1001) docker     (123)      640 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/exitchecktuple.py
+-rw-r--r--   0 runner    (1001) docker     (123)      619 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/exittype.py
+-rw-r--r--   0 runner    (1001) docker     (123)      210 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/hyperoptstate.py
+-rw-r--r--   0 runner    (1001) docker     (123)      237 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/marginmode.py
+-rw-r--r--   0 runner    (1001) docker     (123)      261 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/marketstatetype.py
+-rw-r--r--   0 runner    (1001) docker     (123)      100 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/ordertypevalue.py
+-rw-r--r--   0 runner    (1001) docker     (123)      177 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/pricetype.py
+-rw-r--r--   0 runner    (1001) docker     (123)      976 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/rpcmessagetype.py
+-rw-r--r--   0 runner    (1001) docker     (123)      592 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/runmode.py
+-rw-r--r--   0 runner    (1001) docker     (123)      626 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/signaltype.py
+-rw-r--r--   0 runner    (1001) docker     (123)      202 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/state.py
+-rw-r--r--   0 runner    (1001) docker     (123)      220 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/enums/tradingmode.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2068 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exceptions.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.339417 freqtrade-2023.5.1/freqtrade/exchange/
+-rw-r--r--   0 runner    (1001) docker     (123)     1540 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9455 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/binance.py
+-rw-r--r--   0 runner    (1001) docker     (123)   632547 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/binance_leverage_tiers.json
+-rw-r--r--   0 runner    (1001) docker     (123)     1621 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/bitpanda.py
+-rw-r--r--   0 runner    (1001) docker     (123)      517 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/bittrex.py
+-rw-r--r--   0 runner    (1001) docker     (123)      547 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/bitvavo.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8304 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/bybit.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2975 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/check_exchange.py
+-rw-r--r--   0 runner    (1001) docker     (123)      564 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/coinbasepro.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6112 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/common.py
+-rw-r--r--   0 runner    (1001) docker     (123)   131881 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/exchange.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10553 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/exchange_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5035 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/gate.py
+-rw-r--r--   0 runner    (1001) docker     (123)      517 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/hitbtc.py
+-rw-r--r--   0 runner    (1001) docker     (123)      827 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/huobi.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9717 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/kraken.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2120 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/kucoin.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8695 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/okx.py
+-rw-r--r--   0 runner    (1001) docker     (123)      725 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/exchange/types.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.339417 freqtrade-2023.5.1/freqtrade/freqai/
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.343417 freqtrade-2023.5.1/freqtrade/freqai/RL/
+-rw-r--r--   0 runner    (1001) docker     (123)     4496 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/RL/Base3ActionRLEnv.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5021 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/RL/Base4ActionRLEnv.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5644 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/RL/Base5ActionRLEnv.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15138 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/RL/BaseEnvironment.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20053 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/RL/BaseReinforcementLearningModel.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/RL/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.343417 freqtrade-2023.5.1/freqtrade/freqai/base_models/
+-rw-r--r--   0 runner    (1001) docker     (123)     4320 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/base_models/BaseClassifierModel.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5700 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/base_models/BasePyTorchClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2985 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/base_models/BasePyTorchModel.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1768 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/base_models/BasePyTorchRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4054 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/base_models/BaseRegressionModel.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2572 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/base_models/BaseTensorFlowModel.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3466 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/base_models/FreqaiMultiOutputClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2502 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/base_models/FreqaiMultiOutputRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)    30241 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/data_drawer.py
+-rw-r--r--   0 runner    (1001) docker     (123)    65930 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/data_kitchen.py
+-rw-r--r--   0 runner    (1001) docker     (123)    44639 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/freqai_interface.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.347417 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/
+-rw-r--r--   0 runner    (1001) docker     (123)     2083 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/CatboostClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2866 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/CatboostClassifierMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2048 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/CatboostRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2834 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/CatboostRegressorMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1920 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/LightGBMClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2698 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/LightGBMClassifierMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1837 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/LightGBMRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2692 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/LightGBMRegressorMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3634 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/PyTorchMLPClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3320 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/PyTorchMLPRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5635 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/PyTorchTransformerRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6732 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/ReinforcementLearner.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2981 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/ReinforcementLearner_multiproc.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3338 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3345 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostRFClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1844 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostRFRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2104 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2596 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostRegressorMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/prediction_models/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.347417 freqtrade-2023.5.1/freqtrade/freqai/tensorboard/
+-rw-r--r--   0 runner    (1001) docker     (123)     2166 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/tensorboard/TensorboardCallback.py
+-rw-r--r--   0 runner    (1001) docker     (123)      587 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/tensorboard/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      690 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/tensorboard/base_tensorboard.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1926 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/tensorboard/tensorboard.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.347417 freqtrade-2023.5.1/freqtrade/freqai/torch/
+-rw-r--r--   0 runner    (1001) docker     (123)     2028 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchDataConvertor.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3762 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchMLPModel.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8903 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchModelTrainer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2026 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchTrainerInterface.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3613 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchTransformerModel.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/torch/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      666 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/torch/datasets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7382 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqai/utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)    95442 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/freqtradebot.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.347417 freqtrade-2023.5.1/freqtrade/leverage/
+-rw-r--r--   0 runner    (1001) docker     (123)       63 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/leverage/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1257 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/leverage/interest.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.347417 freqtrade-2023.5.1/freqtrade/loggers/
+-rw-r--r--   0 runner    (1001) docker     (123)     4942 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/loggers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      460 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/loggers/buffering_handler.py
+-rw-r--r--   0 runner    (1001) docker     (123)      714 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/loggers/std_err_stream_handler.py
+-rwxr-xr-x   0 runner    (1001) docker     (123)     2094 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/main.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9450 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/misc.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.347417 freqtrade-2023.5.1/freqtrade/mixins/
+-rw-r--r--   0 runner    (1001) docker     (123)       70 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/mixins/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1265 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/mixins/logging_mixin.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.351417 freqtrade-2023.5.1/freqtrade/optimize/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1519 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/backtest_caching.py
+-rw-r--r--   0 runner    (1001) docker     (123)    64916 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/backtesting.py
+-rw-r--r--   0 runner    (1001) docker     (123)      856 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/bt_progress.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1823 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/edge_cli.py
+-rw-r--r--   0 runner    (1001) docker     (123)    28627 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3676 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_auto.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4525 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_epoch_filters.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8554 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_interface.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.351417 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/
+-rw-r--r--   0 runner    (1001) docker     (123)     1102 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_calmar.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1237 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1470 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown_relative.py
+-rw-r--r--   0 runner    (1001) docker     (123)      746 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_onlyprofit.py
+-rw-r--r--   0 runner    (1001) docker     (123)      931 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_profit_drawdown.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1095 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2108 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe_daily.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1965 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_short_trade_dur.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1109 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2566 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino_daily.py
+-rw-r--r--   0 runner    (1001) docker     (123)      951 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss_interface.py
+-rw-r--r--   0 runner    (1001) docker     (123)    23094 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/hyperopt_tools.py
+-rw-r--r--   0 runner    (1001) docker     (123)    45232 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/optimize_reports.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.351417 freqtrade-2023.5.1/freqtrade/optimize/space/
+-rw-r--r--   0 runner    (1001) docker     (123)      127 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/space/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1391 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/optimize/space/decimalspace.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.351417 freqtrade-2023.5.1/freqtrade/persistence/
+-rw-r--r--   0 runner    (1001) docker     (123)      284 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/persistence/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)      154 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/persistence/base.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6441 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/persistence/key_value_store.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15663 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/persistence/migrations.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2926 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/persistence/models.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3103 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/persistence/pairlock.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6366 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/persistence/pairlock_middleware.py
+-rw-r--r--   0 runner    (1001) docker     (123)    72288 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/persistence/trade_model.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.351417 freqtrade-2023.5.1/freqtrade/plot/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plot/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    26157 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plot/plotting.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.351417 freqtrade-2023.5.1/freqtrade/plugins/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.355417 freqtrade-2023.5.1/freqtrade/plugins/pairlist/
+-rw-r--r--   0 runner    (1001) docker     (123)     5739 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/AgeFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7375 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/IPairList.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2258 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/OffsetFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3259 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/PerformanceFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2957 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/PrecisionFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5426 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/PriceFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3180 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/ProducerPairList.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8104 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/RemotePairList.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2874 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/ShuffleFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2505 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/SpreadFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2369 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/StaticPairList.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5005 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/VolatilityFilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10935 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/VolumePairList.py
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2347 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/pairlist_helpers.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5402 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlist/rangestabilityfilter.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6881 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/pairlistmanager.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2872 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/protectionmanager.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.355417 freqtrade-2023.5.1/freqtrade/plugins/protections/
+-rw-r--r--   0 runner    (1001) docker     (123)      105 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/protections/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2707 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/protections/cooldown_period.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4268 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/protections/iprotection.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3607 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/protections/low_profit_pairs.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3544 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/protections/max_drawdown_protection.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3691 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/plugins/protections/stoploss_guard.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.359418 freqtrade-2023.5.1/freqtrade/resolvers/
+-rw-r--r--   0 runner    (1001) docker     (123)      512 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/resolvers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2618 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/resolvers/exchange_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1799 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/resolvers/freqaimodel_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1727 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/resolvers/hyperopt_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10493 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/resolvers/iresolver.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1794 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/resolvers/pairlist_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1377 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/resolvers/protection_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13615 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/resolvers/strategy_resolver.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.359418 freqtrade-2023.5.1/freqtrade/rpc/
+-rw-r--r--   0 runner    (1001) docker     (123)      111 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.359418 freqtrade-2023.5.1/freqtrade/rpc/api_server/
+-rw-r--r--   0 runner    (1001) docker     (123)       47 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5388 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/api_auth.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9537 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/api_backtest.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10836 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/api_schemas.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14352 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/api_v1.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4200 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/api_ws.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1583 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/deps.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.359418 freqtrade-2023.5.1/freqtrade/rpc/api_server/ui/
+-rw-r--r--   0 runner    (1001) docker     (123)      753 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/ui/fallback_file.html
+-rw-r--r--   0 runner    (1001) docker     (123)   126794 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/ui/favicon.ico
+-rw-r--r--   0 runner    (1001) docker     (123)     2100 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/uvicorn_threaded.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2163 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/web_ui.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7693 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/webserver.py
+-rw-r--r--   0 runner    (1001) docker     (123)      342 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/webserver_bgwork.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.363417 freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/
+-rw-r--r--   0 runner    (1001) docker     (123)      419 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7570 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/channel.py
+-rw-r--r--   0 runner    (1001) docker     (123)      898 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/message_stream.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2292 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/proxy.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1678 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/serializer.py
+-rw-r--r--   0 runner    (1001) docker     (123)      257 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/types.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1775 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/api_server/ws_schemas.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1944 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/discord.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14652 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/external_message_consumer.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7243 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/fiat_convert.py
+-rw-r--r--   0 runner    (1001) docker     (123)    57320 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/rpc.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5294 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/rpc_manager.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3061 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/rpc_types.py
+-rw-r--r--   0 runner    (1001) docker     (123)    79414 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/telegram.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4738 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/rpc/webhook.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.363417 freqtrade-2023.5.1/freqtrade/strategy/
+-rw-r--r--   0 runner    (1001) docker     (123)      650 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/strategy/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8240 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/strategy/hyper.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5671 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/strategy/informative_decorator.py
+-rw-r--r--   0 runner    (1001) docker     (123)    65823 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/strategy/interface.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12586 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/strategy/parameters.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6781 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/strategy/strategy_helper.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1568 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/strategy/strategy_wrapper.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9774 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/strategy/strategyupdater.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.363417 freqtrade-2023.5.1/freqtrade/templates/
+-rw-r--r--   0 runner    (1001) docker     (123)    12781 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/FreqaiExampleHybridStrategy.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12688 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/FreqaiExampleStrategy.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2167 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/base_config.json.j2
+-rw-r--r--   0 runner    (1001) docker     (123)     6167 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/base_strategy.py.j2
+-rw-r--r--   0 runner    (1001) docker     (123)     1917 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/sample_hyperopt_loss.py
+-rw-r--r--   0 runner    (1001) docker     (123)    16719 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/sample_strategy.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14583 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_analysis_example.ipynb
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.367418 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/
+-rw-r--r--   0 runner    (1001) docker     (123)      261 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/buy_trend_full.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      101 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/buy_trend_minimal.j2
+-rw-r--r--   0 runner    (1001) docker     (123)     7747 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/indicators_full.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      464 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/indicators_minimal.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      506 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/plot_config_full.j2
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/plot_config_minimal.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      262 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/sell_trend_full.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      103 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/sell_trend_minimal.j2
+-rw-r--r--   0 runner    (1001) docker     (123)    15312 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/strategy_methods_advanced.j2
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/strategy_methods_empty.j2
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.367418 freqtrade-2023.5.1/freqtrade/templates/subtemplates/
+-rw-r--r--   0 runner    (1001) docker     (123)      261 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/subtemplates/exchange_binance.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      483 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/subtemplates/exchange_bittrex.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      271 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/subtemplates/exchange_gateio.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      244 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/subtemplates/exchange_generic.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      260 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/subtemplates/exchange_huobi.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      413 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/subtemplates/exchange_kraken.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      291 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/subtemplates/exchange_kucoin.j2
+-rw-r--r--   0 runner    (1001) docker     (123)      291 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/templates/subtemplates/exchange_okex.j2
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.367418 freqtrade-2023.5.1/freqtrade/util/
+-rw-r--r--   0 runner    (1001) docker     (123)      442 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/util/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2718 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/util/binance_mig.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1846 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/util/datetime_helpers.py
+-rw-r--r--   0 runner    (1001) docker     (123)      337 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/util/ft_precise.py
+-rw-r--r--   0 runner    (1001) docker     (123)      458 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/util/gc_setup.py
+-rw-r--r--   0 runner    (1001) docker     (123)      580 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/util/periodic_cache.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.367418 freqtrade-2023.5.1/freqtrade/vendor/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/vendor/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.367418 freqtrade-2023.5.1/freqtrade/vendor/qtpylib/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/vendor/qtpylib/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19870 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/vendor/qtpylib/indicators.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14830 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/wallets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8487 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/freqtrade/worker.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.327417 freqtrade-2023.5.1/freqtrade.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (123)    12541 2023-06-08 20:46:37.000000 freqtrade-2023.5.1/freqtrade.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (123)    13938 2023-06-08 20:46:37.000000 freqtrade-2023.5.1/freqtrade.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-06-08 20:46:37.000000 freqtrade-2023.5.1/freqtrade.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (123)       50 2023-06-08 20:46:37.000000 freqtrade-2023.5.1/freqtrade.egg-info/entry_points.txt
+-rw-r--r--   0 runner    (1001) docker     (123)        1 2023-06-08 20:46:37.000000 freqtrade-2023.5.1/freqtrade.egg-info/not-zip-safe
+-rw-r--r--   0 runner    (1001) docker     (123)     1697 2023-06-08 20:46:37.000000 freqtrade-2023.5.1/freqtrade.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (123)       16 2023-06-08 20:46:37.000000 freqtrade-2023.5.1/freqtrade.egg-info/top_level.txt
+-rw-r--r--   0 runner    (1001) docker     (123)     1727 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/pyproject.toml
+-rw-r--r--   0 runner    (1001) docker     (123)     1227 2023-06-08 20:46:37.383418 freqtrade-2023.5.1/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (123)     2291 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.375418 freqtrade-2023.5.1/tests/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.375418 freqtrade-2023.5.1/tests/commands/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/commands/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4444 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/commands/test_build_config.py
+-rw-r--r--   0 runner    (1001) docker     (123)    52582 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/commands/test_commands.py
+-rw-r--r--   0 runner    (1001) docker     (123)   124669 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/conftest.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14607 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/conftest_trades.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10612 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/conftest_trades_usdt.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.375418 freqtrade-2023.5.1/tests/data/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/data/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19274 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/data/test_btanalysis.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12997 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/data/test_converter.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21704 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/data/test_datahandler.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19077 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/data/test_dataprovider.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8496 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/data/test_entryexitanalysis.py
+-rw-r--r--   0 runner    (1001) docker     (123)    26738 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/data/test_history.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.375418 freqtrade-2023.5.1/tests/edge/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/edge/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20687 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/edge/test_edge.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.379418 freqtrade-2023.5.1/tests/exchange/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    21890 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_binance.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2717 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_bitpanda.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3199 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_bybit.py
+-rw-r--r--   0 runner    (1001) docker     (123)    30479 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_ccxt_compat.py
+-rw-r--r--   0 runner    (1001) docker     (123)   221394 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_exchange.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3556 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_exchange_utils.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3959 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_gate.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4979 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_huobi.py
+-rw-r--r--   0 runner    (1001) docker     (123)    10785 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_kraken.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6641 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_kucoin.py
+-rw-r--r--   0 runner    (1001) docker     (123)    22177 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/exchange/test_okx.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.379418 freqtrade-2023.5.1/tests/optimize/
+-rw-r--r--   0 runner    (1001) docker     (123)     2276 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2073 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/conftest.py
+-rw-r--r--   0 runner    (1001) docker     (123)    43247 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/test_backtest_detail.py
+-rw-r--r--   0 runner    (1001) docker     (123)    82511 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/test_backtesting.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7655 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/test_backtesting_adjust_position.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4236 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/test_edge_cli.py
+-rw-r--r--   0 runner    (1001) docker     (123)    44215 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/test_hyperopt.py
+-rw-r--r--   0 runner    (1001) docker     (123)    12797 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/test_hyperopt_tools.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5541 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/test_hyperoptloss.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20838 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/optimize/test_optimize_reports.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.379418 freqtrade-2023.5.1/tests/persistence/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/persistence/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2942 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/persistence/test_key_value_store.py
+-rw-r--r--   0 runner    (1001) docker     (123)    16218 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/persistence/test_migrations.py
+-rw-r--r--   0 runner    (1001) docker     (123)    99825 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/persistence/test_persistence.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6514 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/persistence/test_trade_fromjson.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.383418 freqtrade-2023.5.1/tests/plugins/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/plugins/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)    65213 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/plugins/test_pairlist.py
+-rw-r--r--   0 runner    (1001) docker     (123)     5604 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/plugins/test_pairlocks.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19094 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/plugins/test_protections.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6300 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/plugins/test_remotepairlist.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.383418 freqtrade-2023.5.1/tests/rpc/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/rpc/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     7356 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/rpc/test_fiat_convert.py
+-rw-r--r--   0 runner    (1001) docker     (123)    44020 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/rpc/test_rpc.py
+-rw-r--r--   0 runner    (1001) docker     (123)    71301 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/rpc/test_rpc_apiserver.py
+-rw-r--r--   0 runner    (1001) docker     (123)    14480 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/rpc/test_rpc_emc.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9666 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/rpc/test_rpc_manager.py
+-rw-r--r--   0 runner    (1001) docker     (123)    94365 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/rpc/test_rpc_telegram.py
+-rw-r--r--   0 runner    (1001) docker     (123)    17192 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/rpc/test_rpc_webhook.py
+drwxr-xr-x   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:37.383418 freqtrade-2023.5.1/tests/strategy/
+-rw-r--r--   0 runner    (1001) docker     (123)        0 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/strategy/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (123)     2230 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/strategy/test_default_strategy.py
+-rw-r--r--   0 runner    (1001) docker     (123)    40824 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/strategy/test_interface.py
+-rw-r--r--   0 runner    (1001) docker     (123)    13011 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/strategy/test_strategy_helpers.py
+-rw-r--r--   0 runner    (1001) docker     (123)    18658 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/strategy/test_strategy_loading.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9004 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_arguments.py
+-rw-r--r--   0 runner    (1001) docker     (123)     1761 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_binance_mig.py
+-rw-r--r--   0 runner    (1001) docker     (123)    58618 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_configuration.py
+-rw-r--r--   0 runner    (1001) docker     (123)     4395 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_directory_operations.py
+-rw-r--r--   0 runner    (1001) docker     (123)   235594 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_freqtradebot.py
+-rw-r--r--   0 runner    (1001) docker     (123)      880 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_indicators.py
+-rw-r--r--   0 runner    (1001) docker     (123)    20485 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_integration.py
+-rw-r--r--   0 runner    (1001) docker     (123)     8293 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_main.py
+-rw-r--r--   0 runner    (1001) docker     (123)     9552 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_misc.py
+-rw-r--r--   0 runner    (1001) docker     (123)    19996 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_plotting.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6787 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_strategy_updater.py
+-rw-r--r--   0 runner    (1001) docker     (123)      414 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_talib.py
+-rw-r--r--   0 runner    (1001) docker     (123)     3539 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_timerange.py
+-rw-r--r--   0 runner    (1001) docker     (123)    15063 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_wallets.py
+-rw-r--r--   0 runner    (1001) docker     (123)     6719 2023-06-08 20:46:33.000000 freqtrade-2023.5.1/tests/test_worker.py
```

### Comparing `freqtrade-2023.5/LICENSE` & `freqtrade-2023.5.1/LICENSE`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/PKG-INFO` & `freqtrade-2023.5.1/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: freqtrade
-Version: 2023.5
+Version: 2023.5.1
 Summary: Freqtrade - Crypto Trading Bot
 Home-page: https://github.com/freqtrade/freqtrade
 Author: Freqtrade Team
 Author-email: freqtrade@protonmail.com
 License: GPLv3
 Project-URL: Bug Tracker, https://github.com/freqtrade/freqtrade/issues
 Classifier: Environment :: Console
```

### Comparing `freqtrade-2023.5/README.md` & `freqtrade-2023.5.1/README.md`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/__init__.py` & `freqtrade-2023.5.1/freqtrade/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 """ Freqtrade bot """
-__version__ = '2023.5'
+__version__ = '2023.5.1'
 
 if 'dev' in __version__:
     from pathlib import Path
     try:
         import subprocess
         freqtrade_basedir = Path(__file__).parent
```

### Comparing `freqtrade-2023.5/freqtrade/commands/__init__.py` & `freqtrade-2023.5.1/freqtrade/commands/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/commands/analyze_commands.py` & `freqtrade-2023.5.1/freqtrade/commands/analyze_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/commands/arguments.py` & `freqtrade-2023.5.1/freqtrade/commands/arguments.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/commands/build_config_commands.py` & `freqtrade-2023.5.1/freqtrade/commands/build_config_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/commands/cli_options.py` & `freqtrade-2023.5.1/freqtrade/commands/cli_options.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/commands/data_commands.py` & `freqtrade-2023.5.1/freqtrade/commands/data_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/commands/db_commands.py` & `freqtrade-2023.5.1/freqtrade/commands/db_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/commands/deploy_commands.py` & `freqtrade-2023.5.1/freqtrade/commands/deploy_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/commands/hyperopt_commands.py` & `freqtrade-2023.5.1/freqtrade/commands/hyperopt_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/commands/list_commands.py` & `freqtrade-2023.5.1/freqtrade/commands/list_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/commands/optimize_commands.py` & `freqtrade-2023.5.1/freqtrade/commands/optimize_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/commands/pairlist_commands.py` & `freqtrade-2023.5.1/freqtrade/commands/pairlist_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/commands/plot_commands.py` & `freqtrade-2023.5.1/freqtrade/commands/plot_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/commands/strategy_utils_commands.py` & `freqtrade-2023.5.1/freqtrade/commands/strategy_utils_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/commands/trade_commands.py` & `freqtrade-2023.5.1/freqtrade/commands/trade_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/configuration/config_setup.py` & `freqtrade-2023.5.1/freqtrade/configuration/config_setup.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/configuration/config_validation.py` & `freqtrade-2023.5.1/freqtrade/configuration/config_validation.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/configuration/configuration.py` & `freqtrade-2023.5.1/freqtrade/configuration/configuration.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/configuration/deprecated_settings.py` & `freqtrade-2023.5.1/freqtrade/configuration/deprecated_settings.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/configuration/directory_operations.py` & `freqtrade-2023.5.1/freqtrade/configuration/directory_operations.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/configuration/environment_vars.py` & `freqtrade-2023.5.1/freqtrade/configuration/environment_vars.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/configuration/load_config.py` & `freqtrade-2023.5.1/freqtrade/configuration/load_config.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/configuration/timerange.py` & `freqtrade-2023.5.1/freqtrade/configuration/timerange.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/constants.py` & `freqtrade-2023.5.1/freqtrade/constants.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/data/btanalysis.py` & `freqtrade-2023.5.1/freqtrade/data/btanalysis.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/data/converter.py` & `freqtrade-2023.5.1/freqtrade/data/converter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/data/dataprovider.py` & `freqtrade-2023.5.1/freqtrade/data/dataprovider.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/data/entryexitanalysis.py` & `freqtrade-2023.5.1/freqtrade/data/entryexitanalysis.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/data/history/featherdatahandler.py` & `freqtrade-2023.5.1/freqtrade/data/history/featherdatahandler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/data/history/hdf5datahandler.py` & `freqtrade-2023.5.1/freqtrade/data/history/hdf5datahandler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/data/history/history_utils.py` & `freqtrade-2023.5.1/freqtrade/data/history/history_utils.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/data/history/idatahandler.py` & `freqtrade-2023.5.1/freqtrade/data/history/idatahandler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/data/history/jsondatahandler.py` & `freqtrade-2023.5.1/freqtrade/data/history/jsondatahandler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/data/history/parquetdatahandler.py` & `freqtrade-2023.5.1/freqtrade/data/history/parquetdatahandler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/data/metrics.py` & `freqtrade-2023.5.1/freqtrade/data/metrics.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/edge/edge_positioning.py` & `freqtrade-2023.5.1/freqtrade/edge/edge_positioning.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/enums/__init__.py` & `freqtrade-2023.5.1/freqtrade/enums/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/enums/candletype.py` & `freqtrade-2023.5.1/freqtrade/enums/candletype.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/enums/exitchecktuple.py` & `freqtrade-2023.5.1/freqtrade/enums/exitchecktuple.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/enums/exittype.py` & `freqtrade-2023.5.1/freqtrade/enums/exittype.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/enums/rpcmessagetype.py` & `freqtrade-2023.5.1/freqtrade/enums/rpcmessagetype.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/enums/runmode.py` & `freqtrade-2023.5.1/freqtrade/enums/runmode.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/enums/signaltype.py` & `freqtrade-2023.5.1/freqtrade/enums/signaltype.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/exceptions.py` & `freqtrade-2023.5.1/freqtrade/exceptions.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/exchange/__init__.py` & `freqtrade-2023.5.1/freqtrade/exchange/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/exchange/binance.py` & `freqtrade-2023.5.1/freqtrade/exchange/binance.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/exchange/binance_leverage_tiers.json` & `freqtrade-2023.5.1/freqtrade/exchange/binance_leverage_tiers.json`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/exchange/bitpanda.py` & `freqtrade-2023.5.1/freqtrade/exchange/bitpanda.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/exchange/bittrex.py` & `freqtrade-2023.5.1/freqtrade/exchange/bittrex.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/exchange/bitvavo.py` & `freqtrade-2023.5.1/freqtrade/exchange/bitvavo.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/exchange/bybit.py` & `freqtrade-2023.5.1/freqtrade/exchange/bybit.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/exchange/check_exchange.py` & `freqtrade-2023.5.1/freqtrade/exchange/check_exchange.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/exchange/coinbasepro.py` & `freqtrade-2023.5.1/freqtrade/exchange/coinbasepro.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/exchange/common.py` & `freqtrade-2023.5.1/freqtrade/exchange/common.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/exchange/exchange.py` & `freqtrade-2023.5.1/freqtrade/exchange/exchange.py`

 * *Files 0% similar despite different names*

```diff
@@ -582,7662 +582,7662 @@
 00002450: 746f 2073 6563 6f6e 6473 0a20 2020 2020  to seconds.     
 00002460: 2020 2073 656c 662e 6d61 726b 6574 735f     self.markets_
 00002470: 7265 6672 6573 685f 696e 7465 7276 616c  refresh_interval
 00002480: 3a20 696e 7420 3d20 6578 6368 616e 6765  : int = exchange
 00002490: 5f63 6f6e 662e 6765 7428 0a20 2020 2020  _conf.get(.     
 000024a0: 2020 2020 2020 2022 6d61 726b 6574 735f         "markets_
 000024b0: 7265 6672 6573 685f 696e 7465 7276 616c  refresh_interval
-000024c0: 222c 2036 3029 202a 2036 300a 0a20 2020  ", 60) * 60..   
-000024d0: 2020 2020 2069 6620 7365 6c66 2e74 7261       if self.tra
-000024e0: 6469 6e67 5f6d 6f64 6520 213d 2054 7261  ding_mode != Tra
-000024f0: 6469 6e67 4d6f 6465 2e53 504f 5420 616e  dingMode.SPOT an
-00002500: 6420 6c6f 6164 5f6c 6576 6572 6167 655f  d load_leverage_
-00002510: 7469 6572 733a 0a20 2020 2020 2020 2020  tiers:.         
-00002520: 2020 2073 656c 662e 6669 6c6c 5f6c 6576     self.fill_lev
-00002530: 6572 6167 655f 7469 6572 7328 290a 2020  erage_tiers().  
-00002540: 2020 2020 2020 7365 6c66 2e61 6464 6974        self.addit
-00002550: 696f 6e61 6c5f 6578 6368 616e 6765 5f69  ional_exchange_i
-00002560: 6e69 7428 290a 0a20 2020 2064 6566 205f  nit()..    def _
-00002570: 5f64 656c 5f5f 2873 656c 6629 3a0a 2020  _del__(self):.  
-00002580: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00002590: 2020 4465 7374 7275 6374 6f72 202d 2063    Destructor - c
-000025a0: 6c65 616e 2075 7020 6173 796e 6320 7374  lean up async st
-000025b0: 7566 660a 2020 2020 2020 2020 2222 220a  uff.        """.
-000025c0: 2020 2020 2020 2020 7365 6c66 2e63 6c6f          self.clo
-000025d0: 7365 2829 0a0a 2020 2020 6465 6620 636c  se()..    def cl
-000025e0: 6f73 6528 7365 6c66 293a 0a20 2020 2020  ose(self):.     
-000025f0: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
-00002600: 2245 7863 6861 6e67 6520 6f62 6a65 6374  "Exchange object
-00002610: 2064 6573 7472 6f79 6564 2c20 636c 6f73   destroyed, clos
-00002620: 696e 6720 6173 796e 6320 6c6f 6f70 2229  ing async loop")
-00002630: 0a20 2020 2020 2020 2069 6620 2873 656c  .        if (sel
-00002640: 662e 5f61 7069 5f61 7379 6e63 2061 6e64  f._api_async and
-00002650: 2069 6e73 7065 6374 2e69 7363 6f72 6f75   inspect.iscorou
-00002660: 7469 6e65 6675 6e63 7469 6f6e 2873 656c  tinefunction(sel
-00002670: 662e 5f61 7069 5f61 7379 6e63 2e63 6c6f  f._api_async.clo
-00002680: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
-00002690: 2020 2020 616e 6420 7365 6c66 2e5f 6170      and self._ap
-000026a0: 695f 6173 796e 632e 7365 7373 696f 6e29  i_async.session)
-000026b0: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
-000026c0: 6767 6572 2e64 6562 7567 2822 436c 6f73  gger.debug("Clos
-000026d0: 696e 6720 6173 796e 6320 6363 7874 2073  ing async ccxt s
-000026e0: 6573 7369 6f6e 2e22 290a 2020 2020 2020  ession.").      
-000026f0: 2020 2020 2020 7365 6c66 2e6c 6f6f 702e        self.loop.
-00002700: 7275 6e5f 756e 7469 6c5f 636f 6d70 6c65  run_until_comple
-00002710: 7465 2873 656c 662e 5f61 7069 5f61 7379  te(self._api_asy
-00002720: 6e63 2e63 6c6f 7365 2829 290a 2020 2020  nc.close()).    
-00002730: 2020 2020 6966 2073 656c 662e 6c6f 6f70      if self.loop
-00002740: 2061 6e64 206e 6f74 2073 656c 662e 6c6f   and not self.lo
-00002750: 6f70 2e69 735f 636c 6f73 6564 2829 3a0a  op.is_closed():.
-00002760: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00002770: 2e6c 6f6f 702e 636c 6f73 6528 290a 0a20  .loop.close().. 
-00002780: 2020 2064 6566 205f 696e 6974 5f61 7379     def _init_asy
-00002790: 6e63 5f6c 6f6f 7028 7365 6c66 2920 2d3e  nc_loop(self) ->
-000027a0: 2061 7379 6e63 696f 2e41 6273 7472 6163   asyncio.Abstrac
-000027b0: 7445 7665 6e74 4c6f 6f70 3a0a 2020 2020  tEventLoop:.    
-000027c0: 2020 2020 6c6f 6f70 203d 2061 7379 6e63      loop = async
-000027d0: 696f 2e6e 6577 5f65 7665 6e74 5f6c 6f6f  io.new_event_loo
-000027e0: 7028 290a 2020 2020 2020 2020 6173 796e  p().        asyn
-000027f0: 6369 6f2e 7365 745f 6576 656e 745f 6c6f  cio.set_event_lo
-00002800: 6f70 286c 6f6f 7029 0a20 2020 2020 2020  op(loop).       
-00002810: 2072 6574 7572 6e20 6c6f 6f70 0a0a 2020   return loop..  
-00002820: 2020 6465 6620 7661 6c69 6461 7465 5f63    def validate_c
-00002830: 6f6e 6669 6728 7365 6c66 2c20 636f 6e66  onfig(self, conf
-00002840: 6967 293a 0a20 2020 2020 2020 2023 2043  ig):.        # C
-00002850: 6865 636b 2069 6620 7469 6d65 6672 616d  heck if timefram
-00002860: 6520 6973 2061 7661 696c 6162 6c65 0a20  e is available. 
-00002870: 2020 2020 2020 2073 656c 662e 7661 6c69         self.vali
-00002880: 6461 7465 5f74 696d 6566 7261 6d65 7328  date_timeframes(
-00002890: 636f 6e66 6967 2e67 6574 2827 7469 6d65  config.get('time
-000028a0: 6672 616d 6527 2929 0a0a 2020 2020 2020  frame'))..      
-000028b0: 2020 2320 4368 6563 6b20 6966 2061 6c6c    # Check if all
-000028c0: 2070 6169 7273 2061 7265 2061 7661 696c   pairs are avail
-000028d0: 6162 6c65 0a20 2020 2020 2020 2073 656c  able.        sel
-000028e0: 662e 7661 6c69 6461 7465 5f73 7461 6b65  f.validate_stake
-000028f0: 6375 7272 656e 6379 2863 6f6e 6669 675b  currency(config[
-00002900: 2773 7461 6b65 5f63 7572 7265 6e63 7927  'stake_currency'
-00002910: 5d29 0a20 2020 2020 2020 2069 6620 6e6f  ]).        if no
-00002920: 7420 636f 6e66 6967 5b27 6578 6368 616e  t config['exchan
-00002930: 6765 275d 2e67 6574 2827 736b 6970 5f70  ge'].get('skip_p
-00002940: 6169 725f 7661 6c69 6461 7469 6f6e 2729  air_validation')
-00002950: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
-00002960: 6c66 2e76 616c 6964 6174 655f 7061 6972  lf.validate_pair
-00002970: 7328 636f 6e66 6967 5b27 6578 6368 616e  s(config['exchan
-00002980: 6765 275d 5b27 7061 6972 5f77 6869 7465  ge']['pair_white
-00002990: 6c69 7374 275d 290a 2020 2020 2020 2020  list']).        
-000029a0: 7365 6c66 2e76 616c 6964 6174 655f 6f72  self.validate_or
-000029b0: 6465 7274 7970 6573 2863 6f6e 6669 672e  dertypes(config.
-000029c0: 6765 7428 276f 7264 6572 5f74 7970 6573  get('order_types
-000029d0: 272c 207b 7d29 290a 2020 2020 2020 2020  ', {})).        
-000029e0: 7365 6c66 2e76 616c 6964 6174 655f 6f72  self.validate_or
-000029f0: 6465 725f 7469 6d65 5f69 6e5f 666f 7263  der_time_in_forc
-00002a00: 6528 636f 6e66 6967 2e67 6574 2827 6f72  e(config.get('or
-00002a10: 6465 725f 7469 6d65 5f69 6e5f 666f 7263  der_time_in_forc
-00002a20: 6527 2c20 7b7d 2929 0a20 2020 2020 2020  e', {})).       
-00002a30: 2073 656c 662e 7661 6c69 6461 7465 5f74   self.validate_t
-00002a40: 7261 6469 6e67 5f6d 6f64 655f 616e 645f  rading_mode_and_
-00002a50: 6d61 7267 696e 5f6d 6f64 6528 7365 6c66  margin_mode(self
-00002a60: 2e74 7261 6469 6e67 5f6d 6f64 652c 2073  .trading_mode, s
-00002a70: 656c 662e 6d61 7267 696e 5f6d 6f64 6529  elf.margin_mode)
-00002a80: 0a20 2020 2020 2020 2073 656c 662e 7661  .        self.va
-00002a90: 6c69 6461 7465 5f70 7269 6369 6e67 2863  lidate_pricing(c
-00002aa0: 6f6e 6669 675b 2765 7869 745f 7072 6963  onfig['exit_pric
-00002ab0: 696e 6727 5d29 0a20 2020 2020 2020 2073  ing']).        s
-00002ac0: 656c 662e 7661 6c69 6461 7465 5f70 7269  elf.validate_pri
-00002ad0: 6369 6e67 2863 6f6e 6669 675b 2765 6e74  cing(config['ent
-00002ae0: 7279 5f70 7269 6369 6e67 275d 290a 0a20  ry_pricing']).. 
-00002af0: 2020 2064 6566 205f 696e 6974 5f63 6378     def _init_ccx
-00002b00: 7428 7365 6c66 2c20 6578 6368 616e 6765  t(self, exchange
-00002b10: 5f63 6f6e 6669 673a 2044 6963 745b 7374  _config: Dict[st
-00002b20: 722c 2041 6e79 5d2c 2063 6378 745f 6d6f  r, Any], ccxt_mo
-00002b30: 6475 6c65 3a20 4363 7874 4d6f 6475 6c65  dule: CcxtModule
-00002b40: 5479 7065 203d 2063 6378 742c 0a20 2020  Type = ccxt,.   
-00002b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002b60: 6363 7874 5f6b 7761 7267 733a 2044 6963  ccxt_kwargs: Dic
-00002b70: 7420 3d20 7b7d 2920 2d3e 2063 6378 742e  t = {}) -> ccxt.
-00002b80: 4578 6368 616e 6765 3a0a 2020 2020 2020  Exchange:.      
-00002b90: 2020 2222 220a 2020 2020 2020 2020 496e    """.        In
-00002ba0: 6974 6961 6c69 7a65 2063 6378 7420 7769  itialize ccxt wi
-00002bb0: 7468 2067 6976 656e 2063 6f6e 6669 6720  th given config 
-00002bc0: 616e 6420 7265 7475 726e 2076 616c 6964  and return valid
-00002bd0: 0a20 2020 2020 2020 2063 6378 7420 696e  .        ccxt in
-00002be0: 7374 616e 6365 2e0a 2020 2020 2020 2020  stance..        
-00002bf0: 2222 220a 2020 2020 2020 2020 2320 4669  """.        # Fi
-00002c00: 6e64 206d 6174 6368 696e 6720 636c 6173  nd matching clas
-00002c10: 7320 666f 7220 7468 6520 6769 7665 6e20  s for the given 
-00002c20: 6578 6368 616e 6765 206e 616d 650a 2020  exchange name.  
-00002c30: 2020 2020 2020 6e61 6d65 203d 2065 7863        name = exc
-00002c40: 6861 6e67 655f 636f 6e66 6967 5b27 6e61  hange_config['na
-00002c50: 6d65 275d 0a0a 2020 2020 2020 2020 6966  me']..        if
-00002c60: 206e 6f74 2069 735f 6578 6368 616e 6765   not is_exchange
-00002c70: 5f6b 6e6f 776e 5f63 6378 7428 6e61 6d65  _known_ccxt(name
-00002c80: 2c20 6363 7874 5f6d 6f64 756c 6529 3a0a  , ccxt_module):.
-00002c90: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00002ca0: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
-00002cb0: 6570 7469 6f6e 2866 2745 7863 6861 6e67  eption(f'Exchang
-00002cc0: 6520 7b6e 616d 657d 2069 7320 6e6f 7420  e {name} is not 
-00002cd0: 7375 7070 6f72 7465 6420 6279 2063 6378  supported by ccx
-00002ce0: 7427 290a 0a20 2020 2020 2020 2065 785f  t')..        ex_
-00002cf0: 636f 6e66 6967 203d 207b 0a20 2020 2020  config = {.     
-00002d00: 2020 2020 2020 2027 6170 694b 6579 273a         'apiKey':
-00002d10: 2065 7863 6861 6e67 655f 636f 6e66 6967   exchange_config
-00002d20: 2e67 6574 2827 6b65 7927 292c 0a20 2020  .get('key'),.   
-00002d30: 2020 2020 2020 2020 2027 7365 6372 6574           'secret
-00002d40: 273a 2065 7863 6861 6e67 655f 636f 6e66  ': exchange_conf
-00002d50: 6967 2e67 6574 2827 7365 6372 6574 2729  ig.get('secret')
-00002d60: 2c0a 2020 2020 2020 2020 2020 2020 2770  ,.            'p
-00002d70: 6173 7377 6f72 6427 3a20 6578 6368 616e  assword': exchan
-00002d80: 6765 5f63 6f6e 6669 672e 6765 7428 2770  ge_config.get('p
-00002d90: 6173 7377 6f72 6427 292c 0a20 2020 2020  assword'),.     
-00002da0: 2020 2020 2020 2027 7569 6427 3a20 6578         'uid': ex
-00002db0: 6368 616e 6765 5f63 6f6e 6669 672e 6765  change_config.ge
-00002dc0: 7428 2775 6964 272c 2027 2729 2c0a 2020  t('uid', ''),.  
-00002dd0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00002de0: 6966 2063 6378 745f 6b77 6172 6773 3a0a  if ccxt_kwargs:.
-00002df0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-00002e00: 6572 2e69 6e66 6f28 2741 7070 6c79 696e  er.info('Applyin
-00002e10: 6720 6164 6469 7469 6f6e 616c 2063 6378  g additional ccx
-00002e20: 7420 636f 6e66 6967 3a20 2573 272c 2063  t config: %s', c
-00002e30: 6378 745f 6b77 6172 6773 290a 2020 2020  cxt_kwargs).    
-00002e40: 2020 2020 6966 2073 656c 662e 5f63 6378      if self._ccx
-00002e50: 745f 7061 7261 6d73 3a0a 2020 2020 2020  t_params:.      
-00002e60: 2020 2020 2020 2320 496e 6a65 6374 2073        # Inject s
-00002e70: 7461 7469 6320 6f70 7469 6f6e 7320 6166  tatic options af
-00002e80: 7465 7220 7468 6520 6162 6f76 6520 6f75  ter the above ou
-00002e90: 7470 7574 2074 6f20 6e6f 7420 636f 6e66  tput to not conf
-00002ea0: 7573 6520 7573 6572 732e 0a20 2020 2020  use users..     
-00002eb0: 2020 2020 2020 2063 6378 745f 6b77 6172         ccxt_kwar
-00002ec0: 6773 203d 2064 6565 705f 6d65 7267 655f  gs = deep_merge_
-00002ed0: 6469 6374 7328 7365 6c66 2e5f 6363 7874  dicts(self._ccxt
-00002ee0: 5f70 6172 616d 732c 2063 6378 745f 6b77  _params, ccxt_kw
-00002ef0: 6172 6773 290a 2020 2020 2020 2020 6966  args).        if
-00002f00: 2063 6378 745f 6b77 6172 6773 3a0a 2020   ccxt_kwargs:.  
-00002f10: 2020 2020 2020 2020 2020 6578 5f63 6f6e            ex_con
-00002f20: 6669 672e 7570 6461 7465 2863 6378 745f  fig.update(ccxt_
-00002f30: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
-00002f40: 7472 793a 0a0a 2020 2020 2020 2020 2020  try:..          
-00002f50: 2020 6170 6920 3d20 6765 7461 7474 7228    api = getattr(
-00002f60: 6363 7874 5f6d 6f64 756c 652c 206e 616d  ccxt_module, nam
-00002f70: 652e 6c6f 7765 7228 2929 2865 785f 636f  e.lower())(ex_co
-00002f80: 6e66 6967 290a 2020 2020 2020 2020 6578  nfig).        ex
-00002f90: 6365 7074 2028 4b65 7945 7272 6f72 2c20  cept (KeyError, 
-00002fa0: 4174 7472 6962 7574 6545 7272 6f72 2920  AttributeError) 
-00002fb0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-00002fc0: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
-00002fd0: 6e61 6c45 7863 6570 7469 6f6e 2866 2745  nalException(f'E
-00002fe0: 7863 6861 6e67 6520 7b6e 616d 657d 2069  xchange {name} i
-00002ff0: 7320 6e6f 7420 7375 7070 6f72 7465 6427  s not supported'
-00003000: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
-00003010: 2065 7863 6570 7420 6363 7874 2e42 6173   except ccxt.Bas
-00003020: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
-00003030: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
-00003040: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
-00003050: 696f 6e28 6622 496e 6974 6961 6c69 7a61  ion(f"Initializa
-00003060: 7469 6f6e 206f 6620 6363 7874 2066 6169  tion of ccxt fai
-00003070: 6c65 642e 2052 6561 736f 6e3a 207b 657d  led. Reason: {e}
-00003080: 2229 2066 726f 6d20 650a 0a20 2020 2020  ") from e..     
-00003090: 2020 2073 656c 662e 7365 745f 7361 6e64     self.set_sand
-000030a0: 626f 7828 6170 692c 2065 7863 6861 6e67  box(api, exchang
-000030b0: 655f 636f 6e66 6967 2c20 6e61 6d65 290a  e_config, name).
-000030c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000030d0: 6170 690a 0a20 2020 2040 7072 6f70 6572  api..    @proper
-000030e0: 7479 0a20 2020 2064 6566 205f 6363 7874  ty.    def _ccxt
-000030f0: 5f63 6f6e 6669 6728 7365 6c66 2920 2d3e  _config(self) ->
-00003100: 2044 6963 743a 0a20 2020 2020 2020 2023   Dict:.        #
-00003110: 2050 6172 616d 6574 6572 7320 746f 2061   Parameters to a
-00003120: 6464 2064 6972 6563 746c 7920 746f 2063  dd directly to c
-00003130: 6378 7420 7379 6e63 2f61 7379 6e63 2069  cxt sync/async i
-00003140: 6e69 7469 616c 697a 6174 696f 6e2e 0a20  nitialization.. 
-00003150: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
-00003160: 7261 6469 6e67 5f6d 6f64 6520 3d3d 2054  rading_mode == T
-00003170: 7261 6469 6e67 4d6f 6465 2e4d 4152 4749  radingMode.MARGI
-00003180: 4e3a 0a20 2020 2020 2020 2020 2020 2072  N:.            r
-00003190: 6574 7572 6e20 7b0a 2020 2020 2020 2020  eturn {.        
-000031a0: 2020 2020 2020 2020 226f 7074 696f 6e73          "options
-000031b0: 223a 207b 0a20 2020 2020 2020 2020 2020  ": {.           
-000031c0: 2020 2020 2020 2020 2022 6465 6661 756c           "defaul
-000031d0: 7454 7970 6522 3a20 226d 6172 6769 6e22  tType": "margin"
-000031e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000031f0: 207d 0a20 2020 2020 2020 2020 2020 207d   }.            }
-00003200: 0a20 2020 2020 2020 2065 6c69 6620 7365  .        elif se
-00003210: 6c66 2e74 7261 6469 6e67 5f6d 6f64 6520  lf.trading_mode 
-00003220: 3d3d 2054 7261 6469 6e67 4d6f 6465 2e46  == TradingMode.F
-00003230: 5554 5552 4553 3a0a 2020 2020 2020 2020  UTURES:.        
-00003240: 2020 2020 7265 7475 726e 207b 0a20 2020      return {.   
-00003250: 2020 2020 2020 2020 2020 2020 2022 6f70               "op
-00003260: 7469 6f6e 7322 3a20 7b0a 2020 2020 2020  tions": {.      
-00003270: 2020 2020 2020 2020 2020 2020 2020 2264                "d
-00003280: 6566 6175 6c74 5479 7065 223a 2073 656c  efaultType": sel
-00003290: 662e 5f66 745f 6861 735b 2263 6378 745f  f._ft_has["ccxt_
-000032a0: 6675 7475 7265 735f 6e61 6d65 225d 0a20  futures_name"]. 
-000032b0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-000032c0: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
-000032d0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-000032e0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000032f0: 7b7d 0a0a 2020 2020 4070 726f 7065 7274  {}..    @propert
-00003300: 790a 2020 2020 6465 6620 6e61 6d65 2873  y.    def name(s
-00003310: 656c 6629 202d 3e20 7374 723a 0a20 2020  elf) -> str:.   
-00003320: 2020 2020 2022 2222 6578 6368 616e 6765       """exchange
-00003330: 204e 616d 6520 2866 726f 6d20 6363 7874   Name (from ccxt
-00003340: 2922 2222 0a20 2020 2020 2020 2072 6574  )""".        ret
-00003350: 7572 6e20 7365 6c66 2e5f 6170 692e 6e61  urn self._api.na
-00003360: 6d65 0a0a 2020 2020 4070 726f 7065 7274  me..    @propert
-00003370: 790a 2020 2020 6465 6620 6964 2873 656c  y.    def id(sel
-00003380: 6629 202d 3e20 7374 723a 0a20 2020 2020  f) -> str:.     
-00003390: 2020 2022 2222 6578 6368 616e 6765 2063     """exchange c
-000033a0: 6378 7420 6964 2222 220a 2020 2020 2020  cxt id""".      
-000033b0: 2020 7265 7475 726e 2073 656c 662e 5f61    return self._a
-000033c0: 7069 2e69 640a 0a20 2020 2040 7072 6f70  pi.id..    @prop
-000033d0: 6572 7479 0a20 2020 2064 6566 2074 696d  erty.    def tim
-000033e0: 6566 7261 6d65 7328 7365 6c66 2920 2d3e  eframes(self) ->
-000033f0: 204c 6973 745b 7374 725d 3a0a 2020 2020   List[str]:.    
-00003400: 2020 2020 7265 7475 726e 206c 6973 7428      return list(
-00003410: 2873 656c 662e 5f61 7069 2e74 696d 6566  (self._api.timef
-00003420: 7261 6d65 7320 6f72 207b 7d29 2e6b 6579  rames or {}).key
-00003430: 7328 2929 0a0a 2020 2020 4070 726f 7065  s())..    @prope
-00003440: 7274 790a 2020 2020 6465 6620 6d61 726b  rty.    def mark
-00003450: 6574 7328 7365 6c66 2920 2d3e 2044 6963  ets(self) -> Dic
-00003460: 743a 0a20 2020 2020 2020 2022 2222 6578  t:.        """ex
-00003470: 6368 616e 6765 2063 6378 7420 6d61 726b  change ccxt mark
-00003480: 6574 7322 2222 0a20 2020 2020 2020 2069  ets""".        i
-00003490: 6620 6e6f 7420 7365 6c66 2e5f 6d61 726b  f not self._mark
-000034a0: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
-000034b0: 206c 6f67 6765 722e 696e 666f 2822 4d61   logger.info("Ma
-000034c0: 726b 6574 7320 7765 7265 206e 6f74 206c  rkets were not l
-000034d0: 6f61 6465 642e 204c 6f61 6469 6e67 2074  oaded. Loading t
-000034e0: 6865 6d20 6e6f 772e 2e22 290a 2020 2020  hem now..").    
-000034f0: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
-00003500: 6164 5f6d 6172 6b65 7473 2829 0a20 2020  ad_markets().   
-00003510: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00003520: 2e5f 6d61 726b 6574 730a 0a20 2020 2040  ._markets..    @
-00003530: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-00003540: 2070 7265 6369 7369 6f6e 4d6f 6465 2873   precisionMode(s
-00003550: 656c 6629 202d 3e20 696e 743a 0a20 2020  elf) -> int:.   
-00003560: 2020 2020 2022 2222 6578 6368 616e 6765       """exchange
-00003570: 2063 6378 7420 7072 6563 6973 696f 6e4d   ccxt precisionM
-00003580: 6f64 6522 2222 0a20 2020 2020 2020 2072  ode""".        r
-00003590: 6574 7572 6e20 7365 6c66 2e5f 6170 692e  eturn self._api.
-000035a0: 7072 6563 6973 696f 6e4d 6f64 650a 0a20  precisionMode.. 
-000035b0: 2020 2064 6566 2061 6464 6974 696f 6e61     def additiona
-000035c0: 6c5f 6578 6368 616e 6765 5f69 6e69 7428  l_exchange_init(
-000035d0: 7365 6c66 2920 2d3e 204e 6f6e 653a 0a20  self) -> None:. 
-000035e0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000035f0: 2020 2041 6464 6974 696f 6e61 6c20 6578     Additional ex
-00003600: 6368 616e 6765 2069 6e69 7469 616c 697a  change initializ
-00003610: 6174 696f 6e20 6c6f 6769 632e 0a20 2020  ation logic..   
-00003620: 2020 2020 202e 6170 6920 7769 6c6c 2062       .api will b
-00003630: 6520 6176 6169 6c61 626c 6520 6174 2074  e available at t
-00003640: 6869 7320 706f 696e 742e 0a20 2020 2020  his point..     
-00003650: 2020 204d 7573 7420 6265 206f 7665 7272     Must be overr
-00003660: 6964 6465 6e20 696e 2063 6869 6c64 206d  idden in child m
-00003670: 6574 686f 6473 2069 6620 7265 7175 6972  ethods if requir
-00003680: 6564 2e0a 2020 2020 2020 2020 2222 220a  ed..        """.
-00003690: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
-000036a0: 2020 6465 6620 5f6c 6f67 5f65 7863 6861    def _log_excha
-000036b0: 6e67 655f 7265 7370 6f6e 7365 2873 656c  nge_response(sel
-000036c0: 662c 2065 6e64 706f 696e 742c 2072 6573  f, endpoint, res
-000036d0: 706f 6e73 6529 202d 3e20 4e6f 6e65 3a0a  ponse) -> None:.
-000036e0: 2020 2020 2020 2020 2222 2220 4c6f 6720          """ Log 
-000036f0: 6578 6368 616e 6765 2072 6573 706f 6e73  exchange respons
-00003700: 6573 2022 2222 0a20 2020 2020 2020 2069  es """.        i
-00003710: 6620 7365 6c66 2e6c 6f67 5f72 6573 706f  f self.log_respo
-00003720: 6e73 6573 3a0a 2020 2020 2020 2020 2020  nses:.          
-00003730: 2020 6c6f 6767 6572 2e69 6e66 6f28 6622    logger.info(f"
-00003740: 4150 4920 7b65 6e64 706f 696e 747d 3a20  API {endpoint}: 
-00003750: 7b72 6573 706f 6e73 657d 2229 0a0a 2020  {response}")..  
-00003760: 2020 6465 6620 6f68 6c63 765f 6361 6e64    def ohlcv_cand
-00003770: 6c65 5f6c 696d 6974 280a 2020 2020 2020  le_limit(.      
-00003780: 2020 2020 2020 7365 6c66 2c20 7469 6d65        self, time
-00003790: 6672 616d 653a 2073 7472 2c20 6361 6e64  frame: str, cand
-000037a0: 6c65 5f74 7970 653a 2043 616e 646c 6554  le_type: CandleT
-000037b0: 7970 652c 2073 696e 6365 5f6d 733a 204f  ype, since_ms: O
-000037c0: 7074 696f 6e61 6c5b 696e 745d 203d 204e  ptional[int] = N
-000037d0: 6f6e 6529 202d 3e20 696e 743a 0a20 2020  one) -> int:.   
-000037e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000037f0: 2045 7863 6861 6e67 6520 6f68 6c63 7620   Exchange ohlcv 
-00003800: 6361 6e64 6c65 206c 696d 6974 0a20 2020  candle limit.   
-00003810: 2020 2020 2055 7365 7320 6f68 6c63 765f       Uses ohlcv_
-00003820: 6361 6e64 6c65 5f6c 696d 6974 5f70 6572  candle_limit_per
-00003830: 5f74 696d 6566 7261 6d65 2069 6620 7468  _timeframe if th
-00003840: 6520 6578 6368 616e 6765 2068 6173 2064  e exchange has d
-00003850: 6966 6665 7265 6e74 206c 696d 6974 730a  ifferent limits.
-00003860: 2020 2020 2020 2020 7065 7220 7469 6d65          per time
-00003870: 6672 616d 6520 2865 2e67 2e20 6269 7474  frame (e.g. bitt
-00003880: 7265 7829 2c20 6f74 6865 7277 6973 6520  rex), otherwise 
-00003890: 6661 6c6c 7320 6261 636b 2074 6f20 6f68  falls back to oh
-000038a0: 6c63 765f 6361 6e64 6c65 5f6c 696d 6974  lcv_candle_limit
-000038b0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000038c0: 7469 6d65 6672 616d 653a 2054 696d 6566  timeframe: Timef
-000038d0: 7261 6d65 2074 6f20 6368 6563 6b0a 2020  rame to check.  
-000038e0: 2020 2020 2020 3a70 6172 616d 2063 616e        :param can
-000038f0: 646c 655f 7479 7065 3a20 4361 6e64 6c65  dle_type: Candle
-00003900: 2d74 7970 650a 2020 2020 2020 2020 3a70  -type.        :p
-00003910: 6172 616d 2073 696e 6365 5f6d 733a 2053  aram since_ms: S
-00003920: 7461 7274 696e 6720 7469 6d65 7374 616d  tarting timestam
-00003930: 700a 2020 2020 2020 2020 3a72 6574 7572  p.        :retur
-00003940: 6e3a 2043 616e 646c 6520 6c69 6d69 7420  n: Candle limit 
-00003950: 6173 2069 6e74 6567 6572 0a20 2020 2020  as integer.     
-00003960: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-00003970: 6574 7572 6e20 696e 7428 7365 6c66 2e5f  eturn int(self._
-00003980: 6674 5f68 6173 2e67 6574 2827 6f68 6c63  ft_has.get('ohlc
-00003990: 765f 6361 6e64 6c65 5f6c 696d 6974 5f70  v_candle_limit_p
-000039a0: 6572 5f74 696d 6566 7261 6d65 272c 207b  er_timeframe', {
-000039b0: 7d29 2e67 6574 280a 2020 2020 2020 2020  }).get(.        
-000039c0: 2020 2020 7469 6d65 6672 616d 652c 2073      timeframe, s
-000039d0: 656c 662e 5f66 745f 6861 732e 6765 7428  elf._ft_has.get(
-000039e0: 276f 686c 6376 5f63 616e 646c 655f 6c69  'ohlcv_candle_li
-000039f0: 6d69 7427 2929 290a 0a20 2020 2064 6566  mit')))..    def
-00003a00: 2067 6574 5f6d 6172 6b65 7473 2873 656c   get_markets(sel
-00003a10: 662c 2062 6173 655f 6375 7272 656e 6369  f, base_currenci
-00003a20: 6573 3a20 4c69 7374 5b73 7472 5d20 3d20  es: List[str] = 
-00003a30: 5b5d 2c20 7175 6f74 655f 6375 7272 656e  [], quote_curren
-00003a40: 6369 6573 3a20 4c69 7374 5b73 7472 5d20  cies: List[str] 
-00003a50: 3d20 5b5d 2c0a 2020 2020 2020 2020 2020  = [],.          
-00003a60: 2020 2020 2020 2020 2020 7370 6f74 5f6f            spot_o
-00003a70: 6e6c 793a 2062 6f6f 6c20 3d20 4661 6c73  nly: bool = Fals
-00003a80: 652c 206d 6172 6769 6e5f 6f6e 6c79 3a20  e, margin_only: 
-00003a90: 626f 6f6c 203d 2046 616c 7365 2c20 6675  bool = False, fu
-00003aa0: 7475 7265 735f 6f6e 6c79 3a20 626f 6f6c  tures_only: bool
-00003ab0: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
-00003ac0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00003ad0: 6164 6162 6c65 5f6f 6e6c 793a 2062 6f6f  adable_only: boo
-00003ae0: 6c20 3d20 5472 7565 2c0a 2020 2020 2020  l = True,.      
-00003af0: 2020 2020 2020 2020 2020 2020 2020 6163                ac
-00003b00: 7469 7665 5f6f 6e6c 793a 2062 6f6f 6c20  tive_only: bool 
-00003b10: 3d20 4661 6c73 6529 202d 3e20 4469 6374  = False) -> Dict
-00003b20: 5b73 7472 2c20 416e 795d 3a0a 2020 2020  [str, Any]:.    
-00003b30: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00003b40: 5265 7475 726e 2065 7863 6861 6e67 6520  Return exchange 
-00003b50: 6363 7874 206d 6172 6b65 7473 2c20 6669  ccxt markets, fi
-00003b60: 6c74 6572 6564 206f 7574 2062 7920 6261  ltered out by ba
-00003b70: 7365 2063 7572 7265 6e63 7920 616e 6420  se currency and 
-00003b80: 7175 6f74 6520 6375 7272 656e 6379 0a20  quote currency. 
-00003b90: 2020 2020 2020 2069 6620 7468 6973 2077         if this w
-00003ba0: 6173 2072 6571 7565 7374 6564 2069 6e20  as requested in 
-00003bb0: 7061 7261 6d65 7465 7273 2e0a 2020 2020  parameters..    
-00003bc0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00003bd0: 6d61 726b 6574 7320 3d20 7365 6c66 2e6d  markets = self.m
-00003be0: 6172 6b65 7473 0a20 2020 2020 2020 2069  arkets.        i
-00003bf0: 6620 6e6f 7420 6d61 726b 6574 733a 0a20  f not markets:. 
-00003c00: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00003c10: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
-00003c20: 7074 696f 6e28 224d 6172 6b65 7473 2077  ption("Markets w
-00003c30: 6572 6520 6e6f 7420 6c6f 6164 6564 2e22  ere not loaded."
-00003c40: 290a 0a20 2020 2020 2020 2069 6620 6261  )..        if ba
-00003c50: 7365 5f63 7572 7265 6e63 6965 733a 0a20  se_currencies:. 
-00003c60: 2020 2020 2020 2020 2020 206d 6172 6b65             marke
-00003c70: 7473 203d 207b 6b3a 2076 2066 6f72 206b  ts = {k: v for k
-00003c80: 2c20 7620 696e 206d 6172 6b65 7473 2e69  , v in markets.i
-00003c90: 7465 6d73 2829 2069 6620 765b 2762 6173  tems() if v['bas
-00003ca0: 6527 5d20 696e 2062 6173 655f 6375 7272  e'] in base_curr
-00003cb0: 656e 6369 6573 7d0a 2020 2020 2020 2020  encies}.        
-00003cc0: 6966 2071 756f 7465 5f63 7572 7265 6e63  if quote_currenc
-00003cd0: 6965 733a 0a20 2020 2020 2020 2020 2020  ies:.           
-00003ce0: 206d 6172 6b65 7473 203d 207b 6b3a 2076   markets = {k: v
-00003cf0: 2066 6f72 206b 2c20 7620 696e 206d 6172   for k, v in mar
-00003d00: 6b65 7473 2e69 7465 6d73 2829 2069 6620  kets.items() if 
-00003d10: 765b 2771 756f 7465 275d 2069 6e20 7175  v['quote'] in qu
-00003d20: 6f74 655f 6375 7272 656e 6369 6573 7d0a  ote_currencies}.
-00003d30: 2020 2020 2020 2020 6966 2074 7261 6461          if trada
-00003d40: 626c 655f 6f6e 6c79 3a0a 2020 2020 2020  ble_only:.      
-00003d50: 2020 2020 2020 6d61 726b 6574 7320 3d20        markets = 
-00003d60: 7b6b 3a20 7620 666f 7220 6b2c 2076 2069  {k: v for k, v i
-00003d70: 6e20 6d61 726b 6574 732e 6974 656d 7328  n markets.items(
-00003d80: 2920 6966 2073 656c 662e 6d61 726b 6574  ) if self.market
-00003d90: 5f69 735f 7472 6164 6162 6c65 2876 297d  _is_tradable(v)}
-00003da0: 0a20 2020 2020 2020 2069 6620 7370 6f74  .        if spot
-00003db0: 5f6f 6e6c 793a 0a20 2020 2020 2020 2020  _only:.         
-00003dc0: 2020 206d 6172 6b65 7473 203d 207b 6b3a     markets = {k:
-00003dd0: 2076 2066 6f72 206b 2c20 7620 696e 206d   v for k, v in m
-00003de0: 6172 6b65 7473 2e69 7465 6d73 2829 2069  arkets.items() i
-00003df0: 6620 7365 6c66 2e6d 6172 6b65 745f 6973  f self.market_is
-00003e00: 5f73 706f 7428 7629 7d0a 2020 2020 2020  _spot(v)}.      
-00003e10: 2020 6966 206d 6172 6769 6e5f 6f6e 6c79    if margin_only
-00003e20: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
-00003e30: 726b 6574 7320 3d20 7b6b 3a20 7620 666f  rkets = {k: v fo
-00003e40: 7220 6b2c 2076 2069 6e20 6d61 726b 6574  r k, v in market
-00003e50: 732e 6974 656d 7328 2920 6966 2073 656c  s.items() if sel
-00003e60: 662e 6d61 726b 6574 5f69 735f 6d61 7267  f.market_is_marg
-00003e70: 696e 2876 297d 0a20 2020 2020 2020 2069  in(v)}.        i
-00003e80: 6620 6675 7475 7265 735f 6f6e 6c79 3a0a  f futures_only:.
-00003e90: 2020 2020 2020 2020 2020 2020 6d61 726b              mark
-00003ea0: 6574 7320 3d20 7b6b 3a20 7620 666f 7220  ets = {k: v for 
-00003eb0: 6b2c 2076 2069 6e20 6d61 726b 6574 732e  k, v in markets.
-00003ec0: 6974 656d 7328 2920 6966 2073 656c 662e  items() if self.
-00003ed0: 6d61 726b 6574 5f69 735f 6675 7475 7265  market_is_future
-00003ee0: 2876 297d 0a20 2020 2020 2020 2069 6620  (v)}.        if 
-00003ef0: 6163 7469 7665 5f6f 6e6c 793a 0a20 2020  active_only:.   
-00003f00: 2020 2020 2020 2020 206d 6172 6b65 7473           markets
-00003f10: 203d 207b 6b3a 2076 2066 6f72 206b 2c20   = {k: v for k, 
-00003f20: 7620 696e 206d 6172 6b65 7473 2e69 7465  v in markets.ite
-00003f30: 6d73 2829 2069 6620 6d61 726b 6574 5f69  ms() if market_i
-00003f40: 735f 6163 7469 7665 2876 297d 0a20 2020  s_active(v)}.   
-00003f50: 2020 2020 2072 6574 7572 6e20 6d61 726b       return mark
-00003f60: 6574 730a 0a20 2020 2064 6566 2067 6574  ets..    def get
-00003f70: 5f71 756f 7465 5f63 7572 7265 6e63 6965  _quote_currencie
-00003f80: 7328 7365 6c66 2920 2d3e 204c 6973 745b  s(self) -> List[
-00003f90: 7374 725d 3a0a 2020 2020 2020 2020 2222  str]:.        ""
-00003fa0: 220a 2020 2020 2020 2020 5265 7475 726e  ".        Return
-00003fb0: 2061 206c 6973 7420 6f66 2073 7570 706f   a list of suppo
-00003fc0: 7274 6564 2071 756f 7465 2063 7572 7265  rted quote curre
-00003fd0: 6e63 6965 730a 2020 2020 2020 2020 2222  ncies.        ""
-00003fe0: 220a 2020 2020 2020 2020 6d61 726b 6574  ".        market
-00003ff0: 7320 3d20 7365 6c66 2e6d 6172 6b65 7473  s = self.markets
-00004000: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00004010: 736f 7274 6564 2873 6574 285b 785b 2771  sorted(set([x['q
-00004020: 756f 7465 275d 2066 6f72 205f 2c20 7820  uote'] for _, x 
-00004030: 696e 206d 6172 6b65 7473 2e69 7465 6d73  in markets.items
-00004040: 2829 5d29 290a 0a20 2020 2064 6566 2067  ()]))..    def g
-00004050: 6574 5f70 6169 725f 7175 6f74 655f 6375  et_pair_quote_cu
-00004060: 7272 656e 6379 2873 656c 662c 2070 6169  rrency(self, pai
-00004070: 723a 2073 7472 2920 2d3e 2073 7472 3a0a  r: str) -> str:.
-00004080: 2020 2020 2020 2020 2222 2220 5265 7475          """ Retu
-00004090: 726e 2061 2070 6169 7227 7320 7175 6f74  rn a pair's quot
-000040a0: 6520 6375 7272 656e 6379 2028 6261 7365  e currency (base
-000040b0: 2f71 756f 7465 3a73 6574 746c 656d 656e  /quote:settlemen
-000040c0: 7429 2022 2222 0a20 2020 2020 2020 2072  t) """.        r
-000040d0: 6574 7572 6e20 7365 6c66 2e6d 6172 6b65  eturn self.marke
-000040e0: 7473 2e67 6574 2870 6169 722c 207b 7d29  ts.get(pair, {})
-000040f0: 2e67 6574 2827 7175 6f74 6527 2c20 2727  .get('quote', ''
-00004100: 290a 0a20 2020 2064 6566 2067 6574 5f70  )..    def get_p
-00004110: 6169 725f 6261 7365 5f63 7572 7265 6e63  air_base_currenc
-00004120: 7928 7365 6c66 2c20 7061 6972 3a20 7374  y(self, pair: st
-00004130: 7229 202d 3e20 7374 723a 0a20 2020 2020  r) -> str:.     
-00004140: 2020 2022 2222 2052 6574 7572 6e20 6120     """ Return a 
-00004150: 7061 6972 2773 2062 6173 6520 6375 7272  pair's base curr
-00004160: 656e 6379 2028 6261 7365 2f71 756f 7465  ency (base/quote
-00004170: 3a73 6574 746c 656d 656e 7429 2022 2222  :settlement) """
-00004180: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00004190: 7365 6c66 2e6d 6172 6b65 7473 2e67 6574  self.markets.get
-000041a0: 2870 6169 722c 207b 7d29 2e67 6574 2827  (pair, {}).get('
-000041b0: 6261 7365 272c 2027 2729 0a0a 2020 2020  base', '')..    
-000041c0: 6465 6620 6d61 726b 6574 5f69 735f 6675  def market_is_fu
-000041d0: 7475 7265 2873 656c 662c 206d 6172 6b65  ture(self, marke
-000041e0: 743a 2044 6963 745b 7374 722c 2041 6e79  t: Dict[str, Any
-000041f0: 5d29 202d 3e20 626f 6f6c 3a0a 2020 2020  ]) -> bool:.    
-00004200: 2020 2020 7265 7475 726e 2028 0a20 2020      return (.   
-00004210: 2020 2020 2020 2020 206d 6172 6b65 742e           market.
-00004220: 6765 7428 7365 6c66 2e5f 6674 5f68 6173  get(self._ft_has
-00004230: 5b22 6363 7874 5f66 7574 7572 6573 5f6e  ["ccxt_futures_n
-00004240: 616d 6522 5d2c 2046 616c 7365 2920 6973  ame"], False) is
-00004250: 2054 7275 6520 616e 640a 2020 2020 2020   True and.      
-00004260: 2020 2020 2020 6d61 726b 6574 2e67 6574        market.get
-00004270: 2827 6c69 6e65 6172 272c 2046 616c 7365  ('linear', False
-00004280: 2920 6973 2054 7275 650a 2020 2020 2020  ) is True.      
-00004290: 2020 290a 0a20 2020 2064 6566 206d 6172    )..    def mar
-000042a0: 6b65 745f 6973 5f73 706f 7428 7365 6c66  ket_is_spot(self
-000042b0: 2c20 6d61 726b 6574 3a20 4469 6374 5b73  , market: Dict[s
-000042c0: 7472 2c20 416e 795d 2920 2d3e 2062 6f6f  tr, Any]) -> boo
-000042d0: 6c3a 0a20 2020 2020 2020 2072 6574 7572  l:.        retur
-000042e0: 6e20 6d61 726b 6574 2e67 6574 2827 7370  n market.get('sp
-000042f0: 6f74 272c 2046 616c 7365 2920 6973 2054  ot', False) is T
-00004300: 7275 650a 0a20 2020 2064 6566 206d 6172  rue..    def mar
-00004310: 6b65 745f 6973 5f6d 6172 6769 6e28 7365  ket_is_margin(se
-00004320: 6c66 2c20 6d61 726b 6574 3a20 4469 6374  lf, market: Dict
-00004330: 5b73 7472 2c20 416e 795d 2920 2d3e 2062  [str, Any]) -> b
-00004340: 6f6f 6c3a 0a20 2020 2020 2020 2072 6574  ool:.        ret
-00004350: 7572 6e20 6d61 726b 6574 2e67 6574 2827  urn market.get('
-00004360: 6d61 7267 696e 272c 2046 616c 7365 2920  margin', False) 
-00004370: 6973 2054 7275 650a 0a20 2020 2064 6566  is True..    def
-00004380: 206d 6172 6b65 745f 6973 5f74 7261 6461   market_is_trada
-00004390: 626c 6528 7365 6c66 2c20 6d61 726b 6574  ble(self, market
-000043a0: 3a20 4469 6374 5b73 7472 2c20 416e 795d  : Dict[str, Any]
-000043b0: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
-000043c0: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
-000043d0: 6865 636b 2069 6620 7468 6520 6d61 726b  heck if the mark
-000043e0: 6574 2073 796d 626f 6c20 6973 2074 7261  et symbol is tra
-000043f0: 6461 626c 6520 6279 2046 7265 7174 7261  dable by Freqtra
-00004400: 6465 2e0a 2020 2020 2020 2020 456e 7375  de..        Ensu
-00004410: 7265 7320 7468 6174 2043 6f6e 6669 6775  res that Configu
-00004420: 7265 6420 6d6f 6465 2061 6c69 676e 7320  red mode aligns 
-00004430: 746f 0a20 2020 2020 2020 2022 2222 0a20  to.        """. 
-00004440: 2020 2020 2020 2072 6574 7572 6e20 280a         return (.
-00004450: 2020 2020 2020 2020 2020 2020 6d61 726b              mark
-00004460: 6574 2e67 6574 2827 7175 6f74 6527 2c20  et.get('quote', 
-00004470: 4e6f 6e65 2920 6973 206e 6f74 204e 6f6e  None) is not Non
-00004480: 650a 2020 2020 2020 2020 2020 2020 616e  e.            an
-00004490: 6420 6d61 726b 6574 2e67 6574 2827 6261  d market.get('ba
-000044a0: 7365 272c 204e 6f6e 6529 2069 7320 6e6f  se', None) is no
-000044b0: 7420 4e6f 6e65 0a20 2020 2020 2020 2020  t None.         
-000044c0: 2020 2061 6e64 2028 7365 6c66 2e70 7265     and (self.pre
-000044d0: 6369 7369 6f6e 4d6f 6465 2021 3d20 5449  cisionMode != TI
-000044e0: 434b 5f53 495a 450a 2020 2020 2020 2020  CK_SIZE.        
-000044f0: 2020 2020 2020 2020 2023 2054 6f6f 206c           # Too l
-00004500: 6f77 2070 7265 6369 7369 6f6e 2077 696c  ow precision wil
-00004510: 6c20 6661 6c73 6966 7920 6361 6c63 756c  l falsify calcul
-00004520: 6174 696f 6e73 0a20 2020 2020 2020 2020  ations.         
-00004530: 2020 2020 2020 2020 6f72 206d 6172 6b65          or marke
-00004540: 742e 6765 7428 2770 7265 6369 7369 6f6e  t.get('precision
-00004550: 272c 207b 7d29 2e67 6574 2827 7072 6963  ', {}).get('pric
-00004560: 6527 2920 3e20 3165 2d31 3129 0a20 2020  e') > 1e-11).   
-00004570: 2020 2020 2020 2020 2061 6e64 2028 2873           and ((s
-00004580: 656c 662e 7472 6164 696e 675f 6d6f 6465  elf.trading_mode
-00004590: 203d 3d20 5472 6164 696e 674d 6f64 652e   == TradingMode.
-000045a0: 5350 4f54 2061 6e64 2073 656c 662e 6d61  SPOT and self.ma
-000045b0: 726b 6574 5f69 735f 7370 6f74 286d 6172  rket_is_spot(mar
-000045c0: 6b65 7429 290a 2020 2020 2020 2020 2020  ket)).          
-000045d0: 2020 2020 2020 206f 7220 2873 656c 662e         or (self.
-000045e0: 7472 6164 696e 675f 6d6f 6465 203d 3d20  trading_mode == 
-000045f0: 5472 6164 696e 674d 6f64 652e 4d41 5247  TradingMode.MARG
-00004600: 494e 2061 6e64 2073 656c 662e 6d61 726b  IN and self.mark
-00004610: 6574 5f69 735f 6d61 7267 696e 286d 6172  et_is_margin(mar
-00004620: 6b65 7429 290a 2020 2020 2020 2020 2020  ket)).          
-00004630: 2020 2020 2020 206f 7220 2873 656c 662e         or (self.
-00004640: 7472 6164 696e 675f 6d6f 6465 203d 3d20  trading_mode == 
-00004650: 5472 6164 696e 674d 6f64 652e 4655 5455  TradingMode.FUTU
-00004660: 5245 5320 616e 6420 7365 6c66 2e6d 6172  RES and self.mar
-00004670: 6b65 745f 6973 5f66 7574 7572 6528 6d61  ket_is_future(ma
-00004680: 726b 6574 2929 290a 2020 2020 2020 2020  rket))).        
-00004690: 290a 0a20 2020 2064 6566 206b 6c69 6e65  )..    def kline
-000046a0: 7328 7365 6c66 2c20 7061 6972 5f69 6e74  s(self, pair_int
-000046b0: 6572 7661 6c3a 2050 6169 7257 6974 6854  erval: PairWithT
-000046c0: 696d 6566 7261 6d65 2c20 636f 7079 3a20  imeframe, copy: 
-000046d0: 626f 6f6c 203d 2054 7275 6529 202d 3e20  bool = True) -> 
-000046e0: 4461 7461 4672 616d 653a 0a20 2020 2020  DataFrame:.     
-000046f0: 2020 2069 6620 7061 6972 5f69 6e74 6572     if pair_inter
-00004700: 7661 6c20 696e 2073 656c 662e 5f6b 6c69  val in self._kli
-00004710: 6e65 733a 0a20 2020 2020 2020 2020 2020  nes:.           
-00004720: 2072 6574 7572 6e20 7365 6c66 2e5f 6b6c   return self._kl
-00004730: 696e 6573 5b70 6169 725f 696e 7465 7276  ines[pair_interv
-00004740: 616c 5d2e 636f 7079 2829 2069 6620 636f  al].copy() if co
-00004750: 7079 2065 6c73 6520 7365 6c66 2e5f 6b6c  py else self._kl
-00004760: 696e 6573 5b70 6169 725f 696e 7465 7276  ines[pair_interv
-00004770: 616c 5d0a 2020 2020 2020 2020 656c 7365  al].        else
-00004780: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00004790: 7475 726e 2044 6174 6146 7261 6d65 2829  turn DataFrame()
-000047a0: 0a0a 2020 2020 6465 6620 6765 745f 636f  ..    def get_co
-000047b0: 6e74 7261 6374 5f73 697a 6528 7365 6c66  ntract_size(self
-000047c0: 2c20 7061 6972 3a20 7374 7229 202d 3e20  , pair: str) -> 
-000047d0: 4f70 7469 6f6e 616c 5b66 6c6f 6174 5d3a  Optional[float]:
-000047e0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-000047f0: 2e74 7261 6469 6e67 5f6d 6f64 6520 3d3d  .trading_mode ==
-00004800: 2054 7261 6469 6e67 4d6f 6465 2e46 5554   TradingMode.FUT
-00004810: 5552 4553 3a0a 2020 2020 2020 2020 2020  URES:.          
-00004820: 2020 6d61 726b 6574 203d 2073 656c 662e    market = self.
-00004830: 6d61 726b 6574 732e 6765 7428 7061 6972  markets.get(pair
-00004840: 2c20 7b7d 290a 2020 2020 2020 2020 2020  , {}).          
-00004850: 2020 636f 6e74 7261 6374 5f73 697a 653a    contract_size:
-00004860: 2066 6c6f 6174 203d 2031 2e30 0a20 2020   float = 1.0.   
-00004870: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00004880: 6d61 726b 6574 3a0a 2020 2020 2020 2020  market:.        
-00004890: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-000048a0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-000048b0: 6966 206d 6172 6b65 742e 6765 7428 2763  if market.get('c
-000048c0: 6f6e 7472 6163 7453 697a 6527 2920 6973  ontractSize') is
-000048d0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-000048e0: 2020 2020 2020 2020 2020 2023 2063 6378             # ccx
-000048f0: 7420 6861 7320 636f 6e74 7261 6374 5369  t has contractSi
-00004900: 7a65 2069 6e20 6d61 726b 6574 7320 6173  ze in markets as
-00004910: 2073 7472 696e 670a 2020 2020 2020 2020   string.        
-00004920: 2020 2020 2020 2020 636f 6e74 7261 6374          contract
-00004930: 5f73 697a 6520 3d20 666c 6f61 7428 6d61  _size = float(ma
-00004940: 726b 6574 5b27 636f 6e74 7261 6374 5369  rket['contractSi
-00004950: 7a65 275d 290a 2020 2020 2020 2020 2020  ze']).          
-00004960: 2020 7265 7475 726e 2063 6f6e 7472 6163    return contrac
-00004970: 745f 7369 7a65 0a20 2020 2020 2020 2065  t_size.        e
-00004980: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00004990: 2072 6574 7572 6e20 310a 0a20 2020 2064   return 1..    d
-000049a0: 6566 205f 7472 6164 6573 5f63 6f6e 7472  ef _trades_contr
-000049b0: 6163 7473 5f74 6f5f 616d 6f75 6e74 2873  acts_to_amount(s
-000049c0: 656c 662c 2074 7261 6465 733a 204c 6973  elf, trades: Lis
-000049d0: 7429 202d 3e20 4c69 7374 3a0a 2020 2020  t) -> List:.    
-000049e0: 2020 2020 6966 206c 656e 2874 7261 6465      if len(trade
-000049f0: 7329 203e 2030 2061 6e64 2027 7379 6d62  s) > 0 and 'symb
-00004a00: 6f6c 2720 696e 2074 7261 6465 735b 305d  ol' in trades[0]
-00004a10: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
-00004a20: 6e74 7261 6374 5f73 697a 6520 3d20 7365  ntract_size = se
-00004a30: 6c66 2e67 6574 5f63 6f6e 7472 6163 745f  lf.get_contract_
-00004a40: 7369 7a65 2874 7261 6465 735b 305d 5b27  size(trades[0]['
-00004a50: 7379 6d62 6f6c 275d 290a 2020 2020 2020  symbol']).      
-00004a60: 2020 2020 2020 6966 2063 6f6e 7472 6163        if contrac
-00004a70: 745f 7369 7a65 2021 3d20 313a 0a20 2020  t_size != 1:.   
-00004a80: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00004a90: 2074 7261 6465 2069 6e20 7472 6164 6573   trade in trades
-00004aa0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00004ab0: 2020 2020 2020 7472 6164 655b 2761 6d6f        trade['amo
-00004ac0: 756e 7427 5d20 3d20 7472 6164 655b 2761  unt'] = trade['a
-00004ad0: 6d6f 756e 7427 5d20 2a20 636f 6e74 7261  mount'] * contra
-00004ae0: 6374 5f73 697a 650a 2020 2020 2020 2020  ct_size.        
-00004af0: 7265 7475 726e 2074 7261 6465 730a 0a20  return trades.. 
-00004b00: 2020 2064 6566 205f 6f72 6465 725f 636f     def _order_co
-00004b10: 6e74 7261 6374 735f 746f 5f61 6d6f 756e  ntracts_to_amoun
-00004b20: 7428 7365 6c66 2c20 6f72 6465 723a 2044  t(self, order: D
-00004b30: 6963 7429 202d 3e20 4469 6374 3a0a 2020  ict) -> Dict:.  
-00004b40: 2020 2020 2020 6966 2027 7379 6d62 6f6c        if 'symbol
-00004b50: 2720 696e 206f 7264 6572 2061 6e64 206f  ' in order and o
-00004b60: 7264 6572 5b27 7379 6d62 6f6c 275d 2069  rder['symbol'] i
-00004b70: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-00004b80: 2020 2020 2020 2020 636f 6e74 7261 6374          contract
-00004b90: 5f73 697a 6520 3d20 7365 6c66 2e67 6574  _size = self.get
-00004ba0: 5f63 6f6e 7472 6163 745f 7369 7a65 286f  _contract_size(o
-00004bb0: 7264 6572 5b27 7379 6d62 6f6c 275d 290a  rder['symbol']).
-00004bc0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00004bd0: 6f6e 7472 6163 745f 7369 7a65 2021 3d20  ontract_size != 
-00004be0: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-00004bf0: 2020 2066 6f72 2070 726f 7020 696e 2073     for prop in s
-00004c00: 656c 662e 5f66 745f 6861 732e 6765 7428  elf._ft_has.get(
-00004c10: 276f 7264 6572 5f70 726f 7073 5f69 6e5f  'order_props_in_
-00004c20: 636f 6e74 7261 6374 7327 2c20 5b5d 293a  contracts', []):
-00004c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004c40: 2020 2020 2069 6620 7072 6f70 2069 6e20       if prop in 
-00004c50: 6f72 6465 7220 616e 6420 6f72 6465 725b  order and order[
-00004c60: 7072 6f70 5d20 6973 206e 6f74 204e 6f6e  prop] is not Non
-00004c70: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00004c80: 2020 2020 2020 2020 2020 206f 7264 6572             order
-00004c90: 5b70 726f 705d 203d 206f 7264 6572 5b70  [prop] = order[p
-00004ca0: 726f 705d 202a 2063 6f6e 7472 6163 745f  rop] * contract_
-00004cb0: 7369 7a65 0a20 2020 2020 2020 2072 6574  size.        ret
-00004cc0: 7572 6e20 6f72 6465 720a 0a20 2020 2064  urn order..    d
-00004cd0: 6566 205f 616d 6f75 6e74 5f74 6f5f 636f  ef _amount_to_co
-00004ce0: 6e74 7261 6374 7328 7365 6c66 2c20 7061  ntracts(self, pa
-00004cf0: 6972 3a20 7374 722c 2061 6d6f 756e 743a  ir: str, amount:
-00004d00: 2066 6c6f 6174 2920 2d3e 2066 6c6f 6174   float) -> float
-00004d10: 3a0a 0a20 2020 2020 2020 2063 6f6e 7472  :..        contr
-00004d20: 6163 745f 7369 7a65 203d 2073 656c 662e  act_size = self.
-00004d30: 6765 745f 636f 6e74 7261 6374 5f73 697a  get_contract_siz
-00004d40: 6528 7061 6972 290a 2020 2020 2020 2020  e(pair).        
-00004d50: 7265 7475 726e 2061 6d6f 756e 745f 746f  return amount_to
-00004d60: 5f63 6f6e 7472 6163 7473 2861 6d6f 756e  _contracts(amoun
-00004d70: 742c 2063 6f6e 7472 6163 745f 7369 7a65  t, contract_size
-00004d80: 290a 0a20 2020 2064 6566 205f 636f 6e74  )..    def _cont
-00004d90: 7261 6374 735f 746f 5f61 6d6f 756e 7428  racts_to_amount(
-00004da0: 7365 6c66 2c20 7061 6972 3a20 7374 722c  self, pair: str,
-00004db0: 206e 756d 5f63 6f6e 7472 6163 7473 3a20   num_contracts: 
-00004dc0: 666c 6f61 7429 202d 3e20 666c 6f61 743a  float) -> float:
-00004dd0: 0a0a 2020 2020 2020 2020 636f 6e74 7261  ..        contra
-00004de0: 6374 5f73 697a 6520 3d20 7365 6c66 2e67  ct_size = self.g
-00004df0: 6574 5f63 6f6e 7472 6163 745f 7369 7a65  et_contract_size
-00004e00: 2870 6169 7229 0a20 2020 2020 2020 2072  (pair).        r
-00004e10: 6574 7572 6e20 636f 6e74 7261 6374 735f  eturn contracts_
-00004e20: 746f 5f61 6d6f 756e 7428 6e75 6d5f 636f  to_amount(num_co
-00004e30: 6e74 7261 6374 732c 2063 6f6e 7472 6163  ntracts, contrac
-00004e40: 745f 7369 7a65 290a 0a20 2020 2064 6566  t_size)..    def
-00004e50: 2061 6d6f 756e 745f 746f 5f63 6f6e 7472   amount_to_contr
-00004e60: 6163 745f 7072 6563 6973 696f 6e28 7365  act_precision(se
-00004e70: 6c66 2c20 7061 6972 3a20 7374 722c 2061  lf, pair: str, a
-00004e80: 6d6f 756e 743a 2066 6c6f 6174 2920 2d3e  mount: float) ->
-00004e90: 2066 6c6f 6174 3a0a 2020 2020 2020 2020   float:.        
-00004ea0: 2222 220a 2020 2020 2020 2020 4865 6c70  """.        Help
-00004eb0: 6572 2077 7261 7070 6572 2061 726f 756e  er wrapper aroun
-00004ec0: 6420 616d 6f75 6e74 5f74 6f5f 636f 6e74  d amount_to_cont
-00004ed0: 7261 6374 5f70 7265 6369 7369 6f6e 0a20  ract_precision. 
-00004ee0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00004ef0: 2020 2063 6f6e 7472 6163 745f 7369 7a65     contract_size
-00004f00: 203d 2073 656c 662e 6765 745f 636f 6e74   = self.get_cont
-00004f10: 7261 6374 5f73 697a 6528 7061 6972 290a  ract_size(pair).
-00004f20: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00004f30: 616d 6f75 6e74 5f74 6f5f 636f 6e74 7261  amount_to_contra
-00004f40: 6374 5f70 7265 6369 7369 6f6e 2861 6d6f  ct_precision(amo
-00004f50: 756e 742c 2073 656c 662e 6765 745f 7072  unt, self.get_pr
-00004f60: 6563 6973 696f 6e5f 616d 6f75 6e74 2870  ecision_amount(p
-00004f70: 6169 7229 2c0a 2020 2020 2020 2020 2020  air),.          
+000024c0: 222c 2036 3029 202a 2036 3020 2a20 3130  ", 60) * 60 * 10
+000024d0: 3030 0a0a 2020 2020 2020 2020 6966 2073  00..        if s
+000024e0: 656c 662e 7472 6164 696e 675f 6d6f 6465  elf.trading_mode
+000024f0: 2021 3d20 5472 6164 696e 674d 6f64 652e   != TradingMode.
+00002500: 5350 4f54 2061 6e64 206c 6f61 645f 6c65  SPOT and load_le
+00002510: 7665 7261 6765 5f74 6965 7273 3a0a 2020  verage_tiers:.  
+00002520: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
+00002530: 696c 6c5f 6c65 7665 7261 6765 5f74 6965  ill_leverage_tie
+00002540: 7273 2829 0a20 2020 2020 2020 2073 656c  rs().        sel
+00002550: 662e 6164 6469 7469 6f6e 616c 5f65 7863  f.additional_exc
+00002560: 6861 6e67 655f 696e 6974 2829 0a0a 2020  hange_init()..  
+00002570: 2020 6465 6620 5f5f 6465 6c5f 5f28 7365    def __del__(se
+00002580: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+00002590: 0a20 2020 2020 2020 2044 6573 7472 7563  .        Destruc
+000025a0: 746f 7220 2d20 636c 6561 6e20 7570 2061  tor - clean up a
+000025b0: 7379 6e63 2073 7475 6666 0a20 2020 2020  sync stuff.     
+000025c0: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
+000025d0: 656c 662e 636c 6f73 6528 290a 0a20 2020  elf.close()..   
+000025e0: 2064 6566 2063 6c6f 7365 2873 656c 6629   def close(self)
+000025f0: 3a0a 2020 2020 2020 2020 6c6f 6767 6572  :.        logger
+00002600: 2e64 6562 7567 2822 4578 6368 616e 6765  .debug("Exchange
+00002610: 206f 626a 6563 7420 6465 7374 726f 7965   object destroye
+00002620: 642c 2063 6c6f 7369 6e67 2061 7379 6e63  d, closing async
+00002630: 206c 6f6f 7022 290a 2020 2020 2020 2020   loop").        
+00002640: 6966 2028 7365 6c66 2e5f 6170 695f 6173  if (self._api_as
+00002650: 796e 6320 616e 6420 696e 7370 6563 742e  ync and inspect.
+00002660: 6973 636f 726f 7574 696e 6566 756e 6374  iscoroutinefunct
+00002670: 696f 6e28 7365 6c66 2e5f 6170 695f 6173  ion(self._api_as
+00002680: 796e 632e 636c 6f73 6529 0a20 2020 2020  ync.close).     
+00002690: 2020 2020 2020 2020 2020 2061 6e64 2073             and s
+000026a0: 656c 662e 5f61 7069 5f61 7379 6e63 2e73  elf._api_async.s
+000026b0: 6573 7369 6f6e 293a 0a20 2020 2020 2020  ession):.       
+000026c0: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
+000026d0: 6728 2243 6c6f 7369 6e67 2061 7379 6e63  g("Closing async
+000026e0: 2063 6378 7420 7365 7373 696f 6e2e 2229   ccxt session.")
+000026f0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00002700: 662e 6c6f 6f70 2e72 756e 5f75 6e74 696c  f.loop.run_until
+00002710: 5f63 6f6d 706c 6574 6528 7365 6c66 2e5f  _complete(self._
+00002720: 6170 695f 6173 796e 632e 636c 6f73 6528  api_async.close(
+00002730: 2929 0a20 2020 2020 2020 2069 6620 7365  )).        if se
+00002740: 6c66 2e6c 6f6f 7020 616e 6420 6e6f 7420  lf.loop and not 
+00002750: 7365 6c66 2e6c 6f6f 702e 6973 5f63 6c6f  self.loop.is_clo
+00002760: 7365 6428 293a 0a20 2020 2020 2020 2020  sed():.         
+00002770: 2020 2073 656c 662e 6c6f 6f70 2e63 6c6f     self.loop.clo
+00002780: 7365 2829 0a0a 2020 2020 6465 6620 5f69  se()..    def _i
+00002790: 6e69 745f 6173 796e 635f 6c6f 6f70 2873  nit_async_loop(s
+000027a0: 656c 6629 202d 3e20 6173 796e 6369 6f2e  elf) -> asyncio.
+000027b0: 4162 7374 7261 6374 4576 656e 744c 6f6f  AbstractEventLoo
+000027c0: 703a 0a20 2020 2020 2020 206c 6f6f 7020  p:.        loop 
+000027d0: 3d20 6173 796e 6369 6f2e 6e65 775f 6576  = asyncio.new_ev
+000027e0: 656e 745f 6c6f 6f70 2829 0a20 2020 2020  ent_loop().     
+000027f0: 2020 2061 7379 6e63 696f 2e73 6574 5f65     asyncio.set_e
+00002800: 7665 6e74 5f6c 6f6f 7028 6c6f 6f70 290a  vent_loop(loop).
+00002810: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+00002820: 6f6f 700a 0a20 2020 2064 6566 2076 616c  oop..    def val
+00002830: 6964 6174 655f 636f 6e66 6967 2873 656c  idate_config(sel
+00002840: 662c 2063 6f6e 6669 6729 3a0a 2020 2020  f, config):.    
+00002850: 2020 2020 2320 4368 6563 6b20 6966 2074      # Check if t
+00002860: 696d 6566 7261 6d65 2069 7320 6176 6169  imeframe is avai
+00002870: 6c61 626c 650a 2020 2020 2020 2020 7365  lable.        se
+00002880: 6c66 2e76 616c 6964 6174 655f 7469 6d65  lf.validate_time
+00002890: 6672 616d 6573 2863 6f6e 6669 672e 6765  frames(config.ge
+000028a0: 7428 2774 696d 6566 7261 6d65 2729 290a  t('timeframe')).
+000028b0: 0a20 2020 2020 2020 2023 2043 6865 636b  .        # Check
+000028c0: 2069 6620 616c 6c20 7061 6972 7320 6172   if all pairs ar
+000028d0: 6520 6176 6169 6c61 626c 650a 2020 2020  e available.    
+000028e0: 2020 2020 7365 6c66 2e76 616c 6964 6174      self.validat
+000028f0: 655f 7374 616b 6563 7572 7265 6e63 7928  e_stakecurrency(
+00002900: 636f 6e66 6967 5b27 7374 616b 655f 6375  config['stake_cu
+00002910: 7272 656e 6379 275d 290a 2020 2020 2020  rrency']).      
+00002920: 2020 6966 206e 6f74 2063 6f6e 6669 675b    if not config[
+00002930: 2765 7863 6861 6e67 6527 5d2e 6765 7428  'exchange'].get(
+00002940: 2773 6b69 705f 7061 6972 5f76 616c 6964  'skip_pair_valid
+00002950: 6174 696f 6e27 293a 0a20 2020 2020 2020  ation'):.       
+00002960: 2020 2020 2073 656c 662e 7661 6c69 6461       self.valida
+00002970: 7465 5f70 6169 7273 2863 6f6e 6669 675b  te_pairs(config[
+00002980: 2765 7863 6861 6e67 6527 5d5b 2770 6169  'exchange']['pai
+00002990: 725f 7768 6974 656c 6973 7427 5d29 0a20  r_whitelist']). 
+000029a0: 2020 2020 2020 2073 656c 662e 7661 6c69         self.vali
+000029b0: 6461 7465 5f6f 7264 6572 7479 7065 7328  date_ordertypes(
+000029c0: 636f 6e66 6967 2e67 6574 2827 6f72 6465  config.get('orde
+000029d0: 725f 7479 7065 7327 2c20 7b7d 2929 0a20  r_types', {})). 
+000029e0: 2020 2020 2020 2073 656c 662e 7661 6c69         self.vali
+000029f0: 6461 7465 5f6f 7264 6572 5f74 696d 655f  date_order_time_
+00002a00: 696e 5f66 6f72 6365 2863 6f6e 6669 672e  in_force(config.
+00002a10: 6765 7428 276f 7264 6572 5f74 696d 655f  get('order_time_
+00002a20: 696e 5f66 6f72 6365 272c 207b 7d29 290a  in_force', {})).
+00002a30: 2020 2020 2020 2020 7365 6c66 2e76 616c          self.val
+00002a40: 6964 6174 655f 7472 6164 696e 675f 6d6f  idate_trading_mo
+00002a50: 6465 5f61 6e64 5f6d 6172 6769 6e5f 6d6f  de_and_margin_mo
+00002a60: 6465 2873 656c 662e 7472 6164 696e 675f  de(self.trading_
+00002a70: 6d6f 6465 2c20 7365 6c66 2e6d 6172 6769  mode, self.margi
+00002a80: 6e5f 6d6f 6465 290a 2020 2020 2020 2020  n_mode).        
+00002a90: 7365 6c66 2e76 616c 6964 6174 655f 7072  self.validate_pr
+00002aa0: 6963 696e 6728 636f 6e66 6967 5b27 6578  icing(config['ex
+00002ab0: 6974 5f70 7269 6369 6e67 275d 290a 2020  it_pricing']).  
+00002ac0: 2020 2020 2020 7365 6c66 2e76 616c 6964        self.valid
+00002ad0: 6174 655f 7072 6963 696e 6728 636f 6e66  ate_pricing(conf
+00002ae0: 6967 5b27 656e 7472 795f 7072 6963 696e  ig['entry_pricin
+00002af0: 6727 5d29 0a0a 2020 2020 6465 6620 5f69  g'])..    def _i
+00002b00: 6e69 745f 6363 7874 2873 656c 662c 2065  nit_ccxt(self, e
+00002b10: 7863 6861 6e67 655f 636f 6e66 6967 3a20  xchange_config: 
+00002b20: 4469 6374 5b73 7472 2c20 416e 795d 2c20  Dict[str, Any], 
+00002b30: 6363 7874 5f6d 6f64 756c 653a 2043 6378  ccxt_module: Ccx
+00002b40: 744d 6f64 756c 6554 7970 6520 3d20 6363  tModuleType = cc
+00002b50: 7874 2c0a 2020 2020 2020 2020 2020 2020  xt,.            
+00002b60: 2020 2020 2020 2063 6378 745f 6b77 6172         ccxt_kwar
+00002b70: 6773 3a20 4469 6374 203d 207b 7d29 202d  gs: Dict = {}) -
+00002b80: 3e20 6363 7874 2e45 7863 6861 6e67 653a  > ccxt.Exchange:
+00002b90: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00002ba0: 2020 2020 2049 6e69 7469 616c 697a 6520       Initialize 
+00002bb0: 6363 7874 2077 6974 6820 6769 7665 6e20  ccxt with given 
+00002bc0: 636f 6e66 6967 2061 6e64 2072 6574 7572  config and retur
+00002bd0: 6e20 7661 6c69 640a 2020 2020 2020 2020  n valid.        
+00002be0: 6363 7874 2069 6e73 7461 6e63 652e 0a20  ccxt instance.. 
+00002bf0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00002c00: 2020 2023 2046 696e 6420 6d61 7463 6869     # Find matchi
+00002c10: 6e67 2063 6c61 7373 2066 6f72 2074 6865  ng class for the
+00002c20: 2067 6976 656e 2065 7863 6861 6e67 6520   given exchange 
+00002c30: 6e61 6d65 0a20 2020 2020 2020 206e 616d  name.        nam
+00002c40: 6520 3d20 6578 6368 616e 6765 5f63 6f6e  e = exchange_con
+00002c50: 6669 675b 276e 616d 6527 5d0a 0a20 2020  fig['name']..   
+00002c60: 2020 2020 2069 6620 6e6f 7420 6973 5f65       if not is_e
+00002c70: 7863 6861 6e67 655f 6b6e 6f77 6e5f 6363  xchange_known_cc
+00002c80: 7874 286e 616d 652c 2063 6378 745f 6d6f  xt(name, ccxt_mo
+00002c90: 6475 6c65 293a 0a20 2020 2020 2020 2020  dule):.         
+00002ca0: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
+00002cb0: 6f6e 616c 4578 6365 7074 696f 6e28 6627  onalException(f'
+00002cc0: 4578 6368 616e 6765 207b 6e61 6d65 7d20  Exchange {name} 
+00002cd0: 6973 206e 6f74 2073 7570 706f 7274 6564  is not supported
+00002ce0: 2062 7920 6363 7874 2729 0a0a 2020 2020   by ccxt')..    
+00002cf0: 2020 2020 6578 5f63 6f6e 6669 6720 3d20      ex_config = 
+00002d00: 7b0a 2020 2020 2020 2020 2020 2020 2761  {.            'a
+00002d10: 7069 4b65 7927 3a20 6578 6368 616e 6765  piKey': exchange
+00002d20: 5f63 6f6e 6669 672e 6765 7428 276b 6579  _config.get('key
+00002d30: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
+00002d40: 2773 6563 7265 7427 3a20 6578 6368 616e  'secret': exchan
+00002d50: 6765 5f63 6f6e 6669 672e 6765 7428 2773  ge_config.get('s
+00002d60: 6563 7265 7427 292c 0a20 2020 2020 2020  ecret'),.       
+00002d70: 2020 2020 2027 7061 7373 776f 7264 273a       'password':
+00002d80: 2065 7863 6861 6e67 655f 636f 6e66 6967   exchange_config
+00002d90: 2e67 6574 2827 7061 7373 776f 7264 2729  .get('password')
+00002da0: 2c0a 2020 2020 2020 2020 2020 2020 2775  ,.            'u
+00002db0: 6964 273a 2065 7863 6861 6e67 655f 636f  id': exchange_co
+00002dc0: 6e66 6967 2e67 6574 2827 7569 6427 2c20  nfig.get('uid', 
+00002dd0: 2727 292c 0a20 2020 2020 2020 207d 0a20  ''),.        }. 
+00002de0: 2020 2020 2020 2069 6620 6363 7874 5f6b         if ccxt_k
+00002df0: 7761 7267 733a 0a20 2020 2020 2020 2020  wargs:.         
+00002e00: 2020 206c 6f67 6765 722e 696e 666f 2827     logger.info('
+00002e10: 4170 706c 7969 6e67 2061 6464 6974 696f  Applying additio
+00002e20: 6e61 6c20 6363 7874 2063 6f6e 6669 673a  nal ccxt config:
+00002e30: 2025 7327 2c20 6363 7874 5f6b 7761 7267   %s', ccxt_kwarg
+00002e40: 7329 0a20 2020 2020 2020 2069 6620 7365  s).        if se
+00002e50: 6c66 2e5f 6363 7874 5f70 6172 616d 733a  lf._ccxt_params:
+00002e60: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
+00002e70: 6e6a 6563 7420 7374 6174 6963 206f 7074  nject static opt
+00002e80: 696f 6e73 2061 6674 6572 2074 6865 2061  ions after the a
+00002e90: 626f 7665 206f 7574 7075 7420 746f 206e  bove output to n
+00002ea0: 6f74 2063 6f6e 6675 7365 2075 7365 7273  ot confuse users
+00002eb0: 2e0a 2020 2020 2020 2020 2020 2020 6363  ..            cc
+00002ec0: 7874 5f6b 7761 7267 7320 3d20 6465 6570  xt_kwargs = deep
+00002ed0: 5f6d 6572 6765 5f64 6963 7473 2873 656c  _merge_dicts(sel
+00002ee0: 662e 5f63 6378 745f 7061 7261 6d73 2c20  f._ccxt_params, 
+00002ef0: 6363 7874 5f6b 7761 7267 7329 0a20 2020  ccxt_kwargs).   
+00002f00: 2020 2020 2069 6620 6363 7874 5f6b 7761       if ccxt_kwa
+00002f10: 7267 733a 0a20 2020 2020 2020 2020 2020  rgs:.           
+00002f20: 2065 785f 636f 6e66 6967 2e75 7064 6174   ex_config.updat
+00002f30: 6528 6363 7874 5f6b 7761 7267 7329 0a20  e(ccxt_kwargs). 
+00002f40: 2020 2020 2020 2074 7279 3a0a 0a20 2020         try:..   
+00002f50: 2020 2020 2020 2020 2061 7069 203d 2067           api = g
+00002f60: 6574 6174 7472 2863 6378 745f 6d6f 6475  etattr(ccxt_modu
+00002f70: 6c65 2c20 6e61 6d65 2e6c 6f77 6572 2829  le, name.lower()
+00002f80: 2928 6578 5f63 6f6e 6669 6729 0a20 2020  )(ex_config).   
+00002f90: 2020 2020 2065 7863 6570 7420 284b 6579       except (Key
+00002fa0: 4572 726f 722c 2041 7474 7269 6275 7465  Error, Attribute
+00002fb0: 4572 726f 7229 2061 7320 653a 0a20 2020  Error) as e:.   
+00002fc0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+00002fd0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
+00002fe0: 696f 6e28 6627 4578 6368 616e 6765 207b  ion(f'Exchange {
+00002ff0: 6e61 6d65 7d20 6973 206e 6f74 2073 7570  name} is not sup
+00003000: 706f 7274 6564 2729 2066 726f 6d20 650a  ported') from e.
+00003010: 2020 2020 2020 2020 6578 6365 7074 2063          except c
+00003020: 6378 742e 4261 7365 4572 726f 7220 6173  cxt.BaseError as
+00003030: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00003040: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
+00003050: 6c45 7863 6570 7469 6f6e 2866 2249 6e69  lException(f"Ini
+00003060: 7469 616c 697a 6174 696f 6e20 6f66 2063  tialization of c
+00003070: 6378 7420 6661 696c 6564 2e20 5265 6173  cxt failed. Reas
+00003080: 6f6e 3a20 7b65 7d22 2920 6672 6f6d 2065  on: {e}") from e
+00003090: 0a0a 2020 2020 2020 2020 7365 6c66 2e73  ..        self.s
+000030a0: 6574 5f73 616e 6462 6f78 2861 7069 2c20  et_sandbox(api, 
+000030b0: 6578 6368 616e 6765 5f63 6f6e 6669 672c  exchange_config,
+000030c0: 206e 616d 6529 0a0a 2020 2020 2020 2020   name)..        
+000030d0: 7265 7475 726e 2061 7069 0a0a 2020 2020  return api..    
+000030e0: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+000030f0: 6620 5f63 6378 745f 636f 6e66 6967 2873  f _ccxt_config(s
+00003100: 656c 6629 202d 3e20 4469 6374 3a0a 2020  elf) -> Dict:.  
+00003110: 2020 2020 2020 2320 5061 7261 6d65 7465        # Paramete
+00003120: 7273 2074 6f20 6164 6420 6469 7265 6374  rs to add direct
+00003130: 6c79 2074 6f20 6363 7874 2073 796e 632f  ly to ccxt sync/
+00003140: 6173 796e 6320 696e 6974 6961 6c69 7a61  async initializa
+00003150: 7469 6f6e 2e0a 2020 2020 2020 2020 6966  tion..        if
+00003160: 2073 656c 662e 7472 6164 696e 675f 6d6f   self.trading_mo
+00003170: 6465 203d 3d20 5472 6164 696e 674d 6f64  de == TradingMod
+00003180: 652e 4d41 5247 494e 3a0a 2020 2020 2020  e.MARGIN:.      
+00003190: 2020 2020 2020 7265 7475 726e 207b 0a20        return {. 
+000031a0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000031b0: 6f70 7469 6f6e 7322 3a20 7b0a 2020 2020  options": {.    
+000031c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000031d0: 2264 6566 6175 6c74 5479 7065 223a 2022  "defaultType": "
+000031e0: 6d61 7267 696e 220a 2020 2020 2020 2020  margin".        
+000031f0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00003200: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00003210: 656c 6966 2073 656c 662e 7472 6164 696e  elif self.tradin
+00003220: 675f 6d6f 6465 203d 3d20 5472 6164 696e  g_mode == Tradin
+00003230: 674d 6f64 652e 4655 5455 5245 533a 0a20  gMode.FUTURES:. 
+00003240: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00003250: 6e20 7b0a 2020 2020 2020 2020 2020 2020  n {.            
+00003260: 2020 2020 226f 7074 696f 6e73 223a 207b      "options": {
+00003270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003280: 2020 2020 2022 6465 6661 756c 7454 7970       "defaultTyp
+00003290: 6522 3a20 7365 6c66 2e5f 6674 5f68 6173  e": self._ft_has
+000032a0: 5b22 6363 7874 5f66 7574 7572 6573 5f6e  ["ccxt_futures_n
+000032b0: 616d 6522 5d0a 2020 2020 2020 2020 2020  ame"].          
+000032c0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+000032d0: 2020 2020 7d0a 2020 2020 2020 2020 656c      }.        el
+000032e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000032f0: 7265 7475 726e 207b 7d0a 0a20 2020 2040  return {}..    @
+00003300: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+00003310: 206e 616d 6528 7365 6c66 2920 2d3e 2073   name(self) -> s
+00003320: 7472 3a0a 2020 2020 2020 2020 2222 2265  tr:.        """e
+00003330: 7863 6861 6e67 6520 4e61 6d65 2028 6672  xchange Name (fr
+00003340: 6f6d 2063 6378 7429 2222 220a 2020 2020  om ccxt)""".    
+00003350: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00003360: 5f61 7069 2e6e 616d 650a 0a20 2020 2040  _api.name..    @
+00003370: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+00003380: 2069 6428 7365 6c66 2920 2d3e 2073 7472   id(self) -> str
+00003390: 3a0a 2020 2020 2020 2020 2222 2265 7863  :.        """exc
+000033a0: 6861 6e67 6520 6363 7874 2069 6422 2222  hange ccxt id"""
+000033b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000033c0: 7365 6c66 2e5f 6170 692e 6964 0a0a 2020  self._api.id..  
+000033d0: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+000033e0: 6465 6620 7469 6d65 6672 616d 6573 2873  def timeframes(s
+000033f0: 656c 6629 202d 3e20 4c69 7374 5b73 7472  elf) -> List[str
+00003400: 5d3a 0a20 2020 2020 2020 2072 6574 7572  ]:.        retur
+00003410: 6e20 6c69 7374 2828 7365 6c66 2e5f 6170  n list((self._ap
+00003420: 692e 7469 6d65 6672 616d 6573 206f 7220  i.timeframes or 
+00003430: 7b7d 292e 6b65 7973 2829 290a 0a20 2020  {}).keys())..   
+00003440: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+00003450: 6566 206d 6172 6b65 7473 2873 656c 6629  ef markets(self)
+00003460: 202d 3e20 4469 6374 3a0a 2020 2020 2020   -> Dict:.      
+00003470: 2020 2222 2265 7863 6861 6e67 6520 6363    """exchange cc
+00003480: 7874 206d 6172 6b65 7473 2222 220a 2020  xt markets""".  
+00003490: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+000034a0: 662e 5f6d 6172 6b65 7473 3a0a 2020 2020  f._markets:.    
+000034b0: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
+000034c0: 6e66 6f28 224d 6172 6b65 7473 2077 6572  nfo("Markets wer
+000034d0: 6520 6e6f 7420 6c6f 6164 6564 2e20 4c6f  e not loaded. Lo
+000034e0: 6164 696e 6720 7468 656d 206e 6f77 2e2e  ading them now..
+000034f0: 2229 0a20 2020 2020 2020 2020 2020 2073  ").            s
+00003500: 656c 662e 5f6c 6f61 645f 6d61 726b 6574  elf._load_market
+00003510: 7328 290a 2020 2020 2020 2020 7265 7475  s().        retu
+00003520: 726e 2073 656c 662e 5f6d 6172 6b65 7473  rn self._markets
+00003530: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
+00003540: 2020 2020 6465 6620 7072 6563 6973 696f      def precisio
+00003550: 6e4d 6f64 6528 7365 6c66 2920 2d3e 2069  nMode(self) -> i
+00003560: 6e74 3a0a 2020 2020 2020 2020 2222 2265  nt:.        """e
+00003570: 7863 6861 6e67 6520 6363 7874 2070 7265  xchange ccxt pre
+00003580: 6369 7369 6f6e 4d6f 6465 2222 220a 2020  cisionMode""".  
+00003590: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000035a0: 662e 5f61 7069 2e70 7265 6369 7369 6f6e  f._api.precision
+000035b0: 4d6f 6465 0a0a 2020 2020 6465 6620 6164  Mode..    def ad
+000035c0: 6469 7469 6f6e 616c 5f65 7863 6861 6e67  ditional_exchang
+000035d0: 655f 696e 6974 2873 656c 6629 202d 3e20  e_init(self) -> 
+000035e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+000035f0: 220a 2020 2020 2020 2020 4164 6469 7469  ".        Additi
+00003600: 6f6e 616c 2065 7863 6861 6e67 6520 696e  onal exchange in
+00003610: 6974 6961 6c69 7a61 7469 6f6e 206c 6f67  itialization log
+00003620: 6963 2e0a 2020 2020 2020 2020 2e61 7069  ic..        .api
+00003630: 2077 696c 6c20 6265 2061 7661 696c 6162   will be availab
+00003640: 6c65 2061 7420 7468 6973 2070 6f69 6e74  le at this point
+00003650: 2e0a 2020 2020 2020 2020 4d75 7374 2062  ..        Must b
+00003660: 6520 6f76 6572 7269 6464 656e 2069 6e20  e overridden in 
+00003670: 6368 696c 6420 6d65 7468 6f64 7320 6966  child methods if
+00003680: 2072 6571 7569 7265 642e 0a20 2020 2020   required..     
+00003690: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
+000036a0: 6173 730a 0a20 2020 2064 6566 205f 6c6f  ass..    def _lo
+000036b0: 675f 6578 6368 616e 6765 5f72 6573 706f  g_exchange_respo
+000036c0: 6e73 6528 7365 6c66 2c20 656e 6470 6f69  nse(self, endpoi
+000036d0: 6e74 2c20 7265 7370 6f6e 7365 2920 2d3e  nt, response) ->
+000036e0: 204e 6f6e 653a 0a20 2020 2020 2020 2022   None:.        "
+000036f0: 2222 204c 6f67 2065 7863 6861 6e67 6520  "" Log exchange 
+00003700: 7265 7370 6f6e 7365 7320 2222 220a 2020  responses """.  
+00003710: 2020 2020 2020 6966 2073 656c 662e 6c6f        if self.lo
+00003720: 675f 7265 7370 6f6e 7365 733a 0a20 2020  g_responses:.   
+00003730: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+00003740: 696e 666f 2866 2241 5049 207b 656e 6470  info(f"API {endp
+00003750: 6f69 6e74 7d3a 207b 7265 7370 6f6e 7365  oint}: {response
+00003760: 7d22 290a 0a20 2020 2064 6566 206f 686c  }")..    def ohl
+00003770: 6376 5f63 616e 646c 655f 6c69 6d69 7428  cv_candle_limit(
+00003780: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00003790: 662c 2074 696d 6566 7261 6d65 3a20 7374  f, timeframe: st
+000037a0: 722c 2063 616e 646c 655f 7479 7065 3a20  r, candle_type: 
+000037b0: 4361 6e64 6c65 5479 7065 2c20 7369 6e63  CandleType, sinc
+000037c0: 655f 6d73 3a20 4f70 7469 6f6e 616c 5b69  e_ms: Optional[i
+000037d0: 6e74 5d20 3d20 4e6f 6e65 2920 2d3e 2069  nt] = None) -> i
+000037e0: 6e74 3a0a 2020 2020 2020 2020 2222 220a  nt:.        """.
+000037f0: 2020 2020 2020 2020 4578 6368 616e 6765          Exchange
+00003800: 206f 686c 6376 2063 616e 646c 6520 6c69   ohlcv candle li
+00003810: 6d69 740a 2020 2020 2020 2020 5573 6573  mit.        Uses
+00003820: 206f 686c 6376 5f63 616e 646c 655f 6c69   ohlcv_candle_li
+00003830: 6d69 745f 7065 725f 7469 6d65 6672 616d  mit_per_timefram
+00003840: 6520 6966 2074 6865 2065 7863 6861 6e67  e if the exchang
+00003850: 6520 6861 7320 6469 6666 6572 656e 7420  e has different 
+00003860: 6c69 6d69 7473 0a20 2020 2020 2020 2070  limits.        p
+00003870: 6572 2074 696d 6566 7261 6d65 2028 652e  er timeframe (e.
+00003880: 672e 2062 6974 7472 6578 292c 206f 7468  g. bittrex), oth
+00003890: 6572 7769 7365 2066 616c 6c73 2062 6163  erwise falls bac
+000038a0: 6b20 746f 206f 686c 6376 5f63 616e 646c  k to ohlcv_candl
+000038b0: 655f 6c69 6d69 740a 2020 2020 2020 2020  e_limit.        
+000038c0: 3a70 6172 616d 2074 696d 6566 7261 6d65  :param timeframe
+000038d0: 3a20 5469 6d65 6672 616d 6520 746f 2063  : Timeframe to c
+000038e0: 6865 636b 0a20 2020 2020 2020 203a 7061  heck.        :pa
+000038f0: 7261 6d20 6361 6e64 6c65 5f74 7970 653a  ram candle_type:
+00003900: 2043 616e 646c 652d 7479 7065 0a20 2020   Candle-type.   
+00003910: 2020 2020 203a 7061 7261 6d20 7369 6e63       :param sinc
+00003920: 655f 6d73 3a20 5374 6172 7469 6e67 2074  e_ms: Starting t
+00003930: 696d 6573 7461 6d70 0a20 2020 2020 2020  imestamp.       
+00003940: 203a 7265 7475 726e 3a20 4361 6e64 6c65   :return: Candle
+00003950: 206c 696d 6974 2061 7320 696e 7465 6765   limit as intege
+00003960: 720a 2020 2020 2020 2020 2222 220a 2020  r.        """.  
+00003970: 2020 2020 2020 7265 7475 726e 2069 6e74        return int
+00003980: 2873 656c 662e 5f66 745f 6861 732e 6765  (self._ft_has.ge
+00003990: 7428 276f 686c 6376 5f63 616e 646c 655f  t('ohlcv_candle_
+000039a0: 6c69 6d69 745f 7065 725f 7469 6d65 6672  limit_per_timefr
+000039b0: 616d 6527 2c20 7b7d 292e 6765 7428 0a20  ame', {}).get(. 
+000039c0: 2020 2020 2020 2020 2020 2074 696d 6566             timef
+000039d0: 7261 6d65 2c20 7365 6c66 2e5f 6674 5f68  rame, self._ft_h
+000039e0: 6173 2e67 6574 2827 6f68 6c63 765f 6361  as.get('ohlcv_ca
+000039f0: 6e64 6c65 5f6c 696d 6974 2729 2929 0a0a  ndle_limit')))..
+00003a00: 2020 2020 6465 6620 6765 745f 6d61 726b      def get_mark
+00003a10: 6574 7328 7365 6c66 2c20 6261 7365 5f63  ets(self, base_c
+00003a20: 7572 7265 6e63 6965 733a 204c 6973 745b  urrencies: List[
+00003a30: 7374 725d 203d 205b 5d2c 2071 756f 7465  str] = [], quote
+00003a40: 5f63 7572 7265 6e63 6965 733a 204c 6973  _currencies: Lis
+00003a50: 745b 7374 725d 203d 205b 5d2c 0a20 2020  t[str] = [],.   
+00003a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003a70: 2073 706f 745f 6f6e 6c79 3a20 626f 6f6c   spot_only: bool
+00003a80: 203d 2046 616c 7365 2c20 6d61 7267 696e   = False, margin
+00003a90: 5f6f 6e6c 793a 2062 6f6f 6c20 3d20 4661  _only: bool = Fa
+00003aa0: 6c73 652c 2066 7574 7572 6573 5f6f 6e6c  lse, futures_onl
+00003ab0: 793a 2062 6f6f 6c20 3d20 4661 6c73 652c  y: bool = False,
+00003ac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003ad0: 2020 2020 2074 7261 6461 626c 655f 6f6e       tradable_on
+00003ae0: 6c79 3a20 626f 6f6c 203d 2054 7275 652c  ly: bool = True,
+00003af0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003b00: 2020 2020 2061 6374 6976 655f 6f6e 6c79       active_only
+00003b10: 3a20 626f 6f6c 203d 2046 616c 7365 2920  : bool = False) 
+00003b20: 2d3e 2044 6963 745b 7374 722c 2041 6e79  -> Dict[str, Any
+00003b30: 5d3a 0a20 2020 2020 2020 2022 2222 0a20  ]:.        """. 
+00003b40: 2020 2020 2020 2052 6574 7572 6e20 6578         Return ex
+00003b50: 6368 616e 6765 2063 6378 7420 6d61 726b  change ccxt mark
+00003b60: 6574 732c 2066 696c 7465 7265 6420 6f75  ets, filtered ou
+00003b70: 7420 6279 2062 6173 6520 6375 7272 656e  t by base curren
+00003b80: 6379 2061 6e64 2071 756f 7465 2063 7572  cy and quote cur
+00003b90: 7265 6e63 790a 2020 2020 2020 2020 6966  rency.        if
+00003ba0: 2074 6869 7320 7761 7320 7265 7175 6573   this was reques
+00003bb0: 7465 6420 696e 2070 6172 616d 6574 6572  ted in parameter
+00003bc0: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+00003bd0: 2020 2020 2020 206d 6172 6b65 7473 203d         markets =
+00003be0: 2073 656c 662e 6d61 726b 6574 730a 2020   self.markets.  
+00003bf0: 2020 2020 2020 6966 206e 6f74 206d 6172        if not mar
+00003c00: 6b65 7473 3a0a 2020 2020 2020 2020 2020  kets:.          
+00003c10: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
+00003c20: 6e61 6c45 7863 6570 7469 6f6e 2822 4d61  nalException("Ma
+00003c30: 726b 6574 7320 7765 7265 206e 6f74 206c  rkets were not l
+00003c40: 6f61 6465 642e 2229 0a0a 2020 2020 2020  oaded.")..      
+00003c50: 2020 6966 2062 6173 655f 6375 7272 656e    if base_curren
+00003c60: 6369 6573 3a0a 2020 2020 2020 2020 2020  cies:.          
+00003c70: 2020 6d61 726b 6574 7320 3d20 7b6b 3a20    markets = {k: 
+00003c80: 7620 666f 7220 6b2c 2076 2069 6e20 6d61  v for k, v in ma
+00003c90: 726b 6574 732e 6974 656d 7328 2920 6966  rkets.items() if
+00003ca0: 2076 5b27 6261 7365 275d 2069 6e20 6261   v['base'] in ba
+00003cb0: 7365 5f63 7572 7265 6e63 6965 737d 0a20  se_currencies}. 
+00003cc0: 2020 2020 2020 2069 6620 7175 6f74 655f         if quote_
+00003cd0: 6375 7272 656e 6369 6573 3a0a 2020 2020  currencies:.    
+00003ce0: 2020 2020 2020 2020 6d61 726b 6574 7320          markets 
+00003cf0: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
+00003d00: 2069 6e20 6d61 726b 6574 732e 6974 656d   in markets.item
+00003d10: 7328 2920 6966 2076 5b27 7175 6f74 6527  s() if v['quote'
+00003d20: 5d20 696e 2071 756f 7465 5f63 7572 7265  ] in quote_curre
+00003d30: 6e63 6965 737d 0a20 2020 2020 2020 2069  ncies}.        i
+00003d40: 6620 7472 6164 6162 6c65 5f6f 6e6c 793a  f tradable_only:
+00003d50: 0a20 2020 2020 2020 2020 2020 206d 6172  .            mar
+00003d60: 6b65 7473 203d 207b 6b3a 2076 2066 6f72  kets = {k: v for
+00003d70: 206b 2c20 7620 696e 206d 6172 6b65 7473   k, v in markets
+00003d80: 2e69 7465 6d73 2829 2069 6620 7365 6c66  .items() if self
+00003d90: 2e6d 6172 6b65 745f 6973 5f74 7261 6461  .market_is_trada
+00003da0: 626c 6528 7629 7d0a 2020 2020 2020 2020  ble(v)}.        
+00003db0: 6966 2073 706f 745f 6f6e 6c79 3a0a 2020  if spot_only:.  
+00003dc0: 2020 2020 2020 2020 2020 6d61 726b 6574            market
+00003dd0: 7320 3d20 7b6b 3a20 7620 666f 7220 6b2c  s = {k: v for k,
+00003de0: 2076 2069 6e20 6d61 726b 6574 732e 6974   v in markets.it
+00003df0: 656d 7328 2920 6966 2073 656c 662e 6d61  ems() if self.ma
+00003e00: 726b 6574 5f69 735f 7370 6f74 2876 297d  rket_is_spot(v)}
+00003e10: 0a20 2020 2020 2020 2069 6620 6d61 7267  .        if marg
+00003e20: 696e 5f6f 6e6c 793a 0a20 2020 2020 2020  in_only:.       
+00003e30: 2020 2020 206d 6172 6b65 7473 203d 207b       markets = {
+00003e40: 6b3a 2076 2066 6f72 206b 2c20 7620 696e  k: v for k, v in
+00003e50: 206d 6172 6b65 7473 2e69 7465 6d73 2829   markets.items()
+00003e60: 2069 6620 7365 6c66 2e6d 6172 6b65 745f   if self.market_
+00003e70: 6973 5f6d 6172 6769 6e28 7629 7d0a 2020  is_margin(v)}.  
+00003e80: 2020 2020 2020 6966 2066 7574 7572 6573        if futures
+00003e90: 5f6f 6e6c 793a 0a20 2020 2020 2020 2020  _only:.         
+00003ea0: 2020 206d 6172 6b65 7473 203d 207b 6b3a     markets = {k:
+00003eb0: 2076 2066 6f72 206b 2c20 7620 696e 206d   v for k, v in m
+00003ec0: 6172 6b65 7473 2e69 7465 6d73 2829 2069  arkets.items() i
+00003ed0: 6620 7365 6c66 2e6d 6172 6b65 745f 6973  f self.market_is
+00003ee0: 5f66 7574 7572 6528 7629 7d0a 2020 2020  _future(v)}.    
+00003ef0: 2020 2020 6966 2061 6374 6976 655f 6f6e      if active_on
+00003f00: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
+00003f10: 6d61 726b 6574 7320 3d20 7b6b 3a20 7620  markets = {k: v 
+00003f20: 666f 7220 6b2c 2076 2069 6e20 6d61 726b  for k, v in mark
+00003f30: 6574 732e 6974 656d 7328 2920 6966 206d  ets.items() if m
+00003f40: 6172 6b65 745f 6973 5f61 6374 6976 6528  arket_is_active(
+00003f50: 7629 7d0a 2020 2020 2020 2020 7265 7475  v)}.        retu
+00003f60: 726e 206d 6172 6b65 7473 0a0a 2020 2020  rn markets..    
+00003f70: 6465 6620 6765 745f 7175 6f74 655f 6375  def get_quote_cu
+00003f80: 7272 656e 6369 6573 2873 656c 6629 202d  rrencies(self) -
+00003f90: 3e20 4c69 7374 5b73 7472 5d3a 0a20 2020  > List[str]:.   
+00003fa0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00003fb0: 2052 6574 7572 6e20 6120 6c69 7374 206f   Return a list o
+00003fc0: 6620 7375 7070 6f72 7465 6420 7175 6f74  f supported quot
+00003fd0: 6520 6375 7272 656e 6369 6573 0a20 2020  e currencies.   
+00003fe0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00003ff0: 206d 6172 6b65 7473 203d 2073 656c 662e   markets = self.
+00004000: 6d61 726b 6574 730a 2020 2020 2020 2020  markets.        
+00004010: 7265 7475 726e 2073 6f72 7465 6428 7365  return sorted(se
+00004020: 7428 5b78 5b27 7175 6f74 6527 5d20 666f  t([x['quote'] fo
+00004030: 7220 5f2c 2078 2069 6e20 6d61 726b 6574  r _, x in market
+00004040: 732e 6974 656d 7328 295d 2929 0a0a 2020  s.items()]))..  
+00004050: 2020 6465 6620 6765 745f 7061 6972 5f71    def get_pair_q
+00004060: 756f 7465 5f63 7572 7265 6e63 7928 7365  uote_currency(se
+00004070: 6c66 2c20 7061 6972 3a20 7374 7229 202d  lf, pair: str) -
+00004080: 3e20 7374 723a 0a20 2020 2020 2020 2022  > str:.        "
+00004090: 2222 2052 6574 7572 6e20 6120 7061 6972  "" Return a pair
+000040a0: 2773 2071 756f 7465 2063 7572 7265 6e63  's quote currenc
+000040b0: 7920 2862 6173 652f 7175 6f74 653a 7365  y (base/quote:se
+000040c0: 7474 6c65 6d65 6e74 2920 2222 220a 2020  ttlement) """.  
+000040d0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000040e0: 662e 6d61 726b 6574 732e 6765 7428 7061  f.markets.get(pa
+000040f0: 6972 2c20 7b7d 292e 6765 7428 2771 756f  ir, {}).get('quo
+00004100: 7465 272c 2027 2729 0a0a 2020 2020 6465  te', '')..    de
+00004110: 6620 6765 745f 7061 6972 5f62 6173 655f  f get_pair_base_
+00004120: 6375 7272 656e 6379 2873 656c 662c 2070  currency(self, p
+00004130: 6169 723a 2073 7472 2920 2d3e 2073 7472  air: str) -> str
+00004140: 3a0a 2020 2020 2020 2020 2222 2220 5265  :.        """ Re
+00004150: 7475 726e 2061 2070 6169 7227 7320 6261  turn a pair's ba
+00004160: 7365 2063 7572 7265 6e63 7920 2862 6173  se currency (bas
+00004170: 652f 7175 6f74 653a 7365 7474 6c65 6d65  e/quote:settleme
+00004180: 6e74 2920 2222 220a 2020 2020 2020 2020  nt) """.        
+00004190: 7265 7475 726e 2073 656c 662e 6d61 726b  return self.mark
+000041a0: 6574 732e 6765 7428 7061 6972 2c20 7b7d  ets.get(pair, {}
+000041b0: 292e 6765 7428 2762 6173 6527 2c20 2727  ).get('base', ''
+000041c0: 290a 0a20 2020 2064 6566 206d 6172 6b65  )..    def marke
+000041d0: 745f 6973 5f66 7574 7572 6528 7365 6c66  t_is_future(self
+000041e0: 2c20 6d61 726b 6574 3a20 4469 6374 5b73  , market: Dict[s
+000041f0: 7472 2c20 416e 795d 2920 2d3e 2062 6f6f  tr, Any]) -> boo
+00004200: 6c3a 0a20 2020 2020 2020 2072 6574 7572  l:.        retur
+00004210: 6e20 280a 2020 2020 2020 2020 2020 2020  n (.            
+00004220: 6d61 726b 6574 2e67 6574 2873 656c 662e  market.get(self.
+00004230: 5f66 745f 6861 735b 2263 6378 745f 6675  _ft_has["ccxt_fu
+00004240: 7475 7265 735f 6e61 6d65 225d 2c20 4661  tures_name"], Fa
+00004250: 6c73 6529 2069 7320 5472 7565 2061 6e64  lse) is True and
+00004260: 0a20 2020 2020 2020 2020 2020 206d 6172  .            mar
+00004270: 6b65 742e 6765 7428 276c 696e 6561 7227  ket.get('linear'
+00004280: 2c20 4661 6c73 6529 2069 7320 5472 7565  , False) is True
+00004290: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+000042a0: 6465 6620 6d61 726b 6574 5f69 735f 7370  def market_is_sp
+000042b0: 6f74 2873 656c 662c 206d 6172 6b65 743a  ot(self, market:
+000042c0: 2044 6963 745b 7374 722c 2041 6e79 5d29   Dict[str, Any])
+000042d0: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+000042e0: 2020 7265 7475 726e 206d 6172 6b65 742e    return market.
+000042f0: 6765 7428 2773 706f 7427 2c20 4661 6c73  get('spot', Fals
+00004300: 6529 2069 7320 5472 7565 0a0a 2020 2020  e) is True..    
+00004310: 6465 6620 6d61 726b 6574 5f69 735f 6d61  def market_is_ma
+00004320: 7267 696e 2873 656c 662c 206d 6172 6b65  rgin(self, marke
+00004330: 743a 2044 6963 745b 7374 722c 2041 6e79  t: Dict[str, Any
+00004340: 5d29 202d 3e20 626f 6f6c 3a0a 2020 2020  ]) -> bool:.    
+00004350: 2020 2020 7265 7475 726e 206d 6172 6b65      return marke
+00004360: 742e 6765 7428 276d 6172 6769 6e27 2c20  t.get('margin', 
+00004370: 4661 6c73 6529 2069 7320 5472 7565 0a0a  False) is True..
+00004380: 2020 2020 6465 6620 6d61 726b 6574 5f69      def market_i
+00004390: 735f 7472 6164 6162 6c65 2873 656c 662c  s_tradable(self,
+000043a0: 206d 6172 6b65 743a 2044 6963 745b 7374   market: Dict[st
+000043b0: 722c 2041 6e79 5d29 202d 3e20 626f 6f6c  r, Any]) -> bool
+000043c0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+000043d0: 2020 2020 2020 4368 6563 6b20 6966 2074        Check if t
+000043e0: 6865 206d 6172 6b65 7420 7379 6d62 6f6c  he market symbol
+000043f0: 2069 7320 7472 6164 6162 6c65 2062 7920   is tradable by 
+00004400: 4672 6571 7472 6164 652e 0a20 2020 2020  Freqtrade..     
+00004410: 2020 2045 6e73 7572 6573 2074 6861 7420     Ensures that 
+00004420: 436f 6e66 6967 7572 6564 206d 6f64 6520  Configured mode 
+00004430: 616c 6967 6e73 2074 6f0a 2020 2020 2020  aligns to.      
+00004440: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+00004450: 7475 726e 2028 0a20 2020 2020 2020 2020  turn (.         
+00004460: 2020 206d 6172 6b65 742e 6765 7428 2771     market.get('q
+00004470: 756f 7465 272c 204e 6f6e 6529 2069 7320  uote', None) is 
+00004480: 6e6f 7420 4e6f 6e65 0a20 2020 2020 2020  not None.       
+00004490: 2020 2020 2061 6e64 206d 6172 6b65 742e       and market.
+000044a0: 6765 7428 2762 6173 6527 2c20 4e6f 6e65  get('base', None
+000044b0: 2920 6973 206e 6f74 204e 6f6e 650a 2020  ) is not None.  
+000044c0: 2020 2020 2020 2020 2020 616e 6420 2873            and (s
+000044d0: 656c 662e 7072 6563 6973 696f 6e4d 6f64  elf.precisionMod
+000044e0: 6520 213d 2054 4943 4b5f 5349 5a45 0a20  e != TICK_SIZE. 
+000044f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004500: 2320 546f 6f20 6c6f 7720 7072 6563 6973  # Too low precis
+00004510: 696f 6e20 7769 6c6c 2066 616c 7369 6679  ion will falsify
+00004520: 2063 616c 6375 6c61 7469 6f6e 730a 2020   calculations.  
+00004530: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00004540: 7220 6d61 726b 6574 2e67 6574 2827 7072  r market.get('pr
+00004550: 6563 6973 696f 6e27 2c20 7b7d 292e 6765  ecision', {}).ge
+00004560: 7428 2770 7269 6365 2729 203e 2031 652d  t('price') > 1e-
+00004570: 3131 290a 2020 2020 2020 2020 2020 2020  11).            
+00004580: 616e 6420 2828 7365 6c66 2e74 7261 6469  and ((self.tradi
+00004590: 6e67 5f6d 6f64 6520 3d3d 2054 7261 6469  ng_mode == Tradi
+000045a0: 6e67 4d6f 6465 2e53 504f 5420 616e 6420  ngMode.SPOT and 
+000045b0: 7365 6c66 2e6d 6172 6b65 745f 6973 5f73  self.market_is_s
+000045c0: 706f 7428 6d61 726b 6574 2929 0a20 2020  pot(market)).   
+000045d0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+000045e0: 2028 7365 6c66 2e74 7261 6469 6e67 5f6d   (self.trading_m
+000045f0: 6f64 6520 3d3d 2054 7261 6469 6e67 4d6f  ode == TradingMo
+00004600: 6465 2e4d 4152 4749 4e20 616e 6420 7365  de.MARGIN and se
+00004610: 6c66 2e6d 6172 6b65 745f 6973 5f6d 6172  lf.market_is_mar
+00004620: 6769 6e28 6d61 726b 6574 2929 0a20 2020  gin(market)).   
+00004630: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00004640: 2028 7365 6c66 2e74 7261 6469 6e67 5f6d   (self.trading_m
+00004650: 6f64 6520 3d3d 2054 7261 6469 6e67 4d6f  ode == TradingMo
+00004660: 6465 2e46 5554 5552 4553 2061 6e64 2073  de.FUTURES and s
+00004670: 656c 662e 6d61 726b 6574 5f69 735f 6675  elf.market_is_fu
+00004680: 7475 7265 286d 6172 6b65 7429 2929 0a20  ture(market))). 
+00004690: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+000046a0: 6620 6b6c 696e 6573 2873 656c 662c 2070  f klines(self, p
+000046b0: 6169 725f 696e 7465 7276 616c 3a20 5061  air_interval: Pa
+000046c0: 6972 5769 7468 5469 6d65 6672 616d 652c  irWithTimeframe,
+000046d0: 2063 6f70 793a 2062 6f6f 6c20 3d20 5472   copy: bool = Tr
+000046e0: 7565 2920 2d3e 2044 6174 6146 7261 6d65  ue) -> DataFrame
+000046f0: 3a0a 2020 2020 2020 2020 6966 2070 6169  :.        if pai
+00004700: 725f 696e 7465 7276 616c 2069 6e20 7365  r_interval in se
+00004710: 6c66 2e5f 6b6c 696e 6573 3a0a 2020 2020  lf._klines:.    
+00004720: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00004730: 656c 662e 5f6b 6c69 6e65 735b 7061 6972  elf._klines[pair
+00004740: 5f69 6e74 6572 7661 6c5d 2e63 6f70 7928  _interval].copy(
+00004750: 2920 6966 2063 6f70 7920 656c 7365 2073  ) if copy else s
+00004760: 656c 662e 5f6b 6c69 6e65 735b 7061 6972  elf._klines[pair
+00004770: 5f69 6e74 6572 7661 6c5d 0a20 2020 2020  _interval].     
+00004780: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00004790: 2020 2020 2072 6574 7572 6e20 4461 7461       return Data
+000047a0: 4672 616d 6528 290a 0a20 2020 2064 6566  Frame()..    def
+000047b0: 2067 6574 5f63 6f6e 7472 6163 745f 7369   get_contract_si
+000047c0: 7a65 2873 656c 662c 2070 6169 723a 2073  ze(self, pair: s
+000047d0: 7472 2920 2d3e 204f 7074 696f 6e61 6c5b  tr) -> Optional[
+000047e0: 666c 6f61 745d 3a0a 2020 2020 2020 2020  float]:.        
+000047f0: 6966 2073 656c 662e 7472 6164 696e 675f  if self.trading_
+00004800: 6d6f 6465 203d 3d20 5472 6164 696e 674d  mode == TradingM
+00004810: 6f64 652e 4655 5455 5245 533a 0a20 2020  ode.FUTURES:.   
+00004820: 2020 2020 2020 2020 206d 6172 6b65 7420           market 
+00004830: 3d20 7365 6c66 2e6d 6172 6b65 7473 2e67  = self.markets.g
+00004840: 6574 2870 6169 722c 207b 7d29 0a20 2020  et(pair, {}).   
+00004850: 2020 2020 2020 2020 2063 6f6e 7472 6163           contrac
+00004860: 745f 7369 7a65 3a20 666c 6f61 7420 3d20  t_size: float = 
+00004870: 312e 300a 2020 2020 2020 2020 2020 2020  1.0.            
+00004880: 6966 206e 6f74 206d 6172 6b65 743a 0a20  if not market:. 
+00004890: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000048a0: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
+000048b0: 2020 2020 2020 2069 6620 6d61 726b 6574         if market
+000048c0: 2e67 6574 2827 636f 6e74 7261 6374 5369  .get('contractSi
+000048d0: 7a65 2729 2069 7320 6e6f 7420 4e6f 6e65  ze') is not None
+000048e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000048f0: 2020 2320 6363 7874 2068 6173 2063 6f6e    # ccxt has con
+00004900: 7472 6163 7453 697a 6520 696e 206d 6172  tractSize in mar
+00004910: 6b65 7473 2061 7320 7374 7269 6e67 0a20  kets as string. 
+00004920: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00004930: 6f6e 7472 6163 745f 7369 7a65 203d 2066  ontract_size = f
+00004940: 6c6f 6174 286d 6172 6b65 745b 2763 6f6e  loat(market['con
+00004950: 7472 6163 7453 697a 6527 5d29 0a20 2020  tractSize']).   
+00004960: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00004970: 636f 6e74 7261 6374 5f73 697a 650a 2020  contract_size.  
+00004980: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00004990: 2020 2020 2020 2020 7265 7475 726e 2031          return 1
+000049a0: 0a0a 2020 2020 6465 6620 5f74 7261 6465  ..    def _trade
+000049b0: 735f 636f 6e74 7261 6374 735f 746f 5f61  s_contracts_to_a
+000049c0: 6d6f 756e 7428 7365 6c66 2c20 7472 6164  mount(self, trad
+000049d0: 6573 3a20 4c69 7374 2920 2d3e 204c 6973  es: List) -> Lis
+000049e0: 743a 0a20 2020 2020 2020 2069 6620 6c65  t:.        if le
+000049f0: 6e28 7472 6164 6573 2920 3e20 3020 616e  n(trades) > 0 an
+00004a00: 6420 2773 796d 626f 6c27 2069 6e20 7472  d 'symbol' in tr
+00004a10: 6164 6573 5b30 5d3a 0a20 2020 2020 2020  ades[0]:.       
+00004a20: 2020 2020 2063 6f6e 7472 6163 745f 7369       contract_si
+00004a30: 7a65 203d 2073 656c 662e 6765 745f 636f  ze = self.get_co
+00004a40: 6e74 7261 6374 5f73 697a 6528 7472 6164  ntract_size(trad
+00004a50: 6573 5b30 5d5b 2773 796d 626f 6c27 5d29  es[0]['symbol'])
+00004a60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00004a70: 636f 6e74 7261 6374 5f73 697a 6520 213d  contract_size !=
+00004a80: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00004a90: 2020 2020 666f 7220 7472 6164 6520 696e      for trade in
+00004aa0: 2074 7261 6465 733a 0a20 2020 2020 2020   trades:.       
+00004ab0: 2020 2020 2020 2020 2020 2020 2074 7261               tra
+00004ac0: 6465 5b27 616d 6f75 6e74 275d 203d 2074  de['amount'] = t
+00004ad0: 7261 6465 5b27 616d 6f75 6e74 275d 202a  rade['amount'] *
+00004ae0: 2063 6f6e 7472 6163 745f 7369 7a65 0a20   contract_size. 
+00004af0: 2020 2020 2020 2072 6574 7572 6e20 7472         return tr
+00004b00: 6164 6573 0a0a 2020 2020 6465 6620 5f6f  ades..    def _o
+00004b10: 7264 6572 5f63 6f6e 7472 6163 7473 5f74  rder_contracts_t
+00004b20: 6f5f 616d 6f75 6e74 2873 656c 662c 206f  o_amount(self, o
+00004b30: 7264 6572 3a20 4469 6374 2920 2d3e 2044  rder: Dict) -> D
+00004b40: 6963 743a 0a20 2020 2020 2020 2069 6620  ict:.        if 
+00004b50: 2773 796d 626f 6c27 2069 6e20 6f72 6465  'symbol' in orde
+00004b60: 7220 616e 6420 6f72 6465 725b 2773 796d  r and order['sym
+00004b70: 626f 6c27 5d20 6973 206e 6f74 204e 6f6e  bol'] is not Non
+00004b80: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
+00004b90: 6f6e 7472 6163 745f 7369 7a65 203d 2073  ontract_size = s
+00004ba0: 656c 662e 6765 745f 636f 6e74 7261 6374  elf.get_contract
+00004bb0: 5f73 697a 6528 6f72 6465 725b 2773 796d  _size(order['sym
+00004bc0: 626f 6c27 5d29 0a20 2020 2020 2020 2020  bol']).         
+00004bd0: 2020 2069 6620 636f 6e74 7261 6374 5f73     if contract_s
+00004be0: 697a 6520 213d 2031 3a0a 2020 2020 2020  ize != 1:.      
+00004bf0: 2020 2020 2020 2020 2020 666f 7220 7072            for pr
+00004c00: 6f70 2069 6e20 7365 6c66 2e5f 6674 5f68  op in self._ft_h
+00004c10: 6173 2e67 6574 2827 6f72 6465 725f 7072  as.get('order_pr
+00004c20: 6f70 735f 696e 5f63 6f6e 7472 6163 7473  ops_in_contracts
+00004c30: 272c 205b 5d29 3a0a 2020 2020 2020 2020  ', []):.        
+00004c40: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+00004c50: 726f 7020 696e 206f 7264 6572 2061 6e64  rop in order and
+00004c60: 206f 7264 6572 5b70 726f 705d 2069 7320   order[prop] is 
+00004c70: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00004c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c90: 2020 6f72 6465 725b 7072 6f70 5d20 3d20    order[prop] = 
+00004ca0: 6f72 6465 725b 7072 6f70 5d20 2a20 636f  order[prop] * co
+00004cb0: 6e74 7261 6374 5f73 697a 650a 2020 2020  ntract_size.    
+00004cc0: 2020 2020 7265 7475 726e 206f 7264 6572      return order
+00004cd0: 0a0a 2020 2020 6465 6620 5f61 6d6f 756e  ..    def _amoun
+00004ce0: 745f 746f 5f63 6f6e 7472 6163 7473 2873  t_to_contracts(s
+00004cf0: 656c 662c 2070 6169 723a 2073 7472 2c20  elf, pair: str, 
+00004d00: 616d 6f75 6e74 3a20 666c 6f61 7429 202d  amount: float) -
+00004d10: 3e20 666c 6f61 743a 0a0a 2020 2020 2020  > float:..      
+00004d20: 2020 636f 6e74 7261 6374 5f73 697a 6520    contract_size 
+00004d30: 3d20 7365 6c66 2e67 6574 5f63 6f6e 7472  = self.get_contr
+00004d40: 6163 745f 7369 7a65 2870 6169 7229 0a20  act_size(pair). 
+00004d50: 2020 2020 2020 2072 6574 7572 6e20 616d         return am
+00004d60: 6f75 6e74 5f74 6f5f 636f 6e74 7261 6374  ount_to_contract
+00004d70: 7328 616d 6f75 6e74 2c20 636f 6e74 7261  s(amount, contra
+00004d80: 6374 5f73 697a 6529 0a0a 2020 2020 6465  ct_size)..    de
+00004d90: 6620 5f63 6f6e 7472 6163 7473 5f74 6f5f  f _contracts_to_
+00004da0: 616d 6f75 6e74 2873 656c 662c 2070 6169  amount(self, pai
+00004db0: 723a 2073 7472 2c20 6e75 6d5f 636f 6e74  r: str, num_cont
+00004dc0: 7261 6374 733a 2066 6c6f 6174 2920 2d3e  racts: float) ->
+00004dd0: 2066 6c6f 6174 3a0a 0a20 2020 2020 2020   float:..       
+00004de0: 2063 6f6e 7472 6163 745f 7369 7a65 203d   contract_size =
+00004df0: 2073 656c 662e 6765 745f 636f 6e74 7261   self.get_contra
+00004e00: 6374 5f73 697a 6528 7061 6972 290a 2020  ct_size(pair).  
+00004e10: 2020 2020 2020 7265 7475 726e 2063 6f6e        return con
+00004e20: 7472 6163 7473 5f74 6f5f 616d 6f75 6e74  tracts_to_amount
+00004e30: 286e 756d 5f63 6f6e 7472 6163 7473 2c20  (num_contracts, 
+00004e40: 636f 6e74 7261 6374 5f73 697a 6529 0a0a  contract_size)..
+00004e50: 2020 2020 6465 6620 616d 6f75 6e74 5f74      def amount_t
+00004e60: 6f5f 636f 6e74 7261 6374 5f70 7265 6369  o_contract_preci
+00004e70: 7369 6f6e 2873 656c 662c 2070 6169 723a  sion(self, pair:
+00004e80: 2073 7472 2c20 616d 6f75 6e74 3a20 666c   str, amount: fl
+00004e90: 6f61 7429 202d 3e20 666c 6f61 743a 0a20  oat) -> float:. 
+00004ea0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00004eb0: 2020 2048 656c 7065 7220 7772 6170 7065     Helper wrappe
+00004ec0: 7220 6172 6f75 6e64 2061 6d6f 756e 745f  r around amount_
+00004ed0: 746f 5f63 6f6e 7472 6163 745f 7072 6563  to_contract_prec
+00004ee0: 6973 696f 6e0a 2020 2020 2020 2020 2222  ision.        ""
+00004ef0: 220a 2020 2020 2020 2020 636f 6e74 7261  ".        contra
+00004f00: 6374 5f73 697a 6520 3d20 7365 6c66 2e67  ct_size = self.g
+00004f10: 6574 5f63 6f6e 7472 6163 745f 7369 7a65  et_contract_size
+00004f20: 2870 6169 7229 0a0a 2020 2020 2020 2020  (pair)..        
+00004f30: 7265 7475 726e 2061 6d6f 756e 745f 746f  return amount_to
+00004f40: 5f63 6f6e 7472 6163 745f 7072 6563 6973  _contract_precis
+00004f50: 696f 6e28 616d 6f75 6e74 2c20 7365 6c66  ion(amount, self
+00004f60: 2e67 6574 5f70 7265 6369 7369 6f6e 5f61  .get_precision_a
+00004f70: 6d6f 756e 7428 7061 6972 292c 0a20 2020  mount(pair),.   
 00004f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00004f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004fa0: 2020 7365 6c66 2e70 7265 6369 7369 6f6e    self.precision
-00004fb0: 4d6f 6465 2c20 636f 6e74 7261 6374 5f73  Mode, contract_s
-00004fc0: 697a 6529 0a0a 2020 2020 6465 6620 7365  ize)..    def se
-00004fd0: 745f 7361 6e64 626f 7828 7365 6c66 2c20  t_sandbox(self, 
-00004fe0: 6170 693a 2063 6378 742e 4578 6368 616e  api: ccxt.Exchan
-00004ff0: 6765 2c20 6578 6368 616e 6765 5f63 6f6e  ge, exchange_con
-00005000: 6669 673a 2064 6963 742c 206e 616d 653a  fig: dict, name:
-00005010: 2073 7472 2920 2d3e 204e 6f6e 653a 0a20   str) -> None:. 
-00005020: 2020 2020 2020 2069 6620 6578 6368 616e         if exchan
-00005030: 6765 5f63 6f6e 6669 672e 6765 7428 2773  ge_config.get('s
-00005040: 616e 6462 6f78 2729 3a0a 2020 2020 2020  andbox'):.      
-00005050: 2020 2020 2020 6966 2061 7069 2e75 726c        if api.url
-00005060: 732e 6765 7428 2774 6573 7427 293a 0a20  s.get('test'):. 
-00005070: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00005080: 7069 2e75 726c 735b 2761 7069 275d 203d  pi.urls['api'] =
-00005090: 2061 7069 2e75 726c 735b 2774 6573 7427   api.urls['test'
-000050a0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000050b0: 2020 6c6f 6767 6572 2e69 6e66 6f28 2245    logger.info("E
-000050c0: 6e61 626c 6564 2053 616e 6462 6f78 2041  nabled Sandbox A
-000050d0: 5049 206f 6e20 2573 222c 206e 616d 6529  PI on %s", name)
-000050e0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-000050f0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00005100: 2020 206c 6f67 6765 722e 7761 726e 696e     logger.warnin
-00005110: 6728 0a20 2020 2020 2020 2020 2020 2020  g(.             
-00005120: 2020 2020 2020 2066 224e 6f20 5361 6e64         f"No Sand
-00005130: 626f 7820 5552 4c20 696e 2043 4358 5420  box URL in CCXT 
-00005140: 666f 7220 7b6e 616d 657d 2c20 6578 6974  for {name}, exit
-00005150: 696e 672e 2050 6c65 6173 6520 6368 6563  ing. Please chec
-00005160: 6b20 796f 7572 2063 6f6e 6669 672e 6a73  k your config.js
-00005170: 6f6e 2229 0a20 2020 2020 2020 2020 2020  on").           
-00005180: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
-00005190: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
-000051a0: 6627 4578 6368 616e 6765 207b 6e61 6d65  f'Exchange {name
-000051b0: 7d20 646f 6573 206e 6f74 2070 726f 7669  } does not provi
-000051c0: 6465 2061 2073 616e 6462 6f78 2061 7069  de a sandbox api
-000051d0: 2729 0a0a 2020 2020 6465 6620 5f6c 6f61  ')..    def _loa
-000051e0: 645f 6173 796e 635f 6d61 726b 6574 7328  d_async_markets(
-000051f0: 7365 6c66 2c20 7265 6c6f 6164 3a20 626f  self, reload: bo
-00005200: 6f6c 203d 2046 616c 7365 2920 2d3e 204e  ol = False) -> N
-00005210: 6f6e 653a 0a20 2020 2020 2020 2074 7279  one:.        try
-00005220: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00005230: 2073 656c 662e 5f61 7069 5f61 7379 6e63   self._api_async
-00005240: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00005250: 2020 7365 6c66 2e6c 6f6f 702e 7275 6e5f    self.loop.run_
-00005260: 756e 7469 6c5f 636f 6d70 6c65 7465 280a  until_complete(.
-00005270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005280: 2020 2020 7365 6c66 2e5f 6170 695f 6173      self._api_as
-00005290: 796e 632e 6c6f 6164 5f6d 6172 6b65 7473  ync.load_markets
-000052a0: 2872 656c 6f61 643d 7265 6c6f 6164 2c20  (reload=reload, 
-000052b0: 7061 7261 6d73 3d7b 7d29 290a 0a20 2020  params={}))..   
-000052c0: 2020 2020 2065 7863 6570 7420 2861 7379       except (asy
-000052d0: 6e63 696f 2e54 696d 656f 7574 4572 726f  ncio.TimeoutErro
-000052e0: 722c 2063 6378 742e 4261 7365 4572 726f  r, ccxt.BaseErro
-000052f0: 7229 2061 7320 653a 0a20 2020 2020 2020  r) as e:.       
-00005300: 2020 2020 206c 6f67 6765 722e 7761 726e       logger.warn
-00005310: 696e 6728 2743 6f75 6c64 206e 6f74 206c  ing('Could not l
-00005320: 6f61 6420 6173 796e 6320 6d61 726b 6574  oad async market
-00005330: 732e 2052 6561 736f 6e3a 2025 7327 2c20  s. Reason: %s', 
-00005340: 6529 0a20 2020 2020 2020 2020 2020 2072  e).            r
-00005350: 6574 7572 6e0a 0a20 2020 2064 6566 205f  eturn..    def _
-00005360: 6c6f 6164 5f6d 6172 6b65 7473 2873 656c  load_markets(sel
-00005370: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-00005380: 2020 2020 2222 2220 496e 6974 6961 6c69      """ Initiali
-00005390: 7a65 206d 6172 6b65 7473 2062 6f74 6820  ze markets both 
-000053a0: 7379 6e63 2061 6e64 2061 7379 6e63 2022  sync and async "
-000053b0: 2222 0a20 2020 2020 2020 2074 7279 3a0a  "".        try:.
-000053c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000053d0: 2e5f 6d61 726b 6574 7320 3d20 7365 6c66  ._markets = self
-000053e0: 2e5f 6170 692e 6c6f 6164 5f6d 6172 6b65  ._api.load_marke
-000053f0: 7473 2870 6172 616d 733d 7b7d 290a 2020  ts(params={}).  
-00005400: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00005410: 6c6f 6164 5f61 7379 6e63 5f6d 6172 6b65  load_async_marke
-00005420: 7473 2829 0a20 2020 2020 2020 2020 2020  ts().           
-00005430: 2073 656c 662e 5f6c 6173 745f 6d61 726b   self._last_mark
-00005440: 6574 735f 7265 6672 6573 6820 3d20 6474  ets_refresh = dt
-00005450: 5f74 7328 290a 2020 2020 2020 2020 2020  _ts().          
-00005460: 2020 6966 2073 656c 662e 5f66 745f 6861    if self._ft_ha
-00005470: 735b 276e 6565 6473 5f74 7261 6469 6e67  s['needs_trading
-00005480: 5f66 6565 7327 5d3a 0a20 2020 2020 2020  _fees']:.       
-00005490: 2020 2020 2020 2020 2073 656c 662e 5f74           self._t
-000054a0: 7261 6469 6e67 5f66 6565 7320 3d20 7365  rading_fees = se
-000054b0: 6c66 2e66 6574 6368 5f74 7261 6469 6e67  lf.fetch_trading
-000054c0: 5f66 6565 7328 290a 0a20 2020 2020 2020  _fees()..       
-000054d0: 2065 7863 6570 7420 6363 7874 2e42 6173   except ccxt.Bas
-000054e0: 6545 7272 6f72 3a0a 2020 2020 2020 2020  eError:.        
-000054f0: 2020 2020 6c6f 6767 6572 2e65 7863 6570      logger.excep
-00005500: 7469 6f6e 2827 556e 6162 6c65 2074 6f20  tion('Unable to 
-00005510: 696e 6974 6961 6c69 7a65 206d 6172 6b65  initialize marke
-00005520: 7473 2e27 290a 0a20 2020 2064 6566 2072  ts.')..    def r
-00005530: 656c 6f61 645f 6d61 726b 6574 7328 7365  eload_markets(se
-00005540: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-00005550: 2020 2020 2022 2222 5265 6c6f 6164 206d       """Reload m
-00005560: 6172 6b65 7473 2062 6f74 6820 7379 6e63  arkets both sync
-00005570: 2061 6e64 2061 7379 6e63 2069 6620 7265   and async if re
-00005580: 6672 6573 6820 696e 7465 7276 616c 2068  fresh interval h
-00005590: 6173 2070 6173 7365 6420 2222 220a 2020  as passed """.  
-000055a0: 2020 2020 2020 2320 4368 6563 6b20 7768        # Check wh
-000055b0: 6574 6865 7220 6d61 726b 6574 7320 6861  ether markets ha
-000055c0: 7665 2074 6f20 6265 2072 656c 6f61 6465  ve to be reloade
-000055d0: 640a 2020 2020 2020 2020 6966 2028 7365  d.        if (se
-000055e0: 6c66 2e5f 6c61 7374 5f6d 6172 6b65 7473  lf._last_markets
-000055f0: 5f72 6566 7265 7368 203e 2030 2920 616e  _refresh > 0) an
-00005600: 6420 280a 2020 2020 2020 2020 2020 2020  d (.            
-00005610: 2020 2020 7365 6c66 2e5f 6c61 7374 5f6d      self._last_m
-00005620: 6172 6b65 7473 5f72 6566 7265 7368 202b  arkets_refresh +
-00005630: 2073 656c 662e 6d61 726b 6574 735f 7265   self.markets_re
-00005640: 6672 6573 685f 696e 7465 7276 616c 203e  fresh_interval >
-00005650: 2064 745f 7473 2829 293a 0a20 2020 2020   dt_ts()):.     
-00005660: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-00005670: 6e65 0a20 2020 2020 2020 206c 6f67 6765  ne.        logge
-00005680: 722e 6465 6275 6728 2250 6572 666f 726d  r.debug("Perform
-00005690: 696e 6720 7363 6865 6475 6c65 6420 6d61  ing scheduled ma
-000056a0: 726b 6574 2072 656c 6f61 642e 2e22 290a  rket reload..").
-000056b0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-000056c0: 2020 2020 2020 2020 2073 656c 662e 5f6d           self._m
-000056d0: 6172 6b65 7473 203d 2073 656c 662e 5f61  arkets = self._a
-000056e0: 7069 2e6c 6f61 645f 6d61 726b 6574 7328  pi.load_markets(
-000056f0: 7265 6c6f 6164 3d54 7275 652c 2070 6172  reload=True, par
-00005700: 616d 733d 7b7d 290a 2020 2020 2020 2020  ams={}).        
-00005710: 2020 2020 2320 416c 736f 2072 656c 6f61      # Also reloa
-00005720: 6420 6173 796e 6320 6d61 726b 6574 7320  d async markets 
-00005730: 746f 2061 766f 6964 2069 7373 7565 7320  to avoid issues 
-00005740: 7769 7468 206e 6577 6c79 206c 6973 7465  with newly liste
-00005750: 6420 7061 6972 730a 2020 2020 2020 2020  d pairs.        
-00005760: 2020 2020 7365 6c66 2e5f 6c6f 6164 5f61      self._load_a
-00005770: 7379 6e63 5f6d 6172 6b65 7473 2872 656c  sync_markets(rel
-00005780: 6f61 643d 5472 7565 290a 2020 2020 2020  oad=True).      
-00005790: 2020 2020 2020 7365 6c66 2e5f 6c61 7374        self._last
-000057a0: 5f6d 6172 6b65 7473 5f72 6566 7265 7368  _markets_refresh
-000057b0: 203d 2064 745f 7473 2829 0a20 2020 2020   = dt_ts().     
-000057c0: 2020 2020 2020 2073 656c 662e 6669 6c6c         self.fill
-000057d0: 5f6c 6576 6572 6167 655f 7469 6572 7328  _leverage_tiers(
-000057e0: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-000057f0: 2063 6378 742e 4261 7365 4572 726f 723a   ccxt.BaseError:
-00005800: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-00005810: 6765 722e 6578 6365 7074 696f 6e28 2243  ger.exception("C
-00005820: 6f75 6c64 206e 6f74 2072 656c 6f61 6420  ould not reload 
-00005830: 6d61 726b 6574 732e 2229 0a0a 2020 2020  markets.")..    
-00005840: 6465 6620 7661 6c69 6461 7465 5f73 7461  def validate_sta
-00005850: 6b65 6375 7272 656e 6379 2873 656c 662c  kecurrency(self,
-00005860: 2073 7461 6b65 5f63 7572 7265 6e63 793a   stake_currency:
-00005870: 2073 7472 2920 2d3e 204e 6f6e 653a 0a20   str) -> None:. 
-00005880: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00005890: 2020 2043 6865 636b 7320 7374 616b 652d     Checks stake-
-000058a0: 6375 7272 656e 6379 2061 6761 696e 7374  currency against
-000058b0: 2061 7661 696c 6162 6c65 2063 7572 7265   available curre
-000058c0: 6e63 6965 7320 6f6e 2074 6865 2065 7863  ncies on the exc
-000058d0: 6861 6e67 652e 0a20 2020 2020 2020 204f  hange..        O
-000058e0: 6e6c 7920 7275 6e73 206f 6e20 7374 6172  nly runs on star
-000058f0: 7475 702e 2049 6620 6d61 726b 6574 7320  tup. If markets 
-00005900: 6861 7665 206e 6f74 2062 6565 6e20 6c6f  have not been lo
-00005910: 6164 6564 2c20 7468 6572 6527 7320 6265  aded, there's be
-00005920: 656e 2061 2070 726f 626c 656d 2077 6974  en a problem wit
-00005930: 680a 2020 2020 2020 2020 7468 6520 636f  h.        the co
-00005940: 6e6e 6563 7469 6f6e 2074 6f20 7468 6520  nnection to the 
-00005950: 6578 6368 616e 6765 2e0a 2020 2020 2020  exchange..      
-00005960: 2020 3a70 6172 616d 2073 7461 6b65 5f63    :param stake_c
-00005970: 7572 7265 6e63 793a 2053 7461 6b65 2d63  urrency: Stake-c
-00005980: 7572 7265 6e63 7920 746f 2076 616c 6964  urrency to valid
-00005990: 6174 650a 2020 2020 2020 2020 3a72 6169  ate.        :rai
-000059a0: 7365 3a20 4f70 6572 6174 696f 6e61 6c45  se: OperationalE
-000059b0: 7863 6570 7469 6f6e 2069 6620 7374 616b  xception if stak
-000059c0: 652d 6375 7272 656e 6379 2069 7320 6e6f  e-currency is no
-000059d0: 7420 6176 6169 6c61 626c 652e 0a20 2020  t available..   
-000059e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000059f0: 2069 6620 6e6f 7420 7365 6c66 2e5f 6d61   if not self._ma
-00005a00: 726b 6574 733a 0a20 2020 2020 2020 2020  rkets:.         
-00005a10: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
-00005a20: 6f6e 616c 4578 6365 7074 696f 6e28 0a20  onalException(. 
-00005a30: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00005a40: 436f 756c 6420 6e6f 7420 6c6f 6164 206d  Could not load m
-00005a50: 6172 6b65 7473 2c20 7468 6572 6566 6f72  arkets, therefor
-00005a60: 6520 6361 6e6e 6f74 2073 7461 7274 2e20  e cannot start. 
-00005a70: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-00005a80: 2020 2750 6c65 6173 6520 696e 7665 7374    'Please invest
-00005a90: 6967 6174 6520 7468 6520 6162 6f76 6520  igate the above 
-00005aa0: 6572 726f 7220 666f 7220 6d6f 7265 2064  error for more d
-00005ab0: 6574 6169 6c73 2e27 0a20 2020 2020 2020  etails.'.       
-00005ac0: 2020 2020 2029 0a20 2020 2020 2020 2071       ).        q
-00005ad0: 756f 7465 5f63 7572 7265 6e63 6965 7320  uote_currencies 
-00005ae0: 3d20 7365 6c66 2e67 6574 5f71 756f 7465  = self.get_quote
-00005af0: 5f63 7572 7265 6e63 6965 7328 290a 2020  _currencies().  
-00005b00: 2020 2020 2020 6966 2073 7461 6b65 5f63        if stake_c
-00005b10: 7572 7265 6e63 7920 6e6f 7420 696e 2071  urrency not in q
-00005b20: 756f 7465 5f63 7572 7265 6e63 6965 733a  uote_currencies:
-00005b30: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00005b40: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
-00005b50: 6365 7074 696f 6e28 0a20 2020 2020 2020  ception(.       
-00005b60: 2020 2020 2020 2020 2066 227b 7374 616b           f"{stak
-00005b70: 655f 6375 7272 656e 6379 7d20 6973 206e  e_currency} is n
-00005b80: 6f74 2061 7661 696c 6162 6c65 2061 7320  ot available as 
-00005b90: 7374 616b 6520 6f6e 207b 7365 6c66 2e6e  stake on {self.n
-00005ba0: 616d 657d 2e20 220a 2020 2020 2020 2020  ame}. ".        
-00005bb0: 2020 2020 2020 2020 6622 4176 6169 6c61          f"Availa
-00005bc0: 626c 6520 6375 7272 656e 6369 6573 2061  ble currencies a
-00005bd0: 7265 3a20 7b27 2c20 272e 6a6f 696e 2871  re: {', '.join(q
-00005be0: 756f 7465 5f63 7572 7265 6e63 6965 7329  uote_currencies)
-00005bf0: 7d22 290a 0a20 2020 2064 6566 2076 616c  }")..    def val
-00005c00: 6964 6174 655f 7061 6972 7328 7365 6c66  idate_pairs(self
-00005c10: 2c20 7061 6972 733a 204c 6973 745b 7374  , pairs: List[st
-00005c20: 725d 2920 2d3e 204e 6f6e 653a 0a20 2020  r]) -> None:.   
-00005c30: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00005c40: 2043 6865 636b 7320 6966 2061 6c6c 2067   Checks if all g
-00005c50: 6976 656e 2070 6169 7273 2061 7265 2074  iven pairs are t
-00005c60: 7261 6461 626c 6520 6f6e 2074 6865 2063  radable on the c
-00005c70: 7572 7265 6e74 2065 7863 6861 6e67 652e  urrent exchange.
-00005c80: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00005c90: 7061 6972 733a 206c 6973 7420 6f66 2070  pairs: list of p
-00005ca0: 6169 7273 0a20 2020 2020 2020 203a 7261  airs.        :ra
-00005cb0: 6973 653a 204f 7065 7261 7469 6f6e 616c  ise: Operational
-00005cc0: 4578 6365 7074 696f 6e20 6966 206f 6e65  Exception if one
-00005cd0: 2070 6169 7220 6973 206e 6f74 2061 7661   pair is not ava
-00005ce0: 696c 6162 6c65 0a20 2020 2020 2020 203a  ilable.        :
-00005cf0: 7265 7475 726e 3a20 4e6f 6e65 0a20 2020  return: None.   
-00005d00: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00005d10: 2020 6966 206e 6f74 2073 656c 662e 6d61    if not self.ma
-00005d20: 726b 6574 733a 0a20 2020 2020 2020 2020  rkets:.         
-00005d30: 2020 206c 6f67 6765 722e 7761 726e 696e     logger.warnin
-00005d40: 6728 2755 6e61 626c 6520 746f 2076 616c  g('Unable to val
-00005d50: 6964 6174 6520 7061 6972 7320 2861 7373  idate pairs (ass
-00005d60: 756d 696e 6720 7468 6579 2061 7265 2063  uming they are c
-00005d70: 6f72 7265 6374 292e 2729 0a20 2020 2020  orrect).').     
-00005d80: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-00005d90: 2020 2020 2020 6578 7465 6e64 6564 5f70        extended_p
-00005da0: 6169 7273 203d 2065 7870 616e 645f 7061  airs = expand_pa
-00005db0: 6972 6c69 7374 2870 6169 7273 2c20 6c69  irlist(pairs, li
-00005dc0: 7374 2873 656c 662e 6d61 726b 6574 7329  st(self.markets)
-00005dd0: 2c20 6b65 6570 5f69 6e76 616c 6964 3d54  , keep_invalid=T
-00005de0: 7275 6529 0a20 2020 2020 2020 2069 6e76  rue).        inv
-00005df0: 616c 6964 5f70 6169 7273 203d 205b 5d0a  alid_pairs = [].
-00005e00: 2020 2020 2020 2020 666f 7220 7061 6972          for pair
-00005e10: 2069 6e20 6578 7465 6e64 6564 5f70 6169   in extended_pai
-00005e20: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-00005e30: 2320 4e6f 7465 3a20 6363 7874 2068 6173  # Note: ccxt has
-00005e40: 2042 6173 6543 7572 7265 6e63 792f 5175   BaseCurrency/Qu
-00005e50: 6f74 6543 7572 7265 6e63 7920 666f 726d  oteCurrency form
-00005e60: 6174 2066 6f72 2070 6169 7273 0a20 2020  at for pairs.   
-00005e70: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-00005e80: 2e6d 6172 6b65 7473 2061 6e64 2070 6169  .markets and pai
-00005e90: 7220 6e6f 7420 696e 2073 656c 662e 6d61  r not in self.ma
-00005ea0: 726b 6574 733a 0a20 2020 2020 2020 2020  rkets:.         
-00005eb0: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
-00005ec0: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
-00005ed0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-00005ee0: 2020 2020 2020 2066 2750 6169 7220 7b70         f'Pair {p
-00005ef0: 6169 727d 2069 7320 6e6f 7420 6176 6169  air} is not avai
-00005f00: 6c61 626c 6520 6f6e 207b 7365 6c66 2e6e  lable on {self.n
-00005f10: 616d 657d 207b 7365 6c66 2e74 7261 6469  ame} {self.tradi
-00005f20: 6e67 5f6d 6f64 652e 7661 6c75 657d 2e20  ng_mode.value}. 
-00005f30: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-00005f40: 2020 2020 2020 6627 506c 6561 7365 2072        f'Please r
-00005f50: 656d 6f76 6520 7b70 6169 727d 2066 726f  emove {pair} fro
-00005f60: 6d20 796f 7572 2077 6869 7465 6c69 7374  m your whitelist
-00005f70: 2e27 290a 0a20 2020 2020 2020 2020 2020  .')..           
-00005f80: 2020 2020 2023 2046 726f 6d20 6363 7874       # From ccxt
-00005f90: 2044 6f63 756d 656e 7461 7469 6f6e 3a0a   Documentation:.
-00005fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005fb0: 2320 6d61 726b 6574 732e 696e 666f 3a20  # markets.info: 
-00005fc0: 416e 2061 7373 6f63 6961 7469 7665 2061  An associative a
-00005fd0: 7272 6179 206f 6620 6e6f 6e2d 636f 6d6d  rray of non-comm
-00005fe0: 6f6e 206d 6172 6b65 7420 7072 6f70 6572  on market proper
-00005ff0: 7469 6573 2c0a 2020 2020 2020 2020 2020  ties,.          
-00006000: 2020 2020 2020 2320 696e 636c 7564 696e        # includin
-00006010: 6720 6665 6573 2c20 7261 7465 732c 206c  g fees, rates, l
-00006020: 696d 6974 7320 616e 6420 6f74 6865 7220  imits and other 
-00006030: 6765 6e65 7261 6c20 6d61 726b 6574 2069  general market i
-00006040: 6e66 6f72 6d61 7469 6f6e 2e0a 2020 2020  nformation..    
-00006050: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
-00006060: 6520 696e 7465 726e 616c 2069 6e66 6f20  e internal info 
-00006070: 6172 7261 7920 6973 2064 6966 6665 7265  array is differe
-00006080: 6e74 2066 6f72 2065 6163 6820 7061 7274  nt for each part
-00006090: 6963 756c 6172 206d 6172 6b65 742c 0a20  icular market,. 
-000060a0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-000060b0: 2069 7473 2063 6f6e 7465 6e74 7320 6465   its contents de
-000060c0: 7065 6e64 206f 6e20 7468 6520 6578 6368  pend on the exch
-000060d0: 616e 6765 2e0a 2020 2020 2020 2020 2020  ange..          
-000060e0: 2020 2020 2020 2320 4974 2063 616e 2061        # It can a
-000060f0: 6c73 6f20 6265 2061 2073 7472 696e 6720  lso be a string 
-00006100: 6f72 2073 696d 696c 6172 202e 2e2e 2073  or similar ... s
-00006110: 6f20 7765 206e 6565 6420 746f 2076 6572  o we need to ver
-00006120: 6966 7920 7468 6174 2066 6972 7374 2e0a  ify that first..
-00006130: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-00006140: 2028 6973 696e 7374 616e 6365 2873 656c   (isinstance(sel
-00006150: 662e 6d61 726b 6574 735b 7061 6972 5d2e  f.markets[pair].
-00006160: 6765 7428 2769 6e66 6f27 292c 2064 6963  get('info'), dic
-00006170: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-00006180: 2020 2020 2061 6e64 2073 656c 662e 6d61       and self.ma
-00006190: 726b 6574 735b 7061 6972 5d2e 6765 7428  rkets[pair].get(
-000061a0: 2769 6e66 6f27 2c20 7b7d 292e 6765 7428  'info', {}).get(
-000061b0: 2770 726f 6869 6269 7465 6449 6e27 2c20  'prohibitedIn', 
-000061c0: 4661 6c73 6529 293a 0a20 2020 2020 2020  False)):.       
-000061d0: 2020 2020 2020 2020 2023 2057 6172 6e20           # Warn 
-000061e0: 7573 6572 7320 6162 6f75 7420 7265 7374  users about rest
-000061f0: 7269 6374 6564 2070 6169 7273 2069 6e20  ricted pairs in 
-00006200: 7768 6974 656c 6973 742e 0a20 2020 2020  whitelist..     
-00006210: 2020 2020 2020 2020 2020 2023 2057 6520             # We 
-00006220: 6361 6e6e 6f74 2064 6574 6572 6d69 6e65  cannot determine
-00006230: 2072 656c 6961 626c 7920 6966 2055 7365   reliably if Use
-00006240: 7273 2061 7265 2061 6666 6563 7465 642e  rs are affected.
-00006250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006260: 206c 6f67 6765 722e 7761 726e 696e 6728   logger.warning(
-00006270: 6622 5061 6972 207b 7061 6972 7d20 6973  f"Pair {pair} is
-00006280: 2072 6573 7472 6963 7465 6420 666f 7220   restricted for 
-00006290: 736f 6d65 2075 7365 7273 206f 6e20 7468  some users on th
-000062a0: 6973 2065 7863 6861 6e67 652e 220a 2020  is exchange.".  
-000062b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000062c0: 2020 2020 2020 2020 2020 2020 2066 2250               f"P
-000062d0: 6c65 6173 6520 6368 6563 6b20 6966 2079  lease check if y
-000062e0: 6f75 2061 7265 2069 6d70 6163 7465 6420  ou are impacted 
-000062f0: 6279 2074 6869 7320 7265 7374 7269 6374  by this restrict
-00006300: 696f 6e20 220a 2020 2020 2020 2020 2020  ion ".          
+00004fa0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+00004fb0: 6563 6973 696f 6e4d 6f64 652c 2063 6f6e  ecisionMode, con
+00004fc0: 7472 6163 745f 7369 7a65 290a 0a20 2020  tract_size)..   
+00004fd0: 2064 6566 2073 6574 5f73 616e 6462 6f78   def set_sandbox
+00004fe0: 2873 656c 662c 2061 7069 3a20 6363 7874  (self, api: ccxt
+00004ff0: 2e45 7863 6861 6e67 652c 2065 7863 6861  .Exchange, excha
+00005000: 6e67 655f 636f 6e66 6967 3a20 6469 6374  nge_config: dict
+00005010: 2c20 6e61 6d65 3a20 7374 7229 202d 3e20  , name: str) -> 
+00005020: 4e6f 6e65 3a0a 2020 2020 2020 2020 6966  None:.        if
+00005030: 2065 7863 6861 6e67 655f 636f 6e66 6967   exchange_config
+00005040: 2e67 6574 2827 7361 6e64 626f 7827 293a  .get('sandbox'):
+00005050: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00005060: 6170 692e 7572 6c73 2e67 6574 2827 7465  api.urls.get('te
+00005070: 7374 2729 3a0a 2020 2020 2020 2020 2020  st'):.          
+00005080: 2020 2020 2020 6170 692e 7572 6c73 5b27        api.urls['
+00005090: 6170 6927 5d20 3d20 6170 692e 7572 6c73  api'] = api.urls
+000050a0: 5b27 7465 7374 275d 0a20 2020 2020 2020  ['test'].       
+000050b0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+000050c0: 696e 666f 2822 456e 6162 6c65 6420 5361  info("Enabled Sa
+000050d0: 6e64 626f 7820 4150 4920 6f6e 2025 7322  ndbox API on %s"
+000050e0: 2c20 6e61 6d65 290a 2020 2020 2020 2020  , name).        
+000050f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00005100: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+00005110: 2e77 6172 6e69 6e67 280a 2020 2020 2020  .warning(.      
+00005120: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00005130: 4e6f 2053 616e 6462 6f78 2055 524c 2069  No Sandbox URL i
+00005140: 6e20 4343 5854 2066 6f72 207b 6e61 6d65  n CCXT for {name
+00005150: 7d2c 2065 7869 7469 6e67 2e20 506c 6561  }, exiting. Plea
+00005160: 7365 2063 6865 636b 2079 6f75 7220 636f  se check your co
+00005170: 6e66 6967 2e6a 736f 6e22 290a 2020 2020  nfig.json").    
+00005180: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00005190: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
+000051a0: 6570 7469 6f6e 2866 2745 7863 6861 6e67  eption(f'Exchang
+000051b0: 6520 7b6e 616d 657d 2064 6f65 7320 6e6f  e {name} does no
+000051c0: 7420 7072 6f76 6964 6520 6120 7361 6e64  t provide a sand
+000051d0: 626f 7820 6170 6927 290a 0a20 2020 2064  box api')..    d
+000051e0: 6566 205f 6c6f 6164 5f61 7379 6e63 5f6d  ef _load_async_m
+000051f0: 6172 6b65 7473 2873 656c 662c 2072 656c  arkets(self, rel
+00005200: 6f61 643a 2062 6f6f 6c20 3d20 4661 6c73  oad: bool = Fals
+00005210: 6529 202d 3e20 4e6f 6e65 3a0a 2020 2020  e) -> None:.    
+00005220: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00005230: 2020 2020 2069 6620 7365 6c66 2e5f 6170       if self._ap
+00005240: 695f 6173 796e 633a 0a20 2020 2020 2020  i_async:.       
+00005250: 2020 2020 2020 2020 2073 656c 662e 6c6f           self.lo
+00005260: 6f70 2e72 756e 5f75 6e74 696c 5f63 6f6d  op.run_until_com
+00005270: 706c 6574 6528 0a20 2020 2020 2020 2020  plete(.         
+00005280: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005290: 5f61 7069 5f61 7379 6e63 2e6c 6f61 645f  _api_async.load_
+000052a0: 6d61 726b 6574 7328 7265 6c6f 6164 3d72  markets(reload=r
+000052b0: 656c 6f61 642c 2070 6172 616d 733d 7b7d  eload, params={}
+000052c0: 2929 0a0a 2020 2020 2020 2020 6578 6365  ))..        exce
+000052d0: 7074 2028 6173 796e 6369 6f2e 5469 6d65  pt (asyncio.Time
+000052e0: 6f75 7445 7272 6f72 2c20 6363 7874 2e42  outError, ccxt.B
+000052f0: 6173 6545 7272 6f72 2920 6173 2065 3a0a  aseError) as e:.
+00005300: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+00005310: 6572 2e77 6172 6e69 6e67 2827 436f 756c  er.warning('Coul
+00005320: 6420 6e6f 7420 6c6f 6164 2061 7379 6e63  d not load async
+00005330: 206d 6172 6b65 7473 2e20 5265 6173 6f6e   markets. Reason
+00005340: 3a20 2573 272c 2065 290a 2020 2020 2020  : %s', e).      
+00005350: 2020 2020 2020 7265 7475 726e 0a0a 2020        return..  
+00005360: 2020 6465 6620 5f6c 6f61 645f 6d61 726b    def _load_mark
+00005370: 6574 7328 7365 6c66 2920 2d3e 204e 6f6e  ets(self) -> Non
+00005380: 653a 0a20 2020 2020 2020 2022 2222 2049  e:.        """ I
+00005390: 6e69 7469 616c 697a 6520 6d61 726b 6574  nitialize market
+000053a0: 7320 626f 7468 2073 796e 6320 616e 6420  s both sync and 
+000053b0: 6173 796e 6320 2222 220a 2020 2020 2020  async """.      
+000053c0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+000053d0: 2020 2073 656c 662e 5f6d 6172 6b65 7473     self._markets
+000053e0: 203d 2073 656c 662e 5f61 7069 2e6c 6f61   = self._api.loa
+000053f0: 645f 6d61 726b 6574 7328 7061 7261 6d73  d_markets(params
+00005400: 3d7b 7d29 0a20 2020 2020 2020 2020 2020  ={}).           
+00005410: 2073 656c 662e 5f6c 6f61 645f 6173 796e   self._load_asyn
+00005420: 635f 6d61 726b 6574 7328 290a 2020 2020  c_markets().    
+00005430: 2020 2020 2020 2020 7365 6c66 2e5f 6c61          self._la
+00005440: 7374 5f6d 6172 6b65 7473 5f72 6566 7265  st_markets_refre
+00005450: 7368 203d 2064 745f 7473 2829 0a20 2020  sh = dt_ts().   
+00005460: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00005470: 2e5f 6674 5f68 6173 5b27 6e65 6564 735f  ._ft_has['needs_
+00005480: 7472 6164 696e 675f 6665 6573 275d 3a0a  trading_fees']:.
+00005490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000054a0: 7365 6c66 2e5f 7472 6164 696e 675f 6665  self._trading_fe
+000054b0: 6573 203d 2073 656c 662e 6665 7463 685f  es = self.fetch_
+000054c0: 7472 6164 696e 675f 6665 6573 2829 0a0a  trading_fees()..
+000054d0: 2020 2020 2020 2020 6578 6365 7074 2063          except c
+000054e0: 6378 742e 4261 7365 4572 726f 723a 0a20  cxt.BaseError:. 
+000054f0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+00005500: 722e 6578 6365 7074 696f 6e28 2755 6e61  r.exception('Una
+00005510: 626c 6520 746f 2069 6e69 7469 616c 697a  ble to initializ
+00005520: 6520 6d61 726b 6574 732e 2729 0a0a 2020  e markets.')..  
+00005530: 2020 6465 6620 7265 6c6f 6164 5f6d 6172    def reload_mar
+00005540: 6b65 7473 2873 656c 6629 202d 3e20 4e6f  kets(self) -> No
+00005550: 6e65 3a0a 2020 2020 2020 2020 2222 2252  ne:.        """R
+00005560: 656c 6f61 6420 6d61 726b 6574 7320 626f  eload markets bo
+00005570: 7468 2073 796e 6320 616e 6420 6173 796e  th sync and asyn
+00005580: 6320 6966 2072 6566 7265 7368 2069 6e74  c if refresh int
+00005590: 6572 7661 6c20 6861 7320 7061 7373 6564  erval has passed
+000055a0: 2022 2222 0a20 2020 2020 2020 2023 2043   """.        # C
+000055b0: 6865 636b 2077 6865 7468 6572 206d 6172  heck whether mar
+000055c0: 6b65 7473 2068 6176 6520 746f 2062 6520  kets have to be 
+000055d0: 7265 6c6f 6164 6564 0a20 2020 2020 2020  reloaded.       
+000055e0: 2069 6620 2873 656c 662e 5f6c 6173 745f   if (self._last_
+000055f0: 6d61 726b 6574 735f 7265 6672 6573 6820  markets_refresh 
+00005600: 3e20 3029 2061 6e64 2028 0a20 2020 2020  > 0) and (.     
+00005610: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005620: 5f6c 6173 745f 6d61 726b 6574 735f 7265  _last_markets_re
+00005630: 6672 6573 6820 2b20 7365 6c66 2e6d 6172  fresh + self.mar
+00005640: 6b65 7473 5f72 6566 7265 7368 5f69 6e74  kets_refresh_int
+00005650: 6572 7661 6c20 3e20 6474 5f74 7328 2929  erval > dt_ts())
+00005660: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00005670: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
+00005680: 2020 6c6f 6767 6572 2e64 6562 7567 2822    logger.debug("
+00005690: 5065 7266 6f72 6d69 6e67 2073 6368 6564  Performing sched
+000056a0: 756c 6564 206d 6172 6b65 7420 7265 6c6f  uled market relo
+000056b0: 6164 2e2e 2229 0a20 2020 2020 2020 2074  ad..").        t
+000056c0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+000056d0: 7365 6c66 2e5f 6d61 726b 6574 7320 3d20  self._markets = 
+000056e0: 7365 6c66 2e5f 6170 692e 6c6f 6164 5f6d  self._api.load_m
+000056f0: 6172 6b65 7473 2872 656c 6f61 643d 5472  arkets(reload=Tr
+00005700: 7565 2c20 7061 7261 6d73 3d7b 7d29 0a20  ue, params={}). 
+00005710: 2020 2020 2020 2020 2020 2023 2041 6c73             # Als
+00005720: 6f20 7265 6c6f 6164 2061 7379 6e63 206d  o reload async m
+00005730: 6172 6b65 7473 2074 6f20 6176 6f69 6420  arkets to avoid 
+00005740: 6973 7375 6573 2077 6974 6820 6e65 776c  issues with newl
+00005750: 7920 6c69 7374 6564 2070 6169 7273 0a20  y listed pairs. 
+00005760: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005770: 5f6c 6f61 645f 6173 796e 635f 6d61 726b  _load_async_mark
+00005780: 6574 7328 7265 6c6f 6164 3d54 7275 6529  ets(reload=True)
+00005790: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000057a0: 662e 5f6c 6173 745f 6d61 726b 6574 735f  f._last_markets_
+000057b0: 7265 6672 6573 6820 3d20 6474 5f74 7328  refresh = dt_ts(
+000057c0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
+000057d0: 6c66 2e66 696c 6c5f 6c65 7665 7261 6765  lf.fill_leverage
+000057e0: 5f74 6965 7273 2829 0a20 2020 2020 2020  _tiers().       
+000057f0: 2065 7863 6570 7420 6363 7874 2e42 6173   except ccxt.Bas
+00005800: 6545 7272 6f72 3a0a 2020 2020 2020 2020  eError:.        
+00005810: 2020 2020 6c6f 6767 6572 2e65 7863 6570      logger.excep
+00005820: 7469 6f6e 2822 436f 756c 6420 6e6f 7420  tion("Could not 
+00005830: 7265 6c6f 6164 206d 6172 6b65 7473 2e22  reload markets."
+00005840: 290a 0a20 2020 2064 6566 2076 616c 6964  )..    def valid
+00005850: 6174 655f 7374 616b 6563 7572 7265 6e63  ate_stakecurrenc
+00005860: 7928 7365 6c66 2c20 7374 616b 655f 6375  y(self, stake_cu
+00005870: 7272 656e 6379 3a20 7374 7229 202d 3e20  rrency: str) -> 
+00005880: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
+00005890: 220a 2020 2020 2020 2020 4368 6563 6b73  ".        Checks
+000058a0: 2073 7461 6b65 2d63 7572 7265 6e63 7920   stake-currency 
+000058b0: 6167 6169 6e73 7420 6176 6169 6c61 626c  against availabl
+000058c0: 6520 6375 7272 656e 6369 6573 206f 6e20  e currencies on 
+000058d0: 7468 6520 6578 6368 616e 6765 2e0a 2020  the exchange..  
+000058e0: 2020 2020 2020 4f6e 6c79 2072 756e 7320        Only runs 
+000058f0: 6f6e 2073 7461 7274 7570 2e20 4966 206d  on startup. If m
+00005900: 6172 6b65 7473 2068 6176 6520 6e6f 7420  arkets have not 
+00005910: 6265 656e 206c 6f61 6465 642c 2074 6865  been loaded, the
+00005920: 7265 2773 2062 6565 6e20 6120 7072 6f62  re's been a prob
+00005930: 6c65 6d20 7769 7468 0a20 2020 2020 2020  lem with.       
+00005940: 2074 6865 2063 6f6e 6e65 6374 696f 6e20   the connection 
+00005950: 746f 2074 6865 2065 7863 6861 6e67 652e  to the exchange.
+00005960: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00005970: 7374 616b 655f 6375 7272 656e 6379 3a20  stake_currency: 
+00005980: 5374 616b 652d 6375 7272 656e 6379 2074  Stake-currency t
+00005990: 6f20 7661 6c69 6461 7465 0a20 2020 2020  o validate.     
+000059a0: 2020 203a 7261 6973 653a 204f 7065 7261     :raise: Opera
+000059b0: 7469 6f6e 616c 4578 6365 7074 696f 6e20  tionalException 
+000059c0: 6966 2073 7461 6b65 2d63 7572 7265 6e63  if stake-currenc
+000059d0: 7920 6973 206e 6f74 2061 7661 696c 6162  y is not availab
+000059e0: 6c65 2e0a 2020 2020 2020 2020 2222 220a  le..        """.
+000059f0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+00005a00: 656c 662e 5f6d 6172 6b65 7473 3a0a 2020  elf._markets:.  
+00005a10: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00005a20: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
+00005a30: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
+00005a40: 2020 2020 2020 2743 6f75 6c64 206e 6f74        'Could not
+00005a50: 206c 6f61 6420 6d61 726b 6574 732c 2074   load markets, t
+00005a60: 6865 7265 666f 7265 2063 616e 6e6f 7420  herefore cannot 
+00005a70: 7374 6172 742e 2027 0a20 2020 2020 2020  start. '.       
+00005a80: 2020 2020 2020 2020 2027 506c 6561 7365           'Please
+00005a90: 2069 6e76 6573 7469 6761 7465 2074 6865   investigate the
+00005aa0: 2061 626f 7665 2065 7272 6f72 2066 6f72   above error for
+00005ab0: 206d 6f72 6520 6465 7461 696c 732e 270a   more details.'.
+00005ac0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00005ad0: 2020 2020 2020 7175 6f74 655f 6375 7272        quote_curr
+00005ae0: 656e 6369 6573 203d 2073 656c 662e 6765  encies = self.ge
+00005af0: 745f 7175 6f74 655f 6375 7272 656e 6369  t_quote_currenci
+00005b00: 6573 2829 0a20 2020 2020 2020 2069 6620  es().        if 
+00005b10: 7374 616b 655f 6375 7272 656e 6379 206e  stake_currency n
+00005b20: 6f74 2069 6e20 7175 6f74 655f 6375 7272  ot in quote_curr
+00005b30: 656e 6369 6573 3a0a 2020 2020 2020 2020  encies:.        
+00005b40: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
+00005b50: 696f 6e61 6c45 7863 6570 7469 6f6e 280a  ionalException(.
+00005b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005b70: 6622 7b73 7461 6b65 5f63 7572 7265 6e63  f"{stake_currenc
+00005b80: 797d 2069 7320 6e6f 7420 6176 6169 6c61  y} is not availa
+00005b90: 626c 6520 6173 2073 7461 6b65 206f 6e20  ble as stake on 
+00005ba0: 7b73 656c 662e 6e61 6d65 7d2e 2022 0a20  {self.name}. ". 
+00005bb0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00005bc0: 2241 7661 696c 6162 6c65 2063 7572 7265  "Available curre
+00005bd0: 6e63 6965 7320 6172 653a 207b 272c 2027  ncies are: {', '
+00005be0: 2e6a 6f69 6e28 7175 6f74 655f 6375 7272  .join(quote_curr
+00005bf0: 656e 6369 6573 297d 2229 0a0a 2020 2020  encies)}")..    
+00005c00: 6465 6620 7661 6c69 6461 7465 5f70 6169  def validate_pai
+00005c10: 7273 2873 656c 662c 2070 6169 7273 3a20  rs(self, pairs: 
+00005c20: 4c69 7374 5b73 7472 5d29 202d 3e20 4e6f  List[str]) -> No
+00005c30: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
+00005c40: 2020 2020 2020 2020 4368 6563 6b73 2069          Checks i
+00005c50: 6620 616c 6c20 6769 7665 6e20 7061 6972  f all given pair
+00005c60: 7320 6172 6520 7472 6164 6162 6c65 206f  s are tradable o
+00005c70: 6e20 7468 6520 6375 7272 656e 7420 6578  n the current ex
+00005c80: 6368 616e 6765 2e0a 2020 2020 2020 2020  change..        
+00005c90: 3a70 6172 616d 2070 6169 7273 3a20 6c69  :param pairs: li
+00005ca0: 7374 206f 6620 7061 6972 730a 2020 2020  st of pairs.    
+00005cb0: 2020 2020 3a72 6169 7365 3a20 4f70 6572      :raise: Oper
+00005cc0: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
+00005cd0: 2069 6620 6f6e 6520 7061 6972 2069 7320   if one pair is 
+00005ce0: 6e6f 7420 6176 6169 6c61 626c 650a 2020  not available.  
+00005cf0: 2020 2020 2020 3a72 6574 7572 6e3a 204e        :return: N
+00005d00: 6f6e 650a 2020 2020 2020 2020 2222 220a  one.        """.
+00005d10: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00005d20: 7365 6c66 2e6d 6172 6b65 7473 3a0a 2020  self.markets:.  
+00005d30: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+00005d40: 2e77 6172 6e69 6e67 2827 556e 6162 6c65  .warning('Unable
+00005d50: 2074 6f20 7661 6c69 6461 7465 2070 6169   to validate pai
+00005d60: 7273 2028 6173 7375 6d69 6e67 2074 6865  rs (assuming the
+00005d70: 7920 6172 6520 636f 7272 6563 7429 2e27  y are correct).'
+00005d80: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00005d90: 7475 726e 0a20 2020 2020 2020 2065 7874  turn.        ext
+00005da0: 656e 6465 645f 7061 6972 7320 3d20 6578  ended_pairs = ex
+00005db0: 7061 6e64 5f70 6169 726c 6973 7428 7061  pand_pairlist(pa
+00005dc0: 6972 732c 206c 6973 7428 7365 6c66 2e6d  irs, list(self.m
+00005dd0: 6172 6b65 7473 292c 206b 6565 705f 696e  arkets), keep_in
+00005de0: 7661 6c69 643d 5472 7565 290a 2020 2020  valid=True).    
+00005df0: 2020 2020 696e 7661 6c69 645f 7061 6972      invalid_pair
+00005e00: 7320 3d20 5b5d 0a20 2020 2020 2020 2066  s = [].        f
+00005e10: 6f72 2070 6169 7220 696e 2065 7874 656e  or pair in exten
+00005e20: 6465 645f 7061 6972 733a 0a20 2020 2020  ded_pairs:.     
+00005e30: 2020 2020 2020 2023 204e 6f74 653a 2063         # Note: c
+00005e40: 6378 7420 6861 7320 4261 7365 4375 7272  cxt has BaseCurr
+00005e50: 656e 6379 2f51 756f 7465 4375 7272 656e  ency/QuoteCurren
+00005e60: 6379 2066 6f72 6d61 7420 666f 7220 7061  cy format for pa
+00005e70: 6972 730a 2020 2020 2020 2020 2020 2020  irs.            
+00005e80: 6966 2073 656c 662e 6d61 726b 6574 7320  if self.markets 
+00005e90: 616e 6420 7061 6972 206e 6f74 2069 6e20  and pair not in 
+00005ea0: 7365 6c66 2e6d 6172 6b65 7473 3a0a 2020  self.markets:.  
+00005eb0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00005ec0: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+00005ed0: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
+00005ee0: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+00005ef0: 5061 6972 207b 7061 6972 7d20 6973 206e  Pair {pair} is n
+00005f00: 6f74 2061 7661 696c 6162 6c65 206f 6e20  ot available on 
+00005f10: 7b73 656c 662e 6e61 6d65 7d20 7b73 656c  {self.name} {sel
+00005f20: 662e 7472 6164 696e 675f 6d6f 6465 2e76  f.trading_mode.v
+00005f30: 616c 7565 7d2e 2027 0a20 2020 2020 2020  alue}. '.       
+00005f40: 2020 2020 2020 2020 2020 2020 2066 2750               f'P
+00005f50: 6c65 6173 6520 7265 6d6f 7665 207b 7061  lease remove {pa
+00005f60: 6972 7d20 6672 6f6d 2079 6f75 7220 7768  ir} from your wh
+00005f70: 6974 656c 6973 742e 2729 0a0a 2020 2020  itelist.')..    
+00005f80: 2020 2020 2020 2020 2020 2020 2320 4672              # Fr
+00005f90: 6f6d 2063 6378 7420 446f 6375 6d65 6e74  om ccxt Document
+00005fa0: 6174 696f 6e3a 0a20 2020 2020 2020 2020  ation:.         
+00005fb0: 2020 2020 2020 2023 206d 6172 6b65 7473         # markets
+00005fc0: 2e69 6e66 6f3a 2041 6e20 6173 736f 6369  .info: An associ
+00005fd0: 6174 6976 6520 6172 7261 7920 6f66 206e  ative array of n
+00005fe0: 6f6e 2d63 6f6d 6d6f 6e20 6d61 726b 6574  on-common market
+00005ff0: 2070 726f 7065 7274 6965 732c 0a20 2020   properties,.   
+00006000: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+00006010: 6e63 6c75 6469 6e67 2066 6565 732c 2072  ncluding fees, r
+00006020: 6174 6573 2c20 6c69 6d69 7473 2061 6e64  ates, limits and
+00006030: 206f 7468 6572 2067 656e 6572 616c 206d   other general m
+00006040: 6172 6b65 7420 696e 666f 726d 6174 696f  arket informatio
+00006050: 6e2e 0a20 2020 2020 2020 2020 2020 2020  n..             
+00006060: 2020 2023 2054 6865 2069 6e74 6572 6e61     # The interna
+00006070: 6c20 696e 666f 2061 7272 6179 2069 7320  l info array is 
+00006080: 6469 6666 6572 656e 7420 666f 7220 6561  different for ea
+00006090: 6368 2070 6172 7469 6375 6c61 7220 6d61  ch particular ma
+000060a0: 726b 6574 2c0a 2020 2020 2020 2020 2020  rket,.          
+000060b0: 2020 2020 2020 2320 6974 7320 636f 6e74        # its cont
+000060c0: 656e 7473 2064 6570 656e 6420 6f6e 2074  ents depend on t
+000060d0: 6865 2065 7863 6861 6e67 652e 0a20 2020  he exchange..   
+000060e0: 2020 2020 2020 2020 2020 2020 2023 2049               # I
+000060f0: 7420 6361 6e20 616c 736f 2062 6520 6120  t can also be a 
+00006100: 7374 7269 6e67 206f 7220 7369 6d69 6c61  string or simila
+00006110: 7220 2e2e 2e20 736f 2077 6520 6e65 6564  r ... so we need
+00006120: 2074 6f20 7665 7269 6679 2074 6861 7420   to verify that 
+00006130: 6669 7273 742e 0a20 2020 2020 2020 2020  first..         
+00006140: 2020 2065 6c69 6620 2869 7369 6e73 7461     elif (isinsta
+00006150: 6e63 6528 7365 6c66 2e6d 6172 6b65 7473  nce(self.markets
+00006160: 5b70 6169 725d 2e67 6574 2827 696e 666f  [pair].get('info
+00006170: 2729 2c20 6469 6374 290a 2020 2020 2020  '), dict).      
+00006180: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+00006190: 7365 6c66 2e6d 6172 6b65 7473 5b70 6169  self.markets[pai
+000061a0: 725d 2e67 6574 2827 696e 666f 272c 207b  r].get('info', {
+000061b0: 7d29 2e67 6574 2827 7072 6f68 6962 6974  }).get('prohibit
+000061c0: 6564 496e 272c 2046 616c 7365 2929 3a0a  edIn', False)):.
+000061d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000061e0: 2320 5761 726e 2075 7365 7273 2061 626f  # Warn users abo
+000061f0: 7574 2072 6573 7472 6963 7465 6420 7061  ut restricted pa
+00006200: 6972 7320 696e 2077 6869 7465 6c69 7374  irs in whitelist
+00006210: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006220: 2020 2320 5765 2063 616e 6e6f 7420 6465    # We cannot de
+00006230: 7465 726d 696e 6520 7265 6c69 6162 6c79  termine reliably
+00006240: 2069 6620 5573 6572 7320 6172 6520 6166   if Users are af
+00006250: 6665 6374 6564 2e0a 2020 2020 2020 2020  fected..        
+00006260: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
+00006270: 6172 6e69 6e67 2866 2250 6169 7220 7b70  arning(f"Pair {p
+00006280: 6169 727d 2069 7320 7265 7374 7269 6374  air} is restrict
+00006290: 6564 2066 6f72 2073 6f6d 6520 7573 6572  ed for some user
+000062a0: 7320 6f6e 2074 6869 7320 6578 6368 616e  s on this exchan
+000062b0: 6765 2e22 0a20 2020 2020 2020 2020 2020  ge.".           
+000062c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000062d0: 2020 2020 6622 506c 6561 7365 2063 6865      f"Please che
+000062e0: 636b 2069 6620 796f 7520 6172 6520 696d  ck if you are im
+000062f0: 7061 6374 6564 2062 7920 7468 6973 2072  pacted by this r
+00006300: 6573 7472 6963 7469 6f6e 2022 0a20 2020  estriction ".   
 00006310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006320: 2020 2020 2066 226f 6e20 7468 6520 6578       f"on the ex
-00006330: 6368 616e 6765 2061 6e64 2065 7665 6e74  change and event
-00006340: 7561 6c6c 7920 7265 6d6f 7665 207b 7061  ually remove {pa
-00006350: 6972 7d20 6672 6f6d 2079 6f75 7220 7768  ir} from your wh
-00006360: 6974 656c 6973 742e 2229 0a20 2020 2020  itelist.").     
-00006370: 2020 2020 2020 2069 6620 2873 656c 662e         if (self.
-00006380: 5f63 6f6e 6669 675b 2773 7461 6b65 5f63  _config['stake_c
-00006390: 7572 7265 6e63 7927 5d20 616e 640a 2020  urrency'] and.  
-000063a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000063b0: 2020 7365 6c66 2e67 6574 5f70 6169 725f    self.get_pair_
-000063c0: 7175 6f74 655f 6375 7272 656e 6379 2870  quote_currency(p
-000063d0: 6169 7229 2021 3d20 7365 6c66 2e5f 636f  air) != self._co
-000063e0: 6e66 6967 5b27 7374 616b 655f 6375 7272  nfig['stake_curr
-000063f0: 656e 6379 275d 293a 0a20 2020 2020 2020  ency']):.       
-00006400: 2020 2020 2020 2020 2069 6e76 616c 6964           invalid
-00006410: 5f70 6169 7273 2e61 7070 656e 6428 7061  _pairs.append(pa
-00006420: 6972 290a 2020 2020 2020 2020 6966 2069  ir).        if i
-00006430: 6e76 616c 6964 5f70 6169 7273 3a0a 2020  nvalid_pairs:.  
-00006440: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00006450: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
-00006460: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
-00006470: 2020 2020 2020 6622 5374 616b 652d 6375        f"Stake-cu
-00006480: 7272 656e 6379 2027 7b73 656c 662e 5f63  rrency '{self._c
-00006490: 6f6e 6669 675b 2773 7461 6b65 5f63 7572  onfig['stake_cur
-000064a0: 7265 6e63 7927 5d7d 2720 6e6f 7420 636f  rency']}' not co
-000064b0: 6d70 6174 6962 6c65 2077 6974 6820 220a  mpatible with ".
-000064c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000064d0: 6622 7061 6972 2d77 6869 7465 6c69 7374  f"pair-whitelist
-000064e0: 2e20 506c 6561 7365 2072 656d 6f76 6520  . Please remove 
-000064f0: 7468 6520 666f 6c6c 6f77 696e 6720 7061  the following pa
-00006500: 6972 733a 207b 696e 7661 6c69 645f 7061  irs: {invalid_pa
-00006510: 6972 737d 2229 0a0a 2020 2020 6465 6620  irs}")..    def 
-00006520: 6765 745f 7661 6c69 645f 7061 6972 5f63  get_valid_pair_c
-00006530: 6f6d 6269 6e61 7469 6f6e 2873 656c 662c  ombination(self,
-00006540: 2063 7572 725f 313a 2073 7472 2c20 6375   curr_1: str, cu
-00006550: 7272 5f32 3a20 7374 7229 202d 3e20 7374  rr_2: str) -> st
-00006560: 723a 0a20 2020 2020 2020 2022 2222 0a20  r:.        """. 
-00006570: 2020 2020 2020 2047 6574 2076 616c 6964         Get valid
-00006580: 2070 6169 7220 636f 6d62 696e 6174 696f   pair combinatio
-00006590: 6e20 6f66 2063 7572 725f 3120 616e 6420  n of curr_1 and 
-000065a0: 6375 7272 5f32 2062 7920 7472 7969 6e67  curr_2 by trying
-000065b0: 2062 6f74 6820 636f 6d62 696e 6174 696f   both combinatio
-000065c0: 6e73 2e0a 2020 2020 2020 2020 2222 220a  ns..        """.
-000065d0: 2020 2020 2020 2020 666f 7220 7061 6972          for pair
-000065e0: 2069 6e20 5b66 227b 6375 7272 5f31 7d2f   in [f"{curr_1}/
-000065f0: 7b63 7572 725f 327d 222c 2066 227b 6375  {curr_2}", f"{cu
-00006600: 7272 5f32 7d2f 7b63 7572 725f 317d 225d  rr_2}/{curr_1}"]
-00006610: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00006620: 2070 6169 7220 696e 2073 656c 662e 6d61   pair in self.ma
-00006630: 726b 6574 7320 616e 6420 7365 6c66 2e6d  rkets and self.m
-00006640: 6172 6b65 7473 5b70 6169 725d 2e67 6574  arkets[pair].get
-00006650: 2827 6163 7469 7665 2729 3a0a 2020 2020  ('active'):.    
-00006660: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00006670: 726e 2070 6169 720a 2020 2020 2020 2020  rn pair.        
-00006680: 7261 6973 6520 4578 6368 616e 6765 4572  raise ExchangeEr
-00006690: 726f 7228 6622 436f 756c 6420 6e6f 7420  ror(f"Could not 
-000066a0: 636f 6d62 696e 6520 7b63 7572 725f 317d  combine {curr_1}
-000066b0: 2061 6e64 207b 6375 7272 5f32 7d20 746f   and {curr_2} to
-000066c0: 2067 6574 2061 2076 616c 6964 2070 6169   get a valid pai
-000066d0: 722e 2229 0a0a 2020 2020 6465 6620 7661  r.")..    def va
-000066e0: 6c69 6461 7465 5f74 696d 6566 7261 6d65  lidate_timeframe
-000066f0: 7328 7365 6c66 2c20 7469 6d65 6672 616d  s(self, timefram
-00006700: 653a 204f 7074 696f 6e61 6c5b 7374 725d  e: Optional[str]
-00006710: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00006720: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
-00006730: 6865 636b 2069 6620 7469 6d65 6672 616d  heck if timefram
-00006740: 6520 6672 6f6d 2063 6f6e 6669 6720 6973  e from config is
-00006750: 2061 2073 7570 706f 7274 6564 2074 696d   a supported tim
-00006760: 6566 7261 6d65 206f 6e20 7468 6520 6578  eframe on the ex
-00006770: 6368 616e 6765 0a20 2020 2020 2020 2022  change.        "
-00006780: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
-00006790: 7420 6861 7361 7474 7228 7365 6c66 2e5f  t hasattr(self._
-000067a0: 6170 692c 2022 7469 6d65 6672 616d 6573  api, "timeframes
-000067b0: 2229 206f 7220 7365 6c66 2e5f 6170 692e  ") or self._api.
-000067c0: 7469 6d65 6672 616d 6573 2069 7320 4e6f  timeframes is No
-000067d0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-000067e0: 2320 4966 2074 696d 6566 7261 6d65 7320  # If timeframes 
-000067f0: 6174 7472 6962 7574 6520 6973 206d 6973  attribute is mis
-00006800: 7369 6e67 2028 6f72 2069 7320 4e6f 6e65  sing (or is None
-00006810: 292c 2074 6865 2065 7863 6861 6e67 6520  ), the exchange 
-00006820: 7072 6f62 6162 6c79 0a20 2020 2020 2020  probably.       
-00006830: 2020 2020 2023 2068 6173 206e 6f20 6665       # has no fe
-00006840: 7463 684f 484c 4356 206d 6574 686f 642e  tchOHLCV method.
-00006850: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
-00006860: 6865 7265 666f 7265 2077 6520 616c 736f  herefore we also
-00006870: 2073 686f 7720 7468 6174 2e0a 2020 2020   show that..    
-00006880: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
-00006890: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
-000068a0: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-000068b0: 2020 2020 6622 5468 6520 6363 7874 206c      f"The ccxt l
-000068c0: 6962 7261 7279 2064 6f65 7320 6e6f 7420  ibrary does not 
-000068d0: 7072 6f76 6964 6520 7468 6520 6c69 7374  provide the list
-000068e0: 206f 6620 7469 6d65 6672 616d 6573 2022   of timeframes "
-000068f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006900: 2066 2266 6f72 2074 6865 2065 7863 6861   f"for the excha
-00006910: 6e67 6520 7b73 656c 662e 6e61 6d65 7d20  nge {self.name} 
-00006920: 616e 6420 7468 6973 2065 7863 6861 6e67  and this exchang
-00006930: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
-00006940: 2020 2020 6622 6973 2074 6865 7265 666f      f"is therefo
-00006950: 7265 206e 6f74 2073 7570 706f 7274 6564  re not supported
-00006960: 2e20 6363 7874 2066 6574 6368 4f48 4c43  . ccxt fetchOHLC
-00006970: 563a 207b 7365 6c66 2e65 7863 6861 6e67  V: {self.exchang
-00006980: 655f 6861 7328 2766 6574 6368 4f48 4c43  e_has('fetchOHLC
-00006990: 5627 297d 2229 0a0a 2020 2020 2020 2020  V')}")..        
-000069a0: 6966 2074 696d 6566 7261 6d65 2061 6e64  if timeframe and
-000069b0: 2028 7469 6d65 6672 616d 6520 6e6f 7420   (timeframe not 
-000069c0: 696e 2073 656c 662e 7469 6d65 6672 616d  in self.timefram
-000069d0: 6573 293a 0a20 2020 2020 2020 2020 2020  es):.           
-000069e0: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
-000069f0: 616c 4578 6365 7074 696f 6e28 0a20 2020  alException(.   
-00006a00: 2020 2020 2020 2020 2020 2020 2066 2249               f"I
-00006a10: 6e76 616c 6964 2074 696d 6566 7261 6d65  nvalid timeframe
-00006a20: 2027 7b74 696d 6566 7261 6d65 7d27 2e20   '{timeframe}'. 
-00006a30: 5468 6973 2065 7863 6861 6e67 6520 7375  This exchange su
-00006a40: 7070 6f72 7473 3a20 7b73 656c 662e 7469  pports: {self.ti
-00006a50: 6d65 6672 616d 6573 7d22 290a 0a20 2020  meframes}")..   
-00006a60: 2020 2020 2069 6620 7469 6d65 6672 616d       if timefram
-00006a70: 6520 616e 6420 7469 6d65 6672 616d 655f  e and timeframe_
-00006a80: 746f 5f6d 696e 7574 6573 2874 696d 6566  to_minutes(timef
-00006a90: 7261 6d65 2920 3c20 313a 0a20 2020 2020  rame) < 1:.     
-00006aa0: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
-00006ab0: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
-00006ac0: 6e28 2254 696d 6566 7261 6d65 7320 3c20  n("Timeframes < 
-00006ad0: 316d 2061 7265 2063 7572 7265 6e74 6c79  1m are currently
-00006ae0: 206e 6f74 2073 7570 706f 7274 6564 2062   not supported b
-00006af0: 7920 4672 6571 7472 6164 652e 2229 0a0a  y Freqtrade.")..
-00006b00: 2020 2020 6465 6620 7661 6c69 6461 7465      def validate
-00006b10: 5f6f 7264 6572 7479 7065 7328 7365 6c66  _ordertypes(self
-00006b20: 2c20 6f72 6465 725f 7479 7065 733a 2044  , order_types: D
-00006b30: 6963 7429 202d 3e20 4e6f 6e65 3a0a 2020  ict) -> None:.  
-00006b40: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00006b50: 2020 4368 6563 6b73 2069 6620 6f72 6465    Checks if orde
-00006b60: 722d 7479 7065 7320 636f 6e66 6967 7572  r-types configur
-00006b70: 6564 2069 6e20 7374 7261 7465 6779 2f63  ed in strategy/c
-00006b80: 6f6e 6669 6720 6172 6520 7375 7070 6f72  onfig are suppor
-00006b90: 7465 640a 2020 2020 2020 2020 2222 220a  ted.        """.
-00006ba0: 2020 2020 2020 2020 6966 2061 6e79 2876          if any(v
-00006bb0: 203d 3d20 276d 6172 6b65 7427 2066 6f72   == 'market' for
-00006bc0: 206b 2c20 7620 696e 206f 7264 6572 5f74   k, v in order_t
-00006bd0: 7970 6573 2e69 7465 6d73 2829 293a 0a20  ypes.items()):. 
-00006be0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00006bf0: 7420 7365 6c66 2e65 7863 6861 6e67 655f  t self.exchange_
-00006c00: 6861 7328 2763 7265 6174 654d 6172 6b65  has('createMarke
-00006c10: 744f 7264 6572 2729 3a0a 2020 2020 2020  tOrder'):.      
-00006c20: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00006c30: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
-00006c40: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
-00006c50: 2020 2020 2020 2020 2020 6627 4578 6368            f'Exch
-00006c60: 616e 6765 207b 7365 6c66 2e6e 616d 657d  ange {self.name}
-00006c70: 2064 6f65 7320 6e6f 7420 7375 7070 6f72   does not suppor
-00006c80: 7420 6d61 726b 6574 206f 7264 6572 732e  t market orders.
-00006c90: 2729 0a20 2020 2020 2020 2073 656c 662e  ').        self.
-00006ca0: 7661 6c69 6461 7465 5f73 746f 705f 6f72  validate_stop_or
-00006cb0: 6465 7274 7970 6573 286f 7264 6572 5f74  dertypes(order_t
-00006cc0: 7970 6573 290a 0a20 2020 2064 6566 2076  ypes)..    def v
-00006cd0: 616c 6964 6174 655f 7374 6f70 5f6f 7264  alidate_stop_ord
-00006ce0: 6572 7479 7065 7328 7365 6c66 2c20 6f72  ertypes(self, or
-00006cf0: 6465 725f 7479 7065 733a 2044 6963 7429  der_types: Dict)
-00006d00: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00006d10: 2020 2222 220a 2020 2020 2020 2020 5661    """.        Va
-00006d20: 6c69 6461 7465 2073 746f 706c 6f73 7320  lidate stoploss 
-00006d30: 6f72 6465 7220 7479 7065 730a 2020 2020  order types.    
-00006d40: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00006d50: 6966 2028 6f72 6465 725f 7479 7065 732e  if (order_types.
-00006d60: 6765 7428 2273 746f 706c 6f73 735f 6f6e  get("stoploss_on
-00006d70: 5f65 7863 6861 6e67 6522 290a 2020 2020  _exchange").    
-00006d80: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-00006d90: 6e6f 7420 7365 6c66 2e5f 6674 5f68 6173  not self._ft_has
-00006da0: 2e67 6574 2822 7374 6f70 6c6f 7373 5f6f  .get("stoploss_o
-00006db0: 6e5f 6578 6368 616e 6765 222c 2046 616c  n_exchange", Fal
-00006dc0: 7365 2929 3a0a 2020 2020 2020 2020 2020  se)):.          
-00006dd0: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
-00006de0: 6e61 6c45 7863 6570 7469 6f6e 280a 2020  nalException(.  
-00006df0: 2020 2020 2020 2020 2020 2020 2020 6627                f'
-00006e00: 4f6e 2065 7863 6861 6e67 6520 7374 6f70  On exchange stop
-00006e10: 6c6f 7373 2069 7320 6e6f 7420 7375 7070  loss is not supp
-00006e20: 6f72 7465 6420 666f 7220 7b73 656c 662e  orted for {self.
-00006e30: 6e61 6d65 7d2e 270a 2020 2020 2020 2020  name}.'.        
-00006e40: 2020 2020 290a 2020 2020 2020 2020 6966      ).        if
-00006e50: 2073 656c 662e 7472 6164 696e 675f 6d6f   self.trading_mo
-00006e60: 6465 203d 3d20 5472 6164 696e 674d 6f64  de == TradingMod
-00006e70: 652e 4655 5455 5245 533a 0a20 2020 2020  e.FUTURES:.     
-00006e80: 2020 2020 2020 2070 7269 6365 5f6d 6170         price_map
-00006e90: 7069 6e67 203d 2073 656c 662e 5f66 745f  ping = self._ft_
-00006ea0: 6861 732e 6765 7428 2773 746f 705f 7072  has.get('stop_pr
-00006eb0: 6963 655f 7479 7065 5f76 616c 7565 5f6d  ice_type_value_m
-00006ec0: 6170 7069 6e67 272c 207b 7d29 2e6b 6579  apping', {}).key
-00006ed0: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-00006ee0: 6966 2028 0a20 2020 2020 2020 2020 2020  if (.           
-00006ef0: 2020 2020 206f 7264 6572 5f74 7970 6573       order_types
-00006f00: 2e67 6574 2822 7374 6f70 6c6f 7373 5f6f  .get("stoploss_o
-00006f10: 6e5f 6578 6368 616e 6765 222c 2046 616c  n_exchange", Fal
-00006f20: 7365 2920 6973 2054 7275 650a 2020 2020  se) is True.    
-00006f30: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-00006f40: 2773 746f 706c 6f73 735f 7072 6963 655f  'stoploss_price_
-00006f50: 7479 7065 2720 696e 206f 7264 6572 5f74  type' in order_t
-00006f60: 7970 6573 0a20 2020 2020 2020 2020 2020  ypes.           
-00006f70: 2020 2020 2061 6e64 206f 7264 6572 5f74       and order_t
-00006f80: 7970 6573 5b27 7374 6f70 6c6f 7373 5f70  ypes['stoploss_p
-00006f90: 7269 6365 5f74 7970 6527 5d20 6e6f 7420  rice_type'] not 
-00006fa0: 696e 2070 7269 6365 5f6d 6170 7069 6e67  in price_mapping
-00006fb0: 0a20 2020 2020 2020 2020 2020 2029 3a0a  .            ):.
-00006fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006fd0: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
-00006fe0: 6c45 7863 6570 7469 6f6e 280a 2020 2020  lException(.    
-00006ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007000: 6627 4f6e 2065 7863 6861 6e67 6520 7374  f'On exchange st
-00007010: 6f70 6c6f 7373 2070 7269 6365 2074 7970  oploss price typ
-00007020: 6520 6973 206e 6f74 2073 7570 706f 7274  e is not support
-00007030: 6564 2066 6f72 207b 7365 6c66 2e6e 616d  ed for {self.nam
-00007040: 657d 2e27 0a20 2020 2020 2020 2020 2020  e}.'.           
-00007050: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00007060: 7661 6c69 6461 7465 5f70 7269 6369 6e67  validate_pricing
-00007070: 2873 656c 662c 2070 7269 6369 6e67 3a20  (self, pricing: 
-00007080: 4469 6374 2920 2d3e 204e 6f6e 653a 0a20  Dict) -> None:. 
-00007090: 2020 2020 2020 2069 6620 7072 6963 696e         if pricin
-000070a0: 672e 6765 7428 2775 7365 5f6f 7264 6572  g.get('use_order
-000070b0: 5f62 6f6f 6b27 2c20 4661 6c73 6529 2061  _book', False) a
-000070c0: 6e64 206e 6f74 2073 656c 662e 6578 6368  nd not self.exch
-000070d0: 616e 6765 5f68 6173 2827 6665 7463 684c  ange_has('fetchL
-000070e0: 324f 7264 6572 426f 6f6b 2729 3a0a 2020  2OrderBook'):.  
-000070f0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00007100: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
-00007110: 7469 6f6e 2866 274f 7264 6572 626f 6f6b  tion(f'Orderbook
-00007120: 206e 6f74 2061 7661 696c 6162 6c65 2066   not available f
-00007130: 6f72 207b 7365 6c66 2e6e 616d 657d 2e27  or {self.name}.'
-00007140: 290a 2020 2020 2020 2020 6966 2028 6e6f  ).        if (no
-00007150: 7420 7072 6963 696e 672e 6765 7428 2775  t pricing.get('u
-00007160: 7365 5f6f 7264 6572 5f62 6f6f 6b27 2c20  se_order_book', 
-00007170: 4661 6c73 6529 2061 6e64 2028 0a20 2020  False) and (.   
-00007180: 2020 2020 2020 2020 2020 2020 206e 6f74               not
-00007190: 2073 656c 662e 6578 6368 616e 6765 5f68   self.exchange_h
-000071a0: 6173 2827 6665 7463 6854 6963 6b65 7227  as('fetchTicker'
-000071b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000071c0: 2020 6f72 206e 6f74 2073 656c 662e 5f66    or not self._f
-000071d0: 745f 6861 735b 2774 6963 6b65 7273 5f68  t_has['tickers_h
-000071e0: 6176 655f 7072 6963 6527 5d29 293a 0a20  ave_price'])):. 
-000071f0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00007200: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
-00007210: 7074 696f 6e28 6627 5469 636b 6572 2070  ption(f'Ticker p
-00007220: 7269 6369 6e67 206e 6f74 2061 7661 696c  ricing not avail
-00007230: 6162 6c65 2066 6f72 207b 7365 6c66 2e6e  able for {self.n
-00007240: 616d 657d 2e27 290a 0a20 2020 2064 6566  ame}.')..    def
-00007250: 2076 616c 6964 6174 655f 6f72 6465 725f   validate_order_
-00007260: 7469 6d65 5f69 6e5f 666f 7263 6528 7365  time_in_force(se
-00007270: 6c66 2c20 6f72 6465 725f 7469 6d65 5f69  lf, order_time_i
-00007280: 6e5f 666f 7263 653a 2044 6963 7429 202d  n_force: Dict) -
-00007290: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
-000072a0: 2222 220a 2020 2020 2020 2020 4368 6563  """.        Chec
-000072b0: 6b73 2069 6620 6f72 6465 7220 7469 6d65  ks if order time
-000072c0: 2069 6e20 666f 7263 6520 636f 6e66 6967   in force config
-000072d0: 7572 6564 2069 6e20 7374 7261 7465 6779  ured in strategy
-000072e0: 2f63 6f6e 6669 6720 6172 6520 7375 7070  /config are supp
-000072f0: 6f72 7465 640a 2020 2020 2020 2020 2222  orted.        ""
-00007300: 220a 2020 2020 2020 2020 6966 2061 6e79  ".        if any
-00007310: 2876 2e75 7070 6572 2829 206e 6f74 2069  (v.upper() not i
-00007320: 6e20 7365 6c66 2e5f 6674 5f68 6173 5b22  n self._ft_has["
-00007330: 6f72 6465 725f 7469 6d65 5f69 6e5f 666f  order_time_in_fo
-00007340: 7263 6522 5d0a 2020 2020 2020 2020 2020  rce"].          
-00007350: 2020 2020 2066 6f72 206b 2c20 7620 696e       for k, v in
-00007360: 206f 7264 6572 5f74 696d 655f 696e 5f66   order_time_in_f
-00007370: 6f72 6365 2e69 7465 6d73 2829 293a 0a20  orce.items()):. 
-00007380: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00007390: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
-000073a0: 7074 696f 6e28 0a20 2020 2020 2020 2020  ption(.         
-000073b0: 2020 2020 2020 2066 2754 696d 6520 696e         f'Time in
-000073c0: 2066 6f72 6365 2070 6f6c 6963 6965 7320   force policies 
-000073d0: 6172 6520 6e6f 7420 7375 7070 6f72 7465  are not supporte
-000073e0: 6420 666f 7220 7b73 656c 662e 6e61 6d65  d for {self.name
-000073f0: 7d20 7965 742e 2729 0a0a 2020 2020 6465  } yet.')..    de
-00007400: 6620 7661 6c69 6461 7465 5f72 6571 7569  f validate_requi
-00007410: 7265 645f 7374 6172 7475 705f 6361 6e64  red_startup_cand
-00007420: 6c65 7328 7365 6c66 2c20 7374 6172 7475  les(self, startu
-00007430: 705f 6361 6e64 6c65 733a 2069 6e74 2c20  p_candles: int, 
-00007440: 7469 6d65 6672 616d 653a 2073 7472 2920  timeframe: str) 
-00007450: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
-00007460: 2222 220a 2020 2020 2020 2020 4368 6563  """.        Chec
-00007470: 6b73 2069 6620 7265 7175 6972 6564 2073  ks if required s
-00007480: 7461 7274 7570 5f63 616e 646c 6573 2069  tartup_candles i
-00007490: 7320 6d6f 7265 2074 6861 6e20 6f68 6c63  s more than ohlc
-000074a0: 765f 6361 6e64 6c65 5f6c 696d 6974 2829  v_candle_limit()
-000074b0: 2e0a 2020 2020 2020 2020 5265 7175 6972  ..        Requir
-000074c0: 6573 2061 2067 7261 6365 2d70 6572 696f  es a grace-perio
-000074d0: 6420 6f66 2035 2063 616e 646c 6573 202d  d of 5 candles -
-000074e0: 2073 6f20 6120 7374 6172 7475 702d 7065   so a startup-pe
-000074f0: 7269 6f64 2075 7020 746f 2034 3934 2069  riod up to 494 i
-00007500: 7320 616c 6c6f 7765 6420 6279 2064 6566  s allowed by def
-00007510: 6175 6c74 2e0a 2020 2020 2020 2020 2222  ault..        ""
-00007520: 220a 0a20 2020 2020 2020 2063 616e 646c  "..        candl
-00007530: 655f 6c69 6d69 7420 3d20 7365 6c66 2e6f  e_limit = self.o
-00007540: 686c 6376 5f63 616e 646c 655f 6c69 6d69  hlcv_candle_limi
-00007550: 7428 0a20 2020 2020 2020 2020 2020 2074  t(.            t
-00007560: 696d 6566 7261 6d65 2c20 7365 6c66 2e5f  imeframe, self._
-00007570: 636f 6e66 6967 5b27 6361 6e64 6c65 5f74  config['candle_t
-00007580: 7970 655f 6465 6627 5d2c 0a20 2020 2020  ype_def'],.     
-00007590: 2020 2020 2020 2069 6e74 2864 6174 655f         int(date_
-000075a0: 6d69 6e75 735f 6361 6e64 6c65 7328 7469  minus_candles(ti
-000075b0: 6d65 6672 616d 652c 2073 7461 7274 7570  meframe, startup
-000075c0: 5f63 616e 646c 6573 292e 7469 6d65 7374  _candles).timest
-000075d0: 616d 7028 2920 2a20 3130 3030 290a 2020  amp() * 1000).  
-000075e0: 2020 2020 2020 2020 2020 6966 2074 696d            if tim
-000075f0: 6566 7261 6d65 2065 6c73 6520 4e6f 6e65  eframe else None
-00007600: 290a 2020 2020 2020 2020 2320 5265 7175  ).        # Requ
-00007610: 6972 6520 6f6e 6520 6d6f 7265 2063 616e  ire one more can
-00007620: 646c 6520 2d20 746f 2061 6363 6f75 6e74  dle - to account
-00007630: 2066 6f72 2074 6865 2073 7469 6c6c 206f   for the still o
-00007640: 7065 6e20 6361 6e64 6c65 2e0a 2020 2020  pen candle..    
-00007650: 2020 2020 6361 6e64 6c65 5f63 6f75 6e74      candle_count
-00007660: 203d 2073 7461 7274 7570 5f63 616e 646c   = startup_candl
-00007670: 6573 202b 2031 0a20 2020 2020 2020 2023  es + 1.        #
-00007680: 2041 6c6c 6f77 2035 2063 616c 6c73 2074   Allow 5 calls t
-00007690: 6f20 7468 6520 6578 6368 616e 6765 2070  o the exchange p
-000076a0: 6572 2070 6169 720a 2020 2020 2020 2020  er pair.        
-000076b0: 7265 7175 6972 6564 5f63 616e 646c 655f  required_candle_
-000076c0: 6361 6c6c 5f63 6f75 6e74 203d 2069 6e74  call_count = int
-000076d0: 280a 2020 2020 2020 2020 2020 2020 2863  (.            (c
-000076e0: 616e 646c 655f 636f 756e 7420 2f20 6361  andle_count / ca
-000076f0: 6e64 6c65 5f6c 696d 6974 2920 2b20 2830  ndle_limit) + (0
-00007700: 2069 6620 6361 6e64 6c65 5f63 6f75 6e74   if candle_count
-00007710: 2025 2063 616e 646c 655f 6c69 6d69 7420   % candle_limit 
-00007720: 3d3d 2030 2065 6c73 6520 3129 290a 2020  == 0 else 1)).  
-00007730: 2020 2020 2020 6966 2073 656c 662e 5f66        if self._f
-00007740: 745f 6861 735b 276f 686c 6376 5f68 6173  t_has['ohlcv_has
-00007750: 5f68 6973 746f 7279 275d 3a0a 0a20 2020  _history']:..   
-00007760: 2020 2020 2020 2020 2069 6620 7265 7175           if requ
-00007770: 6972 6564 5f63 616e 646c 655f 6361 6c6c  ired_candle_call
-00007780: 5f63 6f75 6e74 203e 2035 3a0a 2020 2020  _count > 5:.    
-00007790: 2020 2020 2020 2020 2020 2020 2320 4f6e              # On
-000077a0: 6c79 2061 6c6c 6f77 2035 2063 616c 6c73  ly allow 5 calls
-000077b0: 2070 6572 2070 6169 7220 746f 2073 6f6d   per pair to som
-000077c0: 6577 6861 7420 6c69 6d69 7420 7468 6520  ewhat limit the 
-000077d0: 696d 7061 6374 0a20 2020 2020 2020 2020  impact.         
-000077e0: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
-000077f0: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
-00007800: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-00007810: 2020 2020 2020 2066 2254 6869 7320 7374         f"This st
-00007820: 7261 7465 6779 2072 6571 7569 7265 7320  rategy requires 
-00007830: 7b73 7461 7274 7570 5f63 616e 646c 6573  {startup_candles
-00007840: 7d20 6361 6e64 6c65 7320 746f 2073 7461  } candles to sta
-00007850: 7274 2c20 220a 2020 2020 2020 2020 2020  rt, ".          
-00007860: 2020 2020 2020 2020 2020 2277 6869 6368            "which
-00007870: 2069 7320 6d6f 7265 2074 6861 6e20 3578   is more than 5x
-00007880: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-00007890: 2020 2020 2020 2066 2274 6865 2061 6d6f         f"the amo
-000078a0: 756e 7420 6f66 2063 616e 646c 6573 207b  unt of candles {
-000078b0: 7365 6c66 2e6e 616d 657d 2070 726f 7669  self.name} provi
-000078c0: 6465 7320 666f 7220 7b74 696d 6566 7261  des for {timefra
-000078d0: 6d65 7d2e 2229 0a20 2020 2020 2020 2065  me}.").        e
-000078e0: 6c69 6620 7265 7175 6972 6564 5f63 616e  lif required_can
-000078f0: 646c 655f 6361 6c6c 5f63 6f75 6e74 203e  dle_call_count >
-00007900: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00007910: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
-00007920: 6c45 7863 6570 7469 6f6e 280a 2020 2020  lException(.    
-00007930: 2020 2020 2020 2020 2020 2020 6622 5468              f"Th
-00007940: 6973 2073 7472 6174 6567 7920 7265 7175  is strategy requ
-00007950: 6972 6573 207b 7374 6172 7475 705f 6361  ires {startup_ca
-00007960: 6e64 6c65 737d 2063 616e 646c 6573 2074  ndles} candles t
-00007970: 6f20 7374 6172 742c 2077 6869 6368 2069  o start, which i
-00007980: 7320 6d6f 7265 2074 6861 6e20 220a 2020  s more than ".  
-00007990: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-000079a0: 7468 6520 616d 6f75 6e74 206f 6620 6361  the amount of ca
-000079b0: 6e64 6c65 7320 7b73 656c 662e 6e61 6d65  ndles {self.name
-000079c0: 7d20 7072 6f76 6964 6573 2066 6f72 207b  } provides for {
-000079d0: 7469 6d65 6672 616d 657d 2e22 290a 2020  timeframe}.").  
-000079e0: 2020 2020 2020 6966 2072 6571 7569 7265        if require
-000079f0: 645f 6361 6e64 6c65 5f63 616c 6c5f 636f  d_candle_call_co
-00007a00: 756e 7420 3e20 313a 0a20 2020 2020 2020  unt > 1:.       
-00007a10: 2020 2020 206c 6f67 6765 722e 7761 726e       logger.warn
-00007a20: 696e 6728 6622 5573 696e 6720 7b72 6571  ing(f"Using {req
-00007a30: 7569 7265 645f 6361 6e64 6c65 5f63 616c  uired_candle_cal
-00007a40: 6c5f 636f 756e 747d 2063 616c 6c73 2074  l_count} calls t
-00007a50: 6f20 6765 7420 4f48 4c43 562e 2022 0a20  o get OHLCV. ". 
-00007a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007a70: 2020 2020 2020 2020 2020 6622 5468 6973            f"This
-00007a80: 2063 616e 2072 6573 756c 7420 696e 2073   can result in s
-00007a90: 6c6f 7765 7220 6f70 6572 6174 696f 6e73  lower operations
-00007aa0: 2066 6f72 2074 6865 2062 6f74 2e20 506c   for the bot. Pl
-00007ab0: 6561 7365 2063 6865 636b 2022 0a20 2020  ease check ".   
-00007ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007ad0: 2020 2020 2020 2020 6622 6966 2079 6f75          f"if you
-00007ae0: 2072 6561 6c6c 7920 6e65 6564 207b 7374   really need {st
-00007af0: 6172 7475 705f 6361 6e64 6c65 737d 2063  artup_candles} c
-00007b00: 616e 646c 6573 2066 6f72 2079 6f75 7220  andles for your 
-00007b10: 7374 7261 7465 6779 2229 0a20 2020 2020  strategy").     
-00007b20: 2020 2072 6574 7572 6e20 7265 7175 6972     return requir
-00007b30: 6564 5f63 616e 646c 655f 6361 6c6c 5f63  ed_candle_call_c
-00007b40: 6f75 6e74 0a0a 2020 2020 6465 6620 7661  ount..    def va
-00007b50: 6c69 6461 7465 5f74 7261 6469 6e67 5f6d  lidate_trading_m
-00007b60: 6f64 655f 616e 645f 6d61 7267 696e 5f6d  ode_and_margin_m
-00007b70: 6f64 6528 0a20 2020 2020 2020 2073 656c  ode(.        sel
-00007b80: 662c 0a20 2020 2020 2020 2074 7261 6469  f,.        tradi
-00007b90: 6e67 5f6d 6f64 653a 2054 7261 6469 6e67  ng_mode: Trading
-00007ba0: 4d6f 6465 2c0a 2020 2020 2020 2020 6d61  Mode,.        ma
-00007bb0: 7267 696e 5f6d 6f64 653a 204f 7074 696f  rgin_mode: Optio
-00007bc0: 6e61 6c5b 4d61 7267 696e 4d6f 6465 5d20  nal[MarginMode] 
-00007bd0: 2023 204f 6e6c 7920 4e6f 6e65 2077 6865   # Only None whe
-00007be0: 6e20 7472 6164 696e 675f 6d6f 6465 203d  n trading_mode =
-00007bf0: 2054 7261 6469 6e67 4d6f 6465 2e53 504f   TradingMode.SPO
-00007c00: 540a 2020 2020 293a 0a20 2020 2020 2020  T.    ):.       
-00007c10: 2022 2222 0a20 2020 2020 2020 2043 6865   """.        Che
-00007c20: 636b 7320 6966 2066 7265 7174 7261 6465  cks if freqtrade
-00007c30: 2063 616e 2070 6572 666f 726d 2074 7261   can perform tra
-00007c40: 6465 7320 7573 696e 6720 7468 6520 636f  des using the co
-00007c50: 6e66 6967 7572 6564 0a20 2020 2020 2020  nfigured.       
-00007c60: 2074 7261 6469 6e67 206d 6f64 6528 4d61   trading mode(Ma
-00007c70: 7267 696e 2c20 4675 7475 7265 7329 2061  rgin, Futures) a
-00007c80: 6e64 204d 6172 6769 6e4d 6f64 6528 4372  nd MarginMode(Cr
-00007c90: 6f73 732c 2049 736f 6c61 7465 6429 0a20  oss, Isolated). 
-00007ca0: 2020 2020 2020 2054 6872 6f77 7320 4f70         Throws Op
-00007cb0: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
-00007cc0: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
-00007cd0: 4966 2074 6865 2074 7261 6469 6e67 5f6d  If the trading_m
-00007ce0: 6f64 652f 6d61 7267 696e 5f6d 6f64 6520  ode/margin_mode 
-00007cf0: 7479 7065 2061 7265 206e 6f74 2073 7570  type are not sup
-00007d00: 706f 7274 6564 2062 7920 6672 6571 7472  ported by freqtr
-00007d10: 6164 6520 6f6e 2074 6869 7320 6578 6368  ade on this exch
-00007d20: 616e 6765 0a20 2020 2020 2020 2022 2222  ange.        """
-00007d30: 0a20 2020 2020 2020 2069 6620 7472 6164  .        if trad
-00007d40: 696e 675f 6d6f 6465 2021 3d20 5472 6164  ing_mode != Trad
-00007d50: 696e 674d 6f64 652e 5350 4f54 2061 6e64  ingMode.SPOT and
-00007d60: 2028 0a20 2020 2020 2020 2020 2020 2028   (.            (
-00007d70: 7472 6164 696e 675f 6d6f 6465 2c20 6d61  trading_mode, ma
-00007d80: 7267 696e 5f6d 6f64 6529 206e 6f74 2069  rgin_mode) not i
-00007d90: 6e20 7365 6c66 2e5f 7375 7070 6f72 7465  n self._supporte
-00007da0: 645f 7472 6164 696e 675f 6d6f 6465 5f6d  d_trading_mode_m
-00007db0: 6172 6769 6e5f 7061 6972 730a 2020 2020  argin_pairs.    
-00007dc0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-00007dd0: 2020 206d 6d5f 7661 6c75 6520 3d20 6d61     mm_value = ma
-00007de0: 7267 696e 5f6d 6f64 6520 616e 6420 6d61  rgin_mode and ma
-00007df0: 7267 696e 5f6d 6f64 652e 7661 6c75 650a  rgin_mode.value.
-00007e00: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00007e10: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
-00007e20: 6570 7469 6f6e 280a 2020 2020 2020 2020  eption(.        
-00007e30: 2020 2020 2020 2020 6622 4672 6571 7472          f"Freqtr
-00007e40: 6164 6520 646f 6573 206e 6f74 2073 7570  ade does not sup
-00007e50: 706f 7274 207b 6d6d 5f76 616c 7565 7d20  port {mm_value} 
-00007e60: 7b74 7261 6469 6e67 5f6d 6f64 652e 7661  {trading_mode.va
-00007e70: 6c75 657d 206f 6e20 7b73 656c 662e 6e61  lue} on {self.na
-00007e80: 6d65 7d22 0a20 2020 2020 2020 2020 2020  me}".           
-00007e90: 2029 0a0a 2020 2020 6465 6620 6765 745f   )..    def get_
-00007ea0: 6f70 7469 6f6e 2873 656c 662c 2070 6172  option(self, par
-00007eb0: 616d 3a20 7374 722c 2064 6566 6175 6c74  am: str, default
-00007ec0: 3a20 4f70 7469 6f6e 616c 5b41 6e79 5d20  : Optional[Any] 
-00007ed0: 3d20 4e6f 6e65 2920 2d3e 2041 6e79 3a0a  = None) -> Any:.
-00007ee0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00007ef0: 2020 2020 4765 7420 7061 7261 6d65 7465      Get paramete
-00007f00: 7220 7661 6c75 6520 6672 6f6d 205f 6674  r value from _ft
-00007f10: 5f68 6173 0a20 2020 2020 2020 2022 2222  _has.        """
-00007f20: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00007f30: 7365 6c66 2e5f 6674 5f68 6173 2e67 6574  self._ft_has.get
-00007f40: 2870 6172 616d 2c20 6465 6661 756c 7429  (param, default)
-00007f50: 0a0a 2020 2020 6465 6620 6578 6368 616e  ..    def exchan
-00007f60: 6765 5f68 6173 2873 656c 662c 2065 6e64  ge_has(self, end
-00007f70: 706f 696e 743a 2073 7472 2920 2d3e 2062  point: str) -> b
-00007f80: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
-00007f90: 0a20 2020 2020 2020 2043 6865 636b 7320  .        Checks 
-00007fa0: 6966 2065 7863 6861 6e67 6520 696d 706c  if exchange impl
-00007fb0: 656d 656e 7473 2061 2073 7065 6369 6669  ements a specifi
-00007fc0: 6320 4150 4920 656e 6470 6f69 6e74 2e0a  c API endpoint..
-00007fd0: 2020 2020 2020 2020 5772 6170 7065 7220          Wrapper 
-00007fe0: 6172 6f75 6e64 2063 6378 7420 2768 6173  around ccxt 'has
-00007ff0: 2720 6174 7472 6962 7574 650a 2020 2020  ' attribute.    
-00008000: 2020 2020 3a70 6172 616d 2065 6e64 706f      :param endpo
-00008010: 696e 743a 204e 616d 6520 6f66 2065 6e64  int: Name of end
-00008020: 706f 696e 7420 2865 2e67 2e20 2766 6574  point (e.g. 'fet
-00008030: 6368 4f48 4c43 5627 2c20 2766 6574 6368  chOHLCV', 'fetch
-00008040: 5469 636b 6572 7327 290a 2020 2020 2020  Tickers').      
-00008050: 2020 3a72 6574 7572 6e3a 2062 6f6f 6c0a    :return: bool.
-00008060: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00008070: 2020 2020 7265 7475 726e 2065 6e64 706f      return endpo
-00008080: 696e 7420 696e 2073 656c 662e 5f61 7069  int in self._api
-00008090: 2e68 6173 2061 6e64 2073 656c 662e 5f61  .has and self._a
-000080a0: 7069 2e68 6173 5b65 6e64 706f 696e 745d  pi.has[endpoint]
-000080b0: 0a0a 2020 2020 6465 6620 6765 745f 7072  ..    def get_pr
-000080c0: 6563 6973 696f 6e5f 616d 6f75 6e74 2873  ecision_amount(s
-000080d0: 656c 662c 2070 6169 723a 2073 7472 2920  elf, pair: str) 
-000080e0: 2d3e 204f 7074 696f 6e61 6c5b 666c 6f61  -> Optional[floa
-000080f0: 745d 3a0a 2020 2020 2020 2020 2222 220a  t]:.        """.
-00008100: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
-00008110: 7468 6520 616d 6f75 6e74 2070 7265 6369  the amount preci
-00008120: 7369 6f6e 206f 6620 7468 6520 6578 6368  sion of the exch
-00008130: 616e 6765 2e0a 2020 2020 2020 2020 3a70  ange..        :p
-00008140: 6172 616d 2070 6169 723a 2050 6169 7220  aram pair: Pair 
-00008150: 746f 2067 6574 2070 7265 6369 7369 6f6e  to get precision
-00008160: 2066 6f72 0a20 2020 2020 2020 203a 7265   for.        :re
-00008170: 7475 726e 3a20 7072 6563 6973 696f 6e20  turn: precision 
-00008180: 666f 7220 616d 6f75 6e74 206f 7220 4e6f  for amount or No
-00008190: 6e65 2e20 4d75 7374 2062 6520 7573 6564  ne. Must be used
-000081a0: 2069 6e20 636f 6d62 696e 6174 696f 6e20   in combination 
-000081b0: 7769 7468 2070 7265 6369 7369 6f6e 4d6f  with precisionMo
-000081c0: 6465 0a20 2020 2020 2020 2022 2222 0a20  de.        """. 
-000081d0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000081e0: 6c66 2e6d 6172 6b65 7473 2e67 6574 2870  lf.markets.get(p
-000081f0: 6169 722c 207b 7d29 2e67 6574 2827 7072  air, {}).get('pr
-00008200: 6563 6973 696f 6e27 2c20 7b7d 292e 6765  ecision', {}).ge
-00008210: 7428 2761 6d6f 756e 7427 2c20 4e6f 6e65  t('amount', None
-00008220: 290a 0a20 2020 2064 6566 2067 6574 5f70  )..    def get_p
-00008230: 7265 6369 7369 6f6e 5f70 7269 6365 2873  recision_price(s
-00008240: 656c 662c 2070 6169 723a 2073 7472 2920  elf, pair: str) 
-00008250: 2d3e 204f 7074 696f 6e61 6c5b 666c 6f61  -> Optional[floa
-00008260: 745d 3a0a 2020 2020 2020 2020 2222 220a  t]:.        """.
-00008270: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
-00008280: 7468 6520 7072 6963 6520 7072 6563 6973  the price precis
-00008290: 696f 6e20 6f66 2074 6865 2065 7863 6861  ion of the excha
-000082a0: 6e67 652e 0a20 2020 2020 2020 203a 7061  nge..        :pa
-000082b0: 7261 6d20 7061 6972 3a20 5061 6972 2074  ram pair: Pair t
-000082c0: 6f20 6765 7420 7072 6563 6973 696f 6e20  o get precision 
-000082d0: 666f 720a 2020 2020 2020 2020 3a72 6574  for.        :ret
-000082e0: 7572 6e3a 2070 7265 6369 7369 6f6e 2066  urn: precision f
-000082f0: 6f72 2070 7269 6365 206f 7220 4e6f 6e65  or price or None
-00008300: 2e20 4d75 7374 2062 6520 7573 6564 2069  . Must be used i
-00008310: 6e20 636f 6d62 696e 6174 696f 6e20 7769  n combination wi
-00008320: 7468 2070 7265 6369 7369 6f6e 4d6f 6465  th precisionMode
-00008330: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00008340: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00008350: 2e6d 6172 6b65 7473 2e67 6574 2870 6169  .markets.get(pai
-00008360: 722c 207b 7d29 2e67 6574 2827 7072 6563  r, {}).get('prec
-00008370: 6973 696f 6e27 2c20 7b7d 292e 6765 7428  ision', {}).get(
-00008380: 2770 7269 6365 272c 204e 6f6e 6529 0a0a  'price', None)..
-00008390: 2020 2020 6465 6620 616d 6f75 6e74 5f74      def amount_t
-000083a0: 6f5f 7072 6563 6973 696f 6e28 7365 6c66  o_precision(self
-000083b0: 2c20 7061 6972 3a20 7374 722c 2061 6d6f  , pair: str, amo
-000083c0: 756e 743a 2066 6c6f 6174 2920 2d3e 2066  unt: float) -> f
-000083d0: 6c6f 6174 3a0a 2020 2020 2020 2020 2222  loat:.        ""
-000083e0: 220a 2020 2020 2020 2020 5265 7475 726e  ".        Return
-000083f0: 7320 7468 6520 616d 6f75 6e74 2074 6f20  s the amount to 
-00008400: 6275 7920 6f72 2073 656c 6c20 746f 2061  buy or sell to a
-00008410: 2070 7265 6369 7369 6f6e 2074 6865 2045   precision the E
-00008420: 7863 6861 6e67 6520 6163 6365 7074 730a  xchange accepts.
-00008430: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00008440: 2020 2020 2072 6574 7572 6e20 616d 6f75       return amou
-00008450: 6e74 5f74 6f5f 7072 6563 6973 696f 6e28  nt_to_precision(
-00008460: 616d 6f75 6e74 2c20 7365 6c66 2e67 6574  amount, self.get
-00008470: 5f70 7265 6369 7369 6f6e 5f61 6d6f 756e  _precision_amoun
-00008480: 7428 7061 6972 292c 2073 656c 662e 7072  t(pair), self.pr
-00008490: 6563 6973 696f 6e4d 6f64 6529 0a0a 2020  ecisionMode)..  
-000084a0: 2020 6465 6620 7072 6963 655f 746f 5f70    def price_to_p
-000084b0: 7265 6369 7369 6f6e 2873 656c 662c 2070  recision(self, p
-000084c0: 6169 723a 2073 7472 2c20 7072 6963 653a  air: str, price:
-000084d0: 2066 6c6f 6174 2c20 2a2c 2072 6f75 6e64   float, *, round
-000084e0: 696e 675f 6d6f 6465 3a20 696e 7420 3d20  ing_mode: int = 
-000084f0: 524f 554e 4429 202d 3e20 666c 6f61 743a  ROUND) -> float:
-00008500: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00008510: 2020 2020 2052 6574 7572 6e73 2074 6865       Returns the
-00008520: 2070 7269 6365 2072 6f75 6e64 6564 2074   price rounded t
-00008530: 6f20 7468 6520 7072 6563 6973 696f 6e20  o the precision 
-00008540: 7468 6520 4578 6368 616e 6765 2061 6363  the Exchange acc
-00008550: 6570 7473 2e0a 2020 2020 2020 2020 5468  epts..        Th
-00008560: 6520 6465 6661 756c 7420 7072 6963 655f  e default price_
-00008570: 726f 756e 6469 6e67 5f6d 6f64 6520 696e  rounding_mode in
-00008580: 2063 6f6e 6620 6973 2052 4f55 4e44 2e0a   conf is ROUND..
-00008590: 2020 2020 2020 2020 466f 7220 7374 6f70          For stop
-000085a0: 6c6f 7373 2063 616c 6375 6c61 7469 6f6e  loss calculation
-000085b0: 732c 206d 7573 7420 7573 6520 524f 554e  s, must use ROUN
-000085c0: 445f 5550 2066 6f72 206c 6f6e 6773 2c20  D_UP for longs, 
-000085d0: 616e 6420 524f 554e 445f 444f 574e 2066  and ROUND_DOWN f
-000085e0: 6f72 2073 686f 7274 732e 0a20 2020 2020  or shorts..     
-000085f0: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-00008600: 6574 7572 6e20 7072 6963 655f 746f 5f70  eturn price_to_p
-00008610: 7265 6369 7369 6f6e 2870 7269 6365 2c20  recision(price, 
-00008620: 7365 6c66 2e67 6574 5f70 7265 6369 7369  self.get_precisi
-00008630: 6f6e 5f70 7269 6365 2870 6169 7229 2c0a  on_price(pair),.
-00008640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006320: 2020 2020 2020 2020 2020 2020 6622 6f6e              f"on
+00006330: 2074 6865 2065 7863 6861 6e67 6520 616e   the exchange an
+00006340: 6420 6576 656e 7475 616c 6c79 2072 656d  d eventually rem
+00006350: 6f76 6520 7b70 6169 727d 2066 726f 6d20  ove {pair} from 
+00006360: 796f 7572 2077 6869 7465 6c69 7374 2e22  your whitelist."
+00006370: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00006380: 2028 7365 6c66 2e5f 636f 6e66 6967 5b27   (self._config['
+00006390: 7374 616b 655f 6375 7272 656e 6379 275d  stake_currency']
+000063a0: 2061 6e64 0a20 2020 2020 2020 2020 2020   and.           
+000063b0: 2020 2020 2020 2020 2073 656c 662e 6765           self.ge
+000063c0: 745f 7061 6972 5f71 756f 7465 5f63 7572  t_pair_quote_cur
+000063d0: 7265 6e63 7928 7061 6972 2920 213d 2073  rency(pair) != s
+000063e0: 656c 662e 5f63 6f6e 6669 675b 2773 7461  elf._config['sta
+000063f0: 6b65 5f63 7572 7265 6e63 7927 5d29 3a0a  ke_currency']):.
+00006400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006410: 696e 7661 6c69 645f 7061 6972 732e 6170  invalid_pairs.ap
+00006420: 7065 6e64 2870 6169 7229 0a20 2020 2020  pend(pair).     
+00006430: 2020 2069 6620 696e 7661 6c69 645f 7061     if invalid_pa
+00006440: 6972 733a 0a20 2020 2020 2020 2020 2020  irs:.           
+00006450: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
+00006460: 616c 4578 6365 7074 696f 6e28 0a20 2020  alException(.   
+00006470: 2020 2020 2020 2020 2020 2020 2066 2253               f"S
+00006480: 7461 6b65 2d63 7572 7265 6e63 7920 277b  take-currency '{
+00006490: 7365 6c66 2e5f 636f 6e66 6967 5b27 7374  self._config['st
+000064a0: 616b 655f 6375 7272 656e 6379 275d 7d27  ake_currency']}'
+000064b0: 206e 6f74 2063 6f6d 7061 7469 626c 6520   not compatible 
+000064c0: 7769 7468 2022 0a20 2020 2020 2020 2020  with ".         
+000064d0: 2020 2020 2020 2066 2270 6169 722d 7768         f"pair-wh
+000064e0: 6974 656c 6973 742e 2050 6c65 6173 6520  itelist. Please 
+000064f0: 7265 6d6f 7665 2074 6865 2066 6f6c 6c6f  remove the follo
+00006500: 7769 6e67 2070 6169 7273 3a20 7b69 6e76  wing pairs: {inv
+00006510: 616c 6964 5f70 6169 7273 7d22 290a 0a20  alid_pairs}").. 
+00006520: 2020 2064 6566 2067 6574 5f76 616c 6964     def get_valid
+00006530: 5f70 6169 725f 636f 6d62 696e 6174 696f  _pair_combinatio
+00006540: 6e28 7365 6c66 2c20 6375 7272 5f31 3a20  n(self, curr_1: 
+00006550: 7374 722c 2063 7572 725f 323a 2073 7472  str, curr_2: str
+00006560: 2920 2d3e 2073 7472 3a0a 2020 2020 2020  ) -> str:.      
+00006570: 2020 2222 220a 2020 2020 2020 2020 4765    """.        Ge
+00006580: 7420 7661 6c69 6420 7061 6972 2063 6f6d  t valid pair com
+00006590: 6269 6e61 7469 6f6e 206f 6620 6375 7272  bination of curr
+000065a0: 5f31 2061 6e64 2063 7572 725f 3220 6279  _1 and curr_2 by
+000065b0: 2074 7279 696e 6720 626f 7468 2063 6f6d   trying both com
+000065c0: 6269 6e61 7469 6f6e 732e 0a20 2020 2020  binations..     
+000065d0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+000065e0: 6f72 2070 6169 7220 696e 205b 6622 7b63  or pair in [f"{c
+000065f0: 7572 725f 317d 2f7b 6375 7272 5f32 7d22  urr_1}/{curr_2}"
+00006600: 2c20 6622 7b63 7572 725f 327d 2f7b 6375  , f"{curr_2}/{cu
+00006610: 7272 5f31 7d22 5d3a 0a20 2020 2020 2020  rr_1}"]:.       
+00006620: 2020 2020 2069 6620 7061 6972 2069 6e20       if pair in 
+00006630: 7365 6c66 2e6d 6172 6b65 7473 2061 6e64  self.markets and
+00006640: 2073 656c 662e 6d61 726b 6574 735b 7061   self.markets[pa
+00006650: 6972 5d2e 6765 7428 2761 6374 6976 6527  ir].get('active'
+00006660: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00006670: 2020 2072 6574 7572 6e20 7061 6972 0a20     return pair. 
+00006680: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
+00006690: 6861 6e67 6545 7272 6f72 2866 2243 6f75  hangeError(f"Cou
+000066a0: 6c64 206e 6f74 2063 6f6d 6269 6e65 207b  ld not combine {
+000066b0: 6375 7272 5f31 7d20 616e 6420 7b63 7572  curr_1} and {cur
+000066c0: 725f 327d 2074 6f20 6765 7420 6120 7661  r_2} to get a va
+000066d0: 6c69 6420 7061 6972 2e22 290a 0a20 2020  lid pair.")..   
+000066e0: 2064 6566 2076 616c 6964 6174 655f 7469   def validate_ti
+000066f0: 6d65 6672 616d 6573 2873 656c 662c 2074  meframes(self, t
+00006700: 696d 6566 7261 6d65 3a20 4f70 7469 6f6e  imeframe: Option
+00006710: 616c 5b73 7472 5d29 202d 3e20 4e6f 6e65  al[str]) -> None
+00006720: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00006730: 2020 2020 2020 4368 6563 6b20 6966 2074        Check if t
+00006740: 696d 6566 7261 6d65 2066 726f 6d20 636f  imeframe from co
+00006750: 6e66 6967 2069 7320 6120 7375 7070 6f72  nfig is a suppor
+00006760: 7465 6420 7469 6d65 6672 616d 6520 6f6e  ted timeframe on
+00006770: 2074 6865 2065 7863 6861 6e67 650a 2020   the exchange.  
+00006780: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00006790: 2020 6966 206e 6f74 2068 6173 6174 7472    if not hasattr
+000067a0: 2873 656c 662e 5f61 7069 2c20 2274 696d  (self._api, "tim
+000067b0: 6566 7261 6d65 7322 2920 6f72 2073 656c  eframes") or sel
+000067c0: 662e 5f61 7069 2e74 696d 6566 7261 6d65  f._api.timeframe
+000067d0: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+000067e0: 2020 2020 2020 2023 2049 6620 7469 6d65         # If time
+000067f0: 6672 616d 6573 2061 7474 7269 6275 7465  frames attribute
+00006800: 2069 7320 6d69 7373 696e 6720 286f 7220   is missing (or 
+00006810: 6973 204e 6f6e 6529 2c20 7468 6520 6578  is None), the ex
+00006820: 6368 616e 6765 2070 726f 6261 626c 790a  change probably.
+00006830: 2020 2020 2020 2020 2020 2020 2320 6861              # ha
+00006840: 7320 6e6f 2066 6574 6368 4f48 4c43 5620  s no fetchOHLCV 
+00006850: 6d65 7468 6f64 2e0a 2020 2020 2020 2020  method..        
+00006860: 2020 2020 2320 5468 6572 6566 6f72 6520      # Therefore 
+00006870: 7765 2061 6c73 6f20 7368 6f77 2074 6861  we also show tha
+00006880: 742e 0a20 2020 2020 2020 2020 2020 2072  t..            r
+00006890: 6169 7365 204f 7065 7261 7469 6f6e 616c  aise Operational
+000068a0: 4578 6365 7074 696f 6e28 0a20 2020 2020  Exception(.     
+000068b0: 2020 2020 2020 2020 2020 2066 2254 6865             f"The
+000068c0: 2063 6378 7420 6c69 6272 6172 7920 646f   ccxt library do
+000068d0: 6573 206e 6f74 2070 726f 7669 6465 2074  es not provide t
+000068e0: 6865 206c 6973 7420 6f66 2074 696d 6566  he list of timef
+000068f0: 7261 6d65 7320 220a 2020 2020 2020 2020  rames ".        
+00006900: 2020 2020 2020 2020 6622 666f 7220 7468          f"for th
+00006910: 6520 6578 6368 616e 6765 207b 7365 6c66  e exchange {self
+00006920: 2e6e 616d 657d 2061 6e64 2074 6869 7320  .name} and this 
+00006930: 6578 6368 616e 6765 2022 0a20 2020 2020  exchange ".     
+00006940: 2020 2020 2020 2020 2020 2066 2269 7320             f"is 
+00006950: 7468 6572 6566 6f72 6520 6e6f 7420 7375  therefore not su
+00006960: 7070 6f72 7465 642e 2063 6378 7420 6665  pported. ccxt fe
+00006970: 7463 684f 484c 4356 3a20 7b73 656c 662e  tchOHLCV: {self.
+00006980: 6578 6368 616e 6765 5f68 6173 2827 6665  exchange_has('fe
+00006990: 7463 684f 484c 4356 2729 7d22 290a 0a20  tchOHLCV')}").. 
+000069a0: 2020 2020 2020 2069 6620 7469 6d65 6672         if timefr
+000069b0: 616d 6520 616e 6420 2874 696d 6566 7261  ame and (timefra
+000069c0: 6d65 206e 6f74 2069 6e20 7365 6c66 2e74  me not in self.t
+000069d0: 696d 6566 7261 6d65 7329 3a0a 2020 2020  imeframes):.    
+000069e0: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
+000069f0: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
+00006a00: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+00006a10: 2020 2020 6622 496e 7661 6c69 6420 7469      f"Invalid ti
+00006a20: 6d65 6672 616d 6520 277b 7469 6d65 6672  meframe '{timefr
+00006a30: 616d 657d 272e 2054 6869 7320 6578 6368  ame}'. This exch
+00006a40: 616e 6765 2073 7570 706f 7274 733a 207b  ange supports: {
+00006a50: 7365 6c66 2e74 696d 6566 7261 6d65 737d  self.timeframes}
+00006a60: 2229 0a0a 2020 2020 2020 2020 6966 2074  ")..        if t
+00006a70: 696d 6566 7261 6d65 2061 6e64 2074 696d  imeframe and tim
+00006a80: 6566 7261 6d65 5f74 6f5f 6d69 6e75 7465  eframe_to_minute
+00006a90: 7328 7469 6d65 6672 616d 6529 203c 2031  s(timeframe) < 1
+00006aa0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00006ab0: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+00006ac0: 7863 6570 7469 6f6e 2822 5469 6d65 6672  xception("Timefr
+00006ad0: 616d 6573 203c 2031 6d20 6172 6520 6375  ames < 1m are cu
+00006ae0: 7272 656e 746c 7920 6e6f 7420 7375 7070  rrently not supp
+00006af0: 6f72 7465 6420 6279 2046 7265 7174 7261  orted by Freqtra
+00006b00: 6465 2e22 290a 0a20 2020 2064 6566 2076  de.")..    def v
+00006b10: 616c 6964 6174 655f 6f72 6465 7274 7970  alidate_ordertyp
+00006b20: 6573 2873 656c 662c 206f 7264 6572 5f74  es(self, order_t
+00006b30: 7970 6573 3a20 4469 6374 2920 2d3e 204e  ypes: Dict) -> N
+00006b40: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00006b50: 0a20 2020 2020 2020 2043 6865 636b 7320  .        Checks 
+00006b60: 6966 206f 7264 6572 2d74 7970 6573 2063  if order-types c
+00006b70: 6f6e 6669 6775 7265 6420 696e 2073 7472  onfigured in str
+00006b80: 6174 6567 792f 636f 6e66 6967 2061 7265  ategy/config are
+00006b90: 2073 7570 706f 7274 6564 0a20 2020 2020   supported.     
+00006ba0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00006bb0: 6620 616e 7928 7620 3d3d 2027 6d61 726b  f any(v == 'mark
+00006bc0: 6574 2720 666f 7220 6b2c 2076 2069 6e20  et' for k, v in 
+00006bd0: 6f72 6465 725f 7479 7065 732e 6974 656d  order_types.item
+00006be0: 7328 2929 3a0a 2020 2020 2020 2020 2020  s()):.          
+00006bf0: 2020 6966 206e 6f74 2073 656c 662e 6578    if not self.ex
+00006c00: 6368 616e 6765 5f68 6173 2827 6372 6561  change_has('crea
+00006c10: 7465 4d61 726b 6574 4f72 6465 7227 293a  teMarketOrder'):
+00006c20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006c30: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
+00006c40: 616c 4578 6365 7074 696f 6e28 0a20 2020  alException(.   
+00006c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006c60: 2066 2745 7863 6861 6e67 6520 7b73 656c   f'Exchange {sel
+00006c70: 662e 6e61 6d65 7d20 646f 6573 206e 6f74  f.name} does not
+00006c80: 2073 7570 706f 7274 206d 6172 6b65 7420   support market 
+00006c90: 6f72 6465 7273 2e27 290a 2020 2020 2020  orders.').      
+00006ca0: 2020 7365 6c66 2e76 616c 6964 6174 655f    self.validate_
+00006cb0: 7374 6f70 5f6f 7264 6572 7479 7065 7328  stop_ordertypes(
+00006cc0: 6f72 6465 725f 7479 7065 7329 0a0a 2020  order_types)..  
+00006cd0: 2020 6465 6620 7661 6c69 6461 7465 5f73    def validate_s
+00006ce0: 746f 705f 6f72 6465 7274 7970 6573 2873  top_ordertypes(s
+00006cf0: 656c 662c 206f 7264 6572 5f74 7970 6573  elf, order_types
+00006d00: 3a20 4469 6374 2920 2d3e 204e 6f6e 653a  : Dict) -> None:
+00006d10: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00006d20: 2020 2020 2056 616c 6964 6174 6520 7374       Validate st
+00006d30: 6f70 6c6f 7373 206f 7264 6572 2074 7970  oploss order typ
+00006d40: 6573 0a20 2020 2020 2020 2022 2222 0a20  es.        """. 
+00006d50: 2020 2020 2020 2069 6620 286f 7264 6572         if (order
+00006d60: 5f74 7970 6573 2e67 6574 2822 7374 6f70  _types.get("stop
+00006d70: 6c6f 7373 5f6f 6e5f 6578 6368 616e 6765  loss_on_exchange
+00006d80: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00006d90: 2020 2061 6e64 206e 6f74 2073 656c 662e     and not self.
+00006da0: 5f66 745f 6861 732e 6765 7428 2273 746f  _ft_has.get("sto
+00006db0: 706c 6f73 735f 6f6e 5f65 7863 6861 6e67  ploss_on_exchang
+00006dc0: 6522 2c20 4661 6c73 6529 293a 0a20 2020  e", False)):.   
+00006dd0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+00006de0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
+00006df0: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+00006e00: 2020 2020 2066 274f 6e20 6578 6368 616e       f'On exchan
+00006e10: 6765 2073 746f 706c 6f73 7320 6973 206e  ge stoploss is n
+00006e20: 6f74 2073 7570 706f 7274 6564 2066 6f72  ot supported for
+00006e30: 207b 7365 6c66 2e6e 616d 657d 2e27 0a20   {self.name}.'. 
+00006e40: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00006e50: 2020 2020 2069 6620 7365 6c66 2e74 7261       if self.tra
+00006e60: 6469 6e67 5f6d 6f64 6520 3d3d 2054 7261  ding_mode == Tra
+00006e70: 6469 6e67 4d6f 6465 2e46 5554 5552 4553  dingMode.FUTURES
+00006e80: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00006e90: 6963 655f 6d61 7070 696e 6720 3d20 7365  ice_mapping = se
+00006ea0: 6c66 2e5f 6674 5f68 6173 2e67 6574 2827  lf._ft_has.get('
+00006eb0: 7374 6f70 5f70 7269 6365 5f74 7970 655f  stop_price_type_
+00006ec0: 7661 6c75 655f 6d61 7070 696e 6727 2c20  value_mapping', 
+00006ed0: 7b7d 292e 6b65 7973 2829 0a20 2020 2020  {}).keys().     
+00006ee0: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
+00006ef0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+00006f00: 725f 7479 7065 732e 6765 7428 2273 746f  r_types.get("sto
+00006f10: 706c 6f73 735f 6f6e 5f65 7863 6861 6e67  ploss_on_exchang
+00006f20: 6522 2c20 4661 6c73 6529 2069 7320 5472  e", False) is Tr
+00006f30: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+00006f40: 2020 2061 6e64 2027 7374 6f70 6c6f 7373     and 'stoploss
+00006f50: 5f70 7269 6365 5f74 7970 6527 2069 6e20  _price_type' in 
+00006f60: 6f72 6465 725f 7479 7065 730a 2020 2020  order_types.    
+00006f70: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+00006f80: 6f72 6465 725f 7479 7065 735b 2773 746f  order_types['sto
+00006f90: 706c 6f73 735f 7072 6963 655f 7479 7065  ploss_price_type
+00006fa0: 275d 206e 6f74 2069 6e20 7072 6963 655f  '] not in price_
+00006fb0: 6d61 7070 696e 670a 2020 2020 2020 2020  mapping.        
+00006fc0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+00006fd0: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
+00006fe0: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
+00006ff0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+00007000: 2020 2020 2020 2066 274f 6e20 6578 6368         f'On exch
+00007010: 616e 6765 2073 746f 706c 6f73 7320 7072  ange stoploss pr
+00007020: 6963 6520 7479 7065 2069 7320 6e6f 7420  ice type is not 
+00007030: 7375 7070 6f72 7465 6420 666f 7220 7b73  supported for {s
+00007040: 656c 662e 6e61 6d65 7d2e 270a 2020 2020  elf.name}.'.    
+00007050: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00007060: 2020 2064 6566 2076 616c 6964 6174 655f     def validate_
+00007070: 7072 6963 696e 6728 7365 6c66 2c20 7072  pricing(self, pr
+00007080: 6963 696e 673a 2044 6963 7429 202d 3e20  icing: Dict) -> 
+00007090: 4e6f 6e65 3a0a 2020 2020 2020 2020 6966  None:.        if
+000070a0: 2070 7269 6369 6e67 2e67 6574 2827 7573   pricing.get('us
+000070b0: 655f 6f72 6465 725f 626f 6f6b 272c 2046  e_order_book', F
+000070c0: 616c 7365 2920 616e 6420 6e6f 7420 7365  alse) and not se
+000070d0: 6c66 2e65 7863 6861 6e67 655f 6861 7328  lf.exchange_has(
+000070e0: 2766 6574 6368 4c32 4f72 6465 7242 6f6f  'fetchL2OrderBoo
+000070f0: 6b27 293a 0a20 2020 2020 2020 2020 2020  k'):.           
+00007100: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
+00007110: 616c 4578 6365 7074 696f 6e28 6627 4f72  alException(f'Or
+00007120: 6465 7262 6f6f 6b20 6e6f 7420 6176 6169  derbook not avai
+00007130: 6c61 626c 6520 666f 7220 7b73 656c 662e  lable for {self.
+00007140: 6e61 6d65 7d2e 2729 0a20 2020 2020 2020  name}.').       
+00007150: 2069 6620 286e 6f74 2070 7269 6369 6e67   if (not pricing
+00007160: 2e67 6574 2827 7573 655f 6f72 6465 725f  .get('use_order_
+00007170: 626f 6f6b 272c 2046 616c 7365 2920 616e  book', False) an
+00007180: 6420 280a 2020 2020 2020 2020 2020 2020  d (.            
+00007190: 2020 2020 6e6f 7420 7365 6c66 2e65 7863      not self.exc
+000071a0: 6861 6e67 655f 6861 7328 2766 6574 6368  hange_has('fetch
+000071b0: 5469 636b 6572 2729 0a20 2020 2020 2020  Ticker').       
+000071c0: 2020 2020 2020 2020 206f 7220 6e6f 7420           or not 
+000071d0: 7365 6c66 2e5f 6674 5f68 6173 5b27 7469  self._ft_has['ti
+000071e0: 636b 6572 735f 6861 7665 5f70 7269 6365  ckers_have_price
+000071f0: 275d 2929 3a0a 2020 2020 2020 2020 2020  '])):.          
+00007200: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
+00007210: 6e61 6c45 7863 6570 7469 6f6e 2866 2754  nalException(f'T
+00007220: 6963 6b65 7220 7072 6963 696e 6720 6e6f  icker pricing no
+00007230: 7420 6176 6169 6c61 626c 6520 666f 7220  t available for 
+00007240: 7b73 656c 662e 6e61 6d65 7d2e 2729 0a0a  {self.name}.')..
+00007250: 2020 2020 6465 6620 7661 6c69 6461 7465      def validate
+00007260: 5f6f 7264 6572 5f74 696d 655f 696e 5f66  _order_time_in_f
+00007270: 6f72 6365 2873 656c 662c 206f 7264 6572  orce(self, order
+00007280: 5f74 696d 655f 696e 5f66 6f72 6365 3a20  _time_in_force: 
+00007290: 4469 6374 2920 2d3e 204e 6f6e 653a 0a20  Dict) -> None:. 
+000072a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000072b0: 2020 2043 6865 636b 7320 6966 206f 7264     Checks if ord
+000072c0: 6572 2074 696d 6520 696e 2066 6f72 6365  er time in force
+000072d0: 2063 6f6e 6669 6775 7265 6420 696e 2073   configured in s
+000072e0: 7472 6174 6567 792f 636f 6e66 6967 2061  trategy/config a
+000072f0: 7265 2073 7570 706f 7274 6564 0a20 2020  re supported.   
+00007300: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00007310: 2069 6620 616e 7928 762e 7570 7065 7228   if any(v.upper(
+00007320: 2920 6e6f 7420 696e 2073 656c 662e 5f66  ) not in self._f
+00007330: 745f 6861 735b 226f 7264 6572 5f74 696d  t_has["order_tim
+00007340: 655f 696e 5f66 6f72 6365 225d 0a20 2020  e_in_force"].   
+00007350: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00007360: 6b2c 2076 2069 6e20 6f72 6465 725f 7469  k, v in order_ti
+00007370: 6d65 5f69 6e5f 666f 7263 652e 6974 656d  me_in_force.item
+00007380: 7328 2929 3a0a 2020 2020 2020 2020 2020  s()):.          
+00007390: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
+000073a0: 6e61 6c45 7863 6570 7469 6f6e 280a 2020  nalException(.  
+000073b0: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+000073c0: 5469 6d65 2069 6e20 666f 7263 6520 706f  Time in force po
+000073d0: 6c69 6369 6573 2061 7265 206e 6f74 2073  licies are not s
+000073e0: 7570 706f 7274 6564 2066 6f72 207b 7365  upported for {se
+000073f0: 6c66 2e6e 616d 657d 2079 6574 2e27 290a  lf.name} yet.').
+00007400: 0a20 2020 2064 6566 2076 616c 6964 6174  .    def validat
+00007410: 655f 7265 7175 6972 6564 5f73 7461 7274  e_required_start
+00007420: 7570 5f63 616e 646c 6573 2873 656c 662c  up_candles(self,
+00007430: 2073 7461 7274 7570 5f63 616e 646c 6573   startup_candles
+00007440: 3a20 696e 742c 2074 696d 6566 7261 6d65  : int, timeframe
+00007450: 3a20 7374 7229 202d 3e20 696e 743a 0a20  : str) -> int:. 
+00007460: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00007470: 2020 2043 6865 636b 7320 6966 2072 6571     Checks if req
+00007480: 7569 7265 6420 7374 6172 7475 705f 6361  uired startup_ca
+00007490: 6e64 6c65 7320 6973 206d 6f72 6520 7468  ndles is more th
+000074a0: 616e 206f 686c 6376 5f63 616e 646c 655f  an ohlcv_candle_
+000074b0: 6c69 6d69 7428 292e 0a20 2020 2020 2020  limit()..       
+000074c0: 2052 6571 7569 7265 7320 6120 6772 6163   Requires a grac
+000074d0: 652d 7065 7269 6f64 206f 6620 3520 6361  e-period of 5 ca
+000074e0: 6e64 6c65 7320 2d20 736f 2061 2073 7461  ndles - so a sta
+000074f0: 7274 7570 2d70 6572 696f 6420 7570 2074  rtup-period up t
+00007500: 6f20 3439 3420 6973 2061 6c6c 6f77 6564  o 494 is allowed
+00007510: 2062 7920 6465 6661 756c 742e 0a20 2020   by default..   
+00007520: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+00007530: 2020 6361 6e64 6c65 5f6c 696d 6974 203d    candle_limit =
+00007540: 2073 656c 662e 6f68 6c63 765f 6361 6e64   self.ohlcv_cand
+00007550: 6c65 5f6c 696d 6974 280a 2020 2020 2020  le_limit(.      
+00007560: 2020 2020 2020 7469 6d65 6672 616d 652c        timeframe,
+00007570: 2073 656c 662e 5f63 6f6e 6669 675b 2763   self._config['c
+00007580: 616e 646c 655f 7479 7065 5f64 6566 275d  andle_type_def']
+00007590: 2c0a 2020 2020 2020 2020 2020 2020 696e  ,.            in
+000075a0: 7428 6461 7465 5f6d 696e 7573 5f63 616e  t(date_minus_can
+000075b0: 646c 6573 2874 696d 6566 7261 6d65 2c20  dles(timeframe, 
+000075c0: 7374 6172 7475 705f 6361 6e64 6c65 7329  startup_candles)
+000075d0: 2e74 696d 6573 7461 6d70 2829 202a 2031  .timestamp() * 1
+000075e0: 3030 3029 0a20 2020 2020 2020 2020 2020  000).           
+000075f0: 2069 6620 7469 6d65 6672 616d 6520 656c   if timeframe el
+00007600: 7365 204e 6f6e 6529 0a20 2020 2020 2020  se None).       
+00007610: 2023 2052 6571 7569 7265 206f 6e65 206d   # Require one m
+00007620: 6f72 6520 6361 6e64 6c65 202d 2074 6f20  ore candle - to 
+00007630: 6163 636f 756e 7420 666f 7220 7468 6520  account for the 
+00007640: 7374 696c 6c20 6f70 656e 2063 616e 646c  still open candl
+00007650: 652e 0a20 2020 2020 2020 2063 616e 646c  e..        candl
+00007660: 655f 636f 756e 7420 3d20 7374 6172 7475  e_count = startu
+00007670: 705f 6361 6e64 6c65 7320 2b20 310a 2020  p_candles + 1.  
+00007680: 2020 2020 2020 2320 416c 6c6f 7720 3520        # Allow 5 
+00007690: 6361 6c6c 7320 746f 2074 6865 2065 7863  calls to the exc
+000076a0: 6861 6e67 6520 7065 7220 7061 6972 0a20  hange per pair. 
+000076b0: 2020 2020 2020 2072 6571 7569 7265 645f         required_
+000076c0: 6361 6e64 6c65 5f63 616c 6c5f 636f 756e  candle_call_coun
+000076d0: 7420 3d20 696e 7428 0a20 2020 2020 2020  t = int(.       
+000076e0: 2020 2020 2028 6361 6e64 6c65 5f63 6f75       (candle_cou
+000076f0: 6e74 202f 2063 616e 646c 655f 6c69 6d69  nt / candle_limi
+00007700: 7429 202b 2028 3020 6966 2063 616e 646c  t) + (0 if candl
+00007710: 655f 636f 756e 7420 2520 6361 6e64 6c65  e_count % candle
+00007720: 5f6c 696d 6974 203d 3d20 3020 656c 7365  _limit == 0 else
+00007730: 2031 2929 0a20 2020 2020 2020 2069 6620   1)).        if 
+00007740: 7365 6c66 2e5f 6674 5f68 6173 5b27 6f68  self._ft_has['oh
+00007750: 6c63 765f 6861 735f 6869 7374 6f72 7927  lcv_has_history'
+00007760: 5d3a 0a0a 2020 2020 2020 2020 2020 2020  ]:..            
+00007770: 6966 2072 6571 7569 7265 645f 6361 6e64  if required_cand
+00007780: 6c65 5f63 616c 6c5f 636f 756e 7420 3e20  le_call_count > 
+00007790: 353a 0a20 2020 2020 2020 2020 2020 2020  5:.             
+000077a0: 2020 2023 204f 6e6c 7920 616c 6c6f 7720     # Only allow 
+000077b0: 3520 6361 6c6c 7320 7065 7220 7061 6972  5 calls per pair
+000077c0: 2074 6f20 736f 6d65 7768 6174 206c 696d   to somewhat lim
+000077d0: 6974 2074 6865 2069 6d70 6163 740a 2020  it the impact.  
+000077e0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+000077f0: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+00007800: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
+00007810: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00007820: 5468 6973 2073 7472 6174 6567 7920 7265  This strategy re
+00007830: 7175 6972 6573 207b 7374 6172 7475 705f  quires {startup_
+00007840: 6361 6e64 6c65 737d 2063 616e 646c 6573  candles} candles
+00007850: 2074 6f20 7374 6172 742c 2022 0a20 2020   to start, ".   
+00007860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007870: 2022 7768 6963 6820 6973 206d 6f72 6520   "which is more 
+00007880: 7468 616e 2035 7820 220a 2020 2020 2020  than 5x ".      
+00007890: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+000078a0: 7468 6520 616d 6f75 6e74 206f 6620 6361  the amount of ca
+000078b0: 6e64 6c65 7320 7b73 656c 662e 6e61 6d65  ndles {self.name
+000078c0: 7d20 7072 6f76 6964 6573 2066 6f72 207b  } provides for {
+000078d0: 7469 6d65 6672 616d 657d 2e22 290a 2020  timeframe}.").  
+000078e0: 2020 2020 2020 656c 6966 2072 6571 7569        elif requi
+000078f0: 7265 645f 6361 6e64 6c65 5f63 616c 6c5f  red_candle_call_
+00007900: 636f 756e 7420 3e20 313a 0a20 2020 2020  count > 1:.     
+00007910: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
+00007920: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
+00007930: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+00007940: 2020 2066 2254 6869 7320 7374 7261 7465     f"This strate
+00007950: 6779 2072 6571 7569 7265 7320 7b73 7461  gy requires {sta
+00007960: 7274 7570 5f63 616e 646c 6573 7d20 6361  rtup_candles} ca
+00007970: 6e64 6c65 7320 746f 2073 7461 7274 2c20  ndles to start, 
+00007980: 7768 6963 6820 6973 206d 6f72 6520 7468  which is more th
+00007990: 616e 2022 0a20 2020 2020 2020 2020 2020  an ".           
+000079a0: 2020 2020 2066 2274 6865 2061 6d6f 756e       f"the amoun
+000079b0: 7420 6f66 2063 616e 646c 6573 207b 7365  t of candles {se
+000079c0: 6c66 2e6e 616d 657d 2070 726f 7669 6465  lf.name} provide
+000079d0: 7320 666f 7220 7b74 696d 6566 7261 6d65  s for {timeframe
+000079e0: 7d2e 2229 0a20 2020 2020 2020 2069 6620  }.").        if 
+000079f0: 7265 7175 6972 6564 5f63 616e 646c 655f  required_candle_
+00007a00: 6361 6c6c 5f63 6f75 6e74 203e 2031 3a0a  call_count > 1:.
+00007a10: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+00007a20: 6572 2e77 6172 6e69 6e67 2866 2255 7369  er.warning(f"Usi
+00007a30: 6e67 207b 7265 7175 6972 6564 5f63 616e  ng {required_can
+00007a40: 646c 655f 6361 6c6c 5f63 6f75 6e74 7d20  dle_call_count} 
+00007a50: 6361 6c6c 7320 746f 2067 6574 204f 484c  calls to get OHL
+00007a60: 4356 2e20 220a 2020 2020 2020 2020 2020  CV. ".          
+00007a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007a80: 2066 2254 6869 7320 6361 6e20 7265 7375   f"This can resu
+00007a90: 6c74 2069 6e20 736c 6f77 6572 206f 7065  lt in slower ope
+00007aa0: 7261 7469 6f6e 7320 666f 7220 7468 6520  rations for the 
+00007ab0: 626f 742e 2050 6c65 6173 6520 6368 6563  bot. Please chec
+00007ac0: 6b20 220a 2020 2020 2020 2020 2020 2020  k ".            
+00007ad0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00007ae0: 2269 6620 796f 7520 7265 616c 6c79 206e  "if you really n
+00007af0: 6565 6420 7b73 7461 7274 7570 5f63 616e  eed {startup_can
+00007b00: 646c 6573 7d20 6361 6e64 6c65 7320 666f  dles} candles fo
+00007b10: 7220 796f 7572 2073 7472 6174 6567 7922  r your strategy"
+00007b20: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00007b30: 2072 6571 7569 7265 645f 6361 6e64 6c65   required_candle
+00007b40: 5f63 616c 6c5f 636f 756e 740a 0a20 2020  _call_count..   
+00007b50: 2064 6566 2076 616c 6964 6174 655f 7472   def validate_tr
+00007b60: 6164 696e 675f 6d6f 6465 5f61 6e64 5f6d  ading_mode_and_m
+00007b70: 6172 6769 6e5f 6d6f 6465 280a 2020 2020  argin_mode(.    
+00007b80: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00007b90: 2020 7472 6164 696e 675f 6d6f 6465 3a20    trading_mode: 
+00007ba0: 5472 6164 696e 674d 6f64 652c 0a20 2020  TradingMode,.   
+00007bb0: 2020 2020 206d 6172 6769 6e5f 6d6f 6465       margin_mode
+00007bc0: 3a20 4f70 7469 6f6e 616c 5b4d 6172 6769  : Optional[Margi
+00007bd0: 6e4d 6f64 655d 2020 2320 4f6e 6c79 204e  nMode]  # Only N
+00007be0: 6f6e 6520 7768 656e 2074 7261 6469 6e67  one when trading
+00007bf0: 5f6d 6f64 6520 3d20 5472 6164 696e 674d  _mode = TradingM
+00007c00: 6f64 652e 5350 4f54 0a20 2020 2029 3a0a  ode.SPOT.    ):.
+00007c10: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00007c20: 2020 2020 4368 6563 6b73 2069 6620 6672      Checks if fr
+00007c30: 6571 7472 6164 6520 6361 6e20 7065 7266  eqtrade can perf
+00007c40: 6f72 6d20 7472 6164 6573 2075 7369 6e67  orm trades using
+00007c50: 2074 6865 2063 6f6e 6669 6775 7265 640a   the configured.
+00007c60: 2020 2020 2020 2020 7472 6164 696e 6720          trading 
+00007c70: 6d6f 6465 284d 6172 6769 6e2c 2046 7574  mode(Margin, Fut
+00007c80: 7572 6573 2920 616e 6420 4d61 7267 696e  ures) and Margin
+00007c90: 4d6f 6465 2843 726f 7373 2c20 4973 6f6c  Mode(Cross, Isol
+00007ca0: 6174 6564 290a 2020 2020 2020 2020 5468  ated).        Th
+00007cb0: 726f 7773 204f 7065 7261 7469 6f6e 616c  rows Operational
+00007cc0: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+00007cd0: 2020 2020 2020 2049 6620 7468 6520 7472         If the tr
+00007ce0: 6164 696e 675f 6d6f 6465 2f6d 6172 6769  ading_mode/margi
+00007cf0: 6e5f 6d6f 6465 2074 7970 6520 6172 6520  n_mode type are 
+00007d00: 6e6f 7420 7375 7070 6f72 7465 6420 6279  not supported by
+00007d10: 2066 7265 7174 7261 6465 206f 6e20 7468   freqtrade on th
+00007d20: 6973 2065 7863 6861 6e67 650a 2020 2020  is exchange.    
+00007d30: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00007d40: 6966 2074 7261 6469 6e67 5f6d 6f64 6520  if trading_mode 
+00007d50: 213d 2054 7261 6469 6e67 4d6f 6465 2e53  != TradingMode.S
+00007d60: 504f 5420 616e 6420 280a 2020 2020 2020  POT and (.      
+00007d70: 2020 2020 2020 2874 7261 6469 6e67 5f6d        (trading_m
+00007d80: 6f64 652c 206d 6172 6769 6e5f 6d6f 6465  ode, margin_mode
+00007d90: 2920 6e6f 7420 696e 2073 656c 662e 5f73  ) not in self._s
+00007da0: 7570 706f 7274 6564 5f74 7261 6469 6e67  upported_trading
+00007db0: 5f6d 6f64 655f 6d61 7267 696e 5f70 6169  _mode_margin_pai
+00007dc0: 7273 0a20 2020 2020 2020 2029 3a0a 2020  rs.        ):.  
+00007dd0: 2020 2020 2020 2020 2020 6d6d 5f76 616c            mm_val
+00007de0: 7565 203d 206d 6172 6769 6e5f 6d6f 6465  ue = margin_mode
+00007df0: 2061 6e64 206d 6172 6769 6e5f 6d6f 6465   and margin_mode
+00007e00: 2e76 616c 7565 0a20 2020 2020 2020 2020  .value.         
+00007e10: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
+00007e20: 6f6e 616c 4578 6365 7074 696f 6e28 0a20  onalException(. 
+00007e30: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00007e40: 2246 7265 7174 7261 6465 2064 6f65 7320  "Freqtrade does 
+00007e50: 6e6f 7420 7375 7070 6f72 7420 7b6d 6d5f  not support {mm_
+00007e60: 7661 6c75 657d 207b 7472 6164 696e 675f  value} {trading_
+00007e70: 6d6f 6465 2e76 616c 7565 7d20 6f6e 207b  mode.value} on {
+00007e80: 7365 6c66 2e6e 616d 657d 220a 2020 2020  self.name}".    
+00007e90: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00007ea0: 6566 2067 6574 5f6f 7074 696f 6e28 7365  ef get_option(se
+00007eb0: 6c66 2c20 7061 7261 6d3a 2073 7472 2c20  lf, param: str, 
+00007ec0: 6465 6661 756c 743a 204f 7074 696f 6e61  default: Optiona
+00007ed0: 6c5b 416e 795d 203d 204e 6f6e 6529 202d  l[Any] = None) -
+00007ee0: 3e20 416e 793a 0a20 2020 2020 2020 2022  > Any:.        "
+00007ef0: 2222 0a20 2020 2020 2020 2047 6574 2070  "".        Get p
+00007f00: 6172 616d 6574 6572 2076 616c 7565 2066  arameter value f
+00007f10: 726f 6d20 5f66 745f 6861 730a 2020 2020  rom _ft_has.    
+00007f20: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00007f30: 7265 7475 726e 2073 656c 662e 5f66 745f  return self._ft_
+00007f40: 6861 732e 6765 7428 7061 7261 6d2c 2064  has.get(param, d
+00007f50: 6566 6175 6c74 290a 0a20 2020 2064 6566  efault)..    def
+00007f60: 2065 7863 6861 6e67 655f 6861 7328 7365   exchange_has(se
+00007f70: 6c66 2c20 656e 6470 6f69 6e74 3a20 7374  lf, endpoint: st
+00007f80: 7229 202d 3e20 626f 6f6c 3a0a 2020 2020  r) -> bool:.    
+00007f90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00007fa0: 4368 6563 6b73 2069 6620 6578 6368 616e  Checks if exchan
+00007fb0: 6765 2069 6d70 6c65 6d65 6e74 7320 6120  ge implements a 
+00007fc0: 7370 6563 6966 6963 2041 5049 2065 6e64  specific API end
+00007fd0: 706f 696e 742e 0a20 2020 2020 2020 2057  point..        W
+00007fe0: 7261 7070 6572 2061 726f 756e 6420 6363  rapper around cc
+00007ff0: 7874 2027 6861 7327 2061 7474 7269 6275  xt 'has' attribu
+00008000: 7465 0a20 2020 2020 2020 203a 7061 7261  te.        :para
+00008010: 6d20 656e 6470 6f69 6e74 3a20 4e61 6d65  m endpoint: Name
+00008020: 206f 6620 656e 6470 6f69 6e74 2028 652e   of endpoint (e.
+00008030: 672e 2027 6665 7463 684f 484c 4356 272c  g. 'fetchOHLCV',
+00008040: 2027 6665 7463 6854 6963 6b65 7273 2729   'fetchTickers')
+00008050: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+00008060: 3a20 626f 6f6c 0a20 2020 2020 2020 2022  : bool.        "
+00008070: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+00008080: 6e20 656e 6470 6f69 6e74 2069 6e20 7365  n endpoint in se
+00008090: 6c66 2e5f 6170 692e 6861 7320 616e 6420  lf._api.has and 
+000080a0: 7365 6c66 2e5f 6170 692e 6861 735b 656e  self._api.has[en
+000080b0: 6470 6f69 6e74 5d0a 0a20 2020 2064 6566  dpoint]..    def
+000080c0: 2067 6574 5f70 7265 6369 7369 6f6e 5f61   get_precision_a
+000080d0: 6d6f 756e 7428 7365 6c66 2c20 7061 6972  mount(self, pair
+000080e0: 3a20 7374 7229 202d 3e20 4f70 7469 6f6e  : str) -> Option
+000080f0: 616c 5b66 6c6f 6174 5d3a 0a20 2020 2020  al[float]:.     
+00008100: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
+00008110: 6574 7572 6e73 2074 6865 2061 6d6f 756e  eturns the amoun
+00008120: 7420 7072 6563 6973 696f 6e20 6f66 2074  t precision of t
+00008130: 6865 2065 7863 6861 6e67 652e 0a20 2020  he exchange..   
+00008140: 2020 2020 203a 7061 7261 6d20 7061 6972       :param pair
+00008150: 3a20 5061 6972 2074 6f20 6765 7420 7072  : Pair to get pr
+00008160: 6563 6973 696f 6e20 666f 720a 2020 2020  ecision for.    
+00008170: 2020 2020 3a72 6574 7572 6e3a 2070 7265      :return: pre
+00008180: 6369 7369 6f6e 2066 6f72 2061 6d6f 756e  cision for amoun
+00008190: 7420 6f72 204e 6f6e 652e 204d 7573 7420  t or None. Must 
+000081a0: 6265 2075 7365 6420 696e 2063 6f6d 6269  be used in combi
+000081b0: 6e61 7469 6f6e 2077 6974 6820 7072 6563  nation with prec
+000081c0: 6973 696f 6e4d 6f64 650a 2020 2020 2020  isionMode.      
+000081d0: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+000081e0: 7475 726e 2073 656c 662e 6d61 726b 6574  turn self.market
+000081f0: 732e 6765 7428 7061 6972 2c20 7b7d 292e  s.get(pair, {}).
+00008200: 6765 7428 2770 7265 6369 7369 6f6e 272c  get('precision',
+00008210: 207b 7d29 2e67 6574 2827 616d 6f75 6e74   {}).get('amount
+00008220: 272c 204e 6f6e 6529 0a0a 2020 2020 6465  ', None)..    de
+00008230: 6620 6765 745f 7072 6563 6973 696f 6e5f  f get_precision_
+00008240: 7072 6963 6528 7365 6c66 2c20 7061 6972  price(self, pair
+00008250: 3a20 7374 7229 202d 3e20 4f70 7469 6f6e  : str) -> Option
+00008260: 616c 5b66 6c6f 6174 5d3a 0a20 2020 2020  al[float]:.     
+00008270: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
+00008280: 6574 7572 6e73 2074 6865 2070 7269 6365  eturns the price
+00008290: 2070 7265 6369 7369 6f6e 206f 6620 7468   precision of th
+000082a0: 6520 6578 6368 616e 6765 2e0a 2020 2020  e exchange..    
+000082b0: 2020 2020 3a70 6172 616d 2070 6169 723a      :param pair:
+000082c0: 2050 6169 7220 746f 2067 6574 2070 7265   Pair to get pre
+000082d0: 6369 7369 6f6e 2066 6f72 0a20 2020 2020  cision for.     
+000082e0: 2020 203a 7265 7475 726e 3a20 7072 6563     :return: prec
+000082f0: 6973 696f 6e20 666f 7220 7072 6963 6520  ision for price 
+00008300: 6f72 204e 6f6e 652e 204d 7573 7420 6265  or None. Must be
+00008310: 2075 7365 6420 696e 2063 6f6d 6269 6e61   used in combina
+00008320: 7469 6f6e 2077 6974 6820 7072 6563 6973  tion with precis
+00008330: 696f 6e4d 6f64 650a 2020 2020 2020 2020  ionMode.        
+00008340: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+00008350: 726e 2073 656c 662e 6d61 726b 6574 732e  rn self.markets.
+00008360: 6765 7428 7061 6972 2c20 7b7d 292e 6765  get(pair, {}).ge
+00008370: 7428 2770 7265 6369 7369 6f6e 272c 207b  t('precision', {
+00008380: 7d29 2e67 6574 2827 7072 6963 6527 2c20  }).get('price', 
+00008390: 4e6f 6e65 290a 0a20 2020 2064 6566 2061  None)..    def a
+000083a0: 6d6f 756e 745f 746f 5f70 7265 6369 7369  mount_to_precisi
+000083b0: 6f6e 2873 656c 662c 2070 6169 723a 2073  on(self, pair: s
+000083c0: 7472 2c20 616d 6f75 6e74 3a20 666c 6f61  tr, amount: floa
+000083d0: 7429 202d 3e20 666c 6f61 743a 0a20 2020  t) -> float:.   
+000083e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000083f0: 2052 6574 7572 6e73 2074 6865 2061 6d6f   Returns the amo
+00008400: 756e 7420 746f 2062 7579 206f 7220 7365  unt to buy or se
+00008410: 6c6c 2074 6f20 6120 7072 6563 6973 696f  ll to a precisio
+00008420: 6e20 7468 6520 4578 6368 616e 6765 2061  n the Exchange a
+00008430: 6363 6570 7473 0a0a 2020 2020 2020 2020  ccepts..        
+00008440: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+00008450: 726e 2061 6d6f 756e 745f 746f 5f70 7265  rn amount_to_pre
+00008460: 6369 7369 6f6e 2861 6d6f 756e 742c 2073  cision(amount, s
+00008470: 656c 662e 6765 745f 7072 6563 6973 696f  elf.get_precisio
+00008480: 6e5f 616d 6f75 6e74 2870 6169 7229 2c20  n_amount(pair), 
+00008490: 7365 6c66 2e70 7265 6369 7369 6f6e 4d6f  self.precisionMo
+000084a0: 6465 290a 0a20 2020 2064 6566 2070 7269  de)..    def pri
+000084b0: 6365 5f74 6f5f 7072 6563 6973 696f 6e28  ce_to_precision(
+000084c0: 7365 6c66 2c20 7061 6972 3a20 7374 722c  self, pair: str,
+000084d0: 2070 7269 6365 3a20 666c 6f61 742c 202a   price: float, *
+000084e0: 2c20 726f 756e 6469 6e67 5f6d 6f64 653a  , rounding_mode:
+000084f0: 2069 6e74 203d 2052 4f55 4e44 2920 2d3e   int = ROUND) ->
+00008500: 2066 6c6f 6174 3a0a 2020 2020 2020 2020   float:.        
+00008510: 2222 220a 2020 2020 2020 2020 5265 7475  """.        Retu
+00008520: 726e 7320 7468 6520 7072 6963 6520 726f  rns the price ro
+00008530: 756e 6465 6420 746f 2074 6865 2070 7265  unded to the pre
+00008540: 6369 7369 6f6e 2074 6865 2045 7863 6861  cision the Excha
+00008550: 6e67 6520 6163 6365 7074 732e 0a20 2020  nge accepts..   
+00008560: 2020 2020 2054 6865 2064 6566 6175 6c74       The default
+00008570: 2070 7269 6365 5f72 6f75 6e64 696e 675f   price_rounding_
+00008580: 6d6f 6465 2069 6e20 636f 6e66 2069 7320  mode in conf is 
+00008590: 524f 554e 442e 0a20 2020 2020 2020 2046  ROUND..        F
+000085a0: 6f72 2073 746f 706c 6f73 7320 6361 6c63  or stoploss calc
+000085b0: 756c 6174 696f 6e73 2c20 6d75 7374 2075  ulations, must u
+000085c0: 7365 2052 4f55 4e44 5f55 5020 666f 7220  se ROUND_UP for 
+000085d0: 6c6f 6e67 732c 2061 6e64 2052 4f55 4e44  longs, and ROUND
+000085e0: 5f44 4f57 4e20 666f 7220 7368 6f72 7473  _DOWN for shorts
+000085f0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00008600: 2020 2020 2020 7265 7475 726e 2070 7269        return pri
+00008610: 6365 5f74 6f5f 7072 6563 6973 696f 6e28  ce_to_precision(
+00008620: 7072 6963 652c 2073 656c 662e 6765 745f  price, self.get_
+00008630: 7072 6563 6973 696f 6e5f 7072 6963 6528  precision_price(
+00008640: 7061 6972 292c 0a20 2020 2020 2020 2020  pair),.         
 00008650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008660: 2020 7365 6c66 2e70 7265 6369 7369 6f6e    self.precision
-00008670: 4d6f 6465 2c20 726f 756e 6469 6e67 5f6d  Mode, rounding_m
-00008680: 6f64 653d 726f 756e 6469 6e67 5f6d 6f64  ode=rounding_mod
-00008690: 6529 0a0a 2020 2020 6465 6620 7072 6963  e)..    def pric
-000086a0: 655f 6765 745f 6f6e 655f 7069 7028 7365  e_get_one_pip(se
-000086b0: 6c66 2c20 7061 6972 3a20 7374 722c 2070  lf, pair: str, p
-000086c0: 7269 6365 3a20 666c 6f61 7429 202d 3e20  rice: float) -> 
-000086d0: 666c 6f61 743a 0a20 2020 2020 2020 2022  float:.        "
-000086e0: 2222 0a20 2020 2020 2020 2047 6574 2773  "".        Get's
-000086f0: 2074 6865 2022 3120 7069 7022 2076 616c   the "1 pip" val
-00008700: 7565 2066 6f72 2074 6869 7320 7061 6972  ue for this pair
-00008710: 2e0a 2020 2020 2020 2020 5573 6564 2069  ..        Used i
-00008720: 6e20 5072 6963 6546 696c 7465 7220 746f  n PriceFilter to
-00008730: 2063 616c 6375 6c61 7465 2074 6865 2031   calculate the 1
-00008740: 7069 7020 6d6f 7665 6d65 6e74 732e 0a20  pip movements.. 
-00008750: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00008760: 2020 2070 7265 6369 7369 6f6e 203d 2073     precision = s
-00008770: 656c 662e 6d61 726b 6574 735b 7061 6972  elf.markets[pair
-00008780: 5d5b 2770 7265 6369 7369 6f6e 275d 5b27  ]['precision']['
-00008790: 7072 6963 6527 5d0a 2020 2020 2020 2020  price'].        
-000087a0: 6966 2073 656c 662e 7072 6563 6973 696f  if self.precisio
-000087b0: 6e4d 6f64 6520 3d3d 2054 4943 4b5f 5349  nMode == TICK_SI
-000087c0: 5a45 3a0a 2020 2020 2020 2020 2020 2020  ZE:.            
-000087d0: 7265 7475 726e 2070 7265 6369 7369 6f6e  return precision
-000087e0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-000087f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00008800: 6e20 3120 2f20 706f 7728 3130 2c20 7072  n 1 / pow(10, pr
-00008810: 6563 6973 696f 6e29 0a0a 2020 2020 6465  ecision)..    de
-00008820: 6620 6765 745f 6d69 6e5f 7061 6972 5f73  f get_min_pair_s
-00008830: 7461 6b65 5f61 6d6f 756e 7428 0a20 2020  take_amount(.   
-00008840: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00008850: 2020 2070 6169 723a 2073 7472 2c0a 2020     pair: str,.  
-00008860: 2020 2020 2020 7072 6963 653a 2066 6c6f        price: flo
-00008870: 6174 2c0a 2020 2020 2020 2020 7374 6f70  at,.        stop
-00008880: 6c6f 7373 3a20 666c 6f61 742c 0a20 2020  loss: float,.   
-00008890: 2020 2020 206c 6576 6572 6167 653a 204f       leverage: O
-000088a0: 7074 696f 6e61 6c5b 666c 6f61 745d 203d  ptional[float] =
-000088b0: 2031 2e30 0a20 2020 2029 202d 3e20 4f70   1.0.    ) -> Op
-000088c0: 7469 6f6e 616c 5b66 6c6f 6174 5d3a 0a20  tional[float]:. 
-000088d0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-000088e0: 6c66 2e5f 6765 745f 7374 616b 655f 616d  lf._get_stake_am
-000088f0: 6f75 6e74 5f6c 696d 6974 2870 6169 722c  ount_limit(pair,
-00008900: 2070 7269 6365 2c20 7374 6f70 6c6f 7373   price, stoploss
-00008910: 2c20 276d 696e 272c 206c 6576 6572 6167  , 'min', leverag
-00008920: 6529 0a0a 2020 2020 6465 6620 6765 745f  e)..    def get_
-00008930: 6d61 785f 7061 6972 5f73 7461 6b65 5f61  max_pair_stake_a
-00008940: 6d6f 756e 7428 7365 6c66 2c20 7061 6972  mount(self, pair
-00008950: 3a20 7374 722c 2070 7269 6365 3a20 666c  : str, price: fl
-00008960: 6f61 742c 206c 6576 6572 6167 653a 2066  oat, leverage: f
-00008970: 6c6f 6174 203d 2031 2e30 2920 2d3e 2066  loat = 1.0) -> f
-00008980: 6c6f 6174 3a0a 2020 2020 2020 2020 6d61  loat:.        ma
-00008990: 785f 7374 616b 655f 616d 6f75 6e74 203d  x_stake_amount =
-000089a0: 2073 656c 662e 5f67 6574 5f73 7461 6b65   self._get_stake
-000089b0: 5f61 6d6f 756e 745f 6c69 6d69 7428 7061  _amount_limit(pa
-000089c0: 6972 2c20 7072 6963 652c 2030 2e30 2c20  ir, price, 0.0, 
-000089d0: 276d 6178 272c 206c 6576 6572 6167 6529  'max', leverage)
-000089e0: 0a20 2020 2020 2020 2069 6620 6d61 785f  .        if max_
-000089f0: 7374 616b 655f 616d 6f75 6e74 2069 7320  stake_amount is 
-00008a00: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00008a10: 2020 2320 2a20 5368 6f75 6c64 206e 6576    # * Should nev
-00008a20: 6572 2062 6520 6578 6563 7574 6564 0a20  er be executed. 
-00008a30: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00008a40: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
-00008a50: 7074 696f 6e28 6627 7b73 656c 662e 6e61  ption(f'{self.na
-00008a60: 6d65 7d2e 6765 745f 6d61 785f 7061 6972  me}.get_max_pair
-00008a70: 5f73 7461 6b65 5f61 6d6f 756e 7420 7368  _stake_amount sh
-00008a80: 6f75 6c64 270a 2020 2020 2020 2020 2020  ould'.          
+00008660: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+00008670: 6563 6973 696f 6e4d 6f64 652c 2072 6f75  ecisionMode, rou
+00008680: 6e64 696e 675f 6d6f 6465 3d72 6f75 6e64  nding_mode=round
+00008690: 696e 675f 6d6f 6465 290a 0a20 2020 2064  ing_mode)..    d
+000086a0: 6566 2070 7269 6365 5f67 6574 5f6f 6e65  ef price_get_one
+000086b0: 5f70 6970 2873 656c 662c 2070 6169 723a  _pip(self, pair:
+000086c0: 2073 7472 2c20 7072 6963 653a 2066 6c6f   str, price: flo
+000086d0: 6174 2920 2d3e 2066 6c6f 6174 3a0a 2020  at) -> float:.  
+000086e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000086f0: 2020 4765 7427 7320 7468 6520 2231 2070    Get's the "1 p
+00008700: 6970 2220 7661 6c75 6520 666f 7220 7468  ip" value for th
+00008710: 6973 2070 6169 722e 0a20 2020 2020 2020  is pair..       
+00008720: 2055 7365 6420 696e 2050 7269 6365 4669   Used in PriceFi
+00008730: 6c74 6572 2074 6f20 6361 6c63 756c 6174  lter to calculat
+00008740: 6520 7468 6520 3170 6970 206d 6f76 656d  e the 1pip movem
+00008750: 656e 7473 2e0a 2020 2020 2020 2020 2222  ents..        ""
+00008760: 220a 2020 2020 2020 2020 7072 6563 6973  ".        precis
+00008770: 696f 6e20 3d20 7365 6c66 2e6d 6172 6b65  ion = self.marke
+00008780: 7473 5b70 6169 725d 5b27 7072 6563 6973  ts[pair]['precis
+00008790: 696f 6e27 5d5b 2770 7269 6365 275d 0a20  ion']['price']. 
+000087a0: 2020 2020 2020 2069 6620 7365 6c66 2e70         if self.p
+000087b0: 7265 6369 7369 6f6e 4d6f 6465 203d 3d20  recisionMode == 
+000087c0: 5449 434b 5f53 495a 453a 0a20 2020 2020  TICK_SIZE:.     
+000087d0: 2020 2020 2020 2072 6574 7572 6e20 7072         return pr
+000087e0: 6563 6973 696f 6e0a 2020 2020 2020 2020  ecision.        
+000087f0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00008800: 2020 7265 7475 726e 2031 202f 2070 6f77    return 1 / pow
+00008810: 2831 302c 2070 7265 6369 7369 6f6e 290a  (10, precision).
+00008820: 0a20 2020 2064 6566 2067 6574 5f6d 696e  .    def get_min
+00008830: 5f70 6169 725f 7374 616b 655f 616d 6f75  _pair_stake_amou
+00008840: 6e74 280a 2020 2020 2020 2020 7365 6c66  nt(.        self
+00008850: 2c0a 2020 2020 2020 2020 7061 6972 3a20  ,.        pair: 
+00008860: 7374 722c 0a20 2020 2020 2020 2070 7269  str,.        pri
+00008870: 6365 3a20 666c 6f61 742c 0a20 2020 2020  ce: float,.     
+00008880: 2020 2073 746f 706c 6f73 733a 2066 6c6f     stoploss: flo
+00008890: 6174 2c0a 2020 2020 2020 2020 6c65 7665  at,.        leve
+000088a0: 7261 6765 3a20 4f70 7469 6f6e 616c 5b66  rage: Optional[f
+000088b0: 6c6f 6174 5d20 3d20 312e 300a 2020 2020  loat] = 1.0.    
+000088c0: 2920 2d3e 204f 7074 696f 6e61 6c5b 666c  ) -> Optional[fl
+000088d0: 6f61 745d 3a0a 2020 2020 2020 2020 7265  oat]:.        re
+000088e0: 7475 726e 2073 656c 662e 5f67 6574 5f73  turn self._get_s
+000088f0: 7461 6b65 5f61 6d6f 756e 745f 6c69 6d69  take_amount_limi
+00008900: 7428 7061 6972 2c20 7072 6963 652c 2073  t(pair, price, s
+00008910: 746f 706c 6f73 732c 2027 6d69 6e27 2c20  toploss, 'min', 
+00008920: 6c65 7665 7261 6765 290a 0a20 2020 2064  leverage)..    d
+00008930: 6566 2067 6574 5f6d 6178 5f70 6169 725f  ef get_max_pair_
+00008940: 7374 616b 655f 616d 6f75 6e74 2873 656c  stake_amount(sel
+00008950: 662c 2070 6169 723a 2073 7472 2c20 7072  f, pair: str, pr
+00008960: 6963 653a 2066 6c6f 6174 2c20 6c65 7665  ice: float, leve
+00008970: 7261 6765 3a20 666c 6f61 7420 3d20 312e  rage: float = 1.
+00008980: 3029 202d 3e20 666c 6f61 743a 0a20 2020  0) -> float:.   
+00008990: 2020 2020 206d 6178 5f73 7461 6b65 5f61       max_stake_a
+000089a0: 6d6f 756e 7420 3d20 7365 6c66 2e5f 6765  mount = self._ge
+000089b0: 745f 7374 616b 655f 616d 6f75 6e74 5f6c  t_stake_amount_l
+000089c0: 696d 6974 2870 6169 722c 2070 7269 6365  imit(pair, price
+000089d0: 2c20 302e 302c 2027 6d61 7827 2c20 6c65  , 0.0, 'max', le
+000089e0: 7665 7261 6765 290a 2020 2020 2020 2020  verage).        
+000089f0: 6966 206d 6178 5f73 7461 6b65 5f61 6d6f  if max_stake_amo
+00008a00: 756e 7420 6973 204e 6f6e 653a 0a20 2020  unt is None:.   
+00008a10: 2020 2020 2020 2020 2023 202a 2053 686f           # * Sho
+00008a20: 756c 6420 6e65 7665 7220 6265 2065 7865  uld never be exe
+00008a30: 6375 7465 640a 2020 2020 2020 2020 2020  cuted.          
+00008a40: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
+00008a50: 6e61 6c45 7863 6570 7469 6f6e 2866 277b  nalException(f'{
+00008a60: 7365 6c66 2e6e 616d 657d 2e67 6574 5f6d  self.name}.get_m
+00008a70: 6178 5f70 6169 725f 7374 616b 655f 616d  ax_pair_stake_am
+00008a80: 6f75 6e74 2073 686f 756c 6427 0a20 2020  ount should'.   
 00008a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008aa0: 2020 2020 2020 2020 2020 2020 2027 6e65               'ne
-00008ab0: 7665 7220 7365 7420 6d61 785f 7374 616b  ver set max_stak
-00008ac0: 655f 616d 6f75 6e74 2074 6f20 4e6f 6e65  e_amount to None
-00008ad0: 2729 0a20 2020 2020 2020 2072 6574 7572  ').        retur
-00008ae0: 6e20 6d61 785f 7374 616b 655f 616d 6f75  n max_stake_amou
-00008af0: 6e74 0a0a 2020 2020 6465 6620 5f67 6574  nt..    def _get
-00008b00: 5f73 7461 6b65 5f61 6d6f 756e 745f 6c69  _stake_amount_li
-00008b10: 6d69 7428 0a20 2020 2020 2020 2073 656c  mit(.        sel
-00008b20: 662c 0a20 2020 2020 2020 2070 6169 723a  f,.        pair:
-00008b30: 2073 7472 2c0a 2020 2020 2020 2020 7072   str,.        pr
-00008b40: 6963 653a 2066 6c6f 6174 2c0a 2020 2020  ice: float,.    
-00008b50: 2020 2020 7374 6f70 6c6f 7373 3a20 666c      stoploss: fl
-00008b60: 6f61 742c 0a20 2020 2020 2020 206c 696d  oat,.        lim
-00008b70: 6974 3a20 4c69 7465 7261 6c5b 276d 696e  it: Literal['min
-00008b80: 272c 2027 6d61 7827 5d2c 0a20 2020 2020  ', 'max'],.     
-00008b90: 2020 206c 6576 6572 6167 653a 204f 7074     leverage: Opt
-00008ba0: 696f 6e61 6c5b 666c 6f61 745d 203d 2031  ional[float] = 1
-00008bb0: 2e30 0a20 2020 2029 202d 3e20 4f70 7469  .0.    ) -> Opti
-00008bc0: 6f6e 616c 5b66 6c6f 6174 5d3a 0a0a 2020  onal[float]:..  
-00008bd0: 2020 2020 2020 6973 4d69 6e20 3d20 6c69        isMin = li
-00008be0: 6d69 7420 3d3d 2027 6d69 6e27 0a0a 2020  mit == 'min'..  
-00008bf0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00008c00: 2020 2020 2020 206d 6172 6b65 7420 3d20         market = 
-00008c10: 7365 6c66 2e6d 6172 6b65 7473 5b70 6169  self.markets[pai
-00008c20: 725d 0a20 2020 2020 2020 2065 7863 6570  r].        excep
-00008c30: 7420 4b65 7945 7272 6f72 3a0a 2020 2020  t KeyError:.    
-00008c40: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00008c50: 6c75 6545 7272 6f72 2866 2243 616e 2774  lueError(f"Can't
-00008c60: 2067 6574 206d 6172 6b65 7420 696e 666f   get market info
-00008c70: 726d 6174 696f 6e20 666f 7220 7379 6d62  rmation for symb
-00008c80: 6f6c 207b 7061 6972 7d22 290a 0a20 2020  ol {pair}")..   
-00008c90: 2020 2020 2069 6620 6973 4d69 6e3a 0a20       if isMin:. 
-00008ca0: 2020 2020 2020 2020 2020 2023 2072 6573             # res
-00008cb0: 6572 7665 2073 6f6d 6520 7065 7263 656e  erve some percen
-00008cc0: 7420 6465 6669 6e65 6420 696e 2063 6f6e  t defined in con
-00008cd0: 6669 6720 2835 2520 6465 6661 756c 7429  fig (5% default)
-00008ce0: 202b 2073 746f 706c 6f73 730a 2020 2020   + stoploss.    
-00008cf0: 2020 2020 2020 2020 6d61 7267 696e 5f72          margin_r
-00008d00: 6573 6572 7665 3a20 666c 6f61 7420 3d20  eserve: float = 
-00008d10: 312e 3020 2b20 7365 6c66 2e5f 636f 6e66  1.0 + self._conf
-00008d20: 6967 2e67 6574 2827 616d 6f75 6e74 5f72  ig.get('amount_r
-00008d30: 6573 6572 7665 5f70 6572 6365 6e74 272c  eserve_percent',
-00008d40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ab0: 2020 2020 276e 6576 6572 2073 6574 206d      'never set m
+00008ac0: 6178 5f73 7461 6b65 5f61 6d6f 756e 7420  ax_stake_amount 
+00008ad0: 746f 204e 6f6e 6527 290a 2020 2020 2020  to None').      
+00008ae0: 2020 7265 7475 726e 206d 6178 5f73 7461    return max_sta
+00008af0: 6b65 5f61 6d6f 756e 740a 0a20 2020 2064  ke_amount..    d
+00008b00: 6566 205f 6765 745f 7374 616b 655f 616d  ef _get_stake_am
+00008b10: 6f75 6e74 5f6c 696d 6974 280a 2020 2020  ount_limit(.    
+00008b20: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00008b30: 2020 7061 6972 3a20 7374 722c 0a20 2020    pair: str,.   
+00008b40: 2020 2020 2070 7269 6365 3a20 666c 6f61       price: floa
+00008b50: 742c 0a20 2020 2020 2020 2073 746f 706c  t,.        stopl
+00008b60: 6f73 733a 2066 6c6f 6174 2c0a 2020 2020  oss: float,.    
+00008b70: 2020 2020 6c69 6d69 743a 204c 6974 6572      limit: Liter
+00008b80: 616c 5b27 6d69 6e27 2c20 276d 6178 275d  al['min', 'max']
+00008b90: 2c0a 2020 2020 2020 2020 6c65 7665 7261  ,.        levera
+00008ba0: 6765 3a20 4f70 7469 6f6e 616c 5b66 6c6f  ge: Optional[flo
+00008bb0: 6174 5d20 3d20 312e 300a 2020 2020 2920  at] = 1.0.    ) 
+00008bc0: 2d3e 204f 7074 696f 6e61 6c5b 666c 6f61  -> Optional[floa
+00008bd0: 745d 3a0a 0a20 2020 2020 2020 2069 734d  t]:..        isM
+00008be0: 696e 203d 206c 696d 6974 203d 3d20 276d  in = limit == 'm
+00008bf0: 696e 270a 0a20 2020 2020 2020 2074 7279  in'..        try
+00008c00: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
+00008c10: 726b 6574 203d 2073 656c 662e 6d61 726b  rket = self.mark
+00008c20: 6574 735b 7061 6972 5d0a 2020 2020 2020  ets[pair].      
+00008c30: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
+00008c40: 723a 0a20 2020 2020 2020 2020 2020 2072  r:.            r
+00008c50: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00008c60: 6622 4361 6e27 7420 6765 7420 6d61 726b  f"Can't get mark
+00008c70: 6574 2069 6e66 6f72 6d61 7469 6f6e 2066  et information f
+00008c80: 6f72 2073 796d 626f 6c20 7b70 6169 727d  or symbol {pair}
+00008c90: 2229 0a0a 2020 2020 2020 2020 6966 2069  ")..        if i
+00008ca0: 734d 696e 3a0a 2020 2020 2020 2020 2020  sMin:.          
+00008cb0: 2020 2320 7265 7365 7276 6520 736f 6d65    # reserve some
+00008cc0: 2070 6572 6365 6e74 2064 6566 696e 6564   percent defined
+00008cd0: 2069 6e20 636f 6e66 6967 2028 3525 2064   in config (5% d
+00008ce0: 6566 6175 6c74 2920 2b20 7374 6f70 6c6f  efault) + stoplo
+00008cf0: 7373 0a20 2020 2020 2020 2020 2020 206d  ss.            m
+00008d00: 6172 6769 6e5f 7265 7365 7276 653a 2066  argin_reserve: f
+00008d10: 6c6f 6174 203d 2031 2e30 202b 2073 656c  loat = 1.0 + sel
+00008d20: 662e 5f63 6f6e 6669 672e 6765 7428 2761  f._config.get('a
+00008d30: 6d6f 756e 745f 7265 7365 7276 655f 7065  mount_reserve_pe
+00008d40: 7263 656e 7427 2c0a 2020 2020 2020 2020  rcent',.        
 00008d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00008d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008d70: 2020 2020 2020 2020 2020 2020 4445 4641              DEFA
-00008d80: 554c 545f 414d 4f55 4e54 5f52 4553 4552  ULT_AMOUNT_RESER
-00008d90: 5645 5f50 4552 4345 4e54 290a 2020 2020  VE_PERCENT).    
-00008da0: 2020 2020 2020 2020 7374 6f70 6c6f 7373          stoploss
-00008db0: 5f72 6573 6572 7665 203d 2028 0a20 2020  _reserve = (.   
-00008dc0: 2020 2020 2020 2020 2020 2020 206d 6172               mar
-00008dd0: 6769 6e5f 7265 7365 7276 6520 2f20 2831  gin_reserve / (1
-00008de0: 202d 2061 6273 2873 746f 706c 6f73 7329   - abs(stoploss)
-00008df0: 2920 6966 2061 6273 2873 746f 706c 6f73  ) if abs(stoplos
-00008e00: 7329 2021 3d20 3120 656c 7365 2031 2e35  s) != 1 else 1.5
-00008e10: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00008e20: 2020 2020 2020 2020 2020 2023 2069 7420             # it 
-00008e30: 7368 6f75 6c64 206e 6f74 2062 6520 6d6f  should not be mo
-00008e40: 7265 2074 6861 6e20 3530 250a 2020 2020  re than 50%.    
-00008e50: 2020 2020 2020 2020 7374 6f70 6c6f 7373          stoploss
-00008e60: 5f72 6573 6572 7665 203d 206d 6178 286d  _reserve = max(m
-00008e70: 696e 2873 746f 706c 6f73 735f 7265 7365  in(stoploss_rese
-00008e80: 7276 652c 2031 2e35 292c 2031 290a 2020  rve, 1.5), 1).  
-00008e90: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00008ea0: 2020 2020 2020 2020 6d61 7267 696e 5f72          margin_r
-00008eb0: 6573 6572 7665 203d 2031 2e30 0a20 2020  eserve = 1.0.   
-00008ec0: 2020 2020 2020 2020 2073 746f 706c 6f73           stoplos
-00008ed0: 735f 7265 7365 7276 6520 3d20 312e 300a  s_reserve = 1.0.
-00008ee0: 0a20 2020 2020 2020 2073 7461 6b65 5f6c  .        stake_l
-00008ef0: 696d 6974 7320 3d20 5b5d 0a20 2020 2020  imits = [].     
-00008f00: 2020 206c 696d 6974 7320 3d20 6d61 726b     limits = mark
-00008f10: 6574 5b27 6c69 6d69 7473 275d 0a20 2020  et['limits'].   
-00008f20: 2020 2020 2069 6620 286c 696d 6974 735b       if (limits[
-00008f30: 2763 6f73 7427 5d5b 6c69 6d69 745d 2069  'cost'][limit] i
-00008f40: 7320 6e6f 7420 4e6f 6e65 293a 0a20 2020  s not None):.   
-00008f50: 2020 2020 2020 2020 2073 7461 6b65 5f6c           stake_l
-00008f60: 696d 6974 732e 6170 7065 6e64 280a 2020  imits.append(.  
-00008f70: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00008f80: 6c66 2e5f 636f 6e74 7261 6374 735f 746f  lf._contracts_to
-00008f90: 5f61 6d6f 756e 7428 7061 6972 2c20 6c69  _amount(pair, li
-00008fa0: 6d69 7473 5b27 636f 7374 275d 5b6c 696d  mits['cost'][lim
-00008fb0: 6974 5d29 202a 2073 746f 706c 6f73 735f  it]) * stoploss_
-00008fc0: 7265 7365 7276 650a 2020 2020 2020 2020  reserve.        
-00008fd0: 2020 2020 290a 0a20 2020 2020 2020 2069      )..        i
-00008fe0: 6620 286c 696d 6974 735b 2761 6d6f 756e  f (limits['amoun
-00008ff0: 7427 5d5b 6c69 6d69 745d 2069 7320 6e6f  t'][limit] is no
-00009000: 7420 4e6f 6e65 293a 0a20 2020 2020 2020  t None):.       
-00009010: 2020 2020 2073 7461 6b65 5f6c 696d 6974       stake_limit
-00009020: 732e 6170 7065 6e64 280a 2020 2020 2020  s.append(.      
-00009030: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00009040: 636f 6e74 7261 6374 735f 746f 5f61 6d6f  contracts_to_amo
-00009050: 756e 7428 7061 6972 2c20 6c69 6d69 7473  unt(pair, limits
-00009060: 5b27 616d 6f75 6e74 275d 5b6c 696d 6974  ['amount'][limit
-00009070: 5d29 202a 2070 7269 6365 202a 206d 6172  ]) * price * mar
-00009080: 6769 6e5f 7265 7365 7276 650a 2020 2020  gin_reserve.    
-00009090: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-000090a0: 2020 2069 6620 6e6f 7420 7374 616b 655f     if not stake_
-000090b0: 6c69 6d69 7473 3a0a 2020 2020 2020 2020  limits:.        
-000090c0: 2020 2020 7265 7475 726e 204e 6f6e 6520      return None 
-000090d0: 6966 2069 734d 696e 2065 6c73 6520 666c  if isMin else fl
-000090e0: 6f61 7428 2769 6e66 2729 0a0a 2020 2020  oat('inf')..    
-000090f0: 2020 2020 2320 5468 6520 7661 6c75 6520      # The value 
-00009100: 7265 7475 726e 6564 2073 686f 756c 6420  returned should 
-00009110: 7361 7469 7366 7920 626f 7468 206c 696d  satisfy both lim
-00009120: 6974 733a 2066 6f72 2061 6d6f 756e 7420  its: for amount 
-00009130: 2862 6173 6520 6375 7272 656e 6379 2920  (base currency) 
-00009140: 616e 640a 2020 2020 2020 2020 2320 666f  and.        # fo
-00009150: 7220 636f 7374 2028 7175 6f74 652c 2073  r cost (quote, s
-00009160: 7461 6b65 2063 7572 7265 6e63 7929 2c20  take currency), 
-00009170: 736f 206d 6178 2829 2069 7320 7573 6564  so max() is used
-00009180: 2068 6572 652e 0a20 2020 2020 2020 2023   here..        #
-00009190: 2053 6565 2061 6c73 6f20 2332 3537 3520   See also #2575 
-000091a0: 6174 2067 6974 6875 622e 0a20 2020 2020  at github..     
-000091b0: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-000091c0: 6765 745f 7374 616b 655f 616d 6f75 6e74  get_stake_amount
-000091d0: 5f63 6f6e 7369 6465 7269 6e67 5f6c 6576  _considering_lev
-000091e0: 6572 6167 6528 0a20 2020 2020 2020 2020  erage(.         
-000091f0: 2020 206d 6178 2873 7461 6b65 5f6c 696d     max(stake_lim
-00009200: 6974 7329 2069 6620 6973 4d69 6e20 656c  its) if isMin el
-00009210: 7365 206d 696e 2873 7461 6b65 5f6c 696d  se min(stake_lim
-00009220: 6974 7329 2c0a 2020 2020 2020 2020 2020  its),.          
-00009230: 2020 6c65 7665 7261 6765 206f 7220 312e    leverage or 1.
-00009240: 300a 2020 2020 2020 2020 290a 0a20 2020  0.        )..   
-00009250: 2064 6566 205f 6765 745f 7374 616b 655f   def _get_stake_
-00009260: 616d 6f75 6e74 5f63 6f6e 7369 6465 7269  amount_consideri
-00009270: 6e67 5f6c 6576 6572 6167 6528 7365 6c66  ng_leverage(self
-00009280: 2c20 7374 616b 655f 616d 6f75 6e74 3a20  , stake_amount: 
-00009290: 666c 6f61 742c 206c 6576 6572 6167 653a  float, leverage:
-000092a0: 2066 6c6f 6174 2920 2d3e 2066 6c6f 6174   float) -> float
-000092b0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-000092c0: 2020 2020 2020 5461 6b65 7320 7468 6520        Takes the 
-000092d0: 6d69 6e69 6d75 6d20 7374 616b 6520 616d  minimum stake am
-000092e0: 6f75 6e74 2066 6f72 2061 2070 6169 7220  ount for a pair 
-000092f0: 7769 7468 206e 6f20 6c65 7665 7261 6765  with no leverage
-00009300: 2061 6e64 2072 6574 7572 6e73 2074 6865   and returns the
-00009310: 206d 696e 696d 756d 0a20 2020 2020 2020   minimum.       
-00009320: 2073 7461 6b65 2061 6d6f 756e 7420 7768   stake amount wh
-00009330: 656e 206c 6576 6572 6167 6520 6973 2063  en leverage is c
-00009340: 6f6e 7369 6465 7265 640a 2020 2020 2020  onsidered.      
-00009350: 2020 3a70 6172 616d 2073 7461 6b65 5f61    :param stake_a
-00009360: 6d6f 756e 743a 2054 6865 2073 7461 6b65  mount: The stake
-00009370: 2061 6d6f 756e 7420 666f 7220 6120 7061   amount for a pa
-00009380: 6972 2062 6566 6f72 6520 6c65 7665 7261  ir before levera
-00009390: 6765 2069 7320 636f 6e73 6964 6572 6564  ge is considered
-000093a0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000093b0: 6c65 7665 7261 6765 3a20 5468 6520 616d  leverage: The am
-000093c0: 6f75 6e74 206f 6620 6c65 7665 7261 6765  ount of leverage
-000093d0: 2062 6569 6e67 2075 7365 6420 6f6e 2074   being used on t
-000093e0: 6865 2063 7572 7265 6e74 2074 7261 6465  he current trade
-000093f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00009400: 2020 2020 2072 6574 7572 6e20 7374 616b       return stak
-00009410: 655f 616d 6f75 6e74 202f 206c 6576 6572  e_amount / lever
-00009420: 6167 650a 0a20 2020 2023 2044 7279 2d72  age..    # Dry-r
-00009430: 756e 206d 6574 686f 6473 0a0a 2020 2020  un methods..    
-00009440: 6465 6620 6372 6561 7465 5f64 7279 5f72  def create_dry_r
-00009450: 756e 5f6f 7264 6572 2873 656c 662c 2070  un_order(self, p
-00009460: 6169 723a 2073 7472 2c20 6f72 6465 7274  air: str, ordert
-00009470: 7970 653a 2073 7472 2c20 7369 6465 3a20  ype: str, side: 
-00009480: 7374 722c 2061 6d6f 756e 743a 2066 6c6f  str, amount: flo
-00009490: 6174 2c0a 2020 2020 2020 2020 2020 2020  at,.            
+00008d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008d80: 2020 2044 4546 4155 4c54 5f41 4d4f 554e     DEFAULT_AMOUN
+00008d90: 545f 5245 5345 5256 455f 5045 5243 454e  T_RESERVE_PERCEN
+00008da0: 5429 0a20 2020 2020 2020 2020 2020 2073  T).            s
+00008db0: 746f 706c 6f73 735f 7265 7365 7276 6520  toploss_reserve 
+00008dc0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00008dd0: 2020 2020 6d61 7267 696e 5f72 6573 6572      margin_reser
+00008de0: 7665 202f 2028 3120 2d20 6162 7328 7374  ve / (1 - abs(st
+00008df0: 6f70 6c6f 7373 2929 2069 6620 6162 7328  oploss)) if abs(
+00008e00: 7374 6f70 6c6f 7373 2920 213d 2031 2065  stoploss) != 1 e
+00008e10: 6c73 6520 312e 350a 2020 2020 2020 2020  lse 1.5.        
+00008e20: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00008e30: 2020 2320 6974 2073 686f 756c 6420 6e6f    # it should no
+00008e40: 7420 6265 206d 6f72 6520 7468 616e 2035  t be more than 5
+00008e50: 3025 0a20 2020 2020 2020 2020 2020 2073  0%.            s
+00008e60: 746f 706c 6f73 735f 7265 7365 7276 6520  toploss_reserve 
+00008e70: 3d20 6d61 7828 6d69 6e28 7374 6f70 6c6f  = max(min(stoplo
+00008e80: 7373 5f72 6573 6572 7665 2c20 312e 3529  ss_reserve, 1.5)
+00008e90: 2c20 3129 0a20 2020 2020 2020 2065 6c73  , 1).        els
+00008ea0: 653a 0a20 2020 2020 2020 2020 2020 206d  e:.            m
+00008eb0: 6172 6769 6e5f 7265 7365 7276 6520 3d20  argin_reserve = 
+00008ec0: 312e 300a 2020 2020 2020 2020 2020 2020  1.0.            
+00008ed0: 7374 6f70 6c6f 7373 5f72 6573 6572 7665  stoploss_reserve
+00008ee0: 203d 2031 2e30 0a0a 2020 2020 2020 2020   = 1.0..        
+00008ef0: 7374 616b 655f 6c69 6d69 7473 203d 205b  stake_limits = [
+00008f00: 5d0a 2020 2020 2020 2020 6c69 6d69 7473  ].        limits
+00008f10: 203d 206d 6172 6b65 745b 276c 696d 6974   = market['limit
+00008f20: 7327 5d0a 2020 2020 2020 2020 6966 2028  s'].        if (
+00008f30: 6c69 6d69 7473 5b27 636f 7374 275d 5b6c  limits['cost'][l
+00008f40: 696d 6974 5d20 6973 206e 6f74 204e 6f6e  imit] is not Non
+00008f50: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00008f60: 7374 616b 655f 6c69 6d69 7473 2e61 7070  stake_limits.app
+00008f70: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
+00008f80: 2020 2020 2073 656c 662e 5f63 6f6e 7472       self._contr
+00008f90: 6163 7473 5f74 6f5f 616d 6f75 6e74 2870  acts_to_amount(p
+00008fa0: 6169 722c 206c 696d 6974 735b 2763 6f73  air, limits['cos
+00008fb0: 7427 5d5b 6c69 6d69 745d 2920 2a20 7374  t'][limit]) * st
+00008fc0: 6f70 6c6f 7373 5f72 6573 6572 7665 0a20  oploss_reserve. 
+00008fd0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00008fe0: 2020 2020 2020 6966 2028 6c69 6d69 7473        if (limits
+00008ff0: 5b27 616d 6f75 6e74 275d 5b6c 696d 6974  ['amount'][limit
+00009000: 5d20 6973 206e 6f74 204e 6f6e 6529 3a0a  ] is not None):.
+00009010: 2020 2020 2020 2020 2020 2020 7374 616b              stak
+00009020: 655f 6c69 6d69 7473 2e61 7070 656e 6428  e_limits.append(
+00009030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009040: 2073 656c 662e 5f63 6f6e 7472 6163 7473   self._contracts
+00009050: 5f74 6f5f 616d 6f75 6e74 2870 6169 722c  _to_amount(pair,
+00009060: 206c 696d 6974 735b 2761 6d6f 756e 7427   limits['amount'
+00009070: 5d5b 6c69 6d69 745d 2920 2a20 7072 6963  ][limit]) * pric
+00009080: 6520 2a20 6d61 7267 696e 5f72 6573 6572  e * margin_reser
+00009090: 7665 0a20 2020 2020 2020 2020 2020 2029  ve.            )
+000090a0: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
+000090b0: 2073 7461 6b65 5f6c 696d 6974 733a 0a20   stake_limits:. 
+000090c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000090d0: 6e20 4e6f 6e65 2069 6620 6973 4d69 6e20  n None if isMin 
+000090e0: 656c 7365 2066 6c6f 6174 2827 696e 6627  else float('inf'
+000090f0: 290a 0a20 2020 2020 2020 2023 2054 6865  )..        # The
+00009100: 2076 616c 7565 2072 6574 7572 6e65 6420   value returned 
+00009110: 7368 6f75 6c64 2073 6174 6973 6679 2062  should satisfy b
+00009120: 6f74 6820 6c69 6d69 7473 3a20 666f 7220  oth limits: for 
+00009130: 616d 6f75 6e74 2028 6261 7365 2063 7572  amount (base cur
+00009140: 7265 6e63 7929 2061 6e64 0a20 2020 2020  rency) and.     
+00009150: 2020 2023 2066 6f72 2063 6f73 7420 2871     # for cost (q
+00009160: 756f 7465 2c20 7374 616b 6520 6375 7272  uote, stake curr
+00009170: 656e 6379 292c 2073 6f20 6d61 7828 2920  ency), so max() 
+00009180: 6973 2075 7365 6420 6865 7265 2e0a 2020  is used here..  
+00009190: 2020 2020 2020 2320 5365 6520 616c 736f        # See also
+000091a0: 2023 3235 3735 2061 7420 6769 7468 7562   #2575 at github
+000091b0: 2e0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+000091c0: 2073 656c 662e 5f67 6574 5f73 7461 6b65   self._get_stake
+000091d0: 5f61 6d6f 756e 745f 636f 6e73 6964 6572  _amount_consider
+000091e0: 696e 675f 6c65 7665 7261 6765 280a 2020  ing_leverage(.  
+000091f0: 2020 2020 2020 2020 2020 6d61 7828 7374            max(st
+00009200: 616b 655f 6c69 6d69 7473 2920 6966 2069  ake_limits) if i
+00009210: 734d 696e 2065 6c73 6520 6d69 6e28 7374  sMin else min(st
+00009220: 616b 655f 6c69 6d69 7473 292c 0a20 2020  ake_limits),.   
+00009230: 2020 2020 2020 2020 206c 6576 6572 6167           leverag
+00009240: 6520 6f72 2031 2e30 0a20 2020 2020 2020  e or 1.0.       
+00009250: 2029 0a0a 2020 2020 6465 6620 5f67 6574   )..    def _get
+00009260: 5f73 7461 6b65 5f61 6d6f 756e 745f 636f  _stake_amount_co
+00009270: 6e73 6964 6572 696e 675f 6c65 7665 7261  nsidering_levera
+00009280: 6765 2873 656c 662c 2073 7461 6b65 5f61  ge(self, stake_a
+00009290: 6d6f 756e 743a 2066 6c6f 6174 2c20 6c65  mount: float, le
+000092a0: 7665 7261 6765 3a20 666c 6f61 7429 202d  verage: float) -
+000092b0: 3e20 666c 6f61 743a 0a20 2020 2020 2020  > float:.       
+000092c0: 2022 2222 0a20 2020 2020 2020 2054 616b   """.        Tak
+000092d0: 6573 2074 6865 206d 696e 696d 756d 2073  es the minimum s
+000092e0: 7461 6b65 2061 6d6f 756e 7420 666f 7220  take amount for 
+000092f0: 6120 7061 6972 2077 6974 6820 6e6f 206c  a pair with no l
+00009300: 6576 6572 6167 6520 616e 6420 7265 7475  everage and retu
+00009310: 726e 7320 7468 6520 6d69 6e69 6d75 6d0a  rns the minimum.
+00009320: 2020 2020 2020 2020 7374 616b 6520 616d          stake am
+00009330: 6f75 6e74 2077 6865 6e20 6c65 7665 7261  ount when levera
+00009340: 6765 2069 7320 636f 6e73 6964 6572 6564  ge is considered
+00009350: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00009360: 7374 616b 655f 616d 6f75 6e74 3a20 5468  stake_amount: Th
+00009370: 6520 7374 616b 6520 616d 6f75 6e74 2066  e stake amount f
+00009380: 6f72 2061 2070 6169 7220 6265 666f 7265  or a pair before
+00009390: 206c 6576 6572 6167 6520 6973 2063 6f6e   leverage is con
+000093a0: 7369 6465 7265 640a 2020 2020 2020 2020  sidered.        
+000093b0: 3a70 6172 616d 206c 6576 6572 6167 653a  :param leverage:
+000093c0: 2054 6865 2061 6d6f 756e 7420 6f66 206c   The amount of l
+000093d0: 6576 6572 6167 6520 6265 696e 6720 7573  everage being us
+000093e0: 6564 206f 6e20 7468 6520 6375 7272 656e  ed on the curren
+000093f0: 7420 7472 6164 650a 2020 2020 2020 2020  t trade.        
+00009400: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+00009410: 726e 2073 7461 6b65 5f61 6d6f 756e 7420  rn stake_amount 
+00009420: 2f20 6c65 7665 7261 6765 0a0a 2020 2020  / leverage..    
+00009430: 2320 4472 792d 7275 6e20 6d65 7468 6f64  # Dry-run method
+00009440: 730a 0a20 2020 2064 6566 2063 7265 6174  s..    def creat
+00009450: 655f 6472 795f 7275 6e5f 6f72 6465 7228  e_dry_run_order(
+00009460: 7365 6c66 2c20 7061 6972 3a20 7374 722c  self, pair: str,
+00009470: 206f 7264 6572 7479 7065 3a20 7374 722c   ordertype: str,
+00009480: 2073 6964 653a 2073 7472 2c20 616d 6f75   side: str, amou
+00009490: 6e74 3a20 666c 6f61 742c 0a20 2020 2020  nt: float,.     
 000094a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094b0: 2072 6174 653a 2066 6c6f 6174 2c20 6c65   rate: float, le
-000094c0: 7665 7261 6765 3a20 666c 6f61 742c 2070  verage: float, p
-000094d0: 6172 616d 733a 2044 6963 7420 3d20 7b7d  arams: Dict = {}
-000094e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000094f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00009500: 746f 705f 6c6f 7373 3a20 626f 6f6c 203d  top_loss: bool =
-00009510: 2046 616c 7365 2920 2d3e 2044 6963 745b   False) -> Dict[
-00009520: 7374 722c 2041 6e79 5d3a 0a20 2020 2020  str, Any]:.     
-00009530: 2020 206e 6f77 203d 2064 745f 6e6f 7728     now = dt_now(
-00009540: 290a 2020 2020 2020 2020 6f72 6465 725f  ).        order_
-00009550: 6964 203d 2066 2764 7279 5f72 756e 5f7b  id = f'dry_run_{
-00009560: 7369 6465 7d5f 7b6e 6f77 2e74 696d 6573  side}_{now.times
-00009570: 7461 6d70 2829 7d27 0a20 2020 2020 2020  tamp()}'.       
-00009580: 2023 2052 6f75 6e64 696e 6720 6865 7265   # Rounding here
-00009590: 206d 7573 7420 7265 7370 6563 7420 746f   must respect to
-000095a0: 2063 6f6e 7472 6163 7420 7369 7a65 730a   contract sizes.
-000095b0: 2020 2020 2020 2020 5f61 6d6f 756e 7420          _amount 
-000095c0: 3d20 7365 6c66 2e5f 636f 6e74 7261 6374  = self._contract
-000095d0: 735f 746f 5f61 6d6f 756e 7428 0a20 2020  s_to_amount(.   
-000095e0: 2020 2020 2020 2020 2070 6169 722c 2073           pair, s
-000095f0: 656c 662e 616d 6f75 6e74 5f74 6f5f 7072  elf.amount_to_pr
-00009600: 6563 6973 696f 6e28 7061 6972 2c20 7365  ecision(pair, se
-00009610: 6c66 2e5f 616d 6f75 6e74 5f74 6f5f 636f  lf._amount_to_co
-00009620: 6e74 7261 6374 7328 7061 6972 2c20 616d  ntracts(pair, am
-00009630: 6f75 6e74 2929 290a 2020 2020 2020 2020  ount))).        
-00009640: 6472 795f 6f72 6465 723a 2044 6963 745b  dry_order: Dict[
-00009650: 7374 722c 2041 6e79 5d20 3d20 7b0a 2020  str, Any] = {.  
-00009660: 2020 2020 2020 2020 2020 2769 6427 3a20            'id': 
-00009670: 6f72 6465 725f 6964 2c0a 2020 2020 2020  order_id,.      
-00009680: 2020 2020 2020 2773 796d 626f 6c27 3a20        'symbol': 
-00009690: 7061 6972 2c0a 2020 2020 2020 2020 2020  pair,.          
-000096a0: 2020 2770 7269 6365 273a 2072 6174 652c    'price': rate,
-000096b0: 0a20 2020 2020 2020 2020 2020 2027 6176  .            'av
-000096c0: 6572 6167 6527 3a20 7261 7465 2c0a 2020  erage': rate,.  
-000096d0: 2020 2020 2020 2020 2020 2761 6d6f 756e            'amoun
-000096e0: 7427 3a20 5f61 6d6f 756e 742c 0a20 2020  t': _amount,.   
-000096f0: 2020 2020 2020 2020 2027 636f 7374 273a           'cost':
-00009700: 205f 616d 6f75 6e74 202a 2072 6174 652c   _amount * rate,
-00009710: 0a20 2020 2020 2020 2020 2020 2027 7479  .            'ty
-00009720: 7065 273a 206f 7264 6572 7479 7065 2c0a  pe': ordertype,.
-00009730: 2020 2020 2020 2020 2020 2020 2773 6964              'sid
-00009740: 6527 3a20 7369 6465 2c0a 2020 2020 2020  e': side,.      
-00009750: 2020 2020 2020 2766 696c 6c65 6427 3a20        'filled': 
-00009760: 302c 0a20 2020 2020 2020 2020 2020 2027  0,.            '
-00009770: 7265 6d61 696e 696e 6727 3a20 5f61 6d6f  remaining': _amo
-00009780: 756e 742c 0a20 2020 2020 2020 2020 2020  unt,.           
-00009790: 2027 6461 7465 7469 6d65 273a 206e 6f77   'datetime': now
-000097a0: 2e73 7472 6674 696d 6528 2725 592d 256d  .strftime('%Y-%m
-000097b0: 2d25 6454 2548 3a25 4d3a 2553 2e25 665a  -%dT%H:%M:%S.%fZ
-000097c0: 2729 2c0a 2020 2020 2020 2020 2020 2020  '),.            
-000097d0: 2774 696d 6573 7461 6d70 273a 2064 745f  'timestamp': dt_
-000097e0: 7473 286e 6f77 292c 0a20 2020 2020 2020  ts(now),.       
-000097f0: 2020 2020 2027 7374 6174 7573 273a 2022       'status': "
-00009800: 6f70 656e 222c 0a20 2020 2020 2020 2020  open",.         
-00009810: 2020 2027 6665 6527 3a20 4e6f 6e65 2c0a     'fee': None,.
-00009820: 2020 2020 2020 2020 2020 2020 2769 6e66              'inf
-00009830: 6f27 3a20 7b7d 2c0a 2020 2020 2020 2020  o': {},.        
-00009840: 2020 2020 276c 6576 6572 6167 6527 3a20      'leverage': 
-00009850: 6c65 7665 7261 6765 0a20 2020 2020 2020  leverage.       
-00009860: 207d 0a20 2020 2020 2020 2069 6620 7374   }.        if st
-00009870: 6f70 5f6c 6f73 733a 0a20 2020 2020 2020  op_loss:.       
-00009880: 2020 2020 2064 7279 5f6f 7264 6572 5b22       dry_order["
-00009890: 696e 666f 225d 203d 207b 2273 746f 7050  info"] = {"stopP
-000098a0: 7269 6365 223a 2064 7279 5f6f 7264 6572  rice": dry_order
-000098b0: 5b22 7072 6963 6522 5d7d 0a20 2020 2020  ["price"]}.     
-000098c0: 2020 2020 2020 2064 7279 5f6f 7264 6572         dry_order
-000098d0: 5b73 656c 662e 5f66 745f 6861 735b 2773  [self._ft_has['s
-000098e0: 746f 705f 7072 6963 655f 7061 7261 6d27  top_price_param'
-000098f0: 5d5d 203d 2064 7279 5f6f 7264 6572 5b22  ]] = dry_order["
-00009900: 7072 6963 6522 5d0a 2020 2020 2020 2020  price"].        
-00009910: 2020 2020 2320 576f 726b 6172 6f75 6e64      # Workaround
-00009920: 2074 6f20 6176 6f69 6420 6669 6c6c 696e   to avoid fillin
-00009930: 6720 7374 6f70 6c6f 7373 206f 7264 6572  g stoploss order
-00009940: 7320 696d 6d65 6469 6174 656c 790a 2020  s immediately.  
-00009950: 2020 2020 2020 2020 2020 6472 795f 6f72            dry_or
-00009960: 6465 725b 2266 745f 6f72 6465 725f 7479  der["ft_order_ty
-00009970: 7065 225d 203d 2022 7374 6f70 6c6f 7373  pe"] = "stoploss
-00009980: 220a 2020 2020 2020 2020 6f72 6465 7262  ".        orderb
-00009990: 6f6f 6b3a 204f 7074 696f 6e61 6c5b 4f72  ook: Optional[Or
-000099a0: 6465 7242 6f6f 6b5d 203d 204e 6f6e 650a  derBook] = None.
-000099b0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000099c0: 6578 6368 616e 6765 5f68 6173 2827 6665  exchange_has('fe
-000099d0: 7463 684c 324f 7264 6572 426f 6f6b 2729  tchL2OrderBook')
-000099e0: 3a0a 2020 2020 2020 2020 2020 2020 6f72  :.            or
-000099f0: 6465 7262 6f6f 6b20 3d20 7365 6c66 2e66  derbook = self.f
-00009a00: 6574 6368 5f6c 325f 6f72 6465 725f 626f  etch_l2_order_bo
-00009a10: 6f6b 2870 6169 722c 2032 3029 0a20 2020  ok(pair, 20).   
-00009a20: 2020 2020 2069 6620 6f72 6465 7274 7970       if ordertyp
-00009a30: 6520 3d3d 2022 6c69 6d69 7422 2061 6e64  e == "limit" and
-00009a40: 206f 7264 6572 626f 6f6b 3a0a 2020 2020   orderbook:.    
-00009a50: 2020 2020 2020 2020 2320 416c 6c6f 7720          # Allow 
-00009a60: 6120 3325 2070 7269 6365 2064 6966 6665  a 3% price diffe
-00009a70: 7265 6e63 650a 2020 2020 2020 2020 2020  rence.          
-00009a80: 2020 616c 6c6f 7765 645f 6469 6666 203d    allowed_diff =
-00009a90: 2030 2e30 330a 2020 2020 2020 2020 2020   0.03.          
-00009aa0: 2020 6966 2073 656c 662e 5f64 7279 5f69    if self._dry_i
-00009ab0: 735f 7072 6963 655f 6372 6f73 7365 6428  s_price_crossed(
-00009ac0: 7061 6972 2c20 7369 6465 2c20 7261 7465  pair, side, rate
-00009ad0: 2c20 6f72 6465 7262 6f6f 6b2c 2061 6c6c  , orderbook, all
-00009ae0: 6f77 6564 5f64 6966 6629 3a0a 2020 2020  owed_diff):.    
-00009af0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-00009b00: 6572 2e69 6e66 6f28 0a20 2020 2020 2020  er.info(.       
-00009b10: 2020 2020 2020 2020 2020 2020 2066 2243               f"C
-00009b20: 6f6e 7665 7274 6564 206f 7264 6572 207b  onverted order {
-00009b30: 7061 6972 7d20 746f 206d 6172 6b65 7420  pair} to market 
-00009b40: 6f72 6465 7220 6475 6520 746f 2070 7269  order due to pri
-00009b50: 6365 207b 7261 7465 7d20 6372 6f73 7369  ce {rate} crossi
-00009b60: 6e67 2073 7072 6561 6420 220a 2020 2020  ng spread ".    
-00009b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009b80: 6622 6279 206d 6f72 6520 7468 616e 207b  f"by more than {
-00009b90: 616c 6c6f 7765 645f 6469 6666 3a2e 3225  allowed_diff:.2%
-00009ba0: 7d2e 2229 0a20 2020 2020 2020 2020 2020  }.").           
-00009bb0: 2020 2020 2064 7279 5f6f 7264 6572 5b22       dry_order["
-00009bc0: 7479 7065 225d 203d 2022 6d61 726b 6574  type"] = "market
-00009bd0: 220a 0a20 2020 2020 2020 2069 6620 6472  "..        if dr
-00009be0: 795f 6f72 6465 725b 2274 7970 6522 5d20  y_order["type"] 
-00009bf0: 3d3d 2022 6d61 726b 6574 2220 616e 6420  == "market" and 
-00009c00: 6e6f 7420 6472 795f 6f72 6465 722e 6765  not dry_order.ge
-00009c10: 7428 2266 745f 6f72 6465 725f 7479 7065  t("ft_order_type
-00009c20: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
-00009c30: 2320 5570 6461 7465 206d 6172 6b65 7420  # Update market 
-00009c40: 6f72 6465 7220 7072 6963 696e 670a 2020  order pricing.  
-00009c50: 2020 2020 2020 2020 2020 6176 6572 6167            averag
-00009c60: 6520 3d20 7365 6c66 2e67 6574 5f64 7279  e = self.get_dry
-00009c70: 5f6d 6172 6b65 745f 6669 6c6c 5f70 7269  _market_fill_pri
-00009c80: 6365 2870 6169 722c 2073 6964 652c 2061  ce(pair, side, a
-00009c90: 6d6f 756e 742c 2072 6174 652c 206f 7264  mount, rate, ord
-00009ca0: 6572 626f 6f6b 290a 2020 2020 2020 2020  erbook).        
-00009cb0: 2020 2020 6472 795f 6f72 6465 722e 7570      dry_order.up
-00009cc0: 6461 7465 287b 0a20 2020 2020 2020 2020  date({.         
-00009cd0: 2020 2020 2020 2027 6176 6572 6167 6527         'average'
-00009ce0: 3a20 6176 6572 6167 652c 0a20 2020 2020  : average,.     
-00009cf0: 2020 2020 2020 2020 2020 2027 6669 6c6c             'fill
-00009d00: 6564 273a 205f 616d 6f75 6e74 2c0a 2020  ed': _amount,.  
-00009d10: 2020 2020 2020 2020 2020 2020 2020 2772                'r
-00009d20: 656d 6169 6e69 6e67 273a 2030 2e30 2c0a  emaining': 0.0,.
-00009d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009d40: 2773 7461 7475 7327 3a20 2263 6c6f 7365  'status': "close
-00009d50: 6422 2c0a 2020 2020 2020 2020 2020 2020  d",.            
-00009d60: 2020 2020 2763 6f73 7427 3a20 2864 7279      'cost': (dry
-00009d70: 5f6f 7264 6572 5b27 616d 6f75 6e74 275d  _order['amount']
-00009d80: 202a 2061 7665 7261 6765 290a 2020 2020   * average).    
-00009d90: 2020 2020 2020 2020 7d29 0a20 2020 2020          }).     
-00009da0: 2020 2020 2020 2023 206d 6172 6b65 7420         # market 
-00009db0: 6f72 6465 7273 2077 696c 6c20 616c 7761  orders will alwa
-00009dc0: 7973 2069 6e63 7572 7220 7461 6b65 7220  ys incurr taker 
-00009dd0: 6665 6573 0a20 2020 2020 2020 2020 2020  fees.           
-00009de0: 2064 7279 5f6f 7264 6572 203d 2073 656c   dry_order = sel
-00009df0: 662e 6164 645f 6472 795f 6f72 6465 725f  f.add_dry_order_
-00009e00: 6665 6528 7061 6972 2c20 6472 795f 6f72  fee(pair, dry_or
-00009e10: 6465 722c 2027 7461 6b65 7227 290a 0a20  der, 'taker').. 
-00009e20: 2020 2020 2020 2064 7279 5f6f 7264 6572         dry_order
-00009e30: 203d 2073 656c 662e 6368 6563 6b5f 6472   = self.check_dr
-00009e40: 795f 6c69 6d69 745f 6f72 6465 725f 6669  y_limit_order_fi
-00009e50: 6c6c 6564 280a 2020 2020 2020 2020 2020  lled(.          
-00009e60: 2020 6472 795f 6f72 6465 722c 2069 6d6d    dry_order, imm
-00009e70: 6564 6961 7465 3d54 7275 652c 206f 7264  ediate=True, ord
-00009e80: 6572 626f 6f6b 3d6f 7264 6572 626f 6f6b  erbook=orderbook
-00009e90: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
-00009ea0: 5f64 7279 5f72 756e 5f6f 7065 6e5f 6f72  _dry_run_open_or
-00009eb0: 6465 7273 5b64 7279 5f6f 7264 6572 5b22  ders[dry_order["
-00009ec0: 6964 225d 5d20 3d20 6472 795f 6f72 6465  id"]] = dry_orde
-00009ed0: 720a 2020 2020 2020 2020 2320 436f 7079  r.        # Copy
-00009ee0: 206f 7264 6572 2061 6e64 2063 6c6f 7365   order and close
-00009ef0: 2069 7420 2d20 736f 2074 6865 2072 6574   it - so the ret
-00009f00: 7572 6e65 6420 6f72 6465 7220 6973 206f  urned order is o
-00009f10: 7065 6e20 756e 6c65 7373 2069 7427 7320  pen unless it's 
-00009f20: 6120 6d61 726b 6574 206f 7264 6572 0a20  a market order. 
-00009f30: 2020 2020 2020 2072 6574 7572 6e20 6472         return dr
-00009f40: 795f 6f72 6465 720a 0a20 2020 2064 6566  y_order..    def
-00009f50: 2061 6464 5f64 7279 5f6f 7264 6572 5f66   add_dry_order_f
-00009f60: 6565 280a 2020 2020 2020 2020 7365 6c66  ee(.        self
-00009f70: 2c0a 2020 2020 2020 2020 7061 6972 3a20  ,.        pair: 
-00009f80: 7374 722c 0a20 2020 2020 2020 2064 7279  str,.        dry
-00009f90: 5f6f 7264 6572 3a20 4469 6374 5b73 7472  _order: Dict[str
-00009fa0: 2c20 416e 795d 2c0a 2020 2020 2020 2020  , Any],.        
-00009fb0: 7461 6b65 725f 6f72 5f6d 616b 6572 3a20  taker_or_maker: 
-00009fc0: 4d61 6b65 7254 616b 6572 2c0a 2020 2020  MakerTaker,.    
-00009fd0: 2920 2d3e 2044 6963 745b 7374 722c 2041  ) -> Dict[str, A
-00009fe0: 6e79 5d3a 0a20 2020 2020 2020 2066 6565  ny]:.        fee
-00009ff0: 203d 2073 656c 662e 6765 745f 6665 6528   = self.get_fee(
-0000a000: 7061 6972 2c20 7461 6b65 725f 6f72 5f6d  pair, taker_or_m
-0000a010: 616b 6572 3d74 616b 6572 5f6f 725f 6d61  aker=taker_or_ma
-0000a020: 6b65 7229 0a20 2020 2020 2020 2064 7279  ker).        dry
-0000a030: 5f6f 7264 6572 2e75 7064 6174 6528 7b0a  _order.update({.
-0000a040: 2020 2020 2020 2020 2020 2020 2766 6565              'fee
-0000a050: 273a 207b 0a20 2020 2020 2020 2020 2020  ': {.           
-0000a060: 2020 2020 2027 6375 7272 656e 6379 273a       'currency':
-0000a070: 2073 656c 662e 6765 745f 7061 6972 5f71   self.get_pair_q
-0000a080: 756f 7465 5f63 7572 7265 6e63 7928 7061  uote_currency(pa
-0000a090: 6972 292c 0a20 2020 2020 2020 2020 2020  ir),.           
-0000a0a0: 2020 2020 2027 636f 7374 273a 2064 7279       'cost': dry
-0000a0b0: 5f6f 7264 6572 5b27 636f 7374 275d 202a  _order['cost'] *
-0000a0c0: 2066 6565 2c0a 2020 2020 2020 2020 2020   fee,.          
-0000a0d0: 2020 2020 2020 2772 6174 6527 3a20 6665        'rate': fe
-0000a0e0: 650a 2020 2020 2020 2020 2020 2020 7d0a  e.            }.
-0000a0f0: 2020 2020 2020 2020 7d29 0a20 2020 2020          }).     
-0000a100: 2020 2072 6574 7572 6e20 6472 795f 6f72     return dry_or
-0000a110: 6465 720a 0a20 2020 2064 6566 2067 6574  der..    def get
-0000a120: 5f64 7279 5f6d 6172 6b65 745f 6669 6c6c  _dry_market_fill
-0000a130: 5f70 7269 6365 2873 656c 662c 2070 6169  _price(self, pai
-0000a140: 723a 2073 7472 2c20 7369 6465 3a20 7374  r: str, side: st
-0000a150: 722c 2061 6d6f 756e 743a 2066 6c6f 6174  r, amount: float
-0000a160: 2c20 7261 7465 3a20 666c 6f61 742c 0a20  , rate: float,. 
-0000a170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000094b0: 2020 2020 2020 2020 7261 7465 3a20 666c          rate: fl
+000094c0: 6f61 742c 206c 6576 6572 6167 653a 2066  oat, leverage: f
+000094d0: 6c6f 6174 2c20 7061 7261 6d73 3a20 4469  loat, params: Di
+000094e0: 6374 203d 207b 7d2c 0a20 2020 2020 2020  ct = {},.       
+000094f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009500: 2020 2020 2020 7374 6f70 5f6c 6f73 733a        stop_loss:
+00009510: 2062 6f6f 6c20 3d20 4661 6c73 6529 202d   bool = False) -
+00009520: 3e20 4469 6374 5b73 7472 2c20 416e 795d  > Dict[str, Any]
+00009530: 3a0a 2020 2020 2020 2020 6e6f 7720 3d20  :.        now = 
+00009540: 6474 5f6e 6f77 2829 0a20 2020 2020 2020  dt_now().       
+00009550: 206f 7264 6572 5f69 6420 3d20 6627 6472   order_id = f'dr
+00009560: 795f 7275 6e5f 7b73 6964 657d 5f7b 6e6f  y_run_{side}_{no
+00009570: 772e 7469 6d65 7374 616d 7028 297d 270a  w.timestamp()}'.
+00009580: 2020 2020 2020 2020 2320 526f 756e 6469          # Roundi
+00009590: 6e67 2068 6572 6520 6d75 7374 2072 6573  ng here must res
+000095a0: 7065 6374 2074 6f20 636f 6e74 7261 6374  pect to contract
+000095b0: 2073 697a 6573 0a20 2020 2020 2020 205f   sizes.        _
+000095c0: 616d 6f75 6e74 203d 2073 656c 662e 5f63  amount = self._c
+000095d0: 6f6e 7472 6163 7473 5f74 6f5f 616d 6f75  ontracts_to_amou
+000095e0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+000095f0: 7061 6972 2c20 7365 6c66 2e61 6d6f 756e  pair, self.amoun
+00009600: 745f 746f 5f70 7265 6369 7369 6f6e 2870  t_to_precision(p
+00009610: 6169 722c 2073 656c 662e 5f61 6d6f 756e  air, self._amoun
+00009620: 745f 746f 5f63 6f6e 7472 6163 7473 2870  t_to_contracts(p
+00009630: 6169 722c 2061 6d6f 756e 7429 2929 0a20  air, amount))). 
+00009640: 2020 2020 2020 2064 7279 5f6f 7264 6572         dry_order
+00009650: 3a20 4469 6374 5b73 7472 2c20 416e 795d  : Dict[str, Any]
+00009660: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+00009670: 2027 6964 273a 206f 7264 6572 5f69 642c   'id': order_id,
+00009680: 0a20 2020 2020 2020 2020 2020 2027 7379  .            'sy
+00009690: 6d62 6f6c 273a 2070 6169 722c 0a20 2020  mbol': pair,.   
+000096a0: 2020 2020 2020 2020 2027 7072 6963 6527           'price'
+000096b0: 3a20 7261 7465 2c0a 2020 2020 2020 2020  : rate,.        
+000096c0: 2020 2020 2761 7665 7261 6765 273a 2072      'average': r
+000096d0: 6174 652c 0a20 2020 2020 2020 2020 2020  ate,.           
+000096e0: 2027 616d 6f75 6e74 273a 205f 616d 6f75   'amount': _amou
+000096f0: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
+00009700: 2763 6f73 7427 3a20 5f61 6d6f 756e 7420  'cost': _amount 
+00009710: 2a20 7261 7465 2c0a 2020 2020 2020 2020  * rate,.        
+00009720: 2020 2020 2774 7970 6527 3a20 6f72 6465      'type': orde
+00009730: 7274 7970 652c 0a20 2020 2020 2020 2020  rtype,.         
+00009740: 2020 2027 7369 6465 273a 2073 6964 652c     'side': side,
+00009750: 0a20 2020 2020 2020 2020 2020 2027 6669  .            'fi
+00009760: 6c6c 6564 273a 2030 2c0a 2020 2020 2020  lled': 0,.      
+00009770: 2020 2020 2020 2772 656d 6169 6e69 6e67        'remaining
+00009780: 273a 205f 616d 6f75 6e74 2c0a 2020 2020  ': _amount,.    
+00009790: 2020 2020 2020 2020 2764 6174 6574 696d          'datetim
+000097a0: 6527 3a20 6e6f 772e 7374 7266 7469 6d65  e': now.strftime
+000097b0: 2827 2559 2d25 6d2d 2564 5425 483a 254d  ('%Y-%m-%dT%H:%M
+000097c0: 3a25 532e 2566 5a27 292c 0a20 2020 2020  :%S.%fZ'),.     
+000097d0: 2020 2020 2020 2027 7469 6d65 7374 616d         'timestam
+000097e0: 7027 3a20 6474 5f74 7328 6e6f 7729 2c0a  p': dt_ts(now),.
+000097f0: 2020 2020 2020 2020 2020 2020 2773 7461              'sta
+00009800: 7475 7327 3a20 226f 7065 6e22 2c0a 2020  tus': "open",.  
+00009810: 2020 2020 2020 2020 2020 2766 6565 273a            'fee':
+00009820: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+00009830: 2020 2027 696e 666f 273a 207b 7d2c 0a20     'info': {},. 
+00009840: 2020 2020 2020 2020 2020 2027 6c65 7665             'leve
+00009850: 7261 6765 273a 206c 6576 6572 6167 650a  rage': leverage.
+00009860: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00009870: 2020 6966 2073 746f 705f 6c6f 7373 3a0a    if stop_loss:.
+00009880: 2020 2020 2020 2020 2020 2020 6472 795f              dry_
+00009890: 6f72 6465 725b 2269 6e66 6f22 5d20 3d20  order["info"] = 
+000098a0: 7b22 7374 6f70 5072 6963 6522 3a20 6472  {"stopPrice": dr
+000098b0: 795f 6f72 6465 725b 2270 7269 6365 225d  y_order["price"]
+000098c0: 7d0a 2020 2020 2020 2020 2020 2020 6472  }.            dr
+000098d0: 795f 6f72 6465 725b 7365 6c66 2e5f 6674  y_order[self._ft
+000098e0: 5f68 6173 5b27 7374 6f70 5f70 7269 6365  _has['stop_price
+000098f0: 5f70 6172 616d 275d 5d20 3d20 6472 795f  _param']] = dry_
+00009900: 6f72 6465 725b 2270 7269 6365 225d 0a20  order["price"]. 
+00009910: 2020 2020 2020 2020 2020 2023 2057 6f72             # Wor
+00009920: 6b61 726f 756e 6420 746f 2061 766f 6964  karound to avoid
+00009930: 2066 696c 6c69 6e67 2073 746f 706c 6f73   filling stoplos
+00009940: 7320 6f72 6465 7273 2069 6d6d 6564 6961  s orders immedia
+00009950: 7465 6c79 0a20 2020 2020 2020 2020 2020  tely.           
+00009960: 2064 7279 5f6f 7264 6572 5b22 6674 5f6f   dry_order["ft_o
+00009970: 7264 6572 5f74 7970 6522 5d20 3d20 2273  rder_type"] = "s
+00009980: 746f 706c 6f73 7322 0a20 2020 2020 2020  toploss".       
+00009990: 206f 7264 6572 626f 6f6b 3a20 4f70 7469   orderbook: Opti
+000099a0: 6f6e 616c 5b4f 7264 6572 426f 6f6b 5d20  onal[OrderBook] 
+000099b0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2069  = None.        i
+000099c0: 6620 7365 6c66 2e65 7863 6861 6e67 655f  f self.exchange_
+000099d0: 6861 7328 2766 6574 6368 4c32 4f72 6465  has('fetchL2Orde
+000099e0: 7242 6f6f 6b27 293a 0a20 2020 2020 2020  rBook'):.       
+000099f0: 2020 2020 206f 7264 6572 626f 6f6b 203d       orderbook =
+00009a00: 2073 656c 662e 6665 7463 685f 6c32 5f6f   self.fetch_l2_o
+00009a10: 7264 6572 5f62 6f6f 6b28 7061 6972 2c20  rder_book(pair, 
+00009a20: 3230 290a 2020 2020 2020 2020 6966 206f  20).        if o
+00009a30: 7264 6572 7479 7065 203d 3d20 226c 696d  rdertype == "lim
+00009a40: 6974 2220 616e 6420 6f72 6465 7262 6f6f  it" and orderboo
+00009a50: 6b3a 0a20 2020 2020 2020 2020 2020 2023  k:.            #
+00009a60: 2041 6c6c 6f77 2061 2033 2520 7072 6963   Allow a 3% pric
+00009a70: 6520 6469 6666 6572 656e 6365 0a20 2020  e difference.   
+00009a80: 2020 2020 2020 2020 2061 6c6c 6f77 6564           allowed
+00009a90: 5f64 6966 6620 3d20 302e 3033 0a20 2020  _diff = 0.03.   
+00009aa0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00009ab0: 2e5f 6472 795f 6973 5f70 7269 6365 5f63  ._dry_is_price_c
+00009ac0: 726f 7373 6564 2870 6169 722c 2073 6964  rossed(pair, sid
+00009ad0: 652c 2072 6174 652c 206f 7264 6572 626f  e, rate, orderbo
+00009ae0: 6f6b 2c20 616c 6c6f 7765 645f 6469 6666  ok, allowed_diff
+00009af0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00009b00: 2020 206c 6f67 6765 722e 696e 666f 280a     logger.info(.
+00009b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009b20: 2020 2020 6622 436f 6e76 6572 7465 6420      f"Converted 
+00009b30: 6f72 6465 7220 7b70 6169 727d 2074 6f20  order {pair} to 
+00009b40: 6d61 726b 6574 206f 7264 6572 2064 7565  market order due
+00009b50: 2074 6f20 7072 6963 6520 7b72 6174 657d   to price {rate}
+00009b60: 2063 726f 7373 696e 6720 7370 7265 6164   crossing spread
+00009b70: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00009b80: 2020 2020 2020 2066 2262 7920 6d6f 7265         f"by more
+00009b90: 2074 6861 6e20 7b61 6c6c 6f77 6564 5f64   than {allowed_d
+00009ba0: 6966 663a 2e32 257d 2e22 290a 2020 2020  iff:.2%}.").    
+00009bb0: 2020 2020 2020 2020 2020 2020 6472 795f              dry_
+00009bc0: 6f72 6465 725b 2274 7970 6522 5d20 3d20  order["type"] = 
+00009bd0: 226d 6172 6b65 7422 0a0a 2020 2020 2020  "market"..      
+00009be0: 2020 6966 2064 7279 5f6f 7264 6572 5b22    if dry_order["
+00009bf0: 7479 7065 225d 203d 3d20 226d 6172 6b65  type"] == "marke
+00009c00: 7422 2061 6e64 206e 6f74 2064 7279 5f6f  t" and not dry_o
+00009c10: 7264 6572 2e67 6574 2822 6674 5f6f 7264  rder.get("ft_ord
+00009c20: 6572 5f74 7970 6522 293a 0a20 2020 2020  er_type"):.     
+00009c30: 2020 2020 2020 2023 2055 7064 6174 6520         # Update 
+00009c40: 6d61 726b 6574 206f 7264 6572 2070 7269  market order pri
+00009c50: 6369 6e67 0a20 2020 2020 2020 2020 2020  cing.           
+00009c60: 2061 7665 7261 6765 203d 2073 656c 662e   average = self.
+00009c70: 6765 745f 6472 795f 6d61 726b 6574 5f66  get_dry_market_f
+00009c80: 696c 6c5f 7072 6963 6528 7061 6972 2c20  ill_price(pair, 
+00009c90: 7369 6465 2c20 616d 6f75 6e74 2c20 7261  side, amount, ra
+00009ca0: 7465 2c20 6f72 6465 7262 6f6f 6b29 0a20  te, orderbook). 
+00009cb0: 2020 2020 2020 2020 2020 2064 7279 5f6f             dry_o
+00009cc0: 7264 6572 2e75 7064 6174 6528 7b0a 2020  rder.update({.  
+00009cd0: 2020 2020 2020 2020 2020 2020 2020 2761                'a
+00009ce0: 7665 7261 6765 273a 2061 7665 7261 6765  verage': average
+00009cf0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00009d00: 2020 2766 696c 6c65 6427 3a20 5f61 6d6f    'filled': _amo
+00009d10: 756e 742c 0a20 2020 2020 2020 2020 2020  unt,.           
+00009d20: 2020 2020 2027 7265 6d61 696e 696e 6727       'remaining'
+00009d30: 3a20 302e 302c 0a20 2020 2020 2020 2020  : 0.0,.         
+00009d40: 2020 2020 2020 2027 7374 6174 7573 273a         'status':
+00009d50: 2022 636c 6f73 6564 222c 0a20 2020 2020   "closed",.     
+00009d60: 2020 2020 2020 2020 2020 2027 636f 7374             'cost
+00009d70: 273a 2028 6472 795f 6f72 6465 725b 2761  ': (dry_order['a
+00009d80: 6d6f 756e 7427 5d20 2a20 6176 6572 6167  mount'] * averag
+00009d90: 6529 0a20 2020 2020 2020 2020 2020 207d  e).            }
+00009da0: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
+00009db0: 6d61 726b 6574 206f 7264 6572 7320 7769  market orders wi
+00009dc0: 6c6c 2061 6c77 6179 7320 696e 6375 7272  ll always incurr
+00009dd0: 2074 616b 6572 2066 6565 730a 2020 2020   taker fees.    
+00009de0: 2020 2020 2020 2020 6472 795f 6f72 6465          dry_orde
+00009df0: 7220 3d20 7365 6c66 2e61 6464 5f64 7279  r = self.add_dry
+00009e00: 5f6f 7264 6572 5f66 6565 2870 6169 722c  _order_fee(pair,
+00009e10: 2064 7279 5f6f 7264 6572 2c20 2774 616b   dry_order, 'tak
+00009e20: 6572 2729 0a0a 2020 2020 2020 2020 6472  er')..        dr
+00009e30: 795f 6f72 6465 7220 3d20 7365 6c66 2e63  y_order = self.c
+00009e40: 6865 636b 5f64 7279 5f6c 696d 6974 5f6f  heck_dry_limit_o
+00009e50: 7264 6572 5f66 696c 6c65 6428 0a20 2020  rder_filled(.   
+00009e60: 2020 2020 2020 2020 2064 7279 5f6f 7264           dry_ord
+00009e70: 6572 2c20 696d 6d65 6469 6174 653d 5472  er, immediate=Tr
+00009e80: 7565 2c20 6f72 6465 7262 6f6f 6b3d 6f72  ue, orderbook=or
+00009e90: 6465 7262 6f6f 6b29 0a0a 2020 2020 2020  derbook)..      
+00009ea0: 2020 7365 6c66 2e5f 6472 795f 7275 6e5f    self._dry_run_
+00009eb0: 6f70 656e 5f6f 7264 6572 735b 6472 795f  open_orders[dry_
+00009ec0: 6f72 6465 725b 2269 6422 5d5d 203d 2064  order["id"]] = d
+00009ed0: 7279 5f6f 7264 6572 0a20 2020 2020 2020  ry_order.       
+00009ee0: 2023 2043 6f70 7920 6f72 6465 7220 616e   # Copy order an
+00009ef0: 6420 636c 6f73 6520 6974 202d 2073 6f20  d close it - so 
+00009f00: 7468 6520 7265 7475 726e 6564 206f 7264  the returned ord
+00009f10: 6572 2069 7320 6f70 656e 2075 6e6c 6573  er is open unles
+00009f20: 7320 6974 2773 2061 206d 6172 6b65 7420  s it's a market 
+00009f30: 6f72 6465 720a 2020 2020 2020 2020 7265  order.        re
+00009f40: 7475 726e 2064 7279 5f6f 7264 6572 0a0a  turn dry_order..
+00009f50: 2020 2020 6465 6620 6164 645f 6472 795f      def add_dry_
+00009f60: 6f72 6465 725f 6665 6528 0a20 2020 2020  order_fee(.     
+00009f70: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00009f80: 2070 6169 723a 2073 7472 2c0a 2020 2020   pair: str,.    
+00009f90: 2020 2020 6472 795f 6f72 6465 723a 2044      dry_order: D
+00009fa0: 6963 745b 7374 722c 2041 6e79 5d2c 0a20  ict[str, Any],. 
+00009fb0: 2020 2020 2020 2074 616b 6572 5f6f 725f         taker_or_
+00009fc0: 6d61 6b65 723a 204d 616b 6572 5461 6b65  maker: MakerTake
+00009fd0: 722c 0a20 2020 2029 202d 3e20 4469 6374  r,.    ) -> Dict
+00009fe0: 5b73 7472 2c20 416e 795d 3a0a 2020 2020  [str, Any]:.    
+00009ff0: 2020 2020 6665 6520 3d20 7365 6c66 2e67      fee = self.g
+0000a000: 6574 5f66 6565 2870 6169 722c 2074 616b  et_fee(pair, tak
+0000a010: 6572 5f6f 725f 6d61 6b65 723d 7461 6b65  er_or_maker=take
+0000a020: 725f 6f72 5f6d 616b 6572 290a 2020 2020  r_or_maker).    
+0000a030: 2020 2020 6472 795f 6f72 6465 722e 7570      dry_order.up
+0000a040: 6461 7465 287b 0a20 2020 2020 2020 2020  date({.         
+0000a050: 2020 2027 6665 6527 3a20 7b0a 2020 2020     'fee': {.    
+0000a060: 2020 2020 2020 2020 2020 2020 2763 7572              'cur
+0000a070: 7265 6e63 7927 3a20 7365 6c66 2e67 6574  rency': self.get
+0000a080: 5f70 6169 725f 7175 6f74 655f 6375 7272  _pair_quote_curr
+0000a090: 656e 6379 2870 6169 7229 2c0a 2020 2020  ency(pair),.    
+0000a0a0: 2020 2020 2020 2020 2020 2020 2763 6f73              'cos
+0000a0b0: 7427 3a20 6472 795f 6f72 6465 725b 2763  t': dry_order['c
+0000a0c0: 6f73 7427 5d20 2a20 6665 652c 0a20 2020  ost'] * fee,.   
+0000a0d0: 2020 2020 2020 2020 2020 2020 2027 7261               'ra
+0000a0e0: 7465 273a 2066 6565 0a20 2020 2020 2020  te': fee.       
+0000a0f0: 2020 2020 207d 0a20 2020 2020 2020 207d       }.        }
+0000a100: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0000a110: 2064 7279 5f6f 7264 6572 0a0a 2020 2020   dry_order..    
+0000a120: 6465 6620 6765 745f 6472 795f 6d61 726b  def get_dry_mark
+0000a130: 6574 5f66 696c 6c5f 7072 6963 6528 7365  et_fill_price(se
+0000a140: 6c66 2c20 7061 6972 3a20 7374 722c 2073  lf, pair: str, s
+0000a150: 6964 653a 2073 7472 2c20 616d 6f75 6e74  ide: str, amount
+0000a160: 3a20 666c 6f61 742c 2072 6174 653a 2066  : float, rate: f
+0000a170: 6c6f 6174 2c0a 2020 2020 2020 2020 2020  loat,.          
 0000a180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a190: 206f 7264 6572 626f 6f6b 3a20 4f70 7469   orderbook: Opti
-0000a1a0: 6f6e 616c 5b4f 7264 6572 426f 6f6b 5d29  onal[OrderBook])
-0000a1b0: 202d 3e20 666c 6f61 743a 0a20 2020 2020   -> float:.     
-0000a1c0: 2020 2022 2222 0a20 2020 2020 2020 2047     """.        G
-0000a1d0: 6574 2074 6865 206d 6172 6b65 7420 6f72  et the market or
-0000a1e0: 6465 7220 6669 6c6c 2070 7269 6365 2062  der fill price b
-0000a1f0: 6173 6564 206f 6e20 6f72 6465 7262 6f6f  ased on orderboo
-0000a200: 6b20 696e 7465 7270 6f6c 6174 696f 6e0a  k interpolation.
-0000a210: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000a220: 2020 2020 6966 2073 656c 662e 6578 6368      if self.exch
-0000a230: 616e 6765 5f68 6173 2827 6665 7463 684c  ange_has('fetchL
-0000a240: 324f 7264 6572 426f 6f6b 2729 3a0a 2020  2OrderBook'):.  
-0000a250: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-0000a260: 206f 7264 6572 626f 6f6b 3a0a 2020 2020   orderbook:.    
-0000a270: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-0000a280: 7262 6f6f 6b20 3d20 7365 6c66 2e66 6574  rbook = self.fet
-0000a290: 6368 5f6c 325f 6f72 6465 725f 626f 6f6b  ch_l2_order_book
-0000a2a0: 2870 6169 722c 2032 3029 0a20 2020 2020  (pair, 20).     
-0000a2b0: 2020 2020 2020 206f 625f 7479 7065 3a20         ob_type: 
-0000a2c0: 4f42 4c69 7465 7261 6c20 3d20 2761 736b  OBLiteral = 'ask
-0000a2d0: 7327 2069 6620 7369 6465 203d 3d20 2762  s' if side == 'b
-0000a2e0: 7579 2720 656c 7365 2027 6269 6473 270a  uy' else 'bids'.
-0000a2f0: 2020 2020 2020 2020 2020 2020 736c 6970              slip
-0000a300: 7061 6765 203d 2030 2e30 350a 2020 2020  page = 0.05.    
-0000a310: 2020 2020 2020 2020 6d61 785f 736c 6970          max_slip
-0000a320: 7061 6765 5f76 616c 203d 2072 6174 6520  page_val = rate 
-0000a330: 2a20 2828 3120 2b20 736c 6970 7061 6765  * ((1 + slippage
-0000a340: 2920 6966 2073 6964 6520 3d3d 2027 6275  ) if side == 'bu
-0000a350: 7927 2065 6c73 6520 2831 202d 2073 6c69  y' else (1 - sli
-0000a360: 7070 6167 6529 290a 0a20 2020 2020 2020  ppage))..       
-0000a370: 2020 2020 2072 656d 6169 6e69 6e67 5f61       remaining_a
-0000a380: 6d6f 756e 7420 3d20 616d 6f75 6e74 0a20  mount = amount. 
-0000a390: 2020 2020 2020 2020 2020 2066 696c 6c65             fille
-0000a3a0: 645f 616d 6f75 6e74 203d 2030 2e30 0a20  d_amount = 0.0. 
-0000a3b0: 2020 2020 2020 2020 2020 2062 6f6f 6b5f             book_
-0000a3c0: 656e 7472 795f 7072 6963 6520 3d20 302e  entry_price = 0.
-0000a3d0: 300a 2020 2020 2020 2020 2020 2020 666f  0.            fo
-0000a3e0: 7220 626f 6f6b 5f65 6e74 7279 2069 6e20  r book_entry in 
-0000a3f0: 6f72 6465 7262 6f6f 6b5b 6f62 5f74 7970  orderbook[ob_typ
-0000a400: 655d 3a0a 2020 2020 2020 2020 2020 2020  e]:.            
-0000a410: 2020 2020 626f 6f6b 5f65 6e74 7279 5f70      book_entry_p
-0000a420: 7269 6365 203d 2062 6f6f 6b5f 656e 7472  rice = book_entr
-0000a430: 795b 305d 0a20 2020 2020 2020 2020 2020  y[0].           
-0000a440: 2020 2020 2062 6f6f 6b5f 656e 7472 795f       book_entry_
-0000a450: 636f 696e 5f76 6f6c 756d 6520 3d20 626f  coin_volume = bo
-0000a460: 6f6b 5f65 6e74 7279 5b31 5d0a 2020 2020  ok_entry[1].    
-0000a470: 2020 2020 2020 2020 2020 2020 6966 2072              if r
-0000a480: 656d 6169 6e69 6e67 5f61 6d6f 756e 7420  emaining_amount 
-0000a490: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-0000a4a0: 2020 2020 2020 2020 2069 6620 7265 6d61           if rema
-0000a4b0: 696e 696e 675f 616d 6f75 6e74 203c 2062  ining_amount < b
-0000a4c0: 6f6f 6b5f 656e 7472 795f 636f 696e 5f76  ook_entry_coin_v
-0000a4d0: 6f6c 756d 653a 0a20 2020 2020 2020 2020  olume:.         
-0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000a4f0: 204f 7264 6572 626f 6f6b 2061 7420 7468   Orderbook at th
-0000a500: 6973 2073 6c6f 7420 6269 6767 6572 2074  is slot bigger t
-0000a510: 6861 6e20 7265 6d61 696e 696e 6720 616d  han remaining am
-0000a520: 6f75 6e74 0a20 2020 2020 2020 2020 2020  ount.           
-0000a530: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-0000a540: 6c65 645f 616d 6f75 6e74 202b 3d20 7265  led_amount += re
-0000a550: 6d61 696e 696e 675f 616d 6f75 6e74 202a  maining_amount *
-0000a560: 2062 6f6f 6b5f 656e 7472 795f 7072 6963   book_entry_pric
-0000a570: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000a580: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-0000a590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000a5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5c0: 2020 6669 6c6c 6564 5f61 6d6f 756e 7420    filled_amount 
-0000a5d0: 2b3d 2062 6f6f 6b5f 656e 7472 795f 636f  += book_entry_co
-0000a5e0: 696e 5f76 6f6c 756d 6520 2a20 626f 6f6b  in_volume * book
-0000a5f0: 5f65 6e74 7279 5f70 7269 6365 0a20 2020  _entry_price.   
-0000a600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a610: 2072 656d 6169 6e69 6e67 5f61 6d6f 756e   remaining_amoun
-0000a620: 7420 2d3d 2062 6f6f 6b5f 656e 7472 795f  t -= book_entry_
-0000a630: 636f 696e 5f76 6f6c 756d 650a 2020 2020  coin_volume.    
-0000a640: 2020 2020 2020 2020 2020 2020 656c 7365              else
-0000a650: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000a660: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
-0000a670: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000a680: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000a690: 4966 2072 656d 6169 6e69 6e67 5f61 6d6f  If remaining_amo
-0000a6a0: 756e 7420 7761 736e 2774 2063 6f6e 7375  unt wasn't consu
-0000a6b0: 6d65 6420 636f 6d70 6c65 7465 6c79 2028  med completely (
-0000a6c0: 6272 6561 6b20 7761 7320 6e6f 7420 6361  break was not ca
-0000a6d0: 6c6c 6564 290a 2020 2020 2020 2020 2020  lled).          
-0000a6e0: 2020 2020 2020 6669 6c6c 6564 5f61 6d6f        filled_amo
-0000a6f0: 756e 7420 2b3d 2072 656d 6169 6e69 6e67  unt += remaining
-0000a700: 5f61 6d6f 756e 7420 2a20 626f 6f6b 5f65  _amount * book_e
-0000a710: 6e74 7279 5f70 7269 6365 0a20 2020 2020  ntry_price.     
-0000a720: 2020 2020 2020 2066 6f72 6563 6173 745f         forecast_
-0000a730: 6176 675f 6669 6c6c 6564 5f70 7269 6365  avg_filled_price
-0000a740: 203d 206d 6178 2866 696c 6c65 645f 616d   = max(filled_am
-0000a750: 6f75 6e74 2c20 3029 202f 2061 6d6f 756e  ount, 0) / amoun
-0000a760: 740a 2020 2020 2020 2020 2020 2020 2320  t.            # 
-0000a770: 4c69 6d69 7420 6d61 782e 2073 6c69 7070  Limit max. slipp
-0000a780: 6167 6520 746f 2073 7065 6369 6669 6564  age to specified
-0000a790: 2076 616c 7565 0a20 2020 2020 2020 2020   value.         
-0000a7a0: 2020 2069 6620 7369 6465 203d 3d20 2762     if side == 'b
-0000a7b0: 7579 273a 0a20 2020 2020 2020 2020 2020  uy':.           
-0000a7c0: 2020 2020 2066 6f72 6563 6173 745f 6176       forecast_av
-0000a7d0: 675f 6669 6c6c 6564 5f70 7269 6365 203d  g_filled_price =
-0000a7e0: 206d 696e 2866 6f72 6563 6173 745f 6176   min(forecast_av
-0000a7f0: 675f 6669 6c6c 6564 5f70 7269 6365 2c20  g_filled_price, 
-0000a800: 6d61 785f 736c 6970 7061 6765 5f76 616c  max_slippage_val
-0000a810: 290a 0a20 2020 2020 2020 2020 2020 2065  )..            e
-0000a820: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000a830: 2020 2020 2066 6f72 6563 6173 745f 6176       forecast_av
-0000a840: 675f 6669 6c6c 6564 5f70 7269 6365 203d  g_filled_price =
-0000a850: 206d 6178 2866 6f72 6563 6173 745f 6176   max(forecast_av
-0000a860: 675f 6669 6c6c 6564 5f70 7269 6365 2c20  g_filled_price, 
-0000a870: 6d61 785f 736c 6970 7061 6765 5f76 616c  max_slippage_val
-0000a880: 290a 0a20 2020 2020 2020 2020 2020 2072  )..            r
-0000a890: 6574 7572 6e20 7365 6c66 2e70 7269 6365  eturn self.price
-0000a8a0: 5f74 6f5f 7072 6563 6973 696f 6e28 7061  _to_precision(pa
-0000a8b0: 6972 2c20 666f 7265 6361 7374 5f61 7667  ir, forecast_avg
-0000a8c0: 5f66 696c 6c65 645f 7072 6963 6529 0a0a  _filled_price)..
-0000a8d0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-0000a8e0: 6174 650a 0a20 2020 2064 6566 205f 6472  ate..    def _dr
-0000a8f0: 795f 6973 5f70 7269 6365 5f63 726f 7373  y_is_price_cross
-0000a900: 6564 2873 656c 662c 2070 6169 723a 2073  ed(self, pair: s
-0000a910: 7472 2c20 7369 6465 3a20 7374 722c 206c  tr, side: str, l
-0000a920: 696d 6974 3a20 666c 6f61 742c 0a20 2020  imit: float,.   
-0000a930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a940: 2020 2020 2020 2020 2020 206f 7264 6572             order
-0000a950: 626f 6f6b 3a20 4f70 7469 6f6e 616c 5b4f  book: Optional[O
-0000a960: 7264 6572 426f 6f6b 5d20 3d20 4e6f 6e65  rderBook] = None
-0000a970: 2c20 6f66 6673 6574 3a20 666c 6f61 7420  , offset: float 
-0000a980: 3d20 302e 3029 202d 3e20 626f 6f6c 3a0a  = 0.0) -> bool:.
-0000a990: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-0000a9a0: 656c 662e 6578 6368 616e 6765 5f68 6173  elf.exchange_has
-0000a9b0: 2827 6665 7463 684c 324f 7264 6572 426f  ('fetchL2OrderBo
-0000a9c0: 6f6b 2729 3a0a 2020 2020 2020 2020 2020  ok'):.          
-0000a9d0: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
-0000a9e0: 2020 2020 2020 6966 206e 6f74 206f 7264        if not ord
-0000a9f0: 6572 626f 6f6b 3a0a 2020 2020 2020 2020  erbook:.        
-0000aa00: 2020 2020 6f72 6465 7262 6f6f 6b20 3d20      orderbook = 
-0000aa10: 7365 6c66 2e66 6574 6368 5f6c 325f 6f72  self.fetch_l2_or
-0000aa20: 6465 725f 626f 6f6b 2870 6169 722c 2031  der_book(pair, 1
-0000aa30: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
-0000aa40: 2020 2020 2020 2020 2020 2069 6620 7369             if si
-0000aa50: 6465 203d 3d20 2762 7579 273a 0a20 2020  de == 'buy':.   
-0000aa60: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-0000aa70: 6365 203d 206f 7264 6572 626f 6f6b 5b27  ce = orderbook['
-0000aa80: 6173 6b73 275d 5b30 5d5b 305d 0a20 2020  asks'][0][0].   
-0000aa90: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000aaa0: 6c69 6d69 7420 2a20 2831 202d 206f 6666  limit * (1 - off
-0000aab0: 7365 7429 203e 3d20 7072 6963 653a 0a20  set) >= price:. 
-0000aac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aad0: 2020 2072 6574 7572 6e20 5472 7565 0a20     return True. 
-0000aae0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000aaf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ab00: 2070 7269 6365 203d 206f 7264 6572 626f   price = orderbo
-0000ab10: 6f6b 5b27 6269 6473 275d 5b30 5d5b 305d  ok['bids'][0][0]
-0000ab20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ab30: 2069 6620 6c69 6d69 7420 2a20 2831 202b   if limit * (1 +
-0000ab40: 206f 6666 7365 7429 203c 3d20 7072 6963   offset) <= pric
-0000ab50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000ab60: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-0000ab70: 7565 0a20 2020 2020 2020 2065 7863 6570  ue.        excep
-0000ab80: 7420 496e 6465 7845 7272 6f72 3a0a 2020  t IndexError:.  
-0000ab90: 2020 2020 2020 2020 2020 2320 4967 6e6f            # Igno
-0000aba0: 7265 2065 6d70 7479 206f 7264 6572 626f  re empty orderbo
-0000abb0: 6f6b 7320 7768 656e 2066 696c 6c69 6e67  oks when filling
-0000abc0: 202d 2063 616e 2062 6520 6669 6c6c 6564   - can be filled
-0000abd0: 2077 6974 6820 7468 6520 6e65 7874 2069   with the next i
-0000abe0: 7465 7261 7469 6f6e 2e0a 2020 2020 2020  teration..      
-0000abf0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
-0000ac00: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0000ac10: 0a20 2020 2064 6566 2063 6865 636b 5f64  .    def check_d
-0000ac20: 7279 5f6c 696d 6974 5f6f 7264 6572 5f66  ry_limit_order_f
-0000ac30: 696c 6c65 6428 0a20 2020 2020 2020 2020  illed(.         
-0000ac40: 2020 2073 656c 662c 206f 7264 6572 3a20     self, order: 
-0000ac50: 4469 6374 5b73 7472 2c20 416e 795d 2c20  Dict[str, Any], 
-0000ac60: 696d 6d65 6469 6174 653a 2062 6f6f 6c20  immediate: bool 
-0000ac70: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-0000ac80: 2020 2020 206f 7264 6572 626f 6f6b 3a20       orderbook: 
-0000ac90: 4f70 7469 6f6e 616c 5b4f 7264 6572 426f  Optional[OrderBo
-0000aca0: 6f6b 5d20 3d20 4e6f 6e65 2920 2d3e 2044  ok] = None) -> D
-0000acb0: 6963 745b 7374 722c 2041 6e79 5d3a 0a20  ict[str, Any]:. 
-0000acc0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000acd0: 2020 2043 6865 636b 2064 7279 2d72 756e     Check dry-run
-0000ace0: 206c 696d 6974 206f 7264 6572 2066 696c   limit order fil
-0000acf0: 6c20 616e 6420 7570 6461 7465 2066 6565  l and update fee
-0000ad00: 2028 6966 2069 7420 6669 6c6c 6564 292e   (if it filled).
-0000ad10: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000ad20: 2020 2020 2069 6620 286f 7264 6572 5b27       if (order['
-0000ad30: 7374 6174 7573 275d 2021 3d20 2263 6c6f  status'] != "clo
-0000ad40: 7365 6422 0a20 2020 2020 2020 2020 2020  sed".           
-0000ad50: 2020 2020 2061 6e64 206f 7264 6572 5b27       and order['
-0000ad60: 7479 7065 275d 2069 6e20 5b22 6c69 6d69  type'] in ["limi
-0000ad70: 7422 5d0a 2020 2020 2020 2020 2020 2020  t"].            
-0000ad80: 2020 2020 616e 6420 6e6f 7420 6f72 6465      and not orde
-0000ad90: 722e 6765 7428 2766 745f 6f72 6465 725f  r.get('ft_order_
-0000ada0: 7479 7065 2729 293a 0a20 2020 2020 2020  type')):.       
-0000adb0: 2020 2020 2070 6169 7220 3d20 6f72 6465       pair = orde
-0000adc0: 725b 2773 796d 626f 6c27 5d0a 2020 2020  r['symbol'].    
-0000add0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000ade0: 5f64 7279 5f69 735f 7072 6963 655f 6372  _dry_is_price_cr
-0000adf0: 6f73 7365 6428 7061 6972 2c20 6f72 6465  ossed(pair, orde
-0000ae00: 725b 2773 6964 6527 5d2c 206f 7264 6572  r['side'], order
-0000ae10: 5b27 7072 6963 6527 5d2c 206f 7264 6572  ['price'], order
-0000ae20: 626f 6f6b 293a 0a20 2020 2020 2020 2020  book):.         
-0000ae30: 2020 2020 2020 206f 7264 6572 2e75 7064         order.upd
-0000ae40: 6174 6528 7b0a 2020 2020 2020 2020 2020  ate({.          
-0000ae50: 2020 2020 2020 2020 2020 2773 7461 7475            'statu
-0000ae60: 7327 3a20 2763 6c6f 7365 6427 2c0a 2020  s': 'closed',.  
-0000ae70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae80: 2020 2766 696c 6c65 6427 3a20 6f72 6465    'filled': orde
-0000ae90: 725b 2761 6d6f 756e 7427 5d2c 0a20 2020  r['amount'],.   
-0000aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000aeb0: 2027 7265 6d61 696e 696e 6727 3a20 302c   'remaining': 0,
-0000aec0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000aed0: 207d 290a 0a20 2020 2020 2020 2020 2020   })..           
-0000aee0: 2020 2020 2073 656c 662e 6164 645f 6472       self.add_dr
-0000aef0: 795f 6f72 6465 725f 6665 6528 0a20 2020  y_order_fee(.   
-0000af00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000af10: 2070 6169 722c 0a20 2020 2020 2020 2020   pair,.         
-0000af20: 2020 2020 2020 2020 2020 206f 7264 6572             order
-0000af30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000af40: 2020 2020 2020 2774 616b 6572 2720 6966        'taker' if
-0000af50: 2069 6d6d 6564 6961 7465 2065 6c73 6520   immediate else 
-0000af60: 276d 616b 6572 272c 0a20 2020 2020 2020  'maker',.       
-0000af70: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0000af80: 2020 2020 7265 7475 726e 206f 7264 6572      return order
-0000af90: 0a0a 2020 2020 6465 6620 6665 7463 685f  ..    def fetch_
-0000afa0: 6472 795f 7275 6e5f 6f72 6465 7228 7365  dry_run_order(se
-0000afb0: 6c66 2c20 6f72 6465 725f 6964 2920 2d3e  lf, order_id) ->
-0000afc0: 2044 6963 745b 7374 722c 2041 6e79 5d3a   Dict[str, Any]:
-0000afd0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000afe0: 2020 2020 2052 6574 7572 6e20 6472 792d       Return dry-
-0000aff0: 7275 6e20 6f72 6465 720a 2020 2020 2020  run order.      
-0000b000: 2020 4f6e 6c79 2063 616c 6c20 6966 2072    Only call if r
-0000b010: 756e 6e69 6e67 2069 6e20 6472 792d 7275  unning in dry-ru
-0000b020: 6e20 6d6f 6465 2e0a 2020 2020 2020 2020  n mode..        
-0000b030: 2222 220a 2020 2020 2020 2020 7472 793a  """.        try:
-0000b040: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
-0000b050: 6572 203d 2073 656c 662e 5f64 7279 5f72  er = self._dry_r
-0000b060: 756e 5f6f 7065 6e5f 6f72 6465 7273 5b6f  un_open_orders[o
-0000b070: 7264 6572 5f69 645d 0a20 2020 2020 2020  rder_id].       
-0000b080: 2020 2020 206f 7264 6572 203d 2073 656c       order = sel
-0000b090: 662e 6368 6563 6b5f 6472 795f 6c69 6d69  f.check_dry_limi
-0000b0a0: 745f 6f72 6465 725f 6669 6c6c 6564 286f  t_order_filled(o
-0000b0b0: 7264 6572 290a 2020 2020 2020 2020 2020  rder).          
-0000b0c0: 2020 7265 7475 726e 206f 7264 6572 0a20    return order. 
-0000b0d0: 2020 2020 2020 2065 7863 6570 7420 4b65         except Ke
-0000b0e0: 7945 7272 6f72 2061 7320 653a 0a20 2020  yError as e:.   
-0000b0f0: 2020 2020 2020 2020 2066 726f 6d20 6672           from fr
-0000b100: 6571 7472 6164 652e 7065 7273 6973 7465  eqtrade.persiste
-0000b110: 6e63 6520 696d 706f 7274 204f 7264 6572  nce import Order
-0000b120: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
-0000b130: 6572 203d 204f 7264 6572 2e6f 7264 6572  er = Order.order
-0000b140: 5f62 795f 6964 286f 7264 6572 5f69 6429  _by_id(order_id)
-0000b150: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000b160: 6f72 6465 723a 0a20 2020 2020 2020 2020  order:.         
-0000b170: 2020 2020 2020 2063 6378 745f 6f72 6465         ccxt_orde
-0000b180: 7220 3d20 6f72 6465 722e 746f 5f63 6378  r = order.to_ccx
-0000b190: 745f 6f62 6a65 6374 2873 656c 662e 5f66  t_object(self._f
-0000b1a0: 745f 6861 735b 2773 746f 705f 7072 6963  t_has['stop_pric
-0000b1b0: 655f 7061 7261 6d27 5d29 0a20 2020 2020  e_param']).     
-0000b1c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000b1d0: 5f64 7279 5f72 756e 5f6f 7065 6e5f 6f72  _dry_run_open_or
-0000b1e0: 6465 7273 5b6f 7264 6572 5f69 645d 203d  ders[order_id] =
-0000b1f0: 2063 6378 745f 6f72 6465 720a 2020 2020   ccxt_order.    
-0000b200: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000b210: 726e 2063 6378 745f 6f72 6465 720a 2020  rn ccxt_order.  
-0000b220: 2020 2020 2020 2020 2020 2320 4772 6163            # Grac
-0000b230: 6566 756c 6c79 2068 616e 646c 6520 6572  efully handle er
-0000b240: 726f 7273 2077 6974 6820 6472 792d 7275  rors with dry-ru
-0000b250: 6e20 6f72 6465 7273 2e0a 2020 2020 2020  n orders..      
-0000b260: 2020 2020 2020 7261 6973 6520 496e 7661        raise Inva
-0000b270: 6c69 644f 7264 6572 4578 6365 7074 696f  lidOrderExceptio
-0000b280: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-0000b290: 2020 2066 2754 7269 6564 2074 6f20 6765     f'Tried to ge
-0000b2a0: 7420 616e 2069 6e76 616c 6964 2064 7279  t an invalid dry
-0000b2b0: 2d72 756e 2d6f 7264 6572 2028 6964 3a20  -run-order (id: 
-0000b2c0: 7b6f 7264 6572 5f69 647d 292e 204d 6573  {order_id}). Mes
-0000b2d0: 7361 6765 3a20 7b65 7d27 2920 6672 6f6d  sage: {e}') from
-0000b2e0: 2065 0a0a 2020 2020 2320 4f72 6465 7220   e..    # Order 
-0000b2f0: 6861 6e64 6c69 6e67 0a0a 2020 2020 6465  handling..    de
-0000b300: 6620 5f6c 6576 5f70 7265 7028 7365 6c66  f _lev_prep(self
-0000b310: 2c20 7061 6972 3a20 7374 722c 206c 6576  , pair: str, lev
-0000b320: 6572 6167 653a 2066 6c6f 6174 2c20 7369  erage: float, si
-0000b330: 6465 3a20 4275 7953 656c 6c2c 2061 6363  de: BuySell, acc
-0000b340: 6570 745f 6661 696c 3a20 626f 6f6c 203d  ept_fail: bool =
-0000b350: 2046 616c 7365 293a 0a20 2020 2020 2020   False):.       
-0000b360: 2069 6620 7365 6c66 2e74 7261 6469 6e67   if self.trading
-0000b370: 5f6d 6f64 6520 213d 2054 7261 6469 6e67  _mode != Trading
-0000b380: 4d6f 6465 2e53 504f 543a 0a20 2020 2020  Mode.SPOT:.     
-0000b390: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
-0000b3a0: 6d61 7267 696e 5f6d 6f64 6528 7061 6972  margin_mode(pair
-0000b3b0: 2c20 7365 6c66 2e6d 6172 6769 6e5f 6d6f  , self.margin_mo
-0000b3c0: 6465 2c20 6163 6365 7074 5f66 6169 6c29  de, accept_fail)
-0000b3d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000b3e0: 662e 5f73 6574 5f6c 6576 6572 6167 6528  f._set_leverage(
-0000b3f0: 6c65 7665 7261 6765 2c20 7061 6972 2c20  leverage, pair, 
-0000b400: 6163 6365 7074 5f66 6169 6c29 0a0a 2020  accept_fail)..  
-0000b410: 2020 6465 6620 5f67 6574 5f70 6172 616d    def _get_param
-0000b420: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
-0000b430: 0a20 2020 2020 2020 2073 6964 653a 2042  .        side: B
-0000b440: 7579 5365 6c6c 2c0a 2020 2020 2020 2020  uySell,.        
-0000b450: 6f72 6465 7274 7970 653a 2073 7472 2c0a  ordertype: str,.
-0000b460: 2020 2020 2020 2020 6c65 7665 7261 6765          leverage
-0000b470: 3a20 666c 6f61 742c 0a20 2020 2020 2020  : float,.       
-0000b480: 2072 6564 7563 654f 6e6c 793a 2062 6f6f   reduceOnly: boo
-0000b490: 6c2c 0a20 2020 2020 2020 2074 696d 655f  l,.        time_
-0000b4a0: 696e 5f66 6f72 6365 3a20 7374 7220 3d20  in_force: str = 
-0000b4b0: 2747 5443 272c 0a20 2020 2029 202d 3e20  'GTC',.    ) -> 
-0000b4c0: 4469 6374 3a0a 2020 2020 2020 2020 7061  Dict:.        pa
-0000b4d0: 7261 6d73 203d 2073 656c 662e 5f70 6172  rams = self._par
-0000b4e0: 616d 732e 636f 7079 2829 0a20 2020 2020  ams.copy().     
-0000b4f0: 2020 2069 6620 7469 6d65 5f69 6e5f 666f     if time_in_fo
-0000b500: 7263 6520 213d 2027 4754 4327 2061 6e64  rce != 'GTC' and
-0000b510: 206f 7264 6572 7479 7065 2021 3d20 276d   ordertype != 'm
-0000b520: 6172 6b65 7427 3a0a 2020 2020 2020 2020  arket':.        
-0000b530: 2020 2020 7061 7261 6d73 2e75 7064 6174      params.updat
-0000b540: 6528 7b27 7469 6d65 496e 466f 7263 6527  e({'timeInForce'
-0000b550: 3a20 7469 6d65 5f69 6e5f 666f 7263 652e  : time_in_force.
-0000b560: 7570 7065 7228 297d 290a 2020 2020 2020  upper()}).      
-0000b570: 2020 6966 2072 6564 7563 654f 6e6c 793a    if reduceOnly:
-0000b580: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-0000b590: 616d 732e 7570 6461 7465 287b 2772 6564  ams.update({'red
-0000b5a0: 7563 654f 6e6c 7927 3a20 5472 7565 7d29  uceOnly': True})
-0000b5b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000b5c0: 7061 7261 6d73 0a0a 2020 2020 6465 6620  params..    def 
-0000b5d0: 5f6f 7264 6572 5f6e 6565 6473 5f70 7269  _order_needs_pri
-0000b5e0: 6365 2873 656c 662c 206f 7264 6572 7479  ce(self, orderty
-0000b5f0: 7065 3a20 7374 7229 202d 3e20 626f 6f6c  pe: str) -> bool
-0000b600: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0000b610: 2028 0a20 2020 2020 2020 2020 2020 206f   (.            o
-0000b620: 7264 6572 7479 7065 2021 3d20 276d 6172  rdertype != 'mar
-0000b630: 6b65 7427 0a20 2020 2020 2020 2020 2020  ket'.           
-0000b640: 206f 7220 7365 6c66 2e5f 6170 692e 6f70   or self._api.op
-0000b650: 7469 6f6e 732e 6765 7428 2263 7265 6174  tions.get("creat
-0000b660: 654d 6172 6b65 7442 7579 4f72 6465 7252  eMarketBuyOrderR
-0000b670: 6571 7569 7265 7350 7269 6365 222c 2046  equiresPrice", F
-0000b680: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
-0000b690: 2020 6f72 2073 656c 662e 5f66 745f 6861    or self._ft_ha
-0000b6a0: 732e 6765 7428 276d 6172 6b65 744f 7264  s.get('marketOrd
-0000b6b0: 6572 5265 7175 6972 6573 5072 6963 6527  erRequiresPrice'
-0000b6c0: 2c20 4661 6c73 6529 0a20 2020 2020 2020  , False).       
-0000b6d0: 2029 0a0a 2020 2020 6465 6620 6372 6561   )..    def crea
-0000b6e0: 7465 5f6f 7264 6572 280a 2020 2020 2020  te_order(.      
-0000b6f0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-0000b700: 2a2c 0a20 2020 2020 2020 2070 6169 723a  *,.        pair:
-0000b710: 2073 7472 2c0a 2020 2020 2020 2020 6f72   str,.        or
-0000b720: 6465 7274 7970 653a 2073 7472 2c0a 2020  dertype: str,.  
-0000b730: 2020 2020 2020 7369 6465 3a20 4275 7953        side: BuyS
-0000b740: 656c 6c2c 0a20 2020 2020 2020 2061 6d6f  ell,.        amo
-0000b750: 756e 743a 2066 6c6f 6174 2c0a 2020 2020  unt: float,.    
-0000b760: 2020 2020 7261 7465 3a20 666c 6f61 742c      rate: float,
-0000b770: 0a20 2020 2020 2020 206c 6576 6572 6167  .        leverag
-0000b780: 653a 2066 6c6f 6174 2c0a 2020 2020 2020  e: float,.      
-0000b790: 2020 7265 6475 6365 4f6e 6c79 3a20 626f    reduceOnly: bo
-0000b7a0: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-0000b7b0: 2020 2020 7469 6d65 5f69 6e5f 666f 7263      time_in_forc
-0000b7c0: 653a 2073 7472 203d 2027 4754 4327 2c0a  e: str = 'GTC',.
-0000b7d0: 2020 2020 2920 2d3e 2044 6963 743a 0a20      ) -> Dict:. 
-0000b7e0: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-0000b7f0: 636f 6e66 6967 5b27 6472 795f 7275 6e27  config['dry_run'
-0000b800: 5d3a 0a20 2020 2020 2020 2020 2020 2064  ]:.            d
-0000b810: 7279 5f6f 7264 6572 203d 2073 656c 662e  ry_order = self.
-0000b820: 6372 6561 7465 5f64 7279 5f72 756e 5f6f  create_dry_run_o
-0000b830: 7264 6572 280a 2020 2020 2020 2020 2020  rder(.          
-0000b840: 2020 2020 2020 7061 6972 2c20 6f72 6465        pair, orde
-0000b850: 7274 7970 652c 2073 6964 652c 2061 6d6f  rtype, side, amo
-0000b860: 756e 742c 2073 656c 662e 7072 6963 655f  unt, self.price_
-0000b870: 746f 5f70 7265 6369 7369 6f6e 2870 6169  to_precision(pai
-0000b880: 722c 2072 6174 6529 2c20 6c65 7665 7261  r, rate), levera
-0000b890: 6765 290a 2020 2020 2020 2020 2020 2020  ge).            
-0000b8a0: 7265 7475 726e 2064 7279 5f6f 7264 6572  return dry_order
-0000b8b0: 0a0a 2020 2020 2020 2020 7061 7261 6d73  ..        params
-0000b8c0: 203d 2073 656c 662e 5f67 6574 5f70 6172   = self._get_par
-0000b8d0: 616d 7328 7369 6465 2c20 6f72 6465 7274  ams(side, ordert
-0000b8e0: 7970 652c 206c 6576 6572 6167 652c 2072  ype, leverage, r
-0000b8f0: 6564 7563 654f 6e6c 792c 2074 696d 655f  educeOnly, time_
-0000b900: 696e 5f66 6f72 6365 290a 0a20 2020 2020  in_force)..     
-0000b910: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000b920: 2020 2020 2320 5365 7420 7468 6520 7072      # Set the pr
-0000b930: 6563 6973 696f 6e20 666f 7220 616d 6f75  ecision for amou
-0000b940: 6e74 2061 6e64 2070 7269 6365 2872 6174  nt and price(rat
-0000b950: 6529 2061 7320 6163 6365 7074 6564 2062  e) as accepted b
-0000b960: 7920 7468 6520 6578 6368 616e 6765 0a20  y the exchange. 
-0000b970: 2020 2020 2020 2020 2020 2061 6d6f 756e             amoun
-0000b980: 7420 3d20 7365 6c66 2e61 6d6f 756e 745f  t = self.amount_
-0000b990: 746f 5f70 7265 6369 7369 6f6e 2870 6169  to_precision(pai
-0000b9a0: 722c 2073 656c 662e 5f61 6d6f 756e 745f  r, self._amount_
-0000b9b0: 746f 5f63 6f6e 7472 6163 7473 2870 6169  to_contracts(pai
-0000b9c0: 722c 2061 6d6f 756e 7429 290a 2020 2020  r, amount)).    
-0000b9d0: 2020 2020 2020 2020 6e65 6564 735f 7072          needs_pr
-0000b9e0: 6963 6520 3d20 7365 6c66 2e5f 6f72 6465  ice = self._orde
-0000b9f0: 725f 6e65 6564 735f 7072 6963 6528 6f72  r_needs_price(or
-0000ba00: 6465 7274 7970 6529 0a20 2020 2020 2020  dertype).       
-0000ba10: 2020 2020 2072 6174 655f 666f 725f 6f72       rate_for_or
-0000ba20: 6465 7220 3d20 7365 6c66 2e70 7269 6365  der = self.price
-0000ba30: 5f74 6f5f 7072 6563 6973 696f 6e28 7061  _to_precision(pa
-0000ba40: 6972 2c20 7261 7465 2920 6966 206e 6565  ir, rate) if nee
-0000ba50: 6473 5f70 7269 6365 2065 6c73 6520 4e6f  ds_price else No
-0000ba60: 6e65 0a0a 2020 2020 2020 2020 2020 2020  ne..            
-0000ba70: 6966 206e 6f74 2072 6564 7563 654f 6e6c  if not reduceOnl
-0000ba80: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-0000ba90: 2020 2073 656c 662e 5f6c 6576 5f70 7265     self._lev_pre
-0000baa0: 7028 7061 6972 2c20 6c65 7665 7261 6765  p(pair, leverage
-0000bab0: 2c20 7369 6465 290a 0a20 2020 2020 2020  , side)..       
-0000bac0: 2020 2020 206f 7264 6572 203d 2073 656c       order = sel
-0000bad0: 662e 5f61 7069 2e63 7265 6174 655f 6f72  f._api.create_or
-0000bae0: 6465 7228 0a20 2020 2020 2020 2020 2020  der(.           
-0000baf0: 2020 2020 2070 6169 722c 0a20 2020 2020       pair,.     
-0000bb00: 2020 2020 2020 2020 2020 206f 7264 6572             order
-0000bb10: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
-0000bb20: 2020 2020 2020 7369 6465 2c0a 2020 2020        side,.    
-0000bb30: 2020 2020 2020 2020 2020 2020 616d 6f75              amou
-0000bb40: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
-0000bb50: 2020 2020 7261 7465 5f66 6f72 5f6f 7264      rate_for_ord
-0000bb60: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-0000bb70: 2020 2020 7061 7261 6d73 2c0a 2020 2020      params,.    
-0000bb80: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000bb90: 2020 2020 2020 7365 6c66 2e5f 6c6f 675f        self._log_
-0000bba0: 6578 6368 616e 6765 5f72 6573 706f 6e73  exchange_respons
-0000bbb0: 6528 2763 7265 6174 655f 6f72 6465 7227  e('create_order'
-0000bbc0: 2c20 6f72 6465 7229 0a20 2020 2020 2020  , order).       
-0000bbd0: 2020 2020 206f 7264 6572 203d 2073 656c       order = sel
-0000bbe0: 662e 5f6f 7264 6572 5f63 6f6e 7472 6163  f._order_contrac
-0000bbf0: 7473 5f74 6f5f 616d 6f75 6e74 286f 7264  ts_to_amount(ord
-0000bc00: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
-0000bc10: 7265 7475 726e 206f 7264 6572 0a0a 2020  return order..  
-0000bc20: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-0000bc30: 742e 496e 7375 6666 6963 6965 6e74 4675  t.InsufficientFu
-0000bc40: 6e64 7320 6173 2065 3a0a 2020 2020 2020  nds as e:.      
-0000bc50: 2020 2020 2020 7261 6973 6520 496e 7375        raise Insu
-0000bc60: 6666 6963 6965 6e74 4675 6e64 7345 7272  fficientFundsErr
-0000bc70: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0000bc80: 2020 2020 6627 496e 7375 6666 6963 6965      f'Insufficie
-0000bc90: 6e74 2066 756e 6473 2074 6f20 6372 6561  nt funds to crea
-0000bca0: 7465 207b 6f72 6465 7274 7970 657d 207b  te {ordertype} {
-0000bcb0: 7369 6465 7d20 6f72 6465 7220 6f6e 206d  side} order on m
-0000bcc0: 6172 6b65 7420 7b70 6169 727d 2e20 270a  arket {pair}. '.
-0000bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bce0: 6627 5472 6965 6420 746f 207b 7369 6465  f'Tried to {side
-0000bcf0: 7d20 616d 6f75 6e74 207b 616d 6f75 6e74  } amount {amount
-0000bd00: 7d20 6174 2072 6174 6520 7b72 6174 657d  } at rate {rate}
-0000bd10: 2e27 0a20 2020 2020 2020 2020 2020 2020  .'.             
-0000bd20: 2020 2066 274d 6573 7361 6765 3a20 7b65     f'Message: {e
-0000bd30: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
-0000bd40: 2020 2065 7863 6570 7420 6363 7874 2e49     except ccxt.I
-0000bd50: 6e76 616c 6964 4f72 6465 7220 6173 2065  nvalidOrder as e
-0000bd60: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000bd70: 6973 6520 496e 7661 6c69 644f 7264 6572  ise InvalidOrder
-0000bd80: 4578 6365 7074 696f 6e28 0a20 2020 2020  Exception(.     
-0000bd90: 2020 2020 2020 2020 2020 2066 2743 6f75             f'Cou
-0000bda0: 6c64 206e 6f74 2063 7265 6174 6520 7b6f  ld not create {o
-0000bdb0: 7264 6572 7479 7065 7d20 7b73 6964 657d  rdertype} {side}
-0000bdc0: 206f 7264 6572 206f 6e20 6d61 726b 6574   order on market
-0000bdd0: 207b 7061 6972 7d2e 2027 0a20 2020 2020   {pair}. '.     
-0000bde0: 2020 2020 2020 2020 2020 2066 2754 7269             f'Tri
-0000bdf0: 6564 2074 6f20 7b73 6964 657d 2061 6d6f  ed to {side} amo
-0000be00: 756e 7420 7b61 6d6f 756e 747d 2061 7420  unt {amount} at 
-0000be10: 7261 7465 207b 7261 7465 7d2e 2027 0a20  rate {rate}. '. 
-0000be20: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000be30: 274d 6573 7361 6765 3a20 7b65 7d27 2920  'Message: {e}') 
-0000be40: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
-0000be50: 7863 6570 7420 6363 7874 2e44 446f 5350  xcept ccxt.DDoSP
-0000be60: 726f 7465 6374 696f 6e20 6173 2065 3a0a  rotection as e:.
-0000be70: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000be80: 6520 4444 6f73 5072 6f74 6563 7469 6f6e  e DDosProtection
-0000be90: 2865 2920 6672 6f6d 2065 0a20 2020 2020  (e) from e.     
-0000bea0: 2020 2065 7863 6570 7420 2863 6378 742e     except (ccxt.
-0000beb0: 4e65 7477 6f72 6b45 7272 6f72 2c20 6363  NetworkError, cc
-0000bec0: 7874 2e45 7863 6861 6e67 6545 7272 6f72  xt.ExchangeError
-0000bed0: 2920 6173 2065 3a0a 2020 2020 2020 2020  ) as e:.        
-0000bee0: 2020 2020 7261 6973 6520 5465 6d70 6f72      raise Tempor
-0000bef0: 6172 7945 7272 6f72 280a 2020 2020 2020  aryError(.      
-0000bf00: 2020 2020 2020 2020 2020 6627 436f 756c            f'Coul
-0000bf10: 6420 6e6f 7420 706c 6163 6520 7b73 6964  d not place {sid
-0000bf20: 657d 206f 7264 6572 2064 7565 2074 6f20  e} order due to 
-0000bf30: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
-0000bf40: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
-0000bf50: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
-0000bf60: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-0000bf70: 742e 4261 7365 4572 726f 7220 6173 2065  t.BaseError as e
-0000bf80: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000bf90: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
-0000bfa0: 7863 6570 7469 6f6e 2865 2920 6672 6f6d  xception(e) from
-0000bfb0: 2065 0a0a 2020 2020 6465 6620 7374 6f70   e..    def stop
-0000bfc0: 6c6f 7373 5f61 646a 7573 7428 7365 6c66  loss_adjust(self
-0000bfd0: 2c20 7374 6f70 5f6c 6f73 733a 2066 6c6f  , stop_loss: flo
-0000bfe0: 6174 2c20 6f72 6465 723a 2044 6963 742c  at, order: Dict,
-0000bff0: 2073 6964 653a 2073 7472 2920 2d3e 2062   side: str) -> b
-0000c000: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
-0000c010: 0a20 2020 2020 2020 2056 6572 6966 7920  .        Verify 
-0000c020: 7374 6f70 5f6c 6f73 7320 6167 6169 6e73  stop_loss agains
-0000c030: 7420 7374 6f70 6c6f 7373 2d6f 7264 6572  t stoploss-order
-0000c040: 2076 616c 7565 2028 6c69 6d69 7420 6f72   value (limit or
-0000c050: 2070 7269 6365 290a 2020 2020 2020 2020   price).        
-0000c060: 5265 7475 726e 7320 5472 7565 2069 6620  Returns True if 
-0000c070: 6164 6a75 7374 6d65 6e74 2069 7320 6e65  adjustment is ne
-0000c080: 6365 7373 6172 792e 0a20 2020 2020 2020  cessary..       
-0000c090: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-0000c0a0: 6e6f 7420 7365 6c66 2e5f 6674 5f68 6173  not self._ft_has
-0000c0b0: 2e67 6574 2827 7374 6f70 6c6f 7373 5f6f  .get('stoploss_o
-0000c0c0: 6e5f 6578 6368 616e 6765 2729 3a0a 2020  n_exchange'):.  
-0000c0d0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000c0e0: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
-0000c0f0: 7469 6f6e 2866 2273 746f 706c 6f73 7320  tion(f"stoploss 
-0000c100: 6973 206e 6f74 2069 6d70 6c65 6d65 6e74  is not implement
-0000c110: 6564 2066 6f72 207b 7365 6c66 2e6e 616d  ed for {self.nam
-0000c120: 657d 2e22 290a 2020 2020 2020 2020 7072  e}.").        pr
-0000c130: 6963 655f 7061 7261 6d20 3d20 7365 6c66  ice_param = self
-0000c140: 2e5f 6674 5f68 6173 5b27 7374 6f70 5f70  ._ft_has['stop_p
-0000c150: 7269 6365 5f70 6172 616d 275d 0a20 2020  rice_param'].   
-0000c160: 2020 2020 2072 6574 7572 6e20 280a 2020       return (.  
-0000c170: 2020 2020 2020 2020 2020 6f72 6465 722e            order.
-0000c180: 6765 7428 7072 6963 655f 7061 7261 6d2c  get(price_param,
-0000c190: 204e 6f6e 6529 2069 7320 4e6f 6e65 0a20   None) is None. 
-0000c1a0: 2020 2020 2020 2020 2020 206f 7220 2828             or ((
-0000c1b0: 7369 6465 203d 3d20 2273 656c 6c22 2061  side == "sell" a
-0000c1c0: 6e64 2073 746f 705f 6c6f 7373 203e 2066  nd stop_loss > f
-0000c1d0: 6c6f 6174 286f 7264 6572 5b70 7269 6365  loat(order[price
-0000c1e0: 5f70 6172 616d 5d29 2920 6f72 0a20 2020  _param])) or.   
-0000c1f0: 2020 2020 2020 2020 2020 2020 2028 7369               (si
-0000c200: 6465 203d 3d20 2262 7579 2220 616e 6420  de == "buy" and 
-0000c210: 7374 6f70 5f6c 6f73 7320 3c20 666c 6f61  stop_loss < floa
-0000c220: 7428 6f72 6465 725b 7072 6963 655f 7061  t(order[price_pa
-0000c230: 7261 6d5d 2929 290a 2020 2020 2020 2020  ram]))).        
-0000c240: 290a 0a20 2020 2064 6566 205f 6765 745f  )..    def _get_
-0000c250: 7374 6f70 5f6f 7264 6572 5f74 7970 6528  stop_order_type(
-0000c260: 7365 6c66 2c20 7573 6572 5f6f 7264 6572  self, user_order
-0000c270: 5f74 7970 6529 202d 3e20 5475 706c 655b  _type) -> Tuple[
-0000c280: 7374 722c 2073 7472 5d3a 0a0a 2020 2020  str, str]:..    
-0000c290: 2020 2020 6176 6169 6c61 626c 655f 6f72      available_or
-0000c2a0: 6465 725f 5479 7065 733a 2044 6963 745b  der_Types: Dict[
-0000c2b0: 7374 722c 2073 7472 5d20 3d20 7365 6c66  str, str] = self
-0000c2c0: 2e5f 6674 5f68 6173 5b22 7374 6f70 6c6f  ._ft_has["stoplo
-0000c2d0: 7373 5f6f 7264 6572 5f74 7970 6573 225d  ss_order_types"]
-0000c2e0: 0a0a 2020 2020 2020 2020 6966 2075 7365  ..        if use
-0000c2f0: 725f 6f72 6465 725f 7479 7065 2069 6e20  r_order_type in 
-0000c300: 6176 6169 6c61 626c 655f 6f72 6465 725f  available_order_
-0000c310: 5479 7065 732e 6b65 7973 2829 3a0a 2020  Types.keys():.  
-0000c320: 2020 2020 2020 2020 2020 6f72 6465 7274            ordert
-0000c330: 7970 6520 3d20 6176 6169 6c61 626c 655f  ype = available_
-0000c340: 6f72 6465 725f 5479 7065 735b 7573 6572  order_Types[user
-0000c350: 5f6f 7264 6572 5f74 7970 655d 0a20 2020  _order_type].   
-0000c360: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000c370: 2020 2020 2020 2023 204f 7468 6572 7769         # Otherwi
-0000c380: 7365 2070 6963 6b20 6f6e 6c79 206f 6e65  se pick only one
-0000c390: 2061 7661 696c 6162 6c65 0a20 2020 2020   available.     
-0000c3a0: 2020 2020 2020 206f 7264 6572 7479 7065         ordertype
-0000c3b0: 203d 206c 6973 7428 6176 6169 6c61 626c   = list(availabl
-0000c3c0: 655f 6f72 6465 725f 5479 7065 732e 7661  e_order_Types.va
-0000c3d0: 6c75 6573 2829 295b 305d 0a20 2020 2020  lues())[0].     
-0000c3e0: 2020 2020 2020 2075 7365 725f 6f72 6465         user_orde
-0000c3f0: 725f 7479 7065 203d 206c 6973 7428 6176  r_type = list(av
-0000c400: 6169 6c61 626c 655f 6f72 6465 725f 5479  ailable_order_Ty
-0000c410: 7065 732e 6b65 7973 2829 295b 305d 0a20  pes.keys())[0]. 
-0000c420: 2020 2020 2020 2072 6574 7572 6e20 6f72         return or
-0000c430: 6465 7274 7970 652c 2075 7365 725f 6f72  dertype, user_or
-0000c440: 6465 725f 7479 7065 0a0a 2020 2020 6465  der_type..    de
-0000c450: 6620 5f67 6574 5f73 746f 705f 6c69 6d69  f _get_stop_limi
-0000c460: 745f 7261 7465 2873 656c 662c 2073 746f  t_rate(self, sto
-0000c470: 705f 7072 6963 653a 2066 6c6f 6174 2c20  p_price: float, 
-0000c480: 6f72 6465 725f 7479 7065 733a 2044 6963  order_types: Dic
-0000c490: 742c 2073 6964 653a 2073 7472 2920 2d3e  t, side: str) ->
-0000c4a0: 2066 6c6f 6174 3a0a 2020 2020 2020 2020   float:.        
-0000c4b0: 2320 4c69 6d69 7420 7072 6963 6520 7468  # Limit price th
-0000c4c0: 7265 7368 6f6c 643a 2041 7320 6c69 6d69  reshold: As limi
-0000c4d0: 7420 7072 6963 6520 7368 6f75 6c64 2061  t price should a
-0000c4e0: 6c77 6179 7320 6265 2062 656c 6f77 2073  lways be below s
-0000c4f0: 746f 702d 7072 6963 650a 2020 2020 2020  top-price.      
-0000c500: 2020 6c69 6d69 745f 7072 6963 655f 7063    limit_price_pc
-0000c510: 7420 3d20 6f72 6465 725f 7479 7065 732e  t = order_types.
-0000c520: 6765 7428 2773 746f 706c 6f73 735f 6f6e  get('stoploss_on
-0000c530: 5f65 7863 6861 6e67 655f 6c69 6d69 745f  _exchange_limit_
-0000c540: 7261 7469 6f27 2c20 302e 3939 290a 2020  ratio', 0.99).  
-0000c550: 2020 2020 2020 6966 2073 6964 6520 3d3d        if side ==
-0000c560: 2022 7365 6c6c 223a 0a20 2020 2020 2020   "sell":.       
-0000c570: 2020 2020 206c 696d 6974 5f72 6174 6520       limit_rate 
-0000c580: 3d20 7374 6f70 5f70 7269 6365 202a 206c  = stop_price * l
-0000c590: 696d 6974 5f70 7269 6365 5f70 6374 0a20  imit_price_pct. 
-0000c5a0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000c5b0: 2020 2020 2020 2020 206c 696d 6974 5f72           limit_r
-0000c5c0: 6174 6520 3d20 7374 6f70 5f70 7269 6365  ate = stop_price
-0000c5d0: 202a 2028 3220 2d20 6c69 6d69 745f 7072   * (2 - limit_pr
-0000c5e0: 6963 655f 7063 7429 0a0a 2020 2020 2020  ice_pct)..      
-0000c5f0: 2020 6261 645f 7374 6f70 5f70 7269 6365    bad_stop_price
-0000c600: 203d 2028 2873 746f 705f 7072 6963 6520   = ((stop_price 
-0000c610: 3c3d 206c 696d 6974 5f72 6174 6529 2069  <= limit_rate) i
-0000c620: 6620 7369 6465 203d 3d0a 2020 2020 2020  f side ==.      
-0000c630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c640: 2020 2020 2273 656c 6c22 2065 6c73 6520      "sell" else 
-0000c650: 2873 746f 705f 7072 6963 6520 3e3d 206c  (stop_price >= l
-0000c660: 696d 6974 5f72 6174 6529 290a 2020 2020  imit_rate)).    
-0000c670: 2020 2020 2320 456e 7375 7265 2072 6174      # Ensure rat
-0000c680: 6520 6973 206c 6573 7320 7468 616e 2073  e is less than s
-0000c690: 746f 7020 7072 6963 650a 2020 2020 2020  top price.      
-0000c6a0: 2020 6966 2062 6164 5f73 746f 705f 7072    if bad_stop_pr
-0000c6b0: 6963 653a 0a20 2020 2020 2020 2020 2020  ice:.           
-0000c6c0: 2023 2054 6869 7320 6361 6e20 666f 7220   # This can for 
-0000c6d0: 6578 616d 706c 6520 6861 7070 656e 2069  example happen i
-0000c6e0: 6620 7468 6520 7374 6f70 202f 206c 6971  f the stop / liq
-0000c6f0: 7569 6461 7469 6f6e 2070 7269 6365 2069  uidation price i
-0000c700: 7320 7365 7420 746f 2030 0a20 2020 2020  s set to 0.     
-0000c710: 2020 2020 2020 2023 2057 6869 6368 2069         # Which i
-0000c720: 7320 706f 7373 6962 6c65 2069 6620 6120  s possible if a 
-0000c730: 6d61 726b 6574 2d6f 7264 6572 2063 6c6f  market-order clo
-0000c740: 7365 7320 7269 6768 7420 6177 6179 2e0a  ses right away..
-0000c750: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
-0000c760: 6520 496e 7661 6c69 644f 7264 6572 4578  e InvalidOrderEx
-0000c770: 6365 7074 696f 6e20 7769 6c6c 2062 7562  ception will bub
-0000c780: 626c 6520 7570 2074 6f20 6578 6974 5f70  ble up to exit_p
-0000c790: 6f73 6974 696f 6e73 2c20 7768 6572 6520  ositions, where 
-0000c7a0: 6974 2077 696c 6c20 6265 0a20 2020 2020  it will be.     
-0000c7b0: 2020 2020 2020 2023 2068 616e 646c 6564         # handled
-0000c7c0: 2067 7261 6365 6675 6c6c 792e 0a20 2020   gracefully..   
-0000c7d0: 2020 2020 2020 2020 2072 6169 7365 2049           raise I
-0000c7e0: 6e76 616c 6964 4f72 6465 7245 7863 6570  nvalidOrderExcep
-0000c7f0: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
-0000c800: 2020 2020 2020 2249 6e20 7374 6f70 6c6f        "In stoplo
-0000c810: 7373 206c 696d 6974 206f 7264 6572 2c20  ss limit order, 
-0000c820: 7374 6f70 2070 7269 6365 2073 686f 756c  stop price shoul
-0000c830: 6420 6265 206d 6f72 6520 7468 616e 206c  d be more than l
-0000c840: 696d 6974 2070 7269 6365 2e20 220a 2020  imit price. ".  
-0000c850: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0000c860: 5374 6f70 2070 7269 6365 3a20 7b73 746f  Stop price: {sto
-0000c870: 705f 7072 6963 657d 2c20 4c69 6d69 7420  p_price}, Limit 
-0000c880: 7072 6963 653a 207b 6c69 6d69 745f 7261  price: {limit_ra
-0000c890: 7465 7d2c 2022 0a20 2020 2020 2020 2020  te}, ".         
-0000c8a0: 2020 2020 2020 2066 224c 696d 6974 2050         f"Limit P
-0000c8b0: 7269 6365 2070 6374 3a20 7b6c 696d 6974  rice pct: {limit
-0000c8c0: 5f70 7269 6365 5f70 6374 7d22 0a20 2020  _price_pct}".   
-0000c8d0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0000c8e0: 2020 2020 2020 2072 6574 7572 6e20 6c69         return li
-0000c8f0: 6d69 745f 7261 7465 0a0a 2020 2020 6465  mit_rate..    de
-0000c900: 6620 5f67 6574 5f73 746f 705f 7061 7261  f _get_stop_para
-0000c910: 6d73 2873 656c 662c 2073 6964 653a 2042  ms(self, side: B
-0000c920: 7579 5365 6c6c 2c20 6f72 6465 7274 7970  uySell, ordertyp
-0000c930: 653a 2073 7472 2c20 7374 6f70 5f70 7269  e: str, stop_pri
-0000c940: 6365 3a20 666c 6f61 7429 202d 3e20 4469  ce: float) -> Di
-0000c950: 6374 3a0a 2020 2020 2020 2020 7061 7261  ct:.        para
-0000c960: 6d73 203d 2073 656c 662e 5f70 6172 616d  ms = self._param
-0000c970: 732e 636f 7079 2829 0a20 2020 2020 2020  s.copy().       
-0000c980: 2023 2056 6572 6966 7920 6966 2073 746f   # Verify if sto
-0000c990: 7050 7269 6365 2077 6f72 6b73 2066 6f72  pPrice works for
-0000c9a0: 2079 6f75 7220 6578 6368 616e 6765 2c20   your exchange, 
-0000c9b0: 656c 7365 2063 6f6e 6669 6775 7265 2073  else configure s
-0000c9c0: 746f 705f 7072 6963 655f 7061 7261 6d0a  top_price_param.
-0000c9d0: 2020 2020 2020 2020 7061 7261 6d73 2e75          params.u
-0000c9e0: 7064 6174 6528 7b73 656c 662e 5f66 745f  pdate({self._ft_
-0000c9f0: 6861 735b 2773 746f 705f 7072 6963 655f  has['stop_price_
-0000ca00: 7061 7261 6d27 5d3a 2073 746f 705f 7072  param']: stop_pr
-0000ca10: 6963 657d 290a 2020 2020 2020 2020 7265  ice}).        re
-0000ca20: 7475 726e 2070 6172 616d 730a 0a20 2020  turn params..   
-0000ca30: 2040 7265 7472 6965 7228 7265 7472 6965   @retrier(retrie
-0000ca40: 733d 3029 0a20 2020 2064 6566 2063 7265  s=0).    def cre
-0000ca50: 6174 655f 7374 6f70 6c6f 7373 2873 656c  ate_stoploss(sel
-0000ca60: 662c 2070 6169 723a 2073 7472 2c20 616d  f, pair: str, am
-0000ca70: 6f75 6e74 3a20 666c 6f61 742c 2073 746f  ount: float, sto
-0000ca80: 705f 7072 6963 653a 2066 6c6f 6174 2c20  p_price: float, 
-0000ca90: 6f72 6465 725f 7479 7065 733a 2044 6963  order_types: Dic
-0000caa0: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
-0000cab0: 2020 2020 2020 2020 2020 2073 6964 653a             side:
-0000cac0: 2042 7579 5365 6c6c 2c20 6c65 7665 7261   BuySell, levera
-0000cad0: 6765 3a20 666c 6f61 7429 202d 3e20 4469  ge: float) -> Di
-0000cae0: 6374 3a0a 2020 2020 2020 2020 2222 220a  ct:.        """.
-0000caf0: 2020 2020 2020 2020 6372 6561 7465 7320          creates 
-0000cb00: 6120 7374 6f70 6c6f 7373 206f 7264 6572  a stoploss order
-0000cb10: 2e0a 2020 2020 2020 2020 7265 7175 6972  ..        requir
-0000cb20: 6573 2060 5f66 745f 6861 735b 2773 746f  es `_ft_has['sto
-0000cb30: 706c 6f73 735f 6f72 6465 725f 7479 7065  ploss_order_type
-0000cb40: 7327 5d60 2074 6f20 6265 2073 6574 2061  s']` to be set a
-0000cb50: 7320 6120 6469 6374 206d 6170 7069 6e67  s a dict mapping
-0000cb60: 206c 696d 6974 2061 6e64 206d 6172 6b65   limit and marke
-0000cb70: 740a 2020 2020 2020 2020 2020 2020 746f  t.            to
-0000cb80: 2074 6865 2063 6f72 7265 7370 6f6e 6469   the correspondi
-0000cb90: 6e67 2065 7863 6861 6e67 6520 7479 7065  ng exchange type
-0000cba0: 2e0a 0a20 2020 2020 2020 2054 6865 2070  ...        The p
-0000cbb0: 7265 6369 7365 206f 7264 6572 7479 7065  recise ordertype
-0000cbc0: 2069 7320 6465 7465 726d 696e 6564 2062   is determined b
-0000cbd0: 7920 7468 6520 6f72 6465 725f 7479 7065  y the order_type
-0000cbe0: 7320 6469 6374 206f 7220 6578 6368 616e  s dict or exchan
-0000cbf0: 6765 2064 6566 6175 6c74 2e0a 0a20 2020  ge default...   
-0000cc00: 2020 2020 2054 6865 2065 7863 6570 7469       The excepti
-0000cc10: 6f6e 2062 656c 6f77 2073 686f 756c 6420  on below should 
-0000cc20: 6e65 7665 7220 7261 6973 652c 2073 696e  never raise, sin
-0000cc30: 6365 2077 6520 6469 7361 6c6c 6f77 0a20  ce we disallow. 
-0000cc40: 2020 2020 2020 2073 7461 7274 696e 6720         starting 
-0000cc50: 7468 6520 626f 7420 696e 2076 616c 6964  the bot in valid
-0000cc60: 6174 655f 6f72 6465 7274 7970 6573 2829  ate_ordertypes()
-0000cc70: 0a0a 2020 2020 2020 2020 5468 6973 206d  ..        This m
-0000cc80: 6179 2077 6f72 6b20 7769 7468 2061 206c  ay work with a l
-0000cc90: 696d 6974 6564 206e 756d 6265 7220 6f66  imited number of
-0000cca0: 206f 7468 6572 2065 7863 6861 6e67 6573   other exchanges
-0000ccb0: 2c20 6275 7420 636f 7272 6563 7420 776f  , but correct wo
-0000ccc0: 726b 696e 670a 2020 2020 2020 2020 2020  rking.          
-0000ccd0: 2020 6e65 6564 7320 746f 2062 6520 7465    needs to be te
-0000cce0: 7374 6564 2069 6e64 6976 6964 7561 6c6c  sted individuall
-0000ccf0: 792e 0a20 2020 2020 2020 2057 4152 4e49  y..        WARNI
-0000cd00: 4e47 3a20 7365 7474 696e 6720 6073 746f  NG: setting `sto
-0000cd10: 706c 6f73 735f 6f6e 5f65 7863 6861 6e67  ploss_on_exchang
-0000cd20: 6560 2074 6f20 5472 7565 2077 696c 6c20  e` to True will 
-0000cd30: 4e4f 5420 6175 746f 2d65 6e61 626c 6520  NOT auto-enable 
-0000cd40: 7374 6f70 6c6f 7373 206f 6e20 6578 6368  stoploss on exch
-0000cd50: 616e 6765 2e0a 2020 2020 2020 2020 2020  ange..          
-0000cd60: 2020 6073 746f 706c 6f73 735f 6164 6a75    `stoploss_adju
-0000cd70: 7374 6020 6d75 7374 2073 7469 6c6c 2062  st` must still b
-0000cd80: 6520 696d 706c 656d 656e 7465 6420 666f  e implemented fo
-0000cd90: 7220 7468 6973 2074 6f20 776f 726b 2e0a  r this to work..
-0000cda0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000cdb0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-0000cdc0: 5f66 745f 6861 735b 2773 746f 706c 6f73  _ft_has['stoplos
-0000cdd0: 735f 6f6e 5f65 7863 6861 6e67 6527 5d3a  s_on_exchange']:
-0000cde0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000cdf0: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
-0000ce00: 6365 7074 696f 6e28 6622 7374 6f70 6c6f  ception(f"stoplo
-0000ce10: 7373 2069 7320 6e6f 7420 696d 706c 656d  ss is not implem
-0000ce20: 656e 7465 6420 666f 7220 7b73 656c 662e  ented for {self.
-0000ce30: 6e61 6d65 7d2e 2229 0a0a 2020 2020 2020  name}.")..      
-0000ce40: 2020 7573 6572 5f6f 7264 6572 5f74 7970    user_order_typ
-0000ce50: 6520 3d20 6f72 6465 725f 7479 7065 732e  e = order_types.
-0000ce60: 6765 7428 2773 746f 706c 6f73 7327 2c20  get('stoploss', 
-0000ce70: 276d 6172 6b65 7427 290a 2020 2020 2020  'market').      
-0000ce80: 2020 6f72 6465 7274 7970 652c 2075 7365    ordertype, use
-0000ce90: 725f 6f72 6465 725f 7479 7065 203d 2073  r_order_type = s
-0000cea0: 656c 662e 5f67 6574 5f73 746f 705f 6f72  elf._get_stop_or
-0000ceb0: 6465 725f 7479 7065 2875 7365 725f 6f72  der_type(user_or
-0000cec0: 6465 725f 7479 7065 290a 2020 2020 2020  der_type).      
-0000ced0: 2020 726f 756e 645f 6d6f 6465 203d 2052    round_mode = R
-0000cee0: 4f55 4e44 5f44 4f57 4e20 6966 2073 6964  OUND_DOWN if sid
-0000cef0: 6520 3d3d 2027 6275 7927 2065 6c73 6520  e == 'buy' else 
-0000cf00: 524f 554e 445f 5550 0a20 2020 2020 2020  ROUND_UP.       
-0000cf10: 2073 746f 705f 7072 6963 655f 6e6f 726d   stop_price_norm
-0000cf20: 203d 2073 656c 662e 7072 6963 655f 746f   = self.price_to
-0000cf30: 5f70 7265 6369 7369 6f6e 2870 6169 722c  _precision(pair,
-0000cf40: 2073 746f 705f 7072 6963 652c 2072 6f75   stop_price, rou
-0000cf50: 6e64 696e 675f 6d6f 6465 3d72 6f75 6e64  nding_mode=round
-0000cf60: 5f6d 6f64 6529 0a20 2020 2020 2020 206c  _mode).        l
-0000cf70: 696d 6974 5f72 6174 6520 3d20 4e6f 6e65  imit_rate = None
-0000cf80: 0a20 2020 2020 2020 2069 6620 7573 6572  .        if user
-0000cf90: 5f6f 7264 6572 5f74 7970 6520 3d3d 2027  _order_type == '
-0000cfa0: 6c69 6d69 7427 3a0a 2020 2020 2020 2020  limit':.        
-0000cfb0: 2020 2020 6c69 6d69 745f 7261 7465 203d      limit_rate =
-0000cfc0: 2073 656c 662e 5f67 6574 5f73 746f 705f   self._get_stop_
-0000cfd0: 6c69 6d69 745f 7261 7465 2873 746f 705f  limit_rate(stop_
-0000cfe0: 7072 6963 652c 206f 7264 6572 5f74 7970  price, order_typ
-0000cff0: 6573 2c20 7369 6465 290a 2020 2020 2020  es, side).      
-0000d000: 2020 2020 2020 6c69 6d69 745f 7261 7465        limit_rate
-0000d010: 203d 2073 656c 662e 7072 6963 655f 746f   = self.price_to
-0000d020: 5f70 7265 6369 7369 6f6e 2870 6169 722c  _precision(pair,
-0000d030: 206c 696d 6974 5f72 6174 652c 2072 6f75   limit_rate, rou
-0000d040: 6e64 696e 675f 6d6f 6465 3d72 6f75 6e64  nding_mode=round
-0000d050: 5f6d 6f64 6529 0a0a 2020 2020 2020 2020  _mode)..        
-0000d060: 6966 2073 656c 662e 5f63 6f6e 6669 675b  if self._config[
-0000d070: 2764 7279 5f72 756e 275d 3a0a 2020 2020  'dry_run']:.    
-0000d080: 2020 2020 2020 2020 6472 795f 6f72 6465          dry_orde
-0000d090: 7220 3d20 7365 6c66 2e63 7265 6174 655f  r = self.create_
-0000d0a0: 6472 795f 7275 6e5f 6f72 6465 7228 0a20  dry_run_order(. 
-0000d0b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000d0c0: 6169 722c 0a20 2020 2020 2020 2020 2020  air,.           
-0000d0d0: 2020 2020 206f 7264 6572 7479 7065 2c0a       ordertype,.
-0000d0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0f0: 7369 6465 2c0a 2020 2020 2020 2020 2020  side,.          
-0000d100: 2020 2020 2020 616d 6f75 6e74 2c0a 2020        amount,.  
-0000d110: 2020 2020 2020 2020 2020 2020 2020 7374                st
-0000d120: 6f70 5f70 7269 6365 5f6e 6f72 6d2c 0a20  op_price_norm,. 
-0000d130: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000d140: 746f 705f 6c6f 7373 3d54 7275 652c 0a20  top_loss=True,. 
-0000d150: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0000d160: 6576 6572 6167 653d 6c65 7665 7261 6765  everage=leverage
-0000d170: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-0000d180: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000d190: 726e 2064 7279 5f6f 7264 6572 0a0a 2020  rn dry_order..  
-0000d1a0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000d1b0: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
-0000d1c0: 7365 6c66 2e5f 6765 745f 7374 6f70 5f70  self._get_stop_p
-0000d1d0: 6172 616d 7328 7369 6465 3d73 6964 652c  arams(side=side,
-0000d1e0: 206f 7264 6572 7479 7065 3d6f 7264 6572   ordertype=order
-0000d1f0: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
+0000a190: 2020 2020 2020 2020 6f72 6465 7262 6f6f          orderboo
+0000a1a0: 6b3a 204f 7074 696f 6e61 6c5b 4f72 6465  k: Optional[Orde
+0000a1b0: 7242 6f6f 6b5d 2920 2d3e 2066 6c6f 6174  rBook]) -> float
+0000a1c0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000a1d0: 2020 2020 2020 4765 7420 7468 6520 6d61        Get the ma
+0000a1e0: 726b 6574 206f 7264 6572 2066 696c 6c20  rket order fill 
+0000a1f0: 7072 6963 6520 6261 7365 6420 6f6e 206f  price based on o
+0000a200: 7264 6572 626f 6f6b 2069 6e74 6572 706f  rderbook interpo
+0000a210: 6c61 7469 6f6e 0a20 2020 2020 2020 2022  lation.        "
+0000a220: 2222 0a20 2020 2020 2020 2069 6620 7365  "".        if se
+0000a230: 6c66 2e65 7863 6861 6e67 655f 6861 7328  lf.exchange_has(
+0000a240: 2766 6574 6368 4c32 4f72 6465 7242 6f6f  'fetchL2OrderBoo
+0000a250: 6b27 293a 0a20 2020 2020 2020 2020 2020  k'):.           
+0000a260: 2069 6620 6e6f 7420 6f72 6465 7262 6f6f   if not orderboo
+0000a270: 6b3a 0a20 2020 2020 2020 2020 2020 2020  k:.             
+0000a280: 2020 206f 7264 6572 626f 6f6b 203d 2073     orderbook = s
+0000a290: 656c 662e 6665 7463 685f 6c32 5f6f 7264  elf.fetch_l2_ord
+0000a2a0: 6572 5f62 6f6f 6b28 7061 6972 2c20 3230  er_book(pair, 20
+0000a2b0: 290a 2020 2020 2020 2020 2020 2020 6f62  ).            ob
+0000a2c0: 5f74 7970 653a 204f 424c 6974 6572 616c  _type: OBLiteral
+0000a2d0: 203d 2027 6173 6b73 2720 6966 2073 6964   = 'asks' if sid
+0000a2e0: 6520 3d3d 2027 6275 7927 2065 6c73 6520  e == 'buy' else 
+0000a2f0: 2762 6964 7327 0a20 2020 2020 2020 2020  'bids'.         
+0000a300: 2020 2073 6c69 7070 6167 6520 3d20 302e     slippage = 0.
+0000a310: 3035 0a20 2020 2020 2020 2020 2020 206d  05.            m
+0000a320: 6178 5f73 6c69 7070 6167 655f 7661 6c20  ax_slippage_val 
+0000a330: 3d20 7261 7465 202a 2028 2831 202b 2073  = rate * ((1 + s
+0000a340: 6c69 7070 6167 6529 2069 6620 7369 6465  lippage) if side
+0000a350: 203d 3d20 2762 7579 2720 656c 7365 2028   == 'buy' else (
+0000a360: 3120 2d20 736c 6970 7061 6765 2929 0a0a  1 - slippage))..
+0000a370: 2020 2020 2020 2020 2020 2020 7265 6d61              rema
+0000a380: 696e 696e 675f 616d 6f75 6e74 203d 2061  ining_amount = a
+0000a390: 6d6f 756e 740a 2020 2020 2020 2020 2020  mount.          
+0000a3a0: 2020 6669 6c6c 6564 5f61 6d6f 756e 7420    filled_amount 
+0000a3b0: 3d20 302e 300a 2020 2020 2020 2020 2020  = 0.0.          
+0000a3c0: 2020 626f 6f6b 5f65 6e74 7279 5f70 7269    book_entry_pri
+0000a3d0: 6365 203d 2030 2e30 0a20 2020 2020 2020  ce = 0.0.       
+0000a3e0: 2020 2020 2066 6f72 2062 6f6f 6b5f 656e       for book_en
+0000a3f0: 7472 7920 696e 206f 7264 6572 626f 6f6b  try in orderbook
+0000a400: 5b6f 625f 7479 7065 5d3a 0a20 2020 2020  [ob_type]:.     
+0000a410: 2020 2020 2020 2020 2020 2062 6f6f 6b5f             book_
+0000a420: 656e 7472 795f 7072 6963 6520 3d20 626f  entry_price = bo
+0000a430: 6f6b 5f65 6e74 7279 5b30 5d0a 2020 2020  ok_entry[0].    
+0000a440: 2020 2020 2020 2020 2020 2020 626f 6f6b              book
+0000a450: 5f65 6e74 7279 5f63 6f69 6e5f 766f 6c75  _entry_coin_volu
+0000a460: 6d65 203d 2062 6f6f 6b5f 656e 7472 795b  me = book_entry[
+0000a470: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
+0000a480: 2020 2069 6620 7265 6d61 696e 696e 675f     if remaining_
+0000a490: 616d 6f75 6e74 203e 2030 3a0a 2020 2020  amount > 0:.    
+0000a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4b0: 6966 2072 656d 6169 6e69 6e67 5f61 6d6f  if remaining_amo
+0000a4c0: 756e 7420 3c20 626f 6f6b 5f65 6e74 7279  unt < book_entry
+0000a4d0: 5f63 6f69 6e5f 766f 6c75 6d65 3a0a 2020  _coin_volume:.  
+0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a4f0: 2020 2020 2020 2320 4f72 6465 7262 6f6f        # Orderboo
+0000a500: 6b20 6174 2074 6869 7320 736c 6f74 2062  k at this slot b
+0000a510: 6967 6765 7220 7468 616e 2072 656d 6169  igger than remai
+0000a520: 6e69 6e67 2061 6d6f 756e 740a 2020 2020  ning amount.    
+0000a530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a540: 2020 2020 6669 6c6c 6564 5f61 6d6f 756e      filled_amoun
+0000a550: 7420 2b3d 2072 656d 6169 6e69 6e67 5f61  t += remaining_a
+0000a560: 6d6f 756e 7420 2a20 626f 6f6b 5f65 6e74  mount * book_ent
+0000a570: 7279 5f70 7269 6365 0a20 2020 2020 2020  ry_price.       
+0000a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a590: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
+0000a5a0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000a5b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a5c0: 2020 2020 2020 2020 2066 696c 6c65 645f           filled_
+0000a5d0: 616d 6f75 6e74 202b 3d20 626f 6f6b 5f65  amount += book_e
+0000a5e0: 6e74 7279 5f63 6f69 6e5f 766f 6c75 6d65  ntry_coin_volume
+0000a5f0: 202a 2062 6f6f 6b5f 656e 7472 795f 7072   * book_entry_pr
+0000a600: 6963 650a 2020 2020 2020 2020 2020 2020  ice.            
+0000a610: 2020 2020 2020 2020 7265 6d61 696e 696e          remainin
+0000a620: 675f 616d 6f75 6e74 202d 3d20 626f 6f6b  g_amount -= book
+0000a630: 5f65 6e74 7279 5f63 6f69 6e5f 766f 6c75  _entry_coin_volu
+0000a640: 6d65 0a20 2020 2020 2020 2020 2020 2020  me.             
+0000a650: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000a660: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+0000a670: 616b 0a20 2020 2020 2020 2020 2020 2065  ak.            e
+0000a680: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000a690: 2020 2020 2023 2049 6620 7265 6d61 696e       # If remain
+0000a6a0: 696e 675f 616d 6f75 6e74 2077 6173 6e27  ing_amount wasn'
+0000a6b0: 7420 636f 6e73 756d 6564 2063 6f6d 706c  t consumed compl
+0000a6c0: 6574 656c 7920 2862 7265 616b 2077 6173  etely (break was
+0000a6d0: 206e 6f74 2063 616c 6c65 6429 0a20 2020   not called).   
+0000a6e0: 2020 2020 2020 2020 2020 2020 2066 696c               fil
+0000a6f0: 6c65 645f 616d 6f75 6e74 202b 3d20 7265  led_amount += re
+0000a700: 6d61 696e 696e 675f 616d 6f75 6e74 202a  maining_amount *
+0000a710: 2062 6f6f 6b5f 656e 7472 795f 7072 6963   book_entry_pric
+0000a720: 650a 2020 2020 2020 2020 2020 2020 666f  e.            fo
+0000a730: 7265 6361 7374 5f61 7667 5f66 696c 6c65  recast_avg_fille
+0000a740: 645f 7072 6963 6520 3d20 6d61 7828 6669  d_price = max(fi
+0000a750: 6c6c 6564 5f61 6d6f 756e 742c 2030 2920  lled_amount, 0) 
+0000a760: 2f20 616d 6f75 6e74 0a20 2020 2020 2020  / amount.       
+0000a770: 2020 2020 2023 204c 696d 6974 206d 6178       # Limit max
+0000a780: 2e20 736c 6970 7061 6765 2074 6f20 7370  . slippage to sp
+0000a790: 6563 6966 6965 6420 7661 6c75 650a 2020  ecified value.  
+0000a7a0: 2020 2020 2020 2020 2020 6966 2073 6964            if sid
+0000a7b0: 6520 3d3d 2027 6275 7927 3a0a 2020 2020  e == 'buy':.    
+0000a7c0: 2020 2020 2020 2020 2020 2020 666f 7265              fore
+0000a7d0: 6361 7374 5f61 7667 5f66 696c 6c65 645f  cast_avg_filled_
+0000a7e0: 7072 6963 6520 3d20 6d69 6e28 666f 7265  price = min(fore
+0000a7f0: 6361 7374 5f61 7667 5f66 696c 6c65 645f  cast_avg_filled_
+0000a800: 7072 6963 652c 206d 6178 5f73 6c69 7070  price, max_slipp
+0000a810: 6167 655f 7661 6c29 0a0a 2020 2020 2020  age_val)..      
+0000a820: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000a830: 2020 2020 2020 2020 2020 2020 666f 7265              fore
+0000a840: 6361 7374 5f61 7667 5f66 696c 6c65 645f  cast_avg_filled_
+0000a850: 7072 6963 6520 3d20 6d61 7828 666f 7265  price = max(fore
+0000a860: 6361 7374 5f61 7667 5f66 696c 6c65 645f  cast_avg_filled_
+0000a870: 7072 6963 652c 206d 6178 5f73 6c69 7070  price, max_slipp
+0000a880: 6167 655f 7661 6c29 0a0a 2020 2020 2020  age_val)..      
+0000a890: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000a8a0: 662e 7072 6963 655f 746f 5f70 7265 6369  f.price_to_preci
+0000a8b0: 7369 6f6e 2870 6169 722c 2066 6f72 6563  sion(pair, forec
+0000a8c0: 6173 745f 6176 675f 6669 6c6c 6564 5f70  ast_avg_filled_p
+0000a8d0: 7269 6365 290a 0a20 2020 2020 2020 2072  rice)..        r
+0000a8e0: 6574 7572 6e20 7261 7465 0a0a 2020 2020  eturn rate..    
+0000a8f0: 6465 6620 5f64 7279 5f69 735f 7072 6963  def _dry_is_pric
+0000a900: 655f 6372 6f73 7365 6428 7365 6c66 2c20  e_crossed(self, 
+0000a910: 7061 6972 3a20 7374 722c 2073 6964 653a  pair: str, side:
+0000a920: 2073 7472 2c20 6c69 6d69 743a 2066 6c6f   str, limit: flo
+0000a930: 6174 2c0a 2020 2020 2020 2020 2020 2020  at,.            
+0000a940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a950: 2020 6f72 6465 7262 6f6f 6b3a 204f 7074    orderbook: Opt
+0000a960: 696f 6e61 6c5b 4f72 6465 7242 6f6f 6b5d  ional[OrderBook]
+0000a970: 203d 204e 6f6e 652c 206f 6666 7365 743a   = None, offset:
+0000a980: 2066 6c6f 6174 203d 2030 2e30 2920 2d3e   float = 0.0) ->
+0000a990: 2062 6f6f 6c3a 0a20 2020 2020 2020 2069   bool:.        i
+0000a9a0: 6620 6e6f 7420 7365 6c66 2e65 7863 6861  f not self.excha
+0000a9b0: 6e67 655f 6861 7328 2766 6574 6368 4c32  nge_has('fetchL2
+0000a9c0: 4f72 6465 7242 6f6f 6b27 293a 0a20 2020  OrderBook'):.   
+0000a9d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000a9e0: 5472 7565 0a20 2020 2020 2020 2069 6620  True.        if 
+0000a9f0: 6e6f 7420 6f72 6465 7262 6f6f 6b3a 0a20  not orderbook:. 
+0000aa00: 2020 2020 2020 2020 2020 206f 7264 6572             order
+0000aa10: 626f 6f6b 203d 2073 656c 662e 6665 7463  book = self.fetc
+0000aa20: 685f 6c32 5f6f 7264 6572 5f62 6f6f 6b28  h_l2_order_book(
+0000aa30: 7061 6972 2c20 3129 0a20 2020 2020 2020  pair, 1).       
+0000aa40: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0000aa50: 2020 6966 2073 6964 6520 3d3d 2027 6275    if side == 'bu
+0000aa60: 7927 3a0a 2020 2020 2020 2020 2020 2020  y':.            
+0000aa70: 2020 2020 7072 6963 6520 3d20 6f72 6465      price = orde
+0000aa80: 7262 6f6f 6b5b 2761 736b 7327 5d5b 305d  rbook['asks'][0]
+0000aa90: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+0000aaa0: 2020 2020 6966 206c 696d 6974 202a 2028      if limit * (
+0000aab0: 3120 2d20 6f66 6673 6574 2920 3e3d 2070  1 - offset) >= p
+0000aac0: 7269 6365 3a0a 2020 2020 2020 2020 2020  rice:.          
+0000aad0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000aae0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
+0000aaf0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000ab00: 2020 2020 2020 2020 7072 6963 6520 3d20          price = 
+0000ab10: 6f72 6465 7262 6f6f 6b5b 2762 6964 7327  orderbook['bids'
+0000ab20: 5d5b 305d 5b30 5d0a 2020 2020 2020 2020  ][0][0].        
+0000ab30: 2020 2020 2020 2020 6966 206c 696d 6974          if limit
+0000ab40: 202a 2028 3120 2b20 6f66 6673 6574 2920   * (1 + offset) 
+0000ab50: 3c3d 2070 7269 6365 3a0a 2020 2020 2020  <= price:.      
+0000ab60: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000ab70: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
+0000ab80: 2020 6578 6365 7074 2049 6e64 6578 4572    except IndexEr
+0000ab90: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+0000aba0: 2023 2049 676e 6f72 6520 656d 7074 7920   # Ignore empty 
+0000abb0: 6f72 6465 7262 6f6f 6b73 2077 6865 6e20  orderbooks when 
+0000abc0: 6669 6c6c 696e 6720 2d20 6361 6e20 6265  filling - can be
+0000abd0: 2066 696c 6c65 6420 7769 7468 2074 6865   filled with the
+0000abe0: 206e 6578 7420 6974 6572 6174 696f 6e2e   next iteration.
+0000abf0: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
+0000ac00: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
+0000ac10: 2046 616c 7365 0a0a 2020 2020 6465 6620   False..    def 
+0000ac20: 6368 6563 6b5f 6472 795f 6c69 6d69 745f  check_dry_limit_
+0000ac30: 6f72 6465 725f 6669 6c6c 6564 280a 2020  order_filled(.  
+0000ac40: 2020 2020 2020 2020 2020 7365 6c66 2c20            self, 
+0000ac50: 6f72 6465 723a 2044 6963 745b 7374 722c  order: Dict[str,
+0000ac60: 2041 6e79 5d2c 2069 6d6d 6564 6961 7465   Any], immediate
+0000ac70: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+0000ac80: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+0000ac90: 7262 6f6f 6b3a 204f 7074 696f 6e61 6c5b  rbook: Optional[
+0000aca0: 4f72 6465 7242 6f6f 6b5d 203d 204e 6f6e  OrderBook] = Non
+0000acb0: 6529 202d 3e20 4469 6374 5b73 7472 2c20  e) -> Dict[str, 
+0000acc0: 416e 795d 3a0a 2020 2020 2020 2020 2222  Any]:.        ""
+0000acd0: 220a 2020 2020 2020 2020 4368 6563 6b20  ".        Check 
+0000ace0: 6472 792d 7275 6e20 6c69 6d69 7420 6f72  dry-run limit or
+0000acf0: 6465 7220 6669 6c6c 2061 6e64 2075 7064  der fill and upd
+0000ad00: 6174 6520 6665 6520 2869 6620 6974 2066  ate fee (if it f
+0000ad10: 696c 6c65 6429 2e0a 2020 2020 2020 2020  illed)..        
+0000ad20: 2222 220a 2020 2020 2020 2020 6966 2028  """.        if (
+0000ad30: 6f72 6465 725b 2773 7461 7475 7327 5d20  order['status'] 
+0000ad40: 213d 2022 636c 6f73 6564 220a 2020 2020  != "closed".    
+0000ad50: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0000ad60: 6f72 6465 725b 2774 7970 6527 5d20 696e  order['type'] in
+0000ad70: 205b 226c 696d 6974 225d 0a20 2020 2020   ["limit"].     
+0000ad80: 2020 2020 2020 2020 2020 2061 6e64 206e             and n
+0000ad90: 6f74 206f 7264 6572 2e67 6574 2827 6674  ot order.get('ft
+0000ada0: 5f6f 7264 6572 5f74 7970 6527 2929 3a0a  _order_type')):.
+0000adb0: 2020 2020 2020 2020 2020 2020 7061 6972              pair
+0000adc0: 203d 206f 7264 6572 5b27 7379 6d62 6f6c   = order['symbol
+0000add0: 275d 0a20 2020 2020 2020 2020 2020 2069  '].            i
+0000ade0: 6620 7365 6c66 2e5f 6472 795f 6973 5f70  f self._dry_is_p
+0000adf0: 7269 6365 5f63 726f 7373 6564 2870 6169  rice_crossed(pai
+0000ae00: 722c 206f 7264 6572 5b27 7369 6465 275d  r, order['side']
+0000ae10: 2c20 6f72 6465 725b 2770 7269 6365 275d  , order['price']
+0000ae20: 2c20 6f72 6465 7262 6f6f 6b29 3a0a 2020  , orderbook):.  
+0000ae30: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+0000ae40: 6465 722e 7570 6461 7465 287b 0a20 2020  der.update({.   
+0000ae50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ae60: 2027 7374 6174 7573 273a 2027 636c 6f73   'status': 'clos
+0000ae70: 6564 272c 0a20 2020 2020 2020 2020 2020  ed',.           
+0000ae80: 2020 2020 2020 2020 2027 6669 6c6c 6564           'filled
+0000ae90: 273a 206f 7264 6572 5b27 616d 6f75 6e74  ': order['amount
+0000aea0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
+0000aeb0: 2020 2020 2020 2020 2772 656d 6169 6e69          'remaini
+0000aec0: 6e67 273a 2030 2c0a 2020 2020 2020 2020  ng': 0,.        
+0000aed0: 2020 2020 2020 2020 7d29 0a0a 2020 2020          })..    
+0000aee0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000aef0: 2e61 6464 5f64 7279 5f6f 7264 6572 5f66  .add_dry_order_f
+0000af00: 6565 280a 2020 2020 2020 2020 2020 2020  ee(.            
+0000af10: 2020 2020 2020 2020 7061 6972 2c0a 2020          pair,.  
+0000af20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af30: 2020 6f72 6465 722c 0a20 2020 2020 2020    order,.       
+0000af40: 2020 2020 2020 2020 2020 2020 2027 7461               'ta
+0000af50: 6b65 7227 2069 6620 696d 6d65 6469 6174  ker' if immediat
+0000af60: 6520 656c 7365 2027 6d61 6b65 7227 2c0a  e else 'maker',.
+0000af70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af80: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+0000af90: 6e20 6f72 6465 720a 0a20 2020 2064 6566  n order..    def
+0000afa0: 2066 6574 6368 5f64 7279 5f72 756e 5f6f   fetch_dry_run_o
+0000afb0: 7264 6572 2873 656c 662c 206f 7264 6572  rder(self, order
+0000afc0: 5f69 6429 202d 3e20 4469 6374 5b73 7472  _id) -> Dict[str
+0000afd0: 2c20 416e 795d 3a0a 2020 2020 2020 2020  , Any]:.        
+0000afe0: 2222 220a 2020 2020 2020 2020 5265 7475  """.        Retu
+0000aff0: 726e 2064 7279 2d72 756e 206f 7264 6572  rn dry-run order
+0000b000: 0a20 2020 2020 2020 204f 6e6c 7920 6361  .        Only ca
+0000b010: 6c6c 2069 6620 7275 6e6e 696e 6720 696e  ll if running in
+0000b020: 2064 7279 2d72 756e 206d 6f64 652e 0a20   dry-run mode.. 
+0000b030: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000b040: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000b050: 2020 2020 6f72 6465 7220 3d20 7365 6c66      order = self
+0000b060: 2e5f 6472 795f 7275 6e5f 6f70 656e 5f6f  ._dry_run_open_o
+0000b070: 7264 6572 735b 6f72 6465 725f 6964 5d0a  rders[order_id].
+0000b080: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+0000b090: 7220 3d20 7365 6c66 2e63 6865 636b 5f64  r = self.check_d
+0000b0a0: 7279 5f6c 696d 6974 5f6f 7264 6572 5f66  ry_limit_order_f
+0000b0b0: 696c 6c65 6428 6f72 6465 7229 0a20 2020  illed(order).   
+0000b0c0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000b0d0: 6f72 6465 720a 2020 2020 2020 2020 6578  order.        ex
+0000b0e0: 6365 7074 204b 6579 4572 726f 7220 6173  cept KeyError as
+0000b0f0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0000b100: 6672 6f6d 2066 7265 7174 7261 6465 2e70  from freqtrade.p
+0000b110: 6572 7369 7374 656e 6365 2069 6d70 6f72  ersistence impor
+0000b120: 7420 4f72 6465 720a 2020 2020 2020 2020  t Order.        
+0000b130: 2020 2020 6f72 6465 7220 3d20 4f72 6465      order = Orde
+0000b140: 722e 6f72 6465 725f 6279 5f69 6428 6f72  r.order_by_id(or
+0000b150: 6465 725f 6964 290a 2020 2020 2020 2020  der_id).        
+0000b160: 2020 2020 6966 206f 7264 6572 3a0a 2020      if order:.  
+0000b170: 2020 2020 2020 2020 2020 2020 2020 6363                cc
+0000b180: 7874 5f6f 7264 6572 203d 206f 7264 6572  xt_order = order
+0000b190: 2e74 6f5f 6363 7874 5f6f 626a 6563 7428  .to_ccxt_object(
+0000b1a0: 7365 6c66 2e5f 6674 5f68 6173 5b27 7374  self._ft_has['st
+0000b1b0: 6f70 5f70 7269 6365 5f70 6172 616d 275d  op_price_param']
+0000b1c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000b1d0: 2020 7365 6c66 2e5f 6472 795f 7275 6e5f    self._dry_run_
+0000b1e0: 6f70 656e 5f6f 7264 6572 735b 6f72 6465  open_orders[orde
+0000b1f0: 725f 6964 5d20 3d20 6363 7874 5f6f 7264  r_id] = ccxt_ord
+0000b200: 6572 0a20 2020 2020 2020 2020 2020 2020  er.             
+0000b210: 2020 2072 6574 7572 6e20 6363 7874 5f6f     return ccxt_o
+0000b220: 7264 6572 0a20 2020 2020 2020 2020 2020  rder.           
+0000b230: 2023 2047 7261 6365 6675 6c6c 7920 6861   # Gracefully ha
+0000b240: 6e64 6c65 2065 7272 6f72 7320 7769 7468  ndle errors with
+0000b250: 2064 7279 2d72 756e 206f 7264 6572 732e   dry-run orders.
+0000b260: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000b270: 7365 2049 6e76 616c 6964 4f72 6465 7245  se InvalidOrderE
+0000b280: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
+0000b290: 2020 2020 2020 2020 2020 6627 5472 6965            f'Trie
+0000b2a0: 6420 746f 2067 6574 2061 6e20 696e 7661  d to get an inva
+0000b2b0: 6c69 6420 6472 792d 7275 6e2d 6f72 6465  lid dry-run-orde
+0000b2c0: 7220 2869 643a 207b 6f72 6465 725f 6964  r (id: {order_id
+0000b2d0: 7d29 2e20 4d65 7373 6167 653a 207b 657d  }). Message: {e}
+0000b2e0: 2729 2066 726f 6d20 650a 0a20 2020 2023  ') from e..    #
+0000b2f0: 204f 7264 6572 2068 616e 646c 696e 670a   Order handling.
+0000b300: 0a20 2020 2064 6566 205f 6c65 765f 7072  .    def _lev_pr
+0000b310: 6570 2873 656c 662c 2070 6169 723a 2073  ep(self, pair: s
+0000b320: 7472 2c20 6c65 7665 7261 6765 3a20 666c  tr, leverage: fl
+0000b330: 6f61 742c 2073 6964 653a 2042 7579 5365  oat, side: BuySe
+0000b340: 6c6c 2c20 6163 6365 7074 5f66 6169 6c3a  ll, accept_fail:
+0000b350: 2062 6f6f 6c20 3d20 4661 6c73 6529 3a0a   bool = False):.
+0000b360: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000b370: 7472 6164 696e 675f 6d6f 6465 2021 3d20  trading_mode != 
+0000b380: 5472 6164 696e 674d 6f64 652e 5350 4f54  TradingMode.SPOT
+0000b390: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0000b3a0: 6c66 2e73 6574 5f6d 6172 6769 6e5f 6d6f  lf.set_margin_mo
+0000b3b0: 6465 2870 6169 722c 2073 656c 662e 6d61  de(pair, self.ma
+0000b3c0: 7267 696e 5f6d 6f64 652c 2061 6363 6570  rgin_mode, accep
+0000b3d0: 745f 6661 696c 290a 2020 2020 2020 2020  t_fail).        
+0000b3e0: 2020 2020 7365 6c66 2e5f 7365 745f 6c65      self._set_le
+0000b3f0: 7665 7261 6765 286c 6576 6572 6167 652c  verage(leverage,
+0000b400: 2070 6169 722c 2061 6363 6570 745f 6661   pair, accept_fa
+0000b410: 696c 290a 0a20 2020 2064 6566 205f 6765  il)..    def _ge
+0000b420: 745f 7061 7261 6d73 280a 2020 2020 2020  t_params(.      
+0000b430: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+0000b440: 7369 6465 3a20 4275 7953 656c 6c2c 0a20  side: BuySell,. 
+0000b450: 2020 2020 2020 206f 7264 6572 7479 7065         ordertype
+0000b460: 3a20 7374 722c 0a20 2020 2020 2020 206c  : str,.        l
+0000b470: 6576 6572 6167 653a 2066 6c6f 6174 2c0a  everage: float,.
+0000b480: 2020 2020 2020 2020 7265 6475 6365 4f6e          reduceOn
+0000b490: 6c79 3a20 626f 6f6c 2c0a 2020 2020 2020  ly: bool,.      
+0000b4a0: 2020 7469 6d65 5f69 6e5f 666f 7263 653a    time_in_force:
+0000b4b0: 2073 7472 203d 2027 4754 4327 2c0a 2020   str = 'GTC',.  
+0000b4c0: 2020 2920 2d3e 2044 6963 743a 0a20 2020    ) -> Dict:.   
+0000b4d0: 2020 2020 2070 6172 616d 7320 3d20 7365       params = se
+0000b4e0: 6c66 2e5f 7061 7261 6d73 2e63 6f70 7928  lf._params.copy(
+0000b4f0: 290a 2020 2020 2020 2020 6966 2074 696d  ).        if tim
+0000b500: 655f 696e 5f66 6f72 6365 2021 3d20 2747  e_in_force != 'G
+0000b510: 5443 2720 616e 6420 6f72 6465 7274 7970  TC' and ordertyp
+0000b520: 6520 213d 2027 6d61 726b 6574 273a 0a20  e != 'market':. 
+0000b530: 2020 2020 2020 2020 2020 2070 6172 616d             param
+0000b540: 732e 7570 6461 7465 287b 2774 696d 6549  s.update({'timeI
+0000b550: 6e46 6f72 6365 273a 2074 696d 655f 696e  nForce': time_in
+0000b560: 5f66 6f72 6365 2e75 7070 6572 2829 7d29  _force.upper()})
+0000b570: 0a20 2020 2020 2020 2069 6620 7265 6475  .        if redu
+0000b580: 6365 4f6e 6c79 3a0a 2020 2020 2020 2020  ceOnly:.        
+0000b590: 2020 2020 7061 7261 6d73 2e75 7064 6174      params.updat
+0000b5a0: 6528 7b27 7265 6475 6365 4f6e 6c79 273a  e({'reduceOnly':
+0000b5b0: 2054 7275 657d 290a 2020 2020 2020 2020   True}).        
+0000b5c0: 7265 7475 726e 2070 6172 616d 730a 0a20  return params.. 
+0000b5d0: 2020 2064 6566 205f 6f72 6465 725f 6e65     def _order_ne
+0000b5e0: 6564 735f 7072 6963 6528 7365 6c66 2c20  eds_price(self, 
+0000b5f0: 6f72 6465 7274 7970 653a 2073 7472 2920  ordertype: str) 
+0000b600: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
+0000b610: 2072 6574 7572 6e20 280a 2020 2020 2020   return (.      
+0000b620: 2020 2020 2020 6f72 6465 7274 7970 6520        ordertype 
+0000b630: 213d 2027 6d61 726b 6574 270a 2020 2020  != 'market'.    
+0000b640: 2020 2020 2020 2020 6f72 2073 656c 662e          or self.
+0000b650: 5f61 7069 2e6f 7074 696f 6e73 2e67 6574  _api.options.get
+0000b660: 2822 6372 6561 7465 4d61 726b 6574 4275  ("createMarketBu
+0000b670: 794f 7264 6572 5265 7175 6972 6573 5072  yOrderRequiresPr
+0000b680: 6963 6522 2c20 4661 6c73 6529 0a20 2020  ice", False).   
+0000b690: 2020 2020 2020 2020 206f 7220 7365 6c66           or self
+0000b6a0: 2e5f 6674 5f68 6173 2e67 6574 2827 6d61  ._ft_has.get('ma
+0000b6b0: 726b 6574 4f72 6465 7252 6571 7569 7265  rketOrderRequire
+0000b6c0: 7350 7269 6365 272c 2046 616c 7365 290a  sPrice', False).
+0000b6d0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+0000b6e0: 6566 2063 7265 6174 655f 6f72 6465 7228  ef create_order(
+0000b6f0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+0000b700: 2020 2020 2020 202a 2c0a 2020 2020 2020         *,.      
+0000b710: 2020 7061 6972 3a20 7374 722c 0a20 2020    pair: str,.   
+0000b720: 2020 2020 206f 7264 6572 7479 7065 3a20       ordertype: 
+0000b730: 7374 722c 0a20 2020 2020 2020 2073 6964  str,.        sid
+0000b740: 653a 2042 7579 5365 6c6c 2c0a 2020 2020  e: BuySell,.    
+0000b750: 2020 2020 616d 6f75 6e74 3a20 666c 6f61      amount: floa
+0000b760: 742c 0a20 2020 2020 2020 2072 6174 653a  t,.        rate:
+0000b770: 2066 6c6f 6174 2c0a 2020 2020 2020 2020   float,.        
+0000b780: 6c65 7665 7261 6765 3a20 666c 6f61 742c  leverage: float,
+0000b790: 0a20 2020 2020 2020 2072 6564 7563 654f  .        reduceO
+0000b7a0: 6e6c 793a 2062 6f6f 6c20 3d20 4661 6c73  nly: bool = Fals
+0000b7b0: 652c 0a20 2020 2020 2020 2074 696d 655f  e,.        time_
+0000b7c0: 696e 5f66 6f72 6365 3a20 7374 7220 3d20  in_force: str = 
+0000b7d0: 2747 5443 272c 0a20 2020 2029 202d 3e20  'GTC',.    ) -> 
+0000b7e0: 4469 6374 3a0a 2020 2020 2020 2020 6966  Dict:.        if
+0000b7f0: 2073 656c 662e 5f63 6f6e 6669 675b 2764   self._config['d
+0000b800: 7279 5f72 756e 275d 3a0a 2020 2020 2020  ry_run']:.      
+0000b810: 2020 2020 2020 6472 795f 6f72 6465 7220        dry_order 
+0000b820: 3d20 7365 6c66 2e63 7265 6174 655f 6472  = self.create_dr
+0000b830: 795f 7275 6e5f 6f72 6465 7228 0a20 2020  y_run_order(.   
+0000b840: 2020 2020 2020 2020 2020 2020 2070 6169               pai
+0000b850: 722c 206f 7264 6572 7479 7065 2c20 7369  r, ordertype, si
+0000b860: 6465 2c20 616d 6f75 6e74 2c20 7365 6c66  de, amount, self
+0000b870: 2e70 7269 6365 5f74 6f5f 7072 6563 6973  .price_to_precis
+0000b880: 696f 6e28 7061 6972 2c20 7261 7465 292c  ion(pair, rate),
+0000b890: 206c 6576 6572 6167 6529 0a20 2020 2020   leverage).     
+0000b8a0: 2020 2020 2020 2072 6574 7572 6e20 6472         return dr
+0000b8b0: 795f 6f72 6465 720a 0a20 2020 2020 2020  y_order..       
+0000b8c0: 2070 6172 616d 7320 3d20 7365 6c66 2e5f   params = self._
+0000b8d0: 6765 745f 7061 7261 6d73 2873 6964 652c  get_params(side,
+0000b8e0: 206f 7264 6572 7479 7065 2c20 6c65 7665   ordertype, leve
+0000b8f0: 7261 6765 2c20 7265 6475 6365 4f6e 6c79  rage, reduceOnly
+0000b900: 2c20 7469 6d65 5f69 6e5f 666f 7263 6529  , time_in_force)
+0000b910: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
+0000b920: 2020 2020 2020 2020 2020 2023 2053 6574             # Set
+0000b930: 2074 6865 2070 7265 6369 7369 6f6e 2066   the precision f
+0000b940: 6f72 2061 6d6f 756e 7420 616e 6420 7072  or amount and pr
+0000b950: 6963 6528 7261 7465 2920 6173 2061 6363  ice(rate) as acc
+0000b960: 6570 7465 6420 6279 2074 6865 2065 7863  epted by the exc
+0000b970: 6861 6e67 650a 2020 2020 2020 2020 2020  hange.          
+0000b980: 2020 616d 6f75 6e74 203d 2073 656c 662e    amount = self.
+0000b990: 616d 6f75 6e74 5f74 6f5f 7072 6563 6973  amount_to_precis
+0000b9a0: 696f 6e28 7061 6972 2c20 7365 6c66 2e5f  ion(pair, self._
+0000b9b0: 616d 6f75 6e74 5f74 6f5f 636f 6e74 7261  amount_to_contra
+0000b9c0: 6374 7328 7061 6972 2c20 616d 6f75 6e74  cts(pair, amount
+0000b9d0: 2929 0a20 2020 2020 2020 2020 2020 206e  )).            n
+0000b9e0: 6565 6473 5f70 7269 6365 203d 2073 656c  eeds_price = sel
+0000b9f0: 662e 5f6f 7264 6572 5f6e 6565 6473 5f70  f._order_needs_p
+0000ba00: 7269 6365 286f 7264 6572 7479 7065 290a  rice(ordertype).
+0000ba10: 2020 2020 2020 2020 2020 2020 7261 7465              rate
+0000ba20: 5f66 6f72 5f6f 7264 6572 203d 2073 656c  _for_order = sel
+0000ba30: 662e 7072 6963 655f 746f 5f70 7265 6369  f.price_to_preci
+0000ba40: 7369 6f6e 2870 6169 722c 2072 6174 6529  sion(pair, rate)
+0000ba50: 2069 6620 6e65 6564 735f 7072 6963 6520   if needs_price 
+0000ba60: 656c 7365 204e 6f6e 650a 0a20 2020 2020  else None..     
+0000ba70: 2020 2020 2020 2069 6620 6e6f 7420 7265         if not re
+0000ba80: 6475 6365 4f6e 6c79 3a0a 2020 2020 2020  duceOnly:.      
+0000ba90: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0000baa0: 6c65 765f 7072 6570 2870 6169 722c 206c  lev_prep(pair, l
+0000bab0: 6576 6572 6167 652c 2073 6964 6529 0a0a  everage, side)..
+0000bac0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+0000bad0: 7220 3d20 7365 6c66 2e5f 6170 692e 6372  r = self._api.cr
+0000bae0: 6561 7465 5f6f 7264 6572 280a 2020 2020  eate_order(.    
+0000baf0: 2020 2020 2020 2020 2020 2020 7061 6972              pair
+0000bb00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000bb10: 2020 6f72 6465 7274 7970 652c 0a20 2020    ordertype,.   
+0000bb20: 2020 2020 2020 2020 2020 2020 2073 6964               sid
+0000bb30: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0000bb40: 2020 2061 6d6f 756e 742c 0a20 2020 2020     amount,.     
+0000bb50: 2020 2020 2020 2020 2020 2072 6174 655f             rate_
+0000bb60: 666f 725f 6f72 6465 722c 0a20 2020 2020  for_order,.     
+0000bb70: 2020 2020 2020 2020 2020 2070 6172 616d             param
+0000bb80: 732c 0a20 2020 2020 2020 2020 2020 2029  s,.            )
+0000bb90: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000bba0: 662e 5f6c 6f67 5f65 7863 6861 6e67 655f  f._log_exchange_
+0000bbb0: 7265 7370 6f6e 7365 2827 6372 6561 7465  response('create
+0000bbc0: 5f6f 7264 6572 272c 206f 7264 6572 290a  _order', order).
+0000bbd0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+0000bbe0: 7220 3d20 7365 6c66 2e5f 6f72 6465 725f  r = self._order_
+0000bbf0: 636f 6e74 7261 6374 735f 746f 5f61 6d6f  contracts_to_amo
+0000bc00: 756e 7428 6f72 6465 7229 0a20 2020 2020  unt(order).     
+0000bc10: 2020 2020 2020 2072 6574 7572 6e20 6f72         return or
+0000bc20: 6465 720a 0a20 2020 2020 2020 2065 7863  der..        exc
+0000bc30: 6570 7420 6363 7874 2e49 6e73 7566 6669  ept ccxt.Insuffi
+0000bc40: 6369 656e 7446 756e 6473 2061 7320 653a  cientFunds as e:
+0000bc50: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000bc60: 7365 2049 6e73 7566 6669 6369 656e 7446  se InsufficientF
+0000bc70: 756e 6473 4572 726f 7228 0a20 2020 2020  undsError(.     
+0000bc80: 2020 2020 2020 2020 2020 2066 2749 6e73             f'Ins
+0000bc90: 7566 6669 6369 656e 7420 6675 6e64 7320  ufficient funds 
+0000bca0: 746f 2063 7265 6174 6520 7b6f 7264 6572  to create {order
+0000bcb0: 7479 7065 7d20 7b73 6964 657d 206f 7264  type} {side} ord
+0000bcc0: 6572 206f 6e20 6d61 726b 6574 207b 7061  er on market {pa
+0000bcd0: 6972 7d2e 2027 0a20 2020 2020 2020 2020  ir}. '.         
+0000bce0: 2020 2020 2020 2066 2754 7269 6564 2074         f'Tried t
+0000bcf0: 6f20 7b73 6964 657d 2061 6d6f 756e 7420  o {side} amount 
+0000bd00: 7b61 6d6f 756e 747d 2061 7420 7261 7465  {amount} at rate
+0000bd10: 207b 7261 7465 7d2e 270a 2020 2020 2020   {rate}.'.      
+0000bd20: 2020 2020 2020 2020 2020 6627 4d65 7373            f'Mess
+0000bd30: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
+0000bd40: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+0000bd50: 2063 6378 742e 496e 7661 6c69 644f 7264   ccxt.InvalidOrd
+0000bd60: 6572 2061 7320 653a 0a20 2020 2020 2020  er as e:.       
+0000bd70: 2020 2020 2072 6169 7365 2049 6e76 616c       raise Inval
+0000bd80: 6964 4f72 6465 7245 7863 6570 7469 6f6e  idOrderException
+0000bd90: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000bda0: 2020 6627 436f 756c 6420 6e6f 7420 6372    f'Could not cr
+0000bdb0: 6561 7465 207b 6f72 6465 7274 7970 657d  eate {ordertype}
+0000bdc0: 207b 7369 6465 7d20 6f72 6465 7220 6f6e   {side} order on
+0000bdd0: 206d 6172 6b65 7420 7b70 6169 727d 2e20   market {pair}. 
+0000bde0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0000bdf0: 2020 6627 5472 6965 6420 746f 207b 7369    f'Tried to {si
+0000be00: 6465 7d20 616d 6f75 6e74 207b 616d 6f75  de} amount {amou
+0000be10: 6e74 7d20 6174 2072 6174 6520 7b72 6174  nt} at rate {rat
+0000be20: 657d 2e20 270a 2020 2020 2020 2020 2020  e}. '.          
+0000be30: 2020 2020 2020 6627 4d65 7373 6167 653a        f'Message:
+0000be40: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
+0000be50: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
+0000be60: 742e 4444 6f53 5072 6f74 6563 7469 6f6e  t.DDoSProtection
+0000be70: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+0000be80: 2020 2072 6169 7365 2044 446f 7350 726f     raise DDosPro
+0000be90: 7465 6374 696f 6e28 6529 2066 726f 6d20  tection(e) from 
+0000bea0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+0000beb0: 2028 6363 7874 2e4e 6574 776f 726b 4572   (ccxt.NetworkEr
+0000bec0: 726f 722c 2063 6378 742e 4578 6368 616e  ror, ccxt.Exchan
+0000bed0: 6765 4572 726f 7229 2061 7320 653a 0a20  geError) as e:. 
+0000bee0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000bef0: 2054 656d 706f 7261 7279 4572 726f 7228   TemporaryError(
+0000bf00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bf10: 2066 2743 6f75 6c64 206e 6f74 2070 6c61   f'Could not pla
+0000bf20: 6365 207b 7369 6465 7d20 6f72 6465 7220  ce {side} order 
+0000bf30: 6475 6520 746f 207b 652e 5f5f 636c 6173  due to {e.__clas
+0000bf40: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d2e 204d  s__.__name__}. M
+0000bf50: 6573 7361 6765 3a20 7b65 7d27 2920 6672  essage: {e}') fr
+0000bf60: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
+0000bf70: 6570 7420 6363 7874 2e42 6173 6545 7272  ept ccxt.BaseErr
+0000bf80: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
+0000bf90: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
+0000bfa0: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
+0000bfb0: 6529 2066 726f 6d20 650a 0a20 2020 2064  e) from e..    d
+0000bfc0: 6566 2073 746f 706c 6f73 735f 6164 6a75  ef stoploss_adju
+0000bfd0: 7374 2873 656c 662c 2073 746f 705f 6c6f  st(self, stop_lo
+0000bfe0: 7373 3a20 666c 6f61 742c 206f 7264 6572  ss: float, order
+0000bff0: 3a20 4469 6374 2c20 7369 6465 3a20 7374  : Dict, side: st
+0000c000: 7229 202d 3e20 626f 6f6c 3a0a 2020 2020  r) -> bool:.    
+0000c010: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000c020: 5665 7269 6679 2073 746f 705f 6c6f 7373  Verify stop_loss
+0000c030: 2061 6761 696e 7374 2073 746f 706c 6f73   against stoplos
+0000c040: 732d 6f72 6465 7220 7661 6c75 6520 286c  s-order value (l
+0000c050: 696d 6974 206f 7220 7072 6963 6529 0a20  imit or price). 
+0000c060: 2020 2020 2020 2052 6574 7572 6e73 2054         Returns T
+0000c070: 7275 6520 6966 2061 646a 7573 746d 656e  rue if adjustmen
+0000c080: 7420 6973 206e 6563 6573 7361 7279 2e0a  t is necessary..
+0000c090: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000c0a0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+0000c0b0: 5f66 745f 6861 732e 6765 7428 2773 746f  _ft_has.get('sto
+0000c0c0: 706c 6f73 735f 6f6e 5f65 7863 6861 6e67  ploss_on_exchang
+0000c0d0: 6527 293a 0a20 2020 2020 2020 2020 2020  e'):.           
+0000c0e0: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
+0000c0f0: 616c 4578 6365 7074 696f 6e28 6622 7374  alException(f"st
+0000c100: 6f70 6c6f 7373 2069 7320 6e6f 7420 696d  oploss is not im
+0000c110: 706c 656d 656e 7465 6420 666f 7220 7b73  plemented for {s
+0000c120: 656c 662e 6e61 6d65 7d2e 2229 0a20 2020  elf.name}.").   
+0000c130: 2020 2020 2070 7269 6365 5f70 6172 616d       price_param
+0000c140: 203d 2073 656c 662e 5f66 745f 6861 735b   = self._ft_has[
+0000c150: 2773 746f 705f 7072 6963 655f 7061 7261  'stop_price_para
+0000c160: 6d27 5d0a 2020 2020 2020 2020 7265 7475  m'].        retu
+0000c170: 726e 2028 0a20 2020 2020 2020 2020 2020  rn (.           
+0000c180: 206f 7264 6572 2e67 6574 2870 7269 6365   order.get(price
+0000c190: 5f70 6172 616d 2c20 4e6f 6e65 2920 6973  _param, None) is
+0000c1a0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+0000c1b0: 2020 6f72 2028 2873 6964 6520 3d3d 2022    or ((side == "
+0000c1c0: 7365 6c6c 2220 616e 6420 7374 6f70 5f6c  sell" and stop_l
+0000c1d0: 6f73 7320 3e20 666c 6f61 7428 6f72 6465  oss > float(orde
+0000c1e0: 725b 7072 6963 655f 7061 7261 6d5d 2929  r[price_param]))
+0000c1f0: 206f 720a 2020 2020 2020 2020 2020 2020   or.            
+0000c200: 2020 2020 2873 6964 6520 3d3d 2022 6275      (side == "bu
+0000c210: 7922 2061 6e64 2073 746f 705f 6c6f 7373  y" and stop_loss
+0000c220: 203c 2066 6c6f 6174 286f 7264 6572 5b70   < float(order[p
+0000c230: 7269 6365 5f70 6172 616d 5d29 2929 0a20  rice_param]))). 
+0000c240: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+0000c250: 6620 5f67 6574 5f73 746f 705f 6f72 6465  f _get_stop_orde
+0000c260: 725f 7479 7065 2873 656c 662c 2075 7365  r_type(self, use
+0000c270: 725f 6f72 6465 725f 7479 7065 2920 2d3e  r_order_type) ->
+0000c280: 2054 7570 6c65 5b73 7472 2c20 7374 725d   Tuple[str, str]
+0000c290: 3a0a 0a20 2020 2020 2020 2061 7661 696c  :..        avail
+0000c2a0: 6162 6c65 5f6f 7264 6572 5f54 7970 6573  able_order_Types
+0000c2b0: 3a20 4469 6374 5b73 7472 2c20 7374 725d  : Dict[str, str]
+0000c2c0: 203d 2073 656c 662e 5f66 745f 6861 735b   = self._ft_has[
+0000c2d0: 2273 746f 706c 6f73 735f 6f72 6465 725f  "stoploss_order_
+0000c2e0: 7479 7065 7322 5d0a 0a20 2020 2020 2020  types"]..       
+0000c2f0: 2069 6620 7573 6572 5f6f 7264 6572 5f74   if user_order_t
+0000c300: 7970 6520 696e 2061 7661 696c 6162 6c65  ype in available
+0000c310: 5f6f 7264 6572 5f54 7970 6573 2e6b 6579  _order_Types.key
+0000c320: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+0000c330: 206f 7264 6572 7479 7065 203d 2061 7661   ordertype = ava
+0000c340: 696c 6162 6c65 5f6f 7264 6572 5f54 7970  ilable_order_Typ
+0000c350: 6573 5b75 7365 725f 6f72 6465 725f 7479  es[user_order_ty
+0000c360: 7065 5d0a 2020 2020 2020 2020 656c 7365  pe].        else
+0000c370: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0000c380: 4f74 6865 7277 6973 6520 7069 636b 206f  Otherwise pick o
+0000c390: 6e6c 7920 6f6e 6520 6176 6169 6c61 626c  nly one availabl
+0000c3a0: 650a 2020 2020 2020 2020 2020 2020 6f72  e.            or
+0000c3b0: 6465 7274 7970 6520 3d20 6c69 7374 2861  dertype = list(a
+0000c3c0: 7661 696c 6162 6c65 5f6f 7264 6572 5f54  vailable_order_T
+0000c3d0: 7970 6573 2e76 616c 7565 7328 2929 5b30  ypes.values())[0
+0000c3e0: 5d0a 2020 2020 2020 2020 2020 2020 7573  ].            us
+0000c3f0: 6572 5f6f 7264 6572 5f74 7970 6520 3d20  er_order_type = 
+0000c400: 6c69 7374 2861 7661 696c 6162 6c65 5f6f  list(available_o
+0000c410: 7264 6572 5f54 7970 6573 2e6b 6579 7328  rder_Types.keys(
+0000c420: 2929 5b30 5d0a 2020 2020 2020 2020 7265  ))[0].        re
+0000c430: 7475 726e 206f 7264 6572 7479 7065 2c20  turn ordertype, 
+0000c440: 7573 6572 5f6f 7264 6572 5f74 7970 650a  user_order_type.
+0000c450: 0a20 2020 2064 6566 205f 6765 745f 7374  .    def _get_st
+0000c460: 6f70 5f6c 696d 6974 5f72 6174 6528 7365  op_limit_rate(se
+0000c470: 6c66 2c20 7374 6f70 5f70 7269 6365 3a20  lf, stop_price: 
+0000c480: 666c 6f61 742c 206f 7264 6572 5f74 7970  float, order_typ
+0000c490: 6573 3a20 4469 6374 2c20 7369 6465 3a20  es: Dict, side: 
+0000c4a0: 7374 7229 202d 3e20 666c 6f61 743a 0a20  str) -> float:. 
+0000c4b0: 2020 2020 2020 2023 204c 696d 6974 2070         # Limit p
+0000c4c0: 7269 6365 2074 6872 6573 686f 6c64 3a20  rice threshold: 
+0000c4d0: 4173 206c 696d 6974 2070 7269 6365 2073  As limit price s
+0000c4e0: 686f 756c 6420 616c 7761 7973 2062 6520  hould always be 
+0000c4f0: 6265 6c6f 7720 7374 6f70 2d70 7269 6365  below stop-price
+0000c500: 0a20 2020 2020 2020 206c 696d 6974 5f70  .        limit_p
+0000c510: 7269 6365 5f70 6374 203d 206f 7264 6572  rice_pct = order
+0000c520: 5f74 7970 6573 2e67 6574 2827 7374 6f70  _types.get('stop
+0000c530: 6c6f 7373 5f6f 6e5f 6578 6368 616e 6765  loss_on_exchange
+0000c540: 5f6c 696d 6974 5f72 6174 696f 272c 2030  _limit_ratio', 0
+0000c550: 2e39 3929 0a20 2020 2020 2020 2069 6620  .99).        if 
+0000c560: 7369 6465 203d 3d20 2273 656c 6c22 3a0a  side == "sell":.
+0000c570: 2020 2020 2020 2020 2020 2020 6c69 6d69              limi
+0000c580: 745f 7261 7465 203d 2073 746f 705f 7072  t_rate = stop_pr
+0000c590: 6963 6520 2a20 6c69 6d69 745f 7072 6963  ice * limit_pric
+0000c5a0: 655f 7063 740a 2020 2020 2020 2020 656c  e_pct.        el
+0000c5b0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000c5c0: 6c69 6d69 745f 7261 7465 203d 2073 746f  limit_rate = sto
+0000c5d0: 705f 7072 6963 6520 2a20 2832 202d 206c  p_price * (2 - l
+0000c5e0: 696d 6974 5f70 7269 6365 5f70 6374 290a  imit_price_pct).
+0000c5f0: 0a20 2020 2020 2020 2062 6164 5f73 746f  .        bad_sto
+0000c600: 705f 7072 6963 6520 3d20 2828 7374 6f70  p_price = ((stop
+0000c610: 5f70 7269 6365 203c 3d20 6c69 6d69 745f  _price <= limit_
+0000c620: 7261 7465 2920 6966 2073 6964 6520 3d3d  rate) if side ==
+0000c630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c640: 2020 2020 2020 2020 2020 2022 7365 6c6c             "sell
+0000c650: 2220 656c 7365 2028 7374 6f70 5f70 7269  " else (stop_pri
+0000c660: 6365 203e 3d20 6c69 6d69 745f 7261 7465  ce >= limit_rate
+0000c670: 2929 0a20 2020 2020 2020 2023 2045 6e73  )).        # Ens
+0000c680: 7572 6520 7261 7465 2069 7320 6c65 7373  ure rate is less
+0000c690: 2074 6861 6e20 7374 6f70 2070 7269 6365   than stop price
+0000c6a0: 0a20 2020 2020 2020 2069 6620 6261 645f  .        if bad_
+0000c6b0: 7374 6f70 5f70 7269 6365 3a0a 2020 2020  stop_price:.    
+0000c6c0: 2020 2020 2020 2020 2320 5468 6973 2063          # This c
+0000c6d0: 616e 2066 6f72 2065 7861 6d70 6c65 2068  an for example h
+0000c6e0: 6170 7065 6e20 6966 2074 6865 2073 746f  appen if the sto
+0000c6f0: 7020 2f20 6c69 7175 6964 6174 696f 6e20  p / liquidation 
+0000c700: 7072 6963 6520 6973 2073 6574 2074 6f20  price is set to 
+0000c710: 300a 2020 2020 2020 2020 2020 2020 2320  0.            # 
+0000c720: 5768 6963 6820 6973 2070 6f73 7369 626c  Which is possibl
+0000c730: 6520 6966 2061 206d 6172 6b65 742d 6f72  e if a market-or
+0000c740: 6465 7220 636c 6f73 6573 2072 6967 6874  der closes right
+0000c750: 2061 7761 792e 0a20 2020 2020 2020 2020   away..         
+0000c760: 2020 2023 2054 6865 2049 6e76 616c 6964     # The Invalid
+0000c770: 4f72 6465 7245 7863 6570 7469 6f6e 2077  OrderException w
+0000c780: 696c 6c20 6275 6262 6c65 2075 7020 746f  ill bubble up to
+0000c790: 2065 7869 745f 706f 7369 7469 6f6e 732c   exit_positions,
+0000c7a0: 2077 6865 7265 2069 7420 7769 6c6c 2062   where it will b
+0000c7b0: 650a 2020 2020 2020 2020 2020 2020 2320  e.            # 
+0000c7c0: 6861 6e64 6c65 6420 6772 6163 6566 756c  handled graceful
+0000c7d0: 6c79 2e0a 2020 2020 2020 2020 2020 2020  ly..            
+0000c7e0: 7261 6973 6520 496e 7661 6c69 644f 7264  raise InvalidOrd
+0000c7f0: 6572 4578 6365 7074 696f 6e28 0a20 2020  erException(.   
+0000c800: 2020 2020 2020 2020 2020 2020 2022 496e               "In
+0000c810: 2073 746f 706c 6f73 7320 6c69 6d69 7420   stoploss limit 
+0000c820: 6f72 6465 722c 2073 746f 7020 7072 6963  order, stop pric
+0000c830: 6520 7368 6f75 6c64 2062 6520 6d6f 7265  e should be more
+0000c840: 2074 6861 6e20 6c69 6d69 7420 7072 6963   than limit pric
+0000c850: 652e 2022 0a20 2020 2020 2020 2020 2020  e. ".           
+0000c860: 2020 2020 2066 2253 746f 7020 7072 6963       f"Stop pric
+0000c870: 653a 207b 7374 6f70 5f70 7269 6365 7d2c  e: {stop_price},
+0000c880: 204c 696d 6974 2070 7269 6365 3a20 7b6c   Limit price: {l
+0000c890: 696d 6974 5f72 6174 657d 2c20 220a 2020  imit_rate}, ".  
+0000c8a0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0000c8b0: 4c69 6d69 7420 5072 6963 6520 7063 743a  Limit Price pct:
+0000c8c0: 207b 6c69 6d69 745f 7072 6963 655f 7063   {limit_price_pc
+0000c8d0: 747d 220a 2020 2020 2020 2020 2020 2020  t}".            
+0000c8e0: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
+0000c8f0: 7475 726e 206c 696d 6974 5f72 6174 650a  turn limit_rate.
+0000c900: 0a20 2020 2064 6566 205f 6765 745f 7374  .    def _get_st
+0000c910: 6f70 5f70 6172 616d 7328 7365 6c66 2c20  op_params(self, 
+0000c920: 7369 6465 3a20 4275 7953 656c 6c2c 206f  side: BuySell, o
+0000c930: 7264 6572 7479 7065 3a20 7374 722c 2073  rdertype: str, s
+0000c940: 746f 705f 7072 6963 653a 2066 6c6f 6174  top_price: float
+0000c950: 2920 2d3e 2044 6963 743a 0a20 2020 2020  ) -> Dict:.     
+0000c960: 2020 2070 6172 616d 7320 3d20 7365 6c66     params = self
+0000c970: 2e5f 7061 7261 6d73 2e63 6f70 7928 290a  ._params.copy().
+0000c980: 2020 2020 2020 2020 2320 5665 7269 6679          # Verify
+0000c990: 2069 6620 7374 6f70 5072 6963 6520 776f   if stopPrice wo
+0000c9a0: 726b 7320 666f 7220 796f 7572 2065 7863  rks for your exc
+0000c9b0: 6861 6e67 652c 2065 6c73 6520 636f 6e66  hange, else conf
+0000c9c0: 6967 7572 6520 7374 6f70 5f70 7269 6365  igure stop_price
+0000c9d0: 5f70 6172 616d 0a20 2020 2020 2020 2070  _param.        p
+0000c9e0: 6172 616d 732e 7570 6461 7465 287b 7365  arams.update({se
+0000c9f0: 6c66 2e5f 6674 5f68 6173 5b27 7374 6f70  lf._ft_has['stop
+0000ca00: 5f70 7269 6365 5f70 6172 616d 275d 3a20  _price_param']: 
+0000ca10: 7374 6f70 5f70 7269 6365 7d29 0a20 2020  stop_price}).   
+0000ca20: 2020 2020 2072 6574 7572 6e20 7061 7261       return para
+0000ca30: 6d73 0a0a 2020 2020 4072 6574 7269 6572  ms..    @retrier
+0000ca40: 2872 6574 7269 6573 3d30 290a 2020 2020  (retries=0).    
+0000ca50: 6465 6620 6372 6561 7465 5f73 746f 706c  def create_stopl
+0000ca60: 6f73 7328 7365 6c66 2c20 7061 6972 3a20  oss(self, pair: 
+0000ca70: 7374 722c 2061 6d6f 756e 743a 2066 6c6f  str, amount: flo
+0000ca80: 6174 2c20 7374 6f70 5f70 7269 6365 3a20  at, stop_price: 
+0000ca90: 666c 6f61 742c 206f 7264 6572 5f74 7970  float, order_typ
+0000caa0: 6573 3a20 4469 6374 2c0a 2020 2020 2020  es: Dict,.      
+0000cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cac0: 2020 7369 6465 3a20 4275 7953 656c 6c2c    side: BuySell,
+0000cad0: 206c 6576 6572 6167 653a 2066 6c6f 6174   leverage: float
+0000cae0: 2920 2d3e 2044 6963 743a 0a20 2020 2020  ) -> Dict:.     
+0000caf0: 2020 2022 2222 0a20 2020 2020 2020 2063     """.        c
+0000cb00: 7265 6174 6573 2061 2073 746f 706c 6f73  reates a stoplos
+0000cb10: 7320 6f72 6465 722e 0a20 2020 2020 2020  s order..       
+0000cb20: 2072 6571 7569 7265 7320 605f 6674 5f68   requires `_ft_h
+0000cb30: 6173 5b27 7374 6f70 6c6f 7373 5f6f 7264  as['stoploss_ord
+0000cb40: 6572 5f74 7970 6573 275d 6020 746f 2062  er_types']` to b
+0000cb50: 6520 7365 7420 6173 2061 2064 6963 7420  e set as a dict 
+0000cb60: 6d61 7070 696e 6720 6c69 6d69 7420 616e  mapping limit an
+0000cb70: 6420 6d61 726b 6574 0a20 2020 2020 2020  d market.       
+0000cb80: 2020 2020 2074 6f20 7468 6520 636f 7272       to the corr
+0000cb90: 6573 706f 6e64 696e 6720 6578 6368 616e  esponding exchan
+0000cba0: 6765 2074 7970 652e 0a0a 2020 2020 2020  ge type...      
+0000cbb0: 2020 5468 6520 7072 6563 6973 6520 6f72    The precise or
+0000cbc0: 6465 7274 7970 6520 6973 2064 6574 6572  dertype is deter
+0000cbd0: 6d69 6e65 6420 6279 2074 6865 206f 7264  mined by the ord
+0000cbe0: 6572 5f74 7970 6573 2064 6963 7420 6f72  er_types dict or
+0000cbf0: 2065 7863 6861 6e67 6520 6465 6661 756c   exchange defaul
+0000cc00: 742e 0a0a 2020 2020 2020 2020 5468 6520  t...        The 
+0000cc10: 6578 6365 7074 696f 6e20 6265 6c6f 7720  exception below 
+0000cc20: 7368 6f75 6c64 206e 6576 6572 2072 6169  should never rai
+0000cc30: 7365 2c20 7369 6e63 6520 7765 2064 6973  se, since we dis
+0000cc40: 616c 6c6f 770a 2020 2020 2020 2020 7374  allow.        st
+0000cc50: 6172 7469 6e67 2074 6865 2062 6f74 2069  arting the bot i
+0000cc60: 6e20 7661 6c69 6461 7465 5f6f 7264 6572  n validate_order
+0000cc70: 7479 7065 7328 290a 0a20 2020 2020 2020  types()..       
+0000cc80: 2054 6869 7320 6d61 7920 776f 726b 2077   This may work w
+0000cc90: 6974 6820 6120 6c69 6d69 7465 6420 6e75  ith a limited nu
+0000cca0: 6d62 6572 206f 6620 6f74 6865 7220 6578  mber of other ex
+0000ccb0: 6368 616e 6765 732c 2062 7574 2063 6f72  changes, but cor
+0000ccc0: 7265 6374 2077 6f72 6b69 6e67 0a20 2020  rect working.   
+0000ccd0: 2020 2020 2020 2020 206e 6565 6473 2074           needs t
+0000cce0: 6f20 6265 2074 6573 7465 6420 696e 6469  o be tested indi
+0000ccf0: 7669 6475 616c 6c79 2e0a 2020 2020 2020  vidually..      
+0000cd00: 2020 5741 524e 494e 473a 2073 6574 7469    WARNING: setti
+0000cd10: 6e67 2060 7374 6f70 6c6f 7373 5f6f 6e5f  ng `stoploss_on_
+0000cd20: 6578 6368 616e 6765 6020 746f 2054 7275  exchange` to Tru
+0000cd30: 6520 7769 6c6c 204e 4f54 2061 7574 6f2d  e will NOT auto-
+0000cd40: 656e 6162 6c65 2073 746f 706c 6f73 7320  enable stoploss 
+0000cd50: 6f6e 2065 7863 6861 6e67 652e 0a20 2020  on exchange..   
+0000cd60: 2020 2020 2020 2020 2060 7374 6f70 6c6f           `stoplo
+0000cd70: 7373 5f61 646a 7573 7460 206d 7573 7420  ss_adjust` must 
+0000cd80: 7374 696c 6c20 6265 2069 6d70 6c65 6d65  still be impleme
+0000cd90: 6e74 6564 2066 6f72 2074 6869 7320 746f  nted for this to
+0000cda0: 2077 6f72 6b2e 0a20 2020 2020 2020 2022   work..        "
+0000cdb0: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
+0000cdc0: 7420 7365 6c66 2e5f 6674 5f68 6173 5b27  t self._ft_has['
+0000cdd0: 7374 6f70 6c6f 7373 5f6f 6e5f 6578 6368  stoploss_on_exch
+0000cde0: 616e 6765 275d 3a0a 2020 2020 2020 2020  ange']:.        
+0000cdf0: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
+0000ce00: 696f 6e61 6c45 7863 6570 7469 6f6e 2866  ionalException(f
+0000ce10: 2273 746f 706c 6f73 7320 6973 206e 6f74  "stoploss is not
+0000ce20: 2069 6d70 6c65 6d65 6e74 6564 2066 6f72   implemented for
+0000ce30: 207b 7365 6c66 2e6e 616d 657d 2e22 290a   {self.name}.").
+0000ce40: 0a20 2020 2020 2020 2075 7365 725f 6f72  .        user_or
+0000ce50: 6465 725f 7479 7065 203d 206f 7264 6572  der_type = order
+0000ce60: 5f74 7970 6573 2e67 6574 2827 7374 6f70  _types.get('stop
+0000ce70: 6c6f 7373 272c 2027 6d61 726b 6574 2729  loss', 'market')
+0000ce80: 0a20 2020 2020 2020 206f 7264 6572 7479  .        orderty
+0000ce90: 7065 2c20 7573 6572 5f6f 7264 6572 5f74  pe, user_order_t
+0000cea0: 7970 6520 3d20 7365 6c66 2e5f 6765 745f  ype = self._get_
+0000ceb0: 7374 6f70 5f6f 7264 6572 5f74 7970 6528  stop_order_type(
+0000cec0: 7573 6572 5f6f 7264 6572 5f74 7970 6529  user_order_type)
+0000ced0: 0a20 2020 2020 2020 2072 6f75 6e64 5f6d  .        round_m
+0000cee0: 6f64 6520 3d20 524f 554e 445f 444f 574e  ode = ROUND_DOWN
+0000cef0: 2069 6620 7369 6465 203d 3d20 2762 7579   if side == 'buy
+0000cf00: 2720 656c 7365 2052 4f55 4e44 5f55 500a  ' else ROUND_UP.
+0000cf10: 2020 2020 2020 2020 7374 6f70 5f70 7269          stop_pri
+0000cf20: 6365 5f6e 6f72 6d20 3d20 7365 6c66 2e70  ce_norm = self.p
+0000cf30: 7269 6365 5f74 6f5f 7072 6563 6973 696f  rice_to_precisio
+0000cf40: 6e28 7061 6972 2c20 7374 6f70 5f70 7269  n(pair, stop_pri
+0000cf50: 6365 2c20 726f 756e 6469 6e67 5f6d 6f64  ce, rounding_mod
+0000cf60: 653d 726f 756e 645f 6d6f 6465 290a 2020  e=round_mode).  
+0000cf70: 2020 2020 2020 6c69 6d69 745f 7261 7465        limit_rate
+0000cf80: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+0000cf90: 6966 2075 7365 725f 6f72 6465 725f 7479  if user_order_ty
+0000cfa0: 7065 203d 3d20 276c 696d 6974 273a 0a20  pe == 'limit':. 
+0000cfb0: 2020 2020 2020 2020 2020 206c 696d 6974             limit
+0000cfc0: 5f72 6174 6520 3d20 7365 6c66 2e5f 6765  _rate = self._ge
+0000cfd0: 745f 7374 6f70 5f6c 696d 6974 5f72 6174  t_stop_limit_rat
+0000cfe0: 6528 7374 6f70 5f70 7269 6365 2c20 6f72  e(stop_price, or
+0000cff0: 6465 725f 7479 7065 732c 2073 6964 6529  der_types, side)
+0000d000: 0a20 2020 2020 2020 2020 2020 206c 696d  .            lim
+0000d010: 6974 5f72 6174 6520 3d20 7365 6c66 2e70  it_rate = self.p
+0000d020: 7269 6365 5f74 6f5f 7072 6563 6973 696f  rice_to_precisio
+0000d030: 6e28 7061 6972 2c20 6c69 6d69 745f 7261  n(pair, limit_ra
+0000d040: 7465 2c20 726f 756e 6469 6e67 5f6d 6f64  te, rounding_mod
+0000d050: 653d 726f 756e 645f 6d6f 6465 290a 0a20  e=round_mode).. 
+0000d060: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
+0000d070: 636f 6e66 6967 5b27 6472 795f 7275 6e27  config['dry_run'
+0000d080: 5d3a 0a20 2020 2020 2020 2020 2020 2064  ]:.            d
+0000d090: 7279 5f6f 7264 6572 203d 2073 656c 662e  ry_order = self.
+0000d0a0: 6372 6561 7465 5f64 7279 5f72 756e 5f6f  create_dry_run_o
+0000d0b0: 7264 6572 280a 2020 2020 2020 2020 2020  rder(.          
+0000d0c0: 2020 2020 2020 7061 6972 2c0a 2020 2020        pair,.    
+0000d0d0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+0000d0e0: 7274 7970 652c 0a20 2020 2020 2020 2020  rtype,.         
+0000d0f0: 2020 2020 2020 2073 6964 652c 0a20 2020         side,.   
+0000d100: 2020 2020 2020 2020 2020 2020 2061 6d6f               amo
+0000d110: 756e 742c 0a20 2020 2020 2020 2020 2020  unt,.           
+0000d120: 2020 2020 2073 746f 705f 7072 6963 655f       stop_price_
+0000d130: 6e6f 726d 2c0a 2020 2020 2020 2020 2020  norm,.          
+0000d140: 2020 2020 2020 7374 6f70 5f6c 6f73 733d        stop_loss=
+0000d150: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+0000d160: 2020 2020 2020 6c65 7665 7261 6765 3d6c        leverage=l
+0000d170: 6576 6572 6167 652c 0a20 2020 2020 2020  everage,.       
+0000d180: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000d190: 2020 2072 6574 7572 6e20 6472 795f 6f72     return dry_or
+0000d1a0: 6465 720a 0a20 2020 2020 2020 2074 7279  der..        try
+0000d1b0: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+0000d1c0: 7261 6d73 203d 2073 656c 662e 5f67 6574  rams = self._get
+0000d1d0: 5f73 746f 705f 7061 7261 6d73 2873 6964  _stop_params(sid
+0000d1e0: 653d 7369 6465 2c20 6f72 6465 7274 7970  e=side, ordertyp
+0000d1f0: 653d 6f72 6465 7274 7970 652c 0a20 2020  e=ordertype,.   
 0000d200: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000d210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d220: 2073 746f 705f 7072 6963 653d 7374 6f70   stop_price=stop
-0000d230: 5f70 7269 6365 5f6e 6f72 6d29 0a20 2020  _price_norm).   
-0000d240: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-0000d250: 2e74 7261 6469 6e67 5f6d 6f64 6520 3d3d  .trading_mode ==
-0000d260: 2054 7261 6469 6e67 4d6f 6465 2e46 5554   TradingMode.FUT
-0000d270: 5552 4553 3a0a 2020 2020 2020 2020 2020  URES:.          
-0000d280: 2020 2020 2020 7061 7261 6d73 5b27 7265        params['re
-0000d290: 6475 6365 4f6e 6c79 275d 203d 2054 7275  duceOnly'] = Tru
-0000d2a0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000d2b0: 2020 6966 2027 7374 6f70 6c6f 7373 5f70    if 'stoploss_p
-0000d2c0: 7269 6365 5f74 7970 6527 2069 6e20 6f72  rice_type' in or
-0000d2d0: 6465 725f 7479 7065 7320 616e 6420 2773  der_types and 's
-0000d2e0: 746f 705f 7072 6963 655f 7479 7065 5f66  top_price_type_f
-0000d2f0: 6965 6c64 2720 696e 2073 656c 662e 5f66  ield' in self._f
-0000d300: 745f 6861 733a 0a20 2020 2020 2020 2020  t_has:.         
-0000d310: 2020 2020 2020 2020 2020 2070 7269 6365             price
-0000d320: 5f74 7970 6520 3d20 7365 6c66 2e5f 6674  _type = self._ft
-0000d330: 5f68 6173 5b27 7374 6f70 5f70 7269 6365  _has['stop_price
-0000d340: 5f74 7970 655f 7661 6c75 655f 6d61 7070  _type_value_mapp
-0000d350: 696e 6727 5d5b 0a20 2020 2020 2020 2020  ing'][.         
-0000d360: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0000d370: 7264 6572 5f74 7970 6573 2e67 6574 2827  rder_types.get('
-0000d380: 7374 6f70 6c6f 7373 5f70 7269 6365 5f74  stoploss_price_t
-0000d390: 7970 6527 2c20 5072 6963 6554 7970 652e  ype', PriceType.
-0000d3a0: 4c41 5354 295d 0a20 2020 2020 2020 2020  LAST)].         
-0000d3b0: 2020 2020 2020 2020 2020 2070 6172 616d             param
-0000d3c0: 735b 7365 6c66 2e5f 6674 5f68 6173 5b27  s[self._ft_has['
-0000d3d0: 7374 6f70 5f70 7269 6365 5f74 7970 655f  stop_price_type_
-0000d3e0: 6669 656c 6427 5d5d 203d 2070 7269 6365  field']] = price
-0000d3f0: 5f74 7970 650a 0a20 2020 2020 2020 2020  _type..         
-0000d400: 2020 2061 6d6f 756e 7420 3d20 7365 6c66     amount = self
-0000d410: 2e61 6d6f 756e 745f 746f 5f70 7265 6369  .amount_to_preci
-0000d420: 7369 6f6e 2870 6169 722c 2073 656c 662e  sion(pair, self.
-0000d430: 5f61 6d6f 756e 745f 746f 5f63 6f6e 7472  _amount_to_contr
-0000d440: 6163 7473 2870 6169 722c 2061 6d6f 756e  acts(pair, amoun
-0000d450: 7429 290a 0a20 2020 2020 2020 2020 2020  t))..           
-0000d460: 2073 656c 662e 5f6c 6576 5f70 7265 7028   self._lev_prep(
-0000d470: 7061 6972 2c20 6c65 7665 7261 6765 2c20  pair, leverage, 
-0000d480: 7369 6465 2c20 6163 6365 7074 5f66 6169  side, accept_fai
-0000d490: 6c3d 5472 7565 290a 2020 2020 2020 2020  l=True).        
-0000d4a0: 2020 2020 6f72 6465 7220 3d20 7365 6c66      order = self
-0000d4b0: 2e5f 6170 692e 6372 6561 7465 5f6f 7264  ._api.create_ord
-0000d4c0: 6572 2873 796d 626f 6c3d 7061 6972 2c20  er(symbol=pair, 
-0000d4d0: 7479 7065 3d6f 7264 6572 7479 7065 2c20  type=ordertype, 
-0000d4e0: 7369 6465 3d73 6964 652c 0a20 2020 2020  side=side,.     
-0000d4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d220: 2020 2020 2020 2020 7374 6f70 5f70 7269          stop_pri
+0000d230: 6365 3d73 746f 705f 7072 6963 655f 6e6f  ce=stop_price_no
+0000d240: 726d 290a 2020 2020 2020 2020 2020 2020  rm).            
+0000d250: 6966 2073 656c 662e 7472 6164 696e 675f  if self.trading_
+0000d260: 6d6f 6465 203d 3d20 5472 6164 696e 674d  mode == TradingM
+0000d270: 6f64 652e 4655 5455 5245 533a 0a20 2020  ode.FUTURES:.   
+0000d280: 2020 2020 2020 2020 2020 2020 2070 6172               par
+0000d290: 616d 735b 2772 6564 7563 654f 6e6c 7927  ams['reduceOnly'
+0000d2a0: 5d20 3d20 5472 7565 0a20 2020 2020 2020  ] = True.       
+0000d2b0: 2020 2020 2020 2020 2069 6620 2773 746f           if 'sto
+0000d2c0: 706c 6f73 735f 7072 6963 655f 7479 7065  ploss_price_type
+0000d2d0: 2720 696e 206f 7264 6572 5f74 7970 6573  ' in order_types
+0000d2e0: 2061 6e64 2027 7374 6f70 5f70 7269 6365   and 'stop_price
+0000d2f0: 5f74 7970 655f 6669 656c 6427 2069 6e20  _type_field' in 
+0000d300: 7365 6c66 2e5f 6674 5f68 6173 3a0a 2020  self._ft_has:.  
+0000d310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d320: 2020 7072 6963 655f 7479 7065 203d 2073    price_type = s
+0000d330: 656c 662e 5f66 745f 6861 735b 2773 746f  elf._ft_has['sto
+0000d340: 705f 7072 6963 655f 7479 7065 5f76 616c  p_price_type_val
+0000d350: 7565 5f6d 6170 7069 6e67 275d 5b0a 2020  ue_mapping'][.  
+0000d360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d370: 2020 2020 2020 6f72 6465 725f 7479 7065        order_type
+0000d380: 732e 6765 7428 2773 746f 706c 6f73 735f  s.get('stoploss_
+0000d390: 7072 6963 655f 7479 7065 272c 2050 7269  price_type', Pri
+0000d3a0: 6365 5479 7065 2e4c 4153 5429 5d0a 2020  ceType.LAST)].  
+0000d3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3c0: 2020 7061 7261 6d73 5b73 656c 662e 5f66    params[self._f
+0000d3d0: 745f 6861 735b 2773 746f 705f 7072 6963  t_has['stop_pric
+0000d3e0: 655f 7479 7065 5f66 6965 6c64 275d 5d20  e_type_field']] 
+0000d3f0: 3d20 7072 6963 655f 7479 7065 0a0a 2020  = price_type..  
+0000d400: 2020 2020 2020 2020 2020 616d 6f75 6e74            amount
+0000d410: 203d 2073 656c 662e 616d 6f75 6e74 5f74   = self.amount_t
+0000d420: 6f5f 7072 6563 6973 696f 6e28 7061 6972  o_precision(pair
+0000d430: 2c20 7365 6c66 2e5f 616d 6f75 6e74 5f74  , self._amount_t
+0000d440: 6f5f 636f 6e74 7261 6374 7328 7061 6972  o_contracts(pair
+0000d450: 2c20 616d 6f75 6e74 2929 0a0a 2020 2020  , amount))..    
+0000d460: 2020 2020 2020 2020 7365 6c66 2e5f 6c65          self._le
+0000d470: 765f 7072 6570 2870 6169 722c 206c 6576  v_prep(pair, lev
+0000d480: 6572 6167 652c 2073 6964 652c 2061 6363  erage, side, acc
+0000d490: 6570 745f 6661 696c 3d54 7275 6529 0a20  ept_fail=True). 
+0000d4a0: 2020 2020 2020 2020 2020 206f 7264 6572             order
+0000d4b0: 203d 2073 656c 662e 5f61 7069 2e63 7265   = self._api.cre
+0000d4c0: 6174 655f 6f72 6465 7228 7379 6d62 6f6c  ate_order(symbol
+0000d4d0: 3d70 6169 722c 2074 7970 653d 6f72 6465  =pair, type=orde
+0000d4e0: 7274 7970 652c 2073 6964 653d 7369 6465  rtype, side=side
+0000d4f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 0000d500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d510: 2020 2020 2020 616d 6f75 6e74 3d61 6d6f        amount=amo
-0000d520: 756e 742c 2070 7269 6365 3d6c 696d 6974  unt, price=limit
-0000d530: 5f72 6174 652c 2070 6172 616d 733d 7061  _rate, params=pa
-0000d540: 7261 6d73 290a 2020 2020 2020 2020 2020  rams).          
-0000d550: 2020 7365 6c66 2e5f 6c6f 675f 6578 6368    self._log_exch
-0000d560: 616e 6765 5f72 6573 706f 6e73 6528 2763  ange_response('c
-0000d570: 7265 6174 655f 7374 6f70 6c6f 7373 5f6f  reate_stoploss_o
-0000d580: 7264 6572 272c 206f 7264 6572 290a 2020  rder', order).  
-0000d590: 2020 2020 2020 2020 2020 6f72 6465 7220            order 
-0000d5a0: 3d20 7365 6c66 2e5f 6f72 6465 725f 636f  = self._order_co
-0000d5b0: 6e74 7261 6374 735f 746f 5f61 6d6f 756e  ntracts_to_amoun
-0000d5c0: 7428 6f72 6465 7229 0a20 2020 2020 2020  t(order).       
-0000d5d0: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
-0000d5e0: 2866 2273 746f 706c 6f73 7320 7b75 7365  (f"stoploss {use
-0000d5f0: 725f 6f72 6465 725f 7479 7065 7d20 6f72  r_order_type} or
-0000d600: 6465 7220 6164 6465 6420 666f 7220 7b70  der added for {p
-0000d610: 6169 727d 2e20 220a 2020 2020 2020 2020  air}. ".        
+0000d510: 2020 2020 2020 2020 2020 2020 2061 6d6f               amo
+0000d520: 756e 743d 616d 6f75 6e74 2c20 7072 6963  unt=amount, pric
+0000d530: 653d 6c69 6d69 745f 7261 7465 2c20 7061  e=limit_rate, pa
+0000d540: 7261 6d73 3d70 6172 616d 7329 0a20 2020  rams=params).   
+0000d550: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
+0000d560: 6f67 5f65 7863 6861 6e67 655f 7265 7370  og_exchange_resp
+0000d570: 6f6e 7365 2827 6372 6561 7465 5f73 746f  onse('create_sto
+0000d580: 706c 6f73 735f 6f72 6465 7227 2c20 6f72  ploss_order', or
+0000d590: 6465 7229 0a20 2020 2020 2020 2020 2020  der).           
+0000d5a0: 206f 7264 6572 203d 2073 656c 662e 5f6f   order = self._o
+0000d5b0: 7264 6572 5f63 6f6e 7472 6163 7473 5f74  rder_contracts_t
+0000d5c0: 6f5f 616d 6f75 6e74 286f 7264 6572 290a  o_amount(order).
+0000d5d0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+0000d5e0: 6572 2e69 6e66 6f28 6622 7374 6f70 6c6f  er.info(f"stoplo
+0000d5f0: 7373 207b 7573 6572 5f6f 7264 6572 5f74  ss {user_order_t
+0000d600: 7970 657d 206f 7264 6572 2061 6464 6564  ype} order added
+0000d610: 2066 6f72 207b 7061 6972 7d2e 2022 0a20   for {pair}. ". 
 0000d620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d630: 6622 7374 6f70 2070 7269 6365 3a20 7b73  f"stop price: {s
-0000d640: 746f 705f 7072 6963 657d 2e20 6c69 6d69  top_price}. limi
-0000d650: 743a 207b 6c69 6d69 745f 7261 7465 7d22  t: {limit_rate}"
-0000d660: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-0000d670: 7475 726e 206f 7264 6572 0a20 2020 2020  turn order.     
-0000d680: 2020 2065 7863 6570 7420 6363 7874 2e49     except ccxt.I
-0000d690: 6e73 7566 6669 6369 656e 7446 756e 6473  nsufficientFunds
-0000d6a0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0000d6b0: 2020 2072 6169 7365 2049 6e73 7566 6669     raise Insuffi
-0000d6c0: 6369 656e 7446 756e 6473 4572 726f 7228  cientFundsError(
-0000d6d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d6e0: 2066 2749 6e73 7566 6669 6369 656e 7420   f'Insufficient 
-0000d6f0: 6675 6e64 7320 746f 2063 7265 6174 6520  funds to create 
-0000d700: 7b6f 7264 6572 7479 7065 7d20 7365 6c6c  {ordertype} sell
-0000d710: 206f 7264 6572 206f 6e20 6d61 726b 6574   order on market
-0000d720: 207b 7061 6972 7d2e 2027 0a20 2020 2020   {pair}. '.     
-0000d730: 2020 2020 2020 2020 2020 2066 2754 7269             f'Tri
-0000d740: 6564 2074 6f20 7365 6c6c 2061 6d6f 756e  ed to sell amoun
-0000d750: 7420 7b61 6d6f 756e 747d 2061 7420 7261  t {amount} at ra
-0000d760: 7465 207b 6c69 6d69 745f 7261 7465 7d2e  te {limit_rate}.
-0000d770: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
-0000d780: 2020 2066 274d 6573 7361 6765 3a20 7b65     f'Message: {e
-0000d790: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
-0000d7a0: 2020 2065 7863 6570 7420 6363 7874 2e49     except ccxt.I
-0000d7b0: 6e76 616c 6964 4f72 6465 7220 6173 2065  nvalidOrder as e
-0000d7c0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0000d7d0: 4572 726f 7273 3a0a 2020 2020 2020 2020  Errors:.        
-0000d7e0: 2020 2020 2320 604f 7264 6572 2077 6f75      # `Order wou
-0000d7f0: 6c64 2074 7269 6767 6572 2069 6d6d 6564  ld trigger immed
-0000d800: 6961 7465 6c79 2e60 0a20 2020 2020 2020  iately.`.       
-0000d810: 2020 2020 2072 6169 7365 2049 6e76 616c       raise Inval
-0000d820: 6964 4f72 6465 7245 7863 6570 7469 6f6e  idOrderException
-0000d830: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000d840: 2020 6627 436f 756c 6420 6e6f 7420 6372    f'Could not cr
-0000d850: 6561 7465 207b 6f72 6465 7274 7970 657d  eate {ordertype}
-0000d860: 2073 656c 6c20 6f72 6465 7220 6f6e 206d   sell order on m
-0000d870: 6172 6b65 7420 7b70 6169 727d 2e20 270a  arket {pair}. '.
-0000d880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d890: 6627 5472 6965 6420 746f 2073 656c 6c20  f'Tried to sell 
-0000d8a0: 616d 6f75 6e74 207b 616d 6f75 6e74 7d20  amount {amount} 
-0000d8b0: 6174 2072 6174 6520 7b6c 696d 6974 5f72  at rate {limit_r
-0000d8c0: 6174 657d 2e20 270a 2020 2020 2020 2020  ate}. '.        
-0000d8d0: 2020 2020 2020 2020 6627 4d65 7373 6167          f'Messag
-0000d8e0: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
-0000d8f0: 2020 2020 2020 2020 6578 6365 7074 2063          except c
-0000d900: 6378 742e 4444 6f53 5072 6f74 6563 7469  cxt.DDoSProtecti
-0000d910: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
-0000d920: 2020 2020 2072 6169 7365 2044 446f 7350       raise DDosP
-0000d930: 726f 7465 6374 696f 6e28 6529 2066 726f  rotection(e) fro
-0000d940: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
-0000d950: 7074 2028 6363 7874 2e4e 6574 776f 726b  pt (ccxt.Network
-0000d960: 4572 726f 722c 2063 6378 742e 4578 6368  Error, ccxt.Exch
-0000d970: 616e 6765 4572 726f 7229 2061 7320 653a  angeError) as e:
-0000d980: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000d990: 7365 2054 656d 706f 7261 7279 4572 726f  se TemporaryErro
-0000d9a0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-0000d9b0: 2020 2066 2243 6f75 6c64 206e 6f74 2070     f"Could not p
-0000d9c0: 6c61 6365 2073 746f 706c 6f73 7320 6f72  lace stoploss or
-0000d9d0: 6465 7220 6475 6520 746f 207b 652e 5f5f  der due to {e.__
-0000d9e0: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-0000d9f0: 7d2e 2022 0a20 2020 2020 2020 2020 2020  }. ".           
-0000da00: 2020 2020 2066 224d 6573 7361 6765 3a20       f"Message: 
-0000da10: 7b65 7d22 2920 6672 6f6d 2065 0a20 2020  {e}") from e.   
-0000da20: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
-0000da30: 2e42 6173 6545 7272 6f72 2061 7320 653a  .BaseError as e:
-0000da40: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000da50: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
-0000da60: 6365 7074 696f 6e28 6529 2066 726f 6d20  ception(e) from 
-0000da70: 650a 0a20 2020 2040 7265 7472 6965 7228  e..    @retrier(
-0000da80: 7265 7472 6965 733d 4150 495f 4645 5443  retries=API_FETC
-0000da90: 485f 4f52 4445 525f 5245 5452 595f 434f  H_ORDER_RETRY_CO
-0000daa0: 554e 5429 0a20 2020 2064 6566 2066 6574  UNT).    def fet
-0000dab0: 6368 5f6f 7264 6572 2873 656c 662c 206f  ch_order(self, o
-0000dac0: 7264 6572 5f69 643a 2073 7472 2c20 7061  rder_id: str, pa
-0000dad0: 6972 3a20 7374 722c 2070 6172 616d 733a  ir: str, params:
-0000dae0: 2044 6963 7420 3d20 7b7d 2920 2d3e 2044   Dict = {}) -> D
-0000daf0: 6963 743a 0a20 2020 2020 2020 2069 6620  ict:.        if 
-0000db00: 7365 6c66 2e5f 636f 6e66 6967 5b27 6472  self._config['dr
-0000db10: 795f 7275 6e27 5d3a 0a20 2020 2020 2020  y_run']:.       
-0000db20: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000db30: 2e66 6574 6368 5f64 7279 5f72 756e 5f6f  .fetch_dry_run_o
-0000db40: 7264 6572 286f 7264 6572 5f69 6429 0a20  rder(order_id). 
-0000db50: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0000db60: 2020 2020 2020 2020 6f72 6465 7220 3d20          order = 
-0000db70: 7365 6c66 2e5f 6170 692e 6665 7463 685f  self._api.fetch_
-0000db80: 6f72 6465 7228 6f72 6465 725f 6964 2c20  order(order_id, 
-0000db90: 7061 6972 2c20 7061 7261 6d73 3d70 6172  pair, params=par
-0000dba0: 616d 7329 0a20 2020 2020 2020 2020 2020  ams).           
-0000dbb0: 2073 656c 662e 5f6c 6f67 5f65 7863 6861   self._log_excha
-0000dbc0: 6e67 655f 7265 7370 6f6e 7365 2827 6665  nge_response('fe
-0000dbd0: 7463 685f 6f72 6465 7227 2c20 6f72 6465  tch_order', orde
-0000dbe0: 7229 0a20 2020 2020 2020 2020 2020 206f  r).            o
-0000dbf0: 7264 6572 203d 2073 656c 662e 5f6f 7264  rder = self._ord
-0000dc00: 6572 5f63 6f6e 7472 6163 7473 5f74 6f5f  er_contracts_to_
-0000dc10: 616d 6f75 6e74 286f 7264 6572 290a 2020  amount(order).  
-0000dc20: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000dc30: 206f 7264 6572 0a20 2020 2020 2020 2065   order.        e
-0000dc40: 7863 6570 7420 6363 7874 2e4f 7264 6572  xcept ccxt.Order
-0000dc50: 4e6f 7446 6f75 6e64 2061 7320 653a 0a20  NotFound as e:. 
-0000dc60: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000dc70: 2052 6574 7279 6162 6c65 4f72 6465 7245   RetryableOrderE
-0000dc80: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-0000dc90: 2020 2020 2020 6627 4f72 6465 7220 6e6f        f'Order no
-0000dca0: 7420 666f 756e 6420 2870 6169 723a 207b  t found (pair: {
-0000dcb0: 7061 6972 7d20 6964 3a20 7b6f 7264 6572  pair} id: {order
-0000dcc0: 5f69 647d 292e 204d 6573 7361 6765 3a20  _id}). Message: 
-0000dcd0: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
-0000dce0: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
-0000dcf0: 2e49 6e76 616c 6964 4f72 6465 7220 6173  .InvalidOrder as
-0000dd00: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0000dd10: 7261 6973 6520 496e 7661 6c69 644f 7264  raise InvalidOrd
-0000dd20: 6572 4578 6365 7074 696f 6e28 0a20 2020  erException(.   
-0000dd30: 2020 2020 2020 2020 2020 2020 2066 2754               f'T
-0000dd40: 7269 6564 2074 6f20 6765 7420 616e 2069  ried to get an i
-0000dd50: 6e76 616c 6964 206f 7264 6572 2028 7061  nvalid order (pa
-0000dd60: 6972 3a20 7b70 6169 727d 2069 643a 207b  ir: {pair} id: {
-0000dd70: 6f72 6465 725f 6964 7d29 2e20 4d65 7373  order_id}). Mess
-0000dd80: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
-0000dd90: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-0000dda0: 2063 6378 742e 4444 6f53 5072 6f74 6563   ccxt.DDoSProtec
-0000ddb0: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
-0000ddc0: 2020 2020 2020 2072 6169 7365 2044 446f         raise DDo
-0000ddd0: 7350 726f 7465 6374 696f 6e28 6529 2066  sProtection(e) f
-0000dde0: 726f 6d20 650a 2020 2020 2020 2020 6578  rom e.        ex
-0000ddf0: 6365 7074 2028 6363 7874 2e4e 6574 776f  cept (ccxt.Netwo
-0000de00: 726b 4572 726f 722c 2063 6378 742e 4578  rkError, ccxt.Ex
-0000de10: 6368 616e 6765 4572 726f 7229 2061 7320  changeError) as 
-0000de20: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0000de30: 6169 7365 2054 656d 706f 7261 7279 4572  aise TemporaryEr
-0000de40: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0000de50: 2020 2020 2066 2743 6f75 6c64 206e 6f74       f'Could not
-0000de60: 2067 6574 206f 7264 6572 2064 7565 2074   get order due t
-0000de70: 6f20 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f  o {e.__class__._
-0000de80: 5f6e 616d 655f 5f7d 2e20 4d65 7373 6167  _name__}. Messag
-0000de90: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
-0000dea0: 2020 2020 2020 2020 6578 6365 7074 2063          except c
-0000deb0: 6378 742e 4261 7365 4572 726f 7220 6173  cxt.BaseError as
-0000dec0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0000ded0: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
-0000dee0: 6c45 7863 6570 7469 6f6e 2865 2920 6672  lException(e) fr
-0000def0: 6f6d 2065 0a0a 2020 2020 6465 6620 6665  om e..    def fe
-0000df00: 7463 685f 7374 6f70 6c6f 7373 5f6f 7264  tch_stoploss_ord
-0000df10: 6572 2873 656c 662c 206f 7264 6572 5f69  er(self, order_i
-0000df20: 643a 2073 7472 2c20 7061 6972 3a20 7374  d: str, pair: st
-0000df30: 722c 2070 6172 616d 733a 2044 6963 7420  r, params: Dict 
-0000df40: 3d20 7b7d 2920 2d3e 2044 6963 743a 0a20  = {}) -> Dict:. 
-0000df50: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000df60: 6c66 2e66 6574 6368 5f6f 7264 6572 286f  lf.fetch_order(o
-0000df70: 7264 6572 5f69 642c 2070 6169 722c 2070  rder_id, pair, p
-0000df80: 6172 616d 7329 0a0a 2020 2020 6465 6620  arams)..    def 
-0000df90: 6665 7463 685f 6f72 6465 725f 6f72 5f73  fetch_order_or_s
-0000dfa0: 746f 706c 6f73 735f 6f72 6465 7228 7365  toploss_order(se
-0000dfb0: 6c66 2c20 6f72 6465 725f 6964 3a20 7374  lf, order_id: st
-0000dfc0: 722c 2070 6169 723a 2073 7472 2c0a 2020  r, pair: str,.  
-0000dfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d630: 2020 2020 2020 2066 2273 746f 7020 7072         f"stop pr
+0000d640: 6963 653a 207b 7374 6f70 5f70 7269 6365  ice: {stop_price
+0000d650: 7d2e 206c 696d 6974 3a20 7b6c 696d 6974  }. limit: {limit
+0000d660: 5f72 6174 657d 2229 0a20 2020 2020 2020  _rate}").       
+0000d670: 2020 2020 2072 6574 7572 6e20 6f72 6465       return orde
+0000d680: 720a 2020 2020 2020 2020 6578 6365 7074  r.        except
+0000d690: 2063 6378 742e 496e 7375 6666 6963 6965   ccxt.Insufficie
+0000d6a0: 6e74 4675 6e64 7320 6173 2065 3a0a 2020  ntFunds as e:.  
+0000d6b0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000d6c0: 496e 7375 6666 6963 6965 6e74 4675 6e64  InsufficientFund
+0000d6d0: 7345 7272 6f72 280a 2020 2020 2020 2020  sError(.        
+0000d6e0: 2020 2020 2020 2020 6627 496e 7375 6666          f'Insuff
+0000d6f0: 6963 6965 6e74 2066 756e 6473 2074 6f20  icient funds to 
+0000d700: 6372 6561 7465 207b 6f72 6465 7274 7970  create {ordertyp
+0000d710: 657d 2073 656c 6c20 6f72 6465 7220 6f6e  e} sell order on
+0000d720: 206d 6172 6b65 7420 7b70 6169 727d 2e20   market {pair}. 
+0000d730: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0000d740: 2020 6627 5472 6965 6420 746f 2073 656c    f'Tried to sel
+0000d750: 6c20 616d 6f75 6e74 207b 616d 6f75 6e74  l amount {amount
+0000d760: 7d20 6174 2072 6174 6520 7b6c 696d 6974  } at rate {limit
+0000d770: 5f72 6174 657d 2e20 270a 2020 2020 2020  _rate}. '.      
+0000d780: 2020 2020 2020 2020 2020 6627 4d65 7373            f'Mess
+0000d790: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
+0000d7a0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+0000d7b0: 2063 6378 742e 496e 7661 6c69 644f 7264   ccxt.InvalidOrd
+0000d7c0: 6572 2061 7320 653a 0a20 2020 2020 2020  er as e:.       
+0000d7d0: 2020 2020 2023 2045 7272 6f72 733a 0a20       # Errors:. 
+0000d7e0: 2020 2020 2020 2020 2020 2023 2060 4f72             # `Or
+0000d7f0: 6465 7220 776f 756c 6420 7472 6967 6765  der would trigge
+0000d800: 7220 696d 6d65 6469 6174 656c 792e 600a  r immediately.`.
+0000d810: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000d820: 6520 496e 7661 6c69 644f 7264 6572 4578  e InvalidOrderEx
+0000d830: 6365 7074 696f 6e28 0a20 2020 2020 2020  ception(.       
+0000d840: 2020 2020 2020 2020 2066 2743 6f75 6c64           f'Could
+0000d850: 206e 6f74 2063 7265 6174 6520 7b6f 7264   not create {ord
+0000d860: 6572 7479 7065 7d20 7365 6c6c 206f 7264  ertype} sell ord
+0000d870: 6572 206f 6e20 6d61 726b 6574 207b 7061  er on market {pa
+0000d880: 6972 7d2e 2027 0a20 2020 2020 2020 2020  ir}. '.         
+0000d890: 2020 2020 2020 2066 2754 7269 6564 2074         f'Tried t
+0000d8a0: 6f20 7365 6c6c 2061 6d6f 756e 7420 7b61  o sell amount {a
+0000d8b0: 6d6f 756e 747d 2061 7420 7261 7465 207b  mount} at rate {
+0000d8c0: 6c69 6d69 745f 7261 7465 7d2e 2027 0a20  limit_rate}. '. 
+0000d8d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000d8e0: 274d 6573 7361 6765 3a20 7b65 7d27 2920  'Message: {e}') 
+0000d8f0: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
+0000d900: 7863 6570 7420 6363 7874 2e44 446f 5350  xcept ccxt.DDoSP
+0000d910: 726f 7465 6374 696f 6e20 6173 2065 3a0a  rotection as e:.
+0000d920: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000d930: 6520 4444 6f73 5072 6f74 6563 7469 6f6e  e DDosProtection
+0000d940: 2865 2920 6672 6f6d 2065 0a20 2020 2020  (e) from e.     
+0000d950: 2020 2065 7863 6570 7420 2863 6378 742e     except (ccxt.
+0000d960: 4e65 7477 6f72 6b45 7272 6f72 2c20 6363  NetworkError, cc
+0000d970: 7874 2e45 7863 6861 6e67 6545 7272 6f72  xt.ExchangeError
+0000d980: 2920 6173 2065 3a0a 2020 2020 2020 2020  ) as e:.        
+0000d990: 2020 2020 7261 6973 6520 5465 6d70 6f72      raise Tempor
+0000d9a0: 6172 7945 7272 6f72 280a 2020 2020 2020  aryError(.      
+0000d9b0: 2020 2020 2020 2020 2020 6622 436f 756c            f"Coul
+0000d9c0: 6420 6e6f 7420 706c 6163 6520 7374 6f70  d not place stop
+0000d9d0: 6c6f 7373 206f 7264 6572 2064 7565 2074  loss order due t
+0000d9e0: 6f20 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f  o {e.__class__._
+0000d9f0: 5f6e 616d 655f 5f7d 2e20 220a 2020 2020  _name__}. ".    
+0000da00: 2020 2020 2020 2020 2020 2020 6622 4d65              f"Me
+0000da10: 7373 6167 653a 207b 657d 2229 2066 726f  ssage: {e}") fro
+0000da20: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
+0000da30: 7074 2063 6378 742e 4261 7365 4572 726f  pt ccxt.BaseErro
+0000da40: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
+0000da50: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
+0000da60: 696f 6e61 6c45 7863 6570 7469 6f6e 2865  ionalException(e
+0000da70: 2920 6672 6f6d 2065 0a0a 2020 2020 4072  ) from e..    @r
+0000da80: 6574 7269 6572 2872 6574 7269 6573 3d41  etrier(retries=A
+0000da90: 5049 5f46 4554 4348 5f4f 5244 4552 5f52  PI_FETCH_ORDER_R
+0000daa0: 4554 5259 5f43 4f55 4e54 290a 2020 2020  ETRY_COUNT).    
+0000dab0: 6465 6620 6665 7463 685f 6f72 6465 7228  def fetch_order(
+0000dac0: 7365 6c66 2c20 6f72 6465 725f 6964 3a20  self, order_id: 
+0000dad0: 7374 722c 2070 6169 723a 2073 7472 2c20  str, pair: str, 
+0000dae0: 7061 7261 6d73 3a20 4469 6374 203d 207b  params: Dict = {
+0000daf0: 7d29 202d 3e20 4469 6374 3a0a 2020 2020  }) -> Dict:.    
+0000db00: 2020 2020 6966 2073 656c 662e 5f63 6f6e      if self._con
+0000db10: 6669 675b 2764 7279 5f72 756e 275d 3a0a  fig['dry_run']:.
+0000db20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000db30: 726e 2073 656c 662e 6665 7463 685f 6472  rn self.fetch_dr
+0000db40: 795f 7275 6e5f 6f72 6465 7228 6f72 6465  y_run_order(orde
+0000db50: 725f 6964 290a 2020 2020 2020 2020 7472  r_id).        tr
+0000db60: 793a 0a20 2020 2020 2020 2020 2020 206f  y:.            o
+0000db70: 7264 6572 203d 2073 656c 662e 5f61 7069  rder = self._api
+0000db80: 2e66 6574 6368 5f6f 7264 6572 286f 7264  .fetch_order(ord
+0000db90: 6572 5f69 642c 2070 6169 722c 2070 6172  er_id, pair, par
+0000dba0: 616d 733d 7061 7261 6d73 290a 2020 2020  ams=params).    
+0000dbb0: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
+0000dbc0: 675f 6578 6368 616e 6765 5f72 6573 706f  g_exchange_respo
+0000dbd0: 6e73 6528 2766 6574 6368 5f6f 7264 6572  nse('fetch_order
+0000dbe0: 272c 206f 7264 6572 290a 2020 2020 2020  ', order).      
+0000dbf0: 2020 2020 2020 6f72 6465 7220 3d20 7365        order = se
+0000dc00: 6c66 2e5f 6f72 6465 725f 636f 6e74 7261  lf._order_contra
+0000dc10: 6374 735f 746f 5f61 6d6f 756e 7428 6f72  cts_to_amount(or
+0000dc20: 6465 7229 0a20 2020 2020 2020 2020 2020  der).           
+0000dc30: 2072 6574 7572 6e20 6f72 6465 720a 2020   return order.  
+0000dc40: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
+0000dc50: 742e 4f72 6465 724e 6f74 466f 756e 6420  t.OrderNotFound 
+0000dc60: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+0000dc70: 2020 7261 6973 6520 5265 7472 7961 626c    raise Retryabl
+0000dc80: 654f 7264 6572 4572 726f 7228 0a20 2020  eOrderError(.   
+0000dc90: 2020 2020 2020 2020 2020 2020 2066 274f               f'O
+0000dca0: 7264 6572 206e 6f74 2066 6f75 6e64 2028  rder not found (
+0000dcb0: 7061 6972 3a20 7b70 6169 727d 2069 643a  pair: {pair} id:
+0000dcc0: 207b 6f72 6465 725f 6964 7d29 2e20 4d65   {order_id}). Me
+0000dcd0: 7373 6167 653a 207b 657d 2729 2066 726f  ssage: {e}') fro
+0000dce0: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
+0000dcf0: 7074 2063 6378 742e 496e 7661 6c69 644f  pt ccxt.InvalidO
+0000dd00: 7264 6572 2061 7320 653a 0a20 2020 2020  rder as e:.     
+0000dd10: 2020 2020 2020 2072 6169 7365 2049 6e76         raise Inv
+0000dd20: 616c 6964 4f72 6465 7245 7863 6570 7469  alidOrderExcepti
+0000dd30: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+0000dd40: 2020 2020 6627 5472 6965 6420 746f 2067      f'Tried to g
+0000dd50: 6574 2061 6e20 696e 7661 6c69 6420 6f72  et an invalid or
+0000dd60: 6465 7220 2870 6169 723a 207b 7061 6972  der (pair: {pair
+0000dd70: 7d20 6964 3a20 7b6f 7264 6572 5f69 647d  } id: {order_id}
+0000dd80: 292e 204d 6573 7361 6765 3a20 7b65 7d27  ). Message: {e}'
+0000dd90: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
+0000dda0: 2065 7863 6570 7420 6363 7874 2e44 446f   except ccxt.DDo
+0000ddb0: 5350 726f 7465 6374 696f 6e20 6173 2065  SProtection as e
+0000ddc0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0000ddd0: 6973 6520 4444 6f73 5072 6f74 6563 7469  ise DDosProtecti
+0000dde0: 6f6e 2865 2920 6672 6f6d 2065 0a20 2020  on(e) from e.   
+0000ddf0: 2020 2020 2065 7863 6570 7420 2863 6378       except (ccx
+0000de00: 742e 4e65 7477 6f72 6b45 7272 6f72 2c20  t.NetworkError, 
+0000de10: 6363 7874 2e45 7863 6861 6e67 6545 7272  ccxt.ExchangeErr
+0000de20: 6f72 2920 6173 2065 3a0a 2020 2020 2020  or) as e:.      
+0000de30: 2020 2020 2020 7261 6973 6520 5465 6d70        raise Temp
+0000de40: 6f72 6172 7945 7272 6f72 280a 2020 2020  oraryError(.    
+0000de50: 2020 2020 2020 2020 2020 2020 6627 436f              f'Co
+0000de60: 756c 6420 6e6f 7420 6765 7420 6f72 6465  uld not get orde
+0000de70: 7220 6475 6520 746f 207b 652e 5f5f 636c  r due to {e.__cl
+0000de80: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d2e  ass__.__name__}.
+0000de90: 204d 6573 7361 6765 3a20 7b65 7d27 2920   Message: {e}') 
+0000dea0: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
+0000deb0: 7863 6570 7420 6363 7874 2e42 6173 6545  xcept ccxt.BaseE
+0000dec0: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
+0000ded0: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
+0000dee0: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
+0000def0: 6e28 6529 2066 726f 6d20 650a 0a20 2020  n(e) from e..   
+0000df00: 2064 6566 2066 6574 6368 5f73 746f 706c   def fetch_stopl
+0000df10: 6f73 735f 6f72 6465 7228 7365 6c66 2c20  oss_order(self, 
+0000df20: 6f72 6465 725f 6964 3a20 7374 722c 2070  order_id: str, p
+0000df30: 6169 723a 2073 7472 2c20 7061 7261 6d73  air: str, params
+0000df40: 3a20 4469 6374 203d 207b 7d29 202d 3e20  : Dict = {}) -> 
+0000df50: 4469 6374 3a0a 2020 2020 2020 2020 7265  Dict:.        re
+0000df60: 7475 726e 2073 656c 662e 6665 7463 685f  turn self.fetch_
+0000df70: 6f72 6465 7228 6f72 6465 725f 6964 2c20  order(order_id, 
+0000df80: 7061 6972 2c20 7061 7261 6d73 290a 0a20  pair, params).. 
+0000df90: 2020 2064 6566 2066 6574 6368 5f6f 7264     def fetch_ord
+0000dfa0: 6572 5f6f 725f 7374 6f70 6c6f 7373 5f6f  er_or_stoploss_o
+0000dfb0: 7264 6572 2873 656c 662c 206f 7264 6572  rder(self, order
+0000dfc0: 5f69 643a 2073 7472 2c20 7061 6972 3a20  _id: str, pair: 
+0000dfd0: 7374 722c 0a20 2020 2020 2020 2020 2020  str,.           
 0000dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dff0: 2020 2020 7374 6f70 6c6f 7373 5f6f 7264      stoploss_ord
-0000e000: 6572 3a20 626f 6f6c 203d 2046 616c 7365  er: bool = False
-0000e010: 2920 2d3e 2044 6963 743a 0a20 2020 2020  ) -> Dict:.     
-0000e020: 2020 2022 2222 0a20 2020 2020 2020 2053     """.        S
-0000e030: 696d 706c 6520 7772 6170 7065 7220 6361  imple wrapper ca
-0000e040: 6c6c 696e 6720 6569 7468 6572 2066 6574  lling either fet
-0000e050: 6368 5f6f 7264 6572 206f 7220 6665 7463  ch_order or fetc
-0000e060: 685f 7374 6f70 6c6f 7373 5f6f 7264 6572  h_stoploss_order
-0000e070: 2064 6570 656e 6469 6e67 206f 6e0a 2020   depending on.  
-0000e080: 2020 2020 2020 7468 6520 7374 6f70 6c6f        the stoplo
-0000e090: 7373 5f6f 7264 6572 2070 6172 616d 6574  ss_order paramet
-0000e0a0: 6572 0a20 2020 2020 2020 203a 7061 7261  er.        :para
-0000e0b0: 6d20 6f72 6465 725f 6964 3a20 4f72 6465  m order_id: Orde
-0000e0c0: 7249 6420 746f 2066 6574 6368 206f 7264  rId to fetch ord
-0000e0d0: 6572 0a20 2020 2020 2020 203a 7061 7261  er.        :para
-0000e0e0: 6d20 7061 6972 3a20 5061 6972 2063 6f72  m pair: Pair cor
-0000e0f0: 7265 7370 6f6e 6469 6e67 2074 6f20 6f72  responding to or
-0000e100: 6465 725f 6964 0a20 2020 2020 2020 203a  der_id.        :
-0000e110: 7061 7261 6d20 7374 6f70 6c6f 7373 5f6f  param stoploss_o
-0000e120: 7264 6572 3a20 4966 2074 7275 652c 2075  rder: If true, u
-0000e130: 7365 7320 6665 7463 685f 7374 6f70 6c6f  ses fetch_stoplo
-0000e140: 7373 5f6f 7264 6572 2c20 6f74 6865 7277  ss_order, otherw
-0000e150: 6973 6520 6665 7463 685f 6f72 6465 722e  ise fetch_order.
-0000e160: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000e170: 2020 2020 2069 6620 7374 6f70 6c6f 7373       if stoploss
-0000e180: 5f6f 7264 6572 3a0a 2020 2020 2020 2020  _order:.        
-0000e190: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000e1a0: 6665 7463 685f 7374 6f70 6c6f 7373 5f6f  fetch_stoploss_o
-0000e1b0: 7264 6572 286f 7264 6572 5f69 642c 2070  rder(order_id, p
-0000e1c0: 6169 7229 0a20 2020 2020 2020 2072 6574  air).        ret
-0000e1d0: 7572 6e20 7365 6c66 2e66 6574 6368 5f6f  urn self.fetch_o
-0000e1e0: 7264 6572 286f 7264 6572 5f69 642c 2070  rder(order_id, p
-0000e1f0: 6169 7229 0a0a 2020 2020 6465 6620 6368  air)..    def ch
-0000e200: 6563 6b5f 6f72 6465 725f 6361 6e63 656c  eck_order_cancel
-0000e210: 6564 5f65 6d70 7479 2873 656c 662c 206f  ed_empty(self, o
-0000e220: 7264 6572 3a20 4469 6374 2920 2d3e 2062  rder: Dict) -> b
-0000e230: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
-0000e240: 0a20 2020 2020 2020 2056 6572 6966 7920  .        Verify 
-0000e250: 6966 2061 6e20 6f72 6465 7220 6861 7320  if an order has 
-0000e260: 6265 656e 2063 616e 6365 6c6c 6564 2077  been cancelled w
-0000e270: 6974 686f 7574 2062 6569 6e67 2070 6172  ithout being par
-0000e280: 7469 616c 6c79 2066 696c 6c65 640a 2020  tially filled.  
-0000e290: 2020 2020 2020 3a70 6172 616d 206f 7264        :param ord
-0000e2a0: 6572 3a20 4f72 6465 7220 6469 6374 2061  er: Order dict a
-0000e2b0: 7320 7265 7475 726e 6564 2066 726f 6d20  s returned from 
-0000e2c0: 6665 7463 685f 6f72 6465 7228 290a 2020  fetch_order().  
-0000e2d0: 2020 2020 2020 3a72 6574 7572 6e3a 2054        :return: T
-0000e2e0: 7275 6520 6966 206f 7264 6572 2068 6173  rue if order has
-0000e2f0: 2062 6565 6e20 6361 6e63 656c 6c65 6420   been cancelled 
-0000e300: 7769 7468 6f75 7420 6265 696e 6720 6669  without being fi
-0000e310: 6c6c 6564 2c20 4661 6c73 6520 6f74 6865  lled, False othe
-0000e320: 7277 6973 652e 0a20 2020 2020 2020 2022  rwise..        "
-0000e330: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-0000e340: 6e20 286f 7264 6572 2e67 6574 2827 7374  n (order.get('st
-0000e350: 6174 7573 2729 2069 6e20 4e4f 4e5f 4f50  atus') in NON_OP
-0000e360: 454e 5f45 5843 4841 4e47 455f 5354 4154  EN_EXCHANGE_STAT
-0000e370: 4553 0a20 2020 2020 2020 2020 2020 2020  ES.             
-0000e380: 2020 2061 6e64 206f 7264 6572 2e67 6574     and order.get
-0000e390: 2827 6669 6c6c 6564 2729 203d 3d20 302e  ('filled') == 0.
-0000e3a0: 3029 0a0a 2020 2020 4072 6574 7269 6572  0)..    @retrier
-0000e3b0: 0a20 2020 2064 6566 2063 616e 6365 6c5f  .    def cancel_
-0000e3c0: 6f72 6465 7228 7365 6c66 2c20 6f72 6465  order(self, orde
-0000e3d0: 725f 6964 3a20 7374 722c 2070 6169 723a  r_id: str, pair:
-0000e3e0: 2073 7472 2c20 7061 7261 6d73 3a20 4469   str, params: Di
-0000e3f0: 6374 203d 207b 7d29 202d 3e20 4469 6374  ct = {}) -> Dict
-0000e400: 3a0a 2020 2020 2020 2020 6966 2073 656c  :.        if sel
-0000e410: 662e 5f63 6f6e 6669 675b 2764 7279 5f72  f._config['dry_r
-0000e420: 756e 275d 3a0a 2020 2020 2020 2020 2020  un']:.          
-0000e430: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0000e440: 2020 2020 2020 206f 7264 6572 203d 2073         order = s
-0000e450: 656c 662e 6665 7463 685f 6472 795f 7275  elf.fetch_dry_ru
-0000e460: 6e5f 6f72 6465 7228 6f72 6465 725f 6964  n_order(order_id
-0000e470: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0000e480: 2020 206f 7264 6572 2e75 7064 6174 6528     order.update(
-0000e490: 7b27 7374 6174 7573 273a 2027 6361 6e63  {'status': 'canc
-0000e4a0: 656c 6564 272c 2027 6669 6c6c 6564 273a  eled', 'filled':
-0000e4b0: 2030 2e30 2c20 2772 656d 6169 6e69 6e67   0.0, 'remaining
-0000e4c0: 273a 206f 7264 6572 5b27 616d 6f75 6e74  ': order['amount
-0000e4d0: 275d 7d29 0a20 2020 2020 2020 2020 2020  ']}).           
-0000e4e0: 2020 2020 2072 6574 7572 6e20 6f72 6465       return orde
-0000e4f0: 720a 2020 2020 2020 2020 2020 2020 6578  r.            ex
-0000e500: 6365 7074 2049 6e76 616c 6964 4f72 6465  cept InvalidOrde
-0000e510: 7245 7863 6570 7469 6f6e 3a0a 2020 2020  rException:.    
-0000e520: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000e530: 726e 207b 7d0a 0a20 2020 2020 2020 2074  rn {}..        t
-0000e540: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0000e550: 6f72 6465 7220 3d20 7365 6c66 2e5f 6170  order = self._ap
-0000e560: 692e 6361 6e63 656c 5f6f 7264 6572 286f  i.cancel_order(o
-0000e570: 7264 6572 5f69 642c 2070 6169 722c 2070  rder_id, pair, p
-0000e580: 6172 616d 733d 7061 7261 6d73 290a 2020  arams=params).  
-0000e590: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-0000e5a0: 6c6f 675f 6578 6368 616e 6765 5f72 6573  log_exchange_res
-0000e5b0: 706f 6e73 6528 2763 616e 6365 6c5f 6f72  ponse('cancel_or
-0000e5c0: 6465 7227 2c20 6f72 6465 7229 0a20 2020  der', order).   
-0000e5d0: 2020 2020 2020 2020 206f 7264 6572 203d           order =
-0000e5e0: 2073 656c 662e 5f6f 7264 6572 5f63 6f6e   self._order_con
-0000e5f0: 7472 6163 7473 5f74 6f5f 616d 6f75 6e74  tracts_to_amount
-0000e600: 286f 7264 6572 290a 2020 2020 2020 2020  (order).        
-0000e610: 2020 2020 7265 7475 726e 206f 7264 6572      return order
-0000e620: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0000e630: 6363 7874 2e49 6e76 616c 6964 4f72 6465  ccxt.InvalidOrde
-0000e640: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
-0000e650: 2020 2020 7261 6973 6520 496e 7661 6c69      raise Invali
-0000e660: 644f 7264 6572 4578 6365 7074 696f 6e28  dOrderException(
-0000e670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e680: 2066 2743 6f75 6c64 206e 6f74 2063 616e   f'Could not can
-0000e690: 6365 6c20 6f72 6465 722e 204d 6573 7361  cel order. Messa
-0000e6a0: 6765 3a20 7b65 7d27 2920 6672 6f6d 2065  ge: {e}') from e
-0000e6b0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0000e6c0: 6363 7874 2e44 446f 5350 726f 7465 6374  ccxt.DDoSProtect
-0000e6d0: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
-0000e6e0: 2020 2020 2020 7261 6973 6520 4444 6f73        raise DDos
-0000e6f0: 5072 6f74 6563 7469 6f6e 2865 2920 6672  Protection(e) fr
-0000e700: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
-0000e710: 6570 7420 2863 6378 742e 4e65 7477 6f72  ept (ccxt.Networ
-0000e720: 6b45 7272 6f72 2c20 6363 7874 2e45 7863  kError, ccxt.Exc
-0000e730: 6861 6e67 6545 7272 6f72 2920 6173 2065  hangeError) as e
-0000e740: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000e750: 6973 6520 5465 6d70 6f72 6172 7945 7272  ise TemporaryErr
-0000e760: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0000e770: 2020 2020 6627 436f 756c 6420 6e6f 7420      f'Could not 
-0000e780: 6361 6e63 656c 206f 7264 6572 2064 7565  cancel order due
-0000e790: 2074 6f20 7b65 2e5f 5f63 6c61 7373 5f5f   to {e.__class__
-0000e7a0: 2e5f 5f6e 616d 655f 5f7d 2e20 4d65 7373  .__name__}. Mess
-0000e7b0: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
-0000e7c0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-0000e7d0: 2063 6378 742e 4261 7365 4572 726f 7220   ccxt.BaseError 
-0000e7e0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-0000e7f0: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
-0000e800: 6e61 6c45 7863 6570 7469 6f6e 2865 2920  nalException(e) 
-0000e810: 6672 6f6d 2065 0a0a 2020 2020 6465 6620  from e..    def 
-0000e820: 6361 6e63 656c 5f73 746f 706c 6f73 735f  cancel_stoploss_
-0000e830: 6f72 6465 7228 7365 6c66 2c20 6f72 6465  order(self, orde
-0000e840: 725f 6964 3a20 7374 722c 2070 6169 723a  r_id: str, pair:
-0000e850: 2073 7472 2c20 7061 7261 6d73 3a20 4469   str, params: Di
-0000e860: 6374 203d 207b 7d29 202d 3e20 4469 6374  ct = {}) -> Dict
-0000e870: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0000e880: 2073 656c 662e 6361 6e63 656c 5f6f 7264   self.cancel_ord
-0000e890: 6572 286f 7264 6572 5f69 642c 2070 6169  er(order_id, pai
-0000e8a0: 722c 2070 6172 616d 7329 0a0a 2020 2020  r, params)..    
-0000e8b0: 6465 6620 6973 5f63 616e 6365 6c5f 6f72  def is_cancel_or
-0000e8c0: 6465 725f 7265 7375 6c74 5f73 7569 7461  der_result_suita
-0000e8d0: 626c 6528 7365 6c66 2c20 636f 7264 6572  ble(self, corder
-0000e8e0: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
-0000e8f0: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-0000e900: 616e 6365 2863 6f72 6465 722c 2064 6963  ance(corder, dic
-0000e910: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-0000e920: 7265 7475 726e 2046 616c 7365 0a0a 2020  return False..  
-0000e930: 2020 2020 2020 7265 7175 6972 6564 203d        required =
-0000e940: 2028 2766 6565 272c 2027 7374 6174 7573   ('fee', 'status
-0000e950: 272c 2027 616d 6f75 6e74 2729 0a20 2020  ', 'amount').   
-0000e960: 2020 2020 2072 6574 7572 6e20 616c 6c28       return all(
-0000e970: 636f 7264 6572 2e67 6574 286b 2c20 4e6f  corder.get(k, No
-0000e980: 6e65 2920 6973 206e 6f74 204e 6f6e 6520  ne) is not None 
-0000e990: 666f 7220 6b20 696e 2072 6571 7569 7265  for k in require
-0000e9a0: 6429 0a0a 2020 2020 6465 6620 6361 6e63  d)..    def canc
-0000e9b0: 656c 5f6f 7264 6572 5f77 6974 685f 7265  el_order_with_re
-0000e9c0: 7375 6c74 2873 656c 662c 206f 7264 6572  sult(self, order
-0000e9d0: 5f69 643a 2073 7472 2c20 7061 6972 3a20  _id: str, pair: 
-0000e9e0: 7374 722c 2061 6d6f 756e 743a 2066 6c6f  str, amount: flo
-0000e9f0: 6174 2920 2d3e 2044 6963 743a 0a20 2020  at) -> Dict:.   
-0000ea00: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000ea10: 2043 616e 6365 6c20 6f72 6465 7220 7265   Cancel order re
-0000ea20: 7475 726e 696e 6720 6120 7265 7375 6c74  turning a result
-0000ea30: 2e0a 2020 2020 2020 2020 4372 6561 7465  ..        Create
-0000ea40: 7320 6120 6661 6b65 2072 6573 756c 7420  s a fake result 
-0000ea50: 6966 2063 616e 6365 6c20 6f72 6465 7220  if cancel order 
-0000ea60: 7265 7475 726e 7320 6120 6e6f 6e2d 7573  returns a non-us
-0000ea70: 6162 6c65 2072 6573 756c 740a 2020 2020  able result.    
-0000ea80: 2020 2020 616e 6420 6665 7463 685f 6f72      and fetch_or
-0000ea90: 6465 7220 646f 6573 206e 6f74 2077 6f72  der does not wor
-0000eaa0: 6b20 2863 6572 7461 696e 2065 7863 6861  k (certain excha
-0000eab0: 6e67 6573 2064 6f6e 2774 2072 6574 7572  nges don't retur
-0000eac0: 6e20 6361 6e63 656c 6c65 6420 6f72 6465  n cancelled orde
-0000ead0: 7273 290a 2020 2020 2020 2020 3a70 6172  rs).        :par
-0000eae0: 616d 206f 7264 6572 5f69 643a 204f 7264  am order_id: Ord
-0000eaf0: 6572 6964 2074 6f20 6361 6e63 656c 0a20  erid to cancel. 
-0000eb00: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
-0000eb10: 6972 3a20 5061 6972 2063 6f72 7265 7370  ir: Pair corresp
-0000eb20: 6f6e 6469 6e67 2074 6f20 6f72 6465 725f  onding to order_
-0000eb30: 6964 0a20 2020 2020 2020 203a 7061 7261  id.        :para
-0000eb40: 6d20 616d 6f75 6e74 3a20 416d 6f75 6e74  m amount: Amount
-0000eb50: 2074 6f20 7573 6520 666f 7220 6661 6b65   to use for fake
-0000eb60: 2072 6573 706f 6e73 650a 2020 2020 2020   response.      
-0000eb70: 2020 3a72 6574 7572 6e3a 2052 6573 756c    :return: Resul
-0000eb80: 7420 6672 6f6d 2065 6974 6865 7220 6361  t from either ca
-0000eb90: 6e63 656c 5f6f 7264 6572 2069 6620 7573  ncel_order if us
-0000eba0: 6162 6c65 2c20 6f72 2066 6574 6368 5f6f  able, or fetch_o
-0000ebb0: 7264 6572 0a20 2020 2020 2020 2022 2222  rder.        """
-0000ebc0: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-0000ebd0: 2020 2020 2020 2020 2020 636f 7264 6572            corder
-0000ebe0: 203d 2073 656c 662e 6361 6e63 656c 5f6f   = self.cancel_o
-0000ebf0: 7264 6572 286f 7264 6572 5f69 642c 2070  rder(order_id, p
-0000ec00: 6169 7229 0a20 2020 2020 2020 2020 2020  air).           
-0000ec10: 2069 6620 7365 6c66 2e69 735f 6361 6e63   if self.is_canc
-0000ec20: 656c 5f6f 7264 6572 5f72 6573 756c 745f  el_order_result_
-0000ec30: 7375 6974 6162 6c65 2863 6f72 6465 7229  suitable(corder)
-0000ec40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000ec50: 2020 7265 7475 726e 2063 6f72 6465 720a    return corder.
-0000ec60: 2020 2020 2020 2020 6578 6365 7074 2049          except I
-0000ec70: 6e76 616c 6964 4f72 6465 7245 7863 6570  nvalidOrderExcep
-0000ec80: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-0000ec90: 2020 6c6f 6767 6572 2e77 6172 6e69 6e67    logger.warning
-0000eca0: 2866 2243 6f75 6c64 206e 6f74 2063 616e  (f"Could not can
-0000ecb0: 6365 6c20 6f72 6465 7220 7b6f 7264 6572  cel order {order
-0000ecc0: 5f69 647d 2066 6f72 207b 7061 6972 7d2e  _id} for {pair}.
-0000ecd0: 2229 0a20 2020 2020 2020 2074 7279 3a0a  ").        try:.
-0000ece0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-0000ecf0: 7220 3d20 7365 6c66 2e66 6574 6368 5f6f  r = self.fetch_o
-0000ed00: 7264 6572 286f 7264 6572 5f69 642c 2070  rder(order_id, p
-0000ed10: 6169 7229 0a20 2020 2020 2020 2065 7863  air).        exc
-0000ed20: 6570 7420 496e 7661 6c69 644f 7264 6572  ept InvalidOrder
-0000ed30: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
-0000ed40: 2020 2020 2020 206c 6f67 6765 722e 7761         logger.wa
-0000ed50: 726e 696e 6728 6622 436f 756c 6420 6e6f  rning(f"Could no
-0000ed60: 7420 6665 7463 6820 6361 6e63 656c 6c65  t fetch cancelle
-0000ed70: 6420 6f72 6465 7220 7b6f 7264 6572 5f69  d order {order_i
-0000ed80: 647d 2e22 290a 2020 2020 2020 2020 2020  d}.").          
-0000ed90: 2020 6f72 6465 7220 3d20 7b0a 2020 2020    order = {.    
-0000eda0: 2020 2020 2020 2020 2020 2020 2769 6427              'id'
-0000edb0: 3a20 6f72 6465 725f 6964 2c0a 2020 2020  : order_id,.    
-0000edc0: 2020 2020 2020 2020 2020 2020 2773 7461              'sta
-0000edd0: 7475 7327 3a20 2763 616e 6365 6c65 6427  tus': 'canceled'
-0000ede0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000edf0: 2020 2761 6d6f 756e 7427 3a20 616d 6f75    'amount': amou
-0000ee00: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
-0000ee10: 2020 2020 2766 696c 6c65 6427 3a20 302e      'filled': 0.
-0000ee20: 302c 0a20 2020 2020 2020 2020 2020 2020  0,.             
-0000ee30: 2020 2027 6665 6527 3a20 7b7d 2c0a 2020     'fee': {},.  
-0000ee40: 2020 2020 2020 2020 2020 2020 2020 2769                'i
-0000ee50: 6e66 6f27 3a20 7b7d 0a20 2020 2020 2020  nfo': {}.       
-0000ee60: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
-0000ee70: 7265 7475 726e 206f 7264 6572 0a0a 2020  return order..  
-0000ee80: 2020 6465 6620 6361 6e63 656c 5f73 746f    def cancel_sto
-0000ee90: 706c 6f73 735f 6f72 6465 725f 7769 7468  ploss_order_with
-0000eea0: 5f72 6573 756c 7428 7365 6c66 2c20 6f72  _result(self, or
-0000eeb0: 6465 725f 6964 3a20 7374 722c 2070 6169  der_id: str, pai
-0000eec0: 723a 2073 7472 2c20 616d 6f75 6e74 3a20  r: str, amount: 
-0000eed0: 666c 6f61 7429 202d 3e20 4469 6374 3a0a  float) -> Dict:.
-0000eee0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000eef0: 2020 2020 4361 6e63 656c 2073 746f 706c      Cancel stopl
-0000ef00: 6f73 7320 6f72 6465 7220 7265 7475 726e  oss order return
-0000ef10: 696e 6720 6120 7265 7375 6c74 2e0a 2020  ing a result..  
-0000ef20: 2020 2020 2020 4372 6561 7465 7320 6120        Creates a 
-0000ef30: 6661 6b65 2072 6573 756c 7420 6966 2063  fake result if c
-0000ef40: 616e 6365 6c20 6f72 6465 7220 7265 7475  ancel order retu
-0000ef50: 726e 7320 6120 6e6f 6e2d 7573 6162 6c65  rns a non-usable
-0000ef60: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
-0000ef70: 616e 6420 6665 7463 685f 6f72 6465 7220  and fetch_order 
-0000ef80: 646f 6573 206e 6f74 2077 6f72 6b20 2863  does not work (c
-0000ef90: 6572 7461 696e 2065 7863 6861 6e67 6573  ertain exchanges
-0000efa0: 2064 6f6e 2774 2072 6574 7572 6e20 6361   don't return ca
-0000efb0: 6e63 656c 6c65 6420 6f72 6465 7273 290a  ncelled orders).
-0000efc0: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
-0000efd0: 7264 6572 5f69 643a 2073 746f 706c 6f73  rder_id: stoplos
-0000efe0: 732d 6f72 6465 722d 6964 2074 6f20 6361  s-order-id to ca
-0000eff0: 6e63 656c 0a20 2020 2020 2020 203a 7061  ncel.        :pa
-0000f000: 7261 6d20 7061 6972 3a20 5061 6972 2063  ram pair: Pair c
-0000f010: 6f72 7265 7370 6f6e 6469 6e67 2074 6f20  orresponding to 
-0000f020: 6f72 6465 725f 6964 0a20 2020 2020 2020  order_id.       
-0000f030: 203a 7061 7261 6d20 616d 6f75 6e74 3a20   :param amount: 
-0000f040: 416d 6f75 6e74 2074 6f20 7573 6520 666f  Amount to use fo
-0000f050: 7220 6661 6b65 2072 6573 706f 6e73 650a  r fake response.
-0000f060: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-0000f070: 2052 6573 756c 7420 6672 6f6d 2065 6974   Result from eit
-0000f080: 6865 7220 6361 6e63 656c 5f6f 7264 6572  her cancel_order
-0000f090: 2069 6620 7573 6162 6c65 2c20 6f72 2066   if usable, or f
-0000f0a0: 6574 6368 5f6f 7264 6572 0a20 2020 2020  etch_order.     
-0000f0b0: 2020 2022 2222 0a20 2020 2020 2020 2063     """.        c
-0000f0c0: 6f72 6465 7220 3d20 7365 6c66 2e63 616e  order = self.can
-0000f0d0: 6365 6c5f 7374 6f70 6c6f 7373 5f6f 7264  cel_stoploss_ord
-0000f0e0: 6572 286f 7264 6572 5f69 642c 2070 6169  er(order_id, pai
-0000f0f0: 7229 0a20 2020 2020 2020 2069 6620 7365  r).        if se
-0000f100: 6c66 2e69 735f 6361 6e63 656c 5f6f 7264  lf.is_cancel_ord
-0000f110: 6572 5f72 6573 756c 745f 7375 6974 6162  er_result_suitab
-0000f120: 6c65 2863 6f72 6465 7229 3a0a 2020 2020  le(corder):.    
-0000f130: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-0000f140: 6f72 6465 720a 2020 2020 2020 2020 7472  order.        tr
-0000f150: 793a 0a20 2020 2020 2020 2020 2020 206f  y:.            o
-0000f160: 7264 6572 203d 2073 656c 662e 6665 7463  rder = self.fetc
-0000f170: 685f 7374 6f70 6c6f 7373 5f6f 7264 6572  h_stoploss_order
-0000f180: 286f 7264 6572 5f69 642c 2070 6169 7229  (order_id, pair)
-0000f190: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0000f1a0: 496e 7661 6c69 644f 7264 6572 4578 6365  InvalidOrderExce
-0000f1b0: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
-0000f1c0: 2020 206c 6f67 6765 722e 7761 726e 696e     logger.warnin
-0000f1d0: 6728 6622 436f 756c 6420 6e6f 7420 6665  g(f"Could not fe
-0000f1e0: 7463 6820 6361 6e63 656c 6c65 6420 7374  tch cancelled st
-0000f1f0: 6f70 6c6f 7373 206f 7264 6572 207b 6f72  oploss order {or
-0000f200: 6465 725f 6964 7d2e 2229 0a20 2020 2020  der_id}.").     
-0000f210: 2020 2020 2020 206f 7264 6572 203d 207b         order = {
-0000f220: 2766 6565 273a 207b 7d2c 2027 7374 6174  'fee': {}, 'stat
-0000f230: 7573 273a 2027 6361 6e63 656c 6564 272c  us': 'canceled',
-0000f240: 2027 616d 6f75 6e74 273a 2061 6d6f 756e   'amount': amoun
-0000f250: 742c 2027 696e 666f 273a 207b 7d7d 0a0a  t, 'info': {}}..
-0000f260: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-0000f270: 7264 6572 0a0a 2020 2020 4072 6574 7269  rder..    @retri
-0000f280: 6572 0a20 2020 2064 6566 2067 6574 5f62  er.    def get_b
-0000f290: 616c 616e 6365 7328 7365 6c66 2920 2d3e  alances(self) ->
-0000f2a0: 2064 6963 743a 0a0a 2020 2020 2020 2020   dict:..        
-0000f2b0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0000f2c0: 2062 616c 616e 6365 7320 3d20 7365 6c66   balances = self
-0000f2d0: 2e5f 6170 692e 6665 7463 685f 6261 6c61  ._api.fetch_bala
-0000f2e0: 6e63 6528 290a 2020 2020 2020 2020 2020  nce().          
-0000f2f0: 2020 2320 5265 6d6f 7665 2061 6464 6974    # Remove addit
-0000f300: 696f 6e61 6c20 696e 666f 2066 726f 6d20  ional info from 
-0000f310: 6363 7874 2072 6573 756c 7473 0a20 2020  ccxt results.   
-0000f320: 2020 2020 2020 2020 2062 616c 616e 6365           balance
-0000f330: 732e 706f 7028 2269 6e66 6f22 2c20 4e6f  s.pop("info", No
-0000f340: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
-0000f350: 6261 6c61 6e63 6573 2e70 6f70 2822 6672  balances.pop("fr
-0000f360: 6565 222c 204e 6f6e 6529 0a20 2020 2020  ee", None).     
-0000f370: 2020 2020 2020 2062 616c 616e 6365 732e         balances.
-0000f380: 706f 7028 2274 6f74 616c 222c 204e 6f6e  pop("total", Non
-0000f390: 6529 0a20 2020 2020 2020 2020 2020 2062  e).            b
-0000f3a0: 616c 616e 6365 732e 706f 7028 2275 7365  alances.pop("use
-0000f3b0: 6422 2c20 4e6f 6e65 290a 0a20 2020 2020  d", None)..     
-0000f3c0: 2020 2020 2020 2072 6574 7572 6e20 6261         return ba
-0000f3d0: 6c61 6e63 6573 0a20 2020 2020 2020 2065  lances.        e
-0000f3e0: 7863 6570 7420 6363 7874 2e44 446f 5350  xcept ccxt.DDoSP
-0000f3f0: 726f 7465 6374 696f 6e20 6173 2065 3a0a  rotection as e:.
-0000f400: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000f410: 6520 4444 6f73 5072 6f74 6563 7469 6f6e  e DDosProtection
-0000f420: 2865 2920 6672 6f6d 2065 0a20 2020 2020  (e) from e.     
-0000f430: 2020 2065 7863 6570 7420 2863 6378 742e     except (ccxt.
-0000f440: 4e65 7477 6f72 6b45 7272 6f72 2c20 6363  NetworkError, cc
-0000f450: 7874 2e45 7863 6861 6e67 6545 7272 6f72  xt.ExchangeError
-0000f460: 2920 6173 2065 3a0a 2020 2020 2020 2020  ) as e:.        
-0000f470: 2020 2020 7261 6973 6520 5465 6d70 6f72      raise Tempor
-0000f480: 6172 7945 7272 6f72 280a 2020 2020 2020  aryError(.      
-0000f490: 2020 2020 2020 2020 2020 6627 436f 756c            f'Coul
-0000f4a0: 6420 6e6f 7420 6765 7420 6261 6c61 6e63  d not get balanc
-0000f4b0: 6520 6475 6520 746f 207b 652e 5f5f 636c  e due to {e.__cl
-0000f4c0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d2e  ass__.__name__}.
-0000f4d0: 204d 6573 7361 6765 3a20 7b65 7d27 2920   Message: {e}') 
-0000f4e0: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
-0000f4f0: 7863 6570 7420 6363 7874 2e42 6173 6545  xcept ccxt.BaseE
-0000f500: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
-0000f510: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
-0000f520: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
-0000f530: 6e28 6529 2066 726f 6d20 650a 0a20 2020  n(e) from e..   
-0000f540: 2040 7265 7472 6965 720a 2020 2020 6465   @retrier.    de
-0000f550: 6620 6665 7463 685f 706f 7369 7469 6f6e  f fetch_position
-0000f560: 7328 7365 6c66 2c20 7061 6972 3a20 4f70  s(self, pair: Op
-0000f570: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
-0000f580: 6e65 2920 2d3e 204c 6973 745b 4469 6374  ne) -> List[Dict
-0000f590: 5d3a 0a20 2020 2020 2020 2022 2222 0a20  ]:.        """. 
-0000f5a0: 2020 2020 2020 2046 6574 6368 2070 6f73         Fetch pos
-0000f5b0: 6974 696f 6e73 2066 726f 6d20 7468 6520  itions from the 
-0000f5c0: 6578 6368 616e 6765 2e0a 2020 2020 2020  exchange..      
-0000f5d0: 2020 4966 206e 6f20 7061 6972 2069 7320    If no pair is 
-0000f5e0: 6769 7665 6e2c 2061 6c6c 2070 6f73 6974  given, all posit
-0000f5f0: 696f 6e73 2061 7265 2072 6574 7572 6e65  ions are returne
-0000f600: 642e 0a20 2020 2020 2020 203a 7061 7261  d..        :para
-0000f610: 6d20 7061 6972 3a20 5061 6972 2066 6f72  m pair: Pair for
-0000f620: 2074 6865 2071 7565 7279 0a20 2020 2020   the query.     
-0000f630: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0000f640: 6620 7365 6c66 2e5f 636f 6e66 6967 5b27  f self._config['
-0000f650: 6472 795f 7275 6e27 5d20 6f72 2073 656c  dry_run'] or sel
-0000f660: 662e 7472 6164 696e 675f 6d6f 6465 2021  f.trading_mode !
-0000f670: 3d20 5472 6164 696e 674d 6f64 652e 4655  = TradingMode.FU
-0000f680: 5455 5245 533a 0a20 2020 2020 2020 2020  TURES:.         
-0000f690: 2020 2072 6574 7572 6e20 5b5d 0a20 2020     return [].   
-0000f6a0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-0000f6b0: 2020 2020 2020 7379 6d62 6f6c 7320 3d20        symbols = 
-0000f6c0: 5b5d 0a20 2020 2020 2020 2020 2020 2069  [].            i
-0000f6d0: 6620 7061 6972 3a0a 2020 2020 2020 2020  f pair:.        
-0000f6e0: 2020 2020 2020 2020 7379 6d62 6f6c 732e          symbols.
-0000f6f0: 6170 7065 6e64 2870 6169 7229 0a20 2020  append(pair).   
-0000f700: 2020 2020 2020 2020 2070 6f73 6974 696f           positio
-0000f710: 6e73 3a20 4c69 7374 5b44 6963 745d 203d  ns: List[Dict] =
-0000f720: 2073 656c 662e 5f61 7069 2e66 6574 6368   self._api.fetch
-0000f730: 5f70 6f73 6974 696f 6e73 2873 796d 626f  _positions(symbo
-0000f740: 6c73 290a 2020 2020 2020 2020 2020 2020  ls).            
-0000f750: 7365 6c66 2e5f 6c6f 675f 6578 6368 616e  self._log_exchan
-0000f760: 6765 5f72 6573 706f 6e73 6528 2766 6574  ge_response('fet
-0000f770: 6368 5f70 6f73 6974 696f 6e73 272c 2070  ch_positions', p
-0000f780: 6f73 6974 696f 6e73 290a 2020 2020 2020  ositions).      
-0000f790: 2020 2020 2020 7265 7475 726e 2070 6f73        return pos
-0000f7a0: 6974 696f 6e73 0a20 2020 2020 2020 2065  itions.        e
-0000f7b0: 7863 6570 7420 6363 7874 2e44 446f 5350  xcept ccxt.DDoSP
-0000f7c0: 726f 7465 6374 696f 6e20 6173 2065 3a0a  rotection as e:.
-0000f7d0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000f7e0: 6520 4444 6f73 5072 6f74 6563 7469 6f6e  e DDosProtection
-0000f7f0: 2865 2920 6672 6f6d 2065 0a20 2020 2020  (e) from e.     
-0000f800: 2020 2065 7863 6570 7420 2863 6378 742e     except (ccxt.
-0000f810: 4e65 7477 6f72 6b45 7272 6f72 2c20 6363  NetworkError, cc
-0000f820: 7874 2e45 7863 6861 6e67 6545 7272 6f72  xt.ExchangeError
-0000f830: 2920 6173 2065 3a0a 2020 2020 2020 2020  ) as e:.        
-0000f840: 2020 2020 7261 6973 6520 5465 6d70 6f72      raise Tempor
-0000f850: 6172 7945 7272 6f72 280a 2020 2020 2020  aryError(.      
-0000f860: 2020 2020 2020 2020 2020 6627 436f 756c            f'Coul
-0000f870: 6420 6e6f 7420 6765 7420 706f 7369 7469  d not get positi
-0000f880: 6f6e 7320 6475 6520 746f 207b 652e 5f5f  ons due to {e.__
-0000f890: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-0000f8a0: 7d2e 204d 6573 7361 6765 3a20 7b65 7d27  }. Message: {e}'
-0000f8b0: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
-0000f8c0: 2065 7863 6570 7420 6363 7874 2e42 6173   except ccxt.Bas
-0000f8d0: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
-0000f8e0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
-0000f8f0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
-0000f900: 696f 6e28 6529 2066 726f 6d20 650a 0a20  ion(e) from e.. 
-0000f910: 2020 2040 7265 7472 6965 7228 7265 7472     @retrier(retr
-0000f920: 6965 733d 3029 0a20 2020 2064 6566 2066  ies=0).    def f
-0000f930: 6574 6368 5f6f 7264 6572 7328 7365 6c66  etch_orders(self
-0000f940: 2c20 7061 6972 3a20 7374 722c 2073 696e  , pair: str, sin
-0000f950: 6365 3a20 6461 7465 7469 6d65 2920 2d3e  ce: datetime) ->
-0000f960: 204c 6973 745b 4469 6374 5d3a 0a20 2020   List[Dict]:.   
-0000f970: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000f980: 2046 6574 6368 2061 6c6c 206f 7264 6572   Fetch all order
-0000f990: 7320 666f 7220 6120 7061 6972 2022 7369  s for a pair "si
-0000f9a0: 6e63 6522 0a20 2020 2020 2020 203a 7061  nce".        :pa
-0000f9b0: 7261 6d20 7061 6972 3a20 5061 6972 2066  ram pair: Pair f
-0000f9c0: 6f72 2074 6865 2071 7565 7279 0a20 2020  or the query.   
-0000f9d0: 2020 2020 203a 7061 7261 6d20 7369 6e63       :param sinc
-0000f9e0: 653a 2053 7461 7274 696e 6720 7469 6d65  e: Starting time
-0000f9f0: 2066 6f72 2074 6865 2071 7565 7279 0a20   for the query. 
-0000fa00: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000fa10: 2020 2069 6620 7365 6c66 2e5f 636f 6e66     if self._conf
-0000fa20: 6967 5b27 6472 795f 7275 6e27 5d3a 0a20  ig['dry_run']:. 
-0000fa30: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000fa40: 6e20 5b5d 0a0a 2020 2020 2020 2020 6465  n []..        de
-0000fa50: 6620 6665 7463 685f 6f72 6465 7273 5f65  f fetch_orders_e
-0000fa60: 6d75 6c61 7465 2829 202d 3e20 4c69 7374  mulate() -> List
-0000fa70: 5b44 6963 745d 3a0a 2020 2020 2020 2020  [Dict]:.        
-0000fa80: 2020 2020 6f72 6465 7273 203d 205b 5d0a      orders = [].
-0000fa90: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0000faa0: 656c 662e 6578 6368 616e 6765 5f68 6173  elf.exchange_has
-0000fab0: 2827 6665 7463 6843 6c6f 7365 644f 7264  ('fetchClosedOrd
-0000fac0: 6572 7327 293a 0a20 2020 2020 2020 2020  ers'):.         
-0000fad0: 2020 2020 2020 206f 7264 6572 7320 3d20         orders = 
-0000fae0: 7365 6c66 2e5f 6170 692e 6665 7463 685f  self._api.fetch_
-0000faf0: 636c 6f73 6564 5f6f 7264 6572 7328 7061  closed_orders(pa
-0000fb00: 6972 2c20 7369 6e63 653d 7369 6e63 655f  ir, since=since_
-0000fb10: 6d73 290a 2020 2020 2020 2020 2020 2020  ms).            
-0000fb20: 2020 2020 6966 2073 656c 662e 6578 6368      if self.exch
-0000fb30: 616e 6765 5f68 6173 2827 6665 7463 684f  ange_has('fetchO
-0000fb40: 7065 6e4f 7264 6572 7327 293a 0a20 2020  penOrders'):.   
-0000fb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fb60: 206f 7264 6572 735f 6f70 656e 203d 2073   orders_open = s
-0000fb70: 656c 662e 5f61 7069 2e66 6574 6368 5f6f  elf._api.fetch_o
-0000fb80: 7065 6e5f 6f72 6465 7273 2870 6169 722c  pen_orders(pair,
-0000fb90: 2073 696e 6365 3d73 696e 6365 5f6d 7329   since=since_ms)
-0000fba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fbb0: 2020 2020 206f 7264 6572 732e 6578 7465       orders.exte
-0000fbc0: 6e64 286f 7264 6572 735f 6f70 656e 290a  nd(orders_open).
-0000fbd0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000fbe0: 726e 206f 7264 6572 730a 0a20 2020 2020  rn orders..     
-0000fbf0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000fc00: 2020 2020 7369 6e63 655f 6d73 203d 2069      since_ms = i
-0000fc10: 6e74 2828 7369 6e63 652e 7469 6d65 7374  nt((since.timest
-0000fc20: 616d 7028 2920 2d20 3130 2920 2a20 3130  amp() - 10) * 10
-0000fc30: 3030 290a 2020 2020 2020 2020 2020 2020  00).            
-0000fc40: 6966 2073 656c 662e 6578 6368 616e 6765  if self.exchange
-0000fc50: 5f68 6173 2827 6665 7463 684f 7264 6572  _has('fetchOrder
-0000fc60: 7327 293a 0a20 2020 2020 2020 2020 2020  s'):.           
-0000fc70: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-0000fc80: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-0000fc90: 6465 7273 3a20 4c69 7374 5b44 6963 745d  ders: List[Dict]
-0000fca0: 203d 2073 656c 662e 5f61 7069 2e66 6574   = self._api.fet
-0000fcb0: 6368 5f6f 7264 6572 7328 7061 6972 2c20  ch_orders(pair, 
-0000fcc0: 7369 6e63 653d 7369 6e63 655f 6d73 290a  since=since_ms).
-0000fcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fce0: 6578 6365 7074 2063 6378 742e 4e6f 7453  except ccxt.NotS
-0000fcf0: 7570 706f 7274 6564 3a0a 2020 2020 2020  upported:.      
-0000fd00: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000fd10: 536f 6d65 2065 7863 6861 6e67 6573 2064  Some exchanges d
-0000fd20: 6f6e 2774 2073 7570 706f 7274 2066 6574  on't support fet
-0000fd30: 6368 4f72 6465 7273 0a20 2020 2020 2020  chOrders.       
-0000fd40: 2020 2020 2020 2020 2020 2020 2023 2061               # a
-0000fd50: 7474 656d 7074 2074 6f20 6665 7463 6820  ttempt to fetch 
-0000fd60: 6f70 656e 2061 6e64 2063 6c6f 7365 6420  open and closed 
-0000fd70: 6f72 6465 7273 2073 6570 6172 6174 656c  orders separatel
-0000fd80: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
-0000fd90: 2020 2020 2020 6f72 6465 7273 203d 2066        orders = f
-0000fda0: 6574 6368 5f6f 7264 6572 735f 656d 756c  etch_orders_emul
-0000fdb0: 6174 6528 290a 2020 2020 2020 2020 2020  ate().          
-0000fdc0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000fdd0: 2020 2020 2020 2020 6f72 6465 7273 203d          orders =
-0000fde0: 2066 6574 6368 5f6f 7264 6572 735f 656d   fetch_orders_em
-0000fdf0: 756c 6174 6528 290a 2020 2020 2020 2020  ulate().        
-0000fe00: 2020 2020 7365 6c66 2e5f 6c6f 675f 6578      self._log_ex
-0000fe10: 6368 616e 6765 5f72 6573 706f 6e73 6528  change_response(
-0000fe20: 2766 6574 6368 5f6f 7264 6572 7327 2c20  'fetch_orders', 
-0000fe30: 6f72 6465 7273 290a 2020 2020 2020 2020  orders).        
-0000fe40: 2020 2020 6f72 6465 7273 203d 205b 7365      orders = [se
-0000fe50: 6c66 2e5f 6f72 6465 725f 636f 6e74 7261  lf._order_contra
-0000fe60: 6374 735f 746f 5f61 6d6f 756e 7428 6f29  cts_to_amount(o)
-0000fe70: 2066 6f72 206f 2069 6e20 6f72 6465 7273   for o in orders
-0000fe80: 5d0a 2020 2020 2020 2020 2020 2020 7265  ].            re
-0000fe90: 7475 726e 206f 7264 6572 730a 2020 2020  turn orders.    
-0000fea0: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
-0000feb0: 4444 6f53 5072 6f74 6563 7469 6f6e 2061  DDoSProtection a
-0000fec0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-0000fed0: 2072 6169 7365 2044 446f 7350 726f 7465   raise DDosProte
-0000fee0: 6374 696f 6e28 6529 2066 726f 6d20 650a  ction(e) from e.
-0000fef0: 2020 2020 2020 2020 6578 6365 7074 2028          except (
-0000ff00: 6363 7874 2e4e 6574 776f 726b 4572 726f  ccxt.NetworkErro
-0000ff10: 722c 2063 6378 742e 4578 6368 616e 6765  r, ccxt.Exchange
-0000ff20: 4572 726f 7229 2061 7320 653a 0a20 2020  Error) as e:.   
-0000ff30: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
-0000ff40: 656d 706f 7261 7279 4572 726f 7228 0a20  emporaryError(. 
-0000ff50: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000ff60: 2743 6f75 6c64 206e 6f74 2066 6574 6368  'Could not fetch
-0000ff70: 2070 6f73 6974 696f 6e73 2064 7565 2074   positions due t
-0000ff80: 6f20 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f  o {e.__class__._
-0000ff90: 5f6e 616d 655f 5f7d 2e20 4d65 7373 6167  _name__}. Messag
-0000ffa0: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
-0000ffb0: 2020 2020 2020 2020 6578 6365 7074 2063          except c
-0000ffc0: 6378 742e 4261 7365 4572 726f 7220 6173  cxt.BaseError as
-0000ffd0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0000ffe0: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
-0000fff0: 6c45 7863 6570 7469 6f6e 2865 2920 6672  lException(e) fr
-00010000: 6f6d 2065 0a0a 2020 2020 4072 6574 7269  om e..    @retri
-00010010: 6572 0a20 2020 2064 6566 2066 6574 6368  er.    def fetch
-00010020: 5f74 7261 6469 6e67 5f66 6565 7328 7365  _trading_fees(se
-00010030: 6c66 2920 2d3e 2044 6963 745b 7374 722c  lf) -> Dict[str,
-00010040: 2041 6e79 5d3a 0a20 2020 2020 2020 2022   Any]:.        "
-00010050: 2222 0a20 2020 2020 2020 2046 6574 6368  "".        Fetch
-00010060: 2075 7365 7220 6163 636f 756e 7420 7472   user account tr
-00010070: 6164 696e 6720 6665 6573 0a20 2020 2020  ading fees.     
-00010080: 2020 2043 616e 2062 6520 6361 6368 6564     Can be cached
-00010090: 2c20 7368 6f75 6c64 206e 6f74 2075 7064  , should not upd
-000100a0: 6174 6520 6f66 7465 6e2e 0a20 2020 2020  ate often..     
-000100b0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-000100c0: 6620 2873 656c 662e 5f63 6f6e 6669 675b  f (self._config[
-000100d0: 2764 7279 5f72 756e 275d 206f 7220 7365  'dry_run'] or se
-000100e0: 6c66 2e74 7261 6469 6e67 5f6d 6f64 6520  lf.trading_mode 
-000100f0: 213d 2054 7261 6469 6e67 4d6f 6465 2e46  != TradingMode.F
-00010100: 5554 5552 4553 0a20 2020 2020 2020 2020  UTURES.         
-00010110: 2020 2020 2020 206f 7220 6e6f 7420 7365         or not se
-00010120: 6c66 2e65 7863 6861 6e67 655f 6861 7328  lf.exchange_has(
-00010130: 2766 6574 6368 5472 6164 696e 6746 6565  'fetchTradingFee
-00010140: 7327 2929 3a0a 2020 2020 2020 2020 2020  s')):.          
-00010150: 2020 7265 7475 726e 207b 7d0a 2020 2020    return {}.    
-00010160: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00010170: 2020 2020 2074 7261 6469 6e67 5f66 6565       trading_fee
-00010180: 733a 2044 6963 745b 7374 722c 2041 6e79  s: Dict[str, Any
-00010190: 5d20 3d20 7365 6c66 2e5f 6170 692e 6665  ] = self._api.fe
-000101a0: 7463 685f 7472 6164 696e 675f 6665 6573  tch_trading_fees
-000101b0: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
-000101c0: 656c 662e 5f6c 6f67 5f65 7863 6861 6e67  elf._log_exchang
-000101d0: 655f 7265 7370 6f6e 7365 2827 6665 7463  e_response('fetc
-000101e0: 685f 7472 6164 696e 675f 6665 6573 272c  h_trading_fees',
-000101f0: 2074 7261 6469 6e67 5f66 6565 7329 0a20   trading_fees). 
-00010200: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00010210: 6e20 7472 6164 696e 675f 6665 6573 0a20  n trading_fees. 
-00010220: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
-00010230: 7874 2e44 446f 5350 726f 7465 6374 696f  xt.DDoSProtectio
-00010240: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
-00010250: 2020 2020 7261 6973 6520 4444 6f73 5072      raise DDosPr
-00010260: 6f74 6563 7469 6f6e 2865 2920 6672 6f6d  otection(e) from
-00010270: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
-00010280: 7420 2863 6378 742e 4e65 7477 6f72 6b45  t (ccxt.NetworkE
-00010290: 7272 6f72 2c20 6363 7874 2e45 7863 6861  rror, ccxt.Excha
-000102a0: 6e67 6545 7272 6f72 2920 6173 2065 3a0a  ngeError) as e:.
-000102b0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000102c0: 6520 5465 6d70 6f72 6172 7945 7272 6f72  e TemporaryError
-000102d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000102e0: 2020 6627 436f 756c 6420 6e6f 7420 6665    f'Could not fe
-000102f0: 7463 6820 7472 6164 696e 6720 6665 6573  tch trading fees
-00010300: 2064 7565 2074 6f20 7b65 2e5f 5f63 6c61   due to {e.__cla
-00010310: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20  ss__.__name__}. 
-00010320: 4d65 7373 6167 653a 207b 657d 2729 2066  Message: {e}') f
-00010330: 726f 6d20 650a 2020 2020 2020 2020 6578  rom e.        ex
-00010340: 6365 7074 2063 6378 742e 4261 7365 4572  cept ccxt.BaseEr
-00010350: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
-00010360: 2020 2020 2020 7261 6973 6520 4f70 6572        raise Oper
-00010370: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
-00010380: 2865 2920 6672 6f6d 2065 0a0a 2020 2020  (e) from e..    
-00010390: 4072 6574 7269 6572 0a20 2020 2064 6566  @retrier.    def
-000103a0: 2066 6574 6368 5f62 6964 735f 6173 6b73   fetch_bids_asks
-000103b0: 2873 656c 662c 2073 796d 626f 6c73 3a20  (self, symbols: 
-000103c0: 4f70 7469 6f6e 616c 5b4c 6973 745b 7374  Optional[List[st
-000103d0: 725d 5d20 3d20 4e6f 6e65 2c20 6361 6368  r]] = None, cach
-000103e0: 6564 3a20 626f 6f6c 203d 2046 616c 7365  ed: bool = False
-000103f0: 2920 2d3e 2044 6963 743a 0a20 2020 2020  ) -> Dict:.     
-00010400: 2020 2022 2222 0a20 2020 2020 2020 203a     """.        :
-00010410: 7061 7261 6d20 6361 6368 6564 3a20 416c  param cached: Al
-00010420: 6c6f 7720 6361 6368 6564 2072 6573 756c  low cached resul
-00010430: 740a 2020 2020 2020 2020 3a72 6574 7572  t.        :retur
-00010440: 6e3a 2066 6574 6368 5f74 6963 6b65 7273  n: fetch_tickers
-00010450: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
-00010460: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
-00010470: 6f74 2073 656c 662e 6578 6368 616e 6765  ot self.exchange
-00010480: 5f68 6173 2827 6665 7463 6842 6964 7341  _has('fetchBidsA
-00010490: 736b 7327 293a 0a20 2020 2020 2020 2020  sks'):.         
-000104a0: 2020 2072 6574 7572 6e20 7b7d 0a20 2020     return {}.   
-000104b0: 2020 2020 2069 6620 6361 6368 6564 3a0a       if cached:.
-000104c0: 2020 2020 2020 2020 2020 2020 7769 7468              with
-000104d0: 2073 656c 662e 5f63 6163 6865 5f6c 6f63   self._cache_loc
-000104e0: 6b3a 0a20 2020 2020 2020 2020 2020 2020  k:.             
-000104f0: 2020 2074 6963 6b65 7273 203d 2073 656c     tickers = sel
-00010500: 662e 5f66 6574 6368 5f74 6963 6b65 7273  f._fetch_tickers
-00010510: 5f63 6163 6865 2e67 6574 2827 6665 7463  _cache.get('fetc
-00010520: 685f 6269 6473 5f61 736b 7327 290a 2020  h_bids_asks').  
-00010530: 2020 2020 2020 2020 2020 6966 2074 6963            if tic
-00010540: 6b65 7273 3a0a 2020 2020 2020 2020 2020  kers:.          
-00010550: 2020 2020 2020 7265 7475 726e 2074 6963        return tic
-00010560: 6b65 7273 0a20 2020 2020 2020 2074 7279  kers.        try
-00010570: 3a0a 2020 2020 2020 2020 2020 2020 7469  :.            ti
-00010580: 636b 6572 7320 3d20 7365 6c66 2e5f 6170  ckers = self._ap
-00010590: 692e 6665 7463 685f 6269 6473 5f61 736b  i.fetch_bids_ask
-000105a0: 7328 7379 6d62 6f6c 7329 0a20 2020 2020  s(symbols).     
-000105b0: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-000105c0: 2e5f 6361 6368 655f 6c6f 636b 3a0a 2020  ._cache_lock:.  
-000105d0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000105e0: 6c66 2e5f 6665 7463 685f 7469 636b 6572  lf._fetch_ticker
-000105f0: 735f 6361 6368 655b 2766 6574 6368 5f62  s_cache['fetch_b
-00010600: 6964 735f 6173 6b73 275d 203d 2074 6963  ids_asks'] = tic
-00010610: 6b65 7273 0a20 2020 2020 2020 2020 2020  kers.           
-00010620: 2072 6574 7572 6e20 7469 636b 6572 730a   return tickers.
-00010630: 2020 2020 2020 2020 6578 6365 7074 2063          except c
-00010640: 6378 742e 4e6f 7453 7570 706f 7274 6564  cxt.NotSupported
-00010650: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-00010660: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
-00010670: 6f6e 616c 4578 6365 7074 696f 6e28 0a20  onalException(. 
-00010680: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00010690: 2745 7863 6861 6e67 6520 7b73 656c 662e  'Exchange {self.
-000106a0: 5f61 7069 2e6e 616d 657d 2064 6f65 7320  _api.name} does 
-000106b0: 6e6f 7420 7375 7070 6f72 7420 6665 7463  not support fetc
-000106c0: 6869 6e67 2062 6964 732f 6173 6b73 2069  hing bids/asks i
-000106d0: 6e20 6261 7463 682e 2027 0a20 2020 2020  n batch. '.     
-000106e0: 2020 2020 2020 2020 2020 2066 274d 6573             f'Mes
-000106f0: 7361 6765 3a20 7b65 7d27 2920 6672 6f6d  sage: {e}') from
-00010700: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
-00010710: 7420 6363 7874 2e44 446f 5350 726f 7465  t ccxt.DDoSProte
-00010720: 6374 696f 6e20 6173 2065 3a0a 2020 2020  ction as e:.    
-00010730: 2020 2020 2020 2020 7261 6973 6520 4444          raise DD
-00010740: 6f73 5072 6f74 6563 7469 6f6e 2865 2920  osProtection(e) 
-00010750: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
-00010760: 7863 6570 7420 2863 6378 742e 4e65 7477  xcept (ccxt.Netw
-00010770: 6f72 6b45 7272 6f72 2c20 6363 7874 2e45  orkError, ccxt.E
-00010780: 7863 6861 6e67 6545 7272 6f72 2920 6173  xchangeError) as
-00010790: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-000107a0: 7261 6973 6520 5465 6d70 6f72 6172 7945  raise TemporaryE
-000107b0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-000107c0: 2020 2020 2020 6627 436f 756c 6420 6e6f        f'Could no
-000107d0: 7420 6c6f 6164 2062 6964 732f 6173 6b73  t load bids/asks
-000107e0: 2064 7565 2074 6f20 7b65 2e5f 5f63 6c61   due to {e.__cla
-000107f0: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20  ss__.__name__}. 
-00010800: 4d65 7373 6167 653a 207b 657d 2729 2066  Message: {e}') f
-00010810: 726f 6d20 650a 2020 2020 2020 2020 6578  rom e.        ex
-00010820: 6365 7074 2063 6378 742e 4261 7365 4572  cept ccxt.BaseEr
-00010830: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
-00010840: 2020 2020 2020 7261 6973 6520 4f70 6572        raise Oper
-00010850: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
-00010860: 2865 2920 6672 6f6d 2065 0a0a 2020 2020  (e) from e..    
-00010870: 4072 6574 7269 6572 0a20 2020 2064 6566  @retrier.    def
-00010880: 2067 6574 5f74 6963 6b65 7273 2873 656c   get_tickers(sel
-00010890: 662c 2073 796d 626f 6c73 3a20 4f70 7469  f, symbols: Opti
-000108a0: 6f6e 616c 5b4c 6973 745b 7374 725d 5d20  onal[List[str]] 
-000108b0: 3d20 4e6f 6e65 2c20 6361 6368 6564 3a20  = None, cached: 
-000108c0: 626f 6f6c 203d 2046 616c 7365 2920 2d3e  bool = False) ->
-000108d0: 2054 6963 6b65 7273 3a0a 2020 2020 2020   Tickers:.      
-000108e0: 2020 2222 220a 2020 2020 2020 2020 3a70    """.        :p
-000108f0: 6172 616d 2063 6163 6865 643a 2041 6c6c  aram cached: All
-00010900: 6f77 2063 6163 6865 6420 7265 7375 6c74  ow cached result
-00010910: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-00010920: 3a20 6665 7463 685f 7469 636b 6572 7320  : fetch_tickers 
-00010930: 7265 7375 6c74 0a20 2020 2020 2020 2022  result.        "
-00010940: 2222 0a20 2020 2020 2020 2074 6963 6b65  "".        ticke
-00010950: 7273 3a20 5469 636b 6572 730a 2020 2020  rs: Tickers.    
-00010960: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-00010970: 6578 6368 616e 6765 5f68 6173 2827 6665  exchange_has('fe
-00010980: 7463 6854 6963 6b65 7273 2729 3a0a 2020  tchTickers'):.  
-00010990: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000109a0: 207b 7d0a 2020 2020 2020 2020 6966 2063   {}.        if c
-000109b0: 6163 6865 643a 0a20 2020 2020 2020 2020  ached:.         
-000109c0: 2020 2077 6974 6820 7365 6c66 2e5f 6361     with self._ca
-000109d0: 6368 655f 6c6f 636b 3a0a 2020 2020 2020  che_lock:.      
-000109e0: 2020 2020 2020 2020 2020 7469 636b 6572            ticker
-000109f0: 7320 3d20 7365 6c66 2e5f 6665 7463 685f  s = self._fetch_
-00010a00: 7469 636b 6572 735f 6361 6368 652e 6765  tickers_cache.ge
-00010a10: 7428 2766 6574 6368 5f74 6963 6b65 7273  t('fetch_tickers
-00010a20: 2729 2020 2320 7479 7065 3a20 6967 6e6f  ')  # type: igno
-00010a30: 7265 0a20 2020 2020 2020 2020 2020 2069  re.            i
-00010a40: 6620 7469 636b 6572 733a 0a20 2020 2020  f tickers:.     
-00010a50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00010a60: 6e20 7469 636b 6572 730a 2020 2020 2020  n tickers.      
-00010a70: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00010a80: 2020 2074 6963 6b65 7273 203d 2073 656c     tickers = sel
-00010a90: 662e 5f61 7069 2e66 6574 6368 5f74 6963  f._api.fetch_tic
-00010aa0: 6b65 7273 2873 796d 626f 6c73 290a 2020  kers(symbols).  
-00010ab0: 2020 2020 2020 2020 2020 7769 7468 2073            with s
-00010ac0: 656c 662e 5f63 6163 6865 5f6c 6f63 6b3a  elf._cache_lock:
-00010ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010ae0: 2073 656c 662e 5f66 6574 6368 5f74 6963   self._fetch_tic
-00010af0: 6b65 7273 5f63 6163 6865 5b27 6665 7463  kers_cache['fetc
-00010b00: 685f 7469 636b 6572 7327 5d20 3d20 7469  h_tickers'] = ti
-00010b10: 636b 6572 730a 2020 2020 2020 2020 2020  ckers.          
-00010b20: 2020 7265 7475 726e 2074 6963 6b65 7273    return tickers
-00010b30: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00010b40: 6363 7874 2e4e 6f74 5375 7070 6f72 7465  ccxt.NotSupporte
-00010b50: 6420 6173 2065 3a0a 2020 2020 2020 2020  d as e:.        
-00010b60: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
-00010b70: 696f 6e61 6c45 7863 6570 7469 6f6e 280a  ionalException(.
-00010b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b90: 6627 4578 6368 616e 6765 207b 7365 6c66  f'Exchange {self
-00010ba0: 2e5f 6170 692e 6e61 6d65 7d20 646f 6573  ._api.name} does
-00010bb0: 206e 6f74 2073 7570 706f 7274 2066 6574   not support fet
-00010bc0: 6368 696e 6720 7469 636b 6572 7320 696e  ching tickers in
-00010bd0: 2062 6174 6368 2e20 270a 2020 2020 2020   batch. '.      
-00010be0: 2020 2020 2020 2020 2020 6627 4d65 7373            f'Mess
-00010bf0: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
-00010c00: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-00010c10: 2063 6378 742e 4444 6f53 5072 6f74 6563   ccxt.DDoSProtec
-00010c20: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
-00010c30: 2020 2020 2020 2072 6169 7365 2044 446f         raise DDo
-00010c40: 7350 726f 7465 6374 696f 6e28 6529 2066  sProtection(e) f
-00010c50: 726f 6d20 650a 2020 2020 2020 2020 6578  rom e.        ex
-00010c60: 6365 7074 2028 6363 7874 2e4e 6574 776f  cept (ccxt.Netwo
-00010c70: 726b 4572 726f 722c 2063 6378 742e 4578  rkError, ccxt.Ex
-00010c80: 6368 616e 6765 4572 726f 7229 2061 7320  changeError) as 
-00010c90: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00010ca0: 6169 7365 2054 656d 706f 7261 7279 4572  aise TemporaryEr
-00010cb0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00010cc0: 2020 2020 2066 2743 6f75 6c64 206e 6f74       f'Could not
-00010cd0: 206c 6f61 6420 7469 636b 6572 7320 6475   load tickers du
-00010ce0: 6520 746f 207b 652e 5f5f 636c 6173 735f  e to {e.__class_
-00010cf0: 5f2e 5f5f 6e61 6d65 5f5f 7d2e 204d 6573  _.__name__}. Mes
-00010d00: 7361 6765 3a20 7b65 7d27 2920 6672 6f6d  sage: {e}') from
-00010d10: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
-00010d20: 7420 6363 7874 2e42 6173 6545 7272 6f72  t ccxt.BaseError
-00010d30: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-00010d40: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
-00010d50: 6f6e 616c 4578 6365 7074 696f 6e28 6529  onalException(e)
-00010d60: 2066 726f 6d20 650a 0a20 2020 2023 2050   from e..    # P
-00010d70: 7269 6369 6e67 2069 6e66 6f0a 0a20 2020  ricing info..   
-00010d80: 2040 7265 7472 6965 720a 2020 2020 6465   @retrier.    de
-00010d90: 6620 6665 7463 685f 7469 636b 6572 2873  f fetch_ticker(s
-00010da0: 656c 662c 2070 6169 723a 2073 7472 2920  elf, pair: str) 
-00010db0: 2d3e 2054 6963 6b65 723a 0a20 2020 2020  -> Ticker:.     
-00010dc0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00010dd0: 2020 2020 6966 2028 7061 6972 206e 6f74      if (pair not
-00010de0: 2069 6e20 7365 6c66 2e6d 6172 6b65 7473   in self.markets
-00010df0: 206f 720a 2020 2020 2020 2020 2020 2020   or.            
-00010e00: 2020 2020 2020 2020 7365 6c66 2e6d 6172          self.mar
-00010e10: 6b65 7473 5b70 6169 725d 2e67 6574 2827  kets[pair].get('
-00010e20: 6163 7469 7665 272c 2046 616c 7365 2920  active', False) 
-00010e30: 6973 2046 616c 7365 293a 0a20 2020 2020  is False):.     
-00010e40: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00010e50: 2045 7863 6861 6e67 6545 7272 6f72 2866   ExchangeError(f
-00010e60: 2250 6169 7220 7b70 6169 727d 206e 6f74  "Pair {pair} not
-00010e70: 2061 7661 696c 6162 6c65 2229 0a20 2020   available").   
-00010e80: 2020 2020 2020 2020 2064 6174 613a 2054           data: T
-00010e90: 6963 6b65 7220 3d20 7365 6c66 2e5f 6170  icker = self._ap
-00010ea0: 692e 6665 7463 685f 7469 636b 6572 2870  i.fetch_ticker(p
-00010eb0: 6169 7229 0a20 2020 2020 2020 2020 2020  air).           
-00010ec0: 2072 6574 7572 6e20 6461 7461 0a20 2020   return data.   
-00010ed0: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
-00010ee0: 2e44 446f 5350 726f 7465 6374 696f 6e20  .DDoSProtection 
-00010ef0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-00010f00: 2020 7261 6973 6520 4444 6f73 5072 6f74    raise DDosProt
-00010f10: 6563 7469 6f6e 2865 2920 6672 6f6d 2065  ection(e) from e
-00010f20: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00010f30: 2863 6378 742e 4e65 7477 6f72 6b45 7272  (ccxt.NetworkErr
-00010f40: 6f72 2c20 6363 7874 2e45 7863 6861 6e67  or, ccxt.Exchang
-00010f50: 6545 7272 6f72 2920 6173 2065 3a0a 2020  eError) as e:.  
-00010f60: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00010f70: 5465 6d70 6f72 6172 7945 7272 6f72 280a  TemporaryError(.
-00010f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f90: 6627 436f 756c 6420 6e6f 7420 6c6f 6164  f'Could not load
-00010fa0: 2074 6963 6b65 7220 6475 6520 746f 207b   ticker due to {
-00010fb0: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
-00010fc0: 6d65 5f5f 7d2e 204d 6573 7361 6765 3a20  me__}. Message: 
-00010fd0: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
-00010fe0: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
-00010ff0: 2e42 6173 6545 7272 6f72 2061 7320 653a  .BaseError as e:
-00011000: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00011010: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
-00011020: 6365 7074 696f 6e28 6529 2066 726f 6d20  ception(e) from 
-00011030: 650a 0a20 2020 2040 7374 6174 6963 6d65  e..    @staticme
-00011040: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
-00011050: 5f6e 6578 745f 6c69 6d69 745f 696e 5f6c  _next_limit_in_l
-00011060: 6973 7428 6c69 6d69 743a 2069 6e74 2c20  ist(limit: int, 
-00011070: 6c69 6d69 745f 7261 6e67 653a 204f 7074  limit_range: Opt
-00011080: 696f 6e61 6c5b 4c69 7374 5b69 6e74 5d5d  ional[List[int]]
-00011090: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000dff0: 2020 2020 2020 2020 2020 2073 746f 706c             stopl
+0000e000: 6f73 735f 6f72 6465 723a 2062 6f6f 6c20  oss_order: bool 
+0000e010: 3d20 4661 6c73 6529 202d 3e20 4469 6374  = False) -> Dict
+0000e020: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000e030: 2020 2020 2020 5369 6d70 6c65 2077 7261        Simple wra
+0000e040: 7070 6572 2063 616c 6c69 6e67 2065 6974  pper calling eit
+0000e050: 6865 7220 6665 7463 685f 6f72 6465 7220  her fetch_order 
+0000e060: 6f72 2066 6574 6368 5f73 746f 706c 6f73  or fetch_stoplos
+0000e070: 735f 6f72 6465 7220 6465 7065 6e64 696e  s_order dependin
+0000e080: 6720 6f6e 0a20 2020 2020 2020 2074 6865  g on.        the
+0000e090: 2073 746f 706c 6f73 735f 6f72 6465 7220   stoploss_order 
+0000e0a0: 7061 7261 6d65 7465 720a 2020 2020 2020  parameter.      
+0000e0b0: 2020 3a70 6172 616d 206f 7264 6572 5f69    :param order_i
+0000e0c0: 643a 204f 7264 6572 4964 2074 6f20 6665  d: OrderId to fe
+0000e0d0: 7463 6820 6f72 6465 720a 2020 2020 2020  tch order.      
+0000e0e0: 2020 3a70 6172 616d 2070 6169 723a 2050    :param pair: P
+0000e0f0: 6169 7220 636f 7272 6573 706f 6e64 696e  air correspondin
+0000e100: 6720 746f 206f 7264 6572 5f69 640a 2020  g to order_id.  
+0000e110: 2020 2020 2020 3a70 6172 616d 2073 746f        :param sto
+0000e120: 706c 6f73 735f 6f72 6465 723a 2049 6620  ploss_order: If 
+0000e130: 7472 7565 2c20 7573 6573 2066 6574 6368  true, uses fetch
+0000e140: 5f73 746f 706c 6f73 735f 6f72 6465 722c  _stoploss_order,
+0000e150: 206f 7468 6572 7769 7365 2066 6574 6368   otherwise fetch
+0000e160: 5f6f 7264 6572 2e0a 2020 2020 2020 2020  _order..        
+0000e170: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
+0000e180: 746f 706c 6f73 735f 6f72 6465 723a 0a20  toploss_order:. 
+0000e190: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000e1a0: 6e20 7365 6c66 2e66 6574 6368 5f73 746f  n self.fetch_sto
+0000e1b0: 706c 6f73 735f 6f72 6465 7228 6f72 6465  ploss_order(orde
+0000e1c0: 725f 6964 2c20 7061 6972 290a 2020 2020  r_id, pair).    
+0000e1d0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000e1e0: 6665 7463 685f 6f72 6465 7228 6f72 6465  fetch_order(orde
+0000e1f0: 725f 6964 2c20 7061 6972 290a 0a20 2020  r_id, pair)..   
+0000e200: 2064 6566 2063 6865 636b 5f6f 7264 6572   def check_order
+0000e210: 5f63 616e 6365 6c65 645f 656d 7074 7928  _canceled_empty(
+0000e220: 7365 6c66 2c20 6f72 6465 723a 2044 6963  self, order: Dic
+0000e230: 7429 202d 3e20 626f 6f6c 3a0a 2020 2020  t) -> bool:.    
+0000e240: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000e250: 5665 7269 6679 2069 6620 616e 206f 7264  Verify if an ord
+0000e260: 6572 2068 6173 2062 6565 6e20 6361 6e63  er has been canc
+0000e270: 656c 6c65 6420 7769 7468 6f75 7420 6265  elled without be
+0000e280: 696e 6720 7061 7274 6961 6c6c 7920 6669  ing partially fi
+0000e290: 6c6c 6564 0a20 2020 2020 2020 203a 7061  lled.        :pa
+0000e2a0: 7261 6d20 6f72 6465 723a 204f 7264 6572  ram order: Order
+0000e2b0: 2064 6963 7420 6173 2072 6574 7572 6e65   dict as returne
+0000e2c0: 6420 6672 6f6d 2066 6574 6368 5f6f 7264  d from fetch_ord
+0000e2d0: 6572 2829 0a20 2020 2020 2020 203a 7265  er().        :re
+0000e2e0: 7475 726e 3a20 5472 7565 2069 6620 6f72  turn: True if or
+0000e2f0: 6465 7220 6861 7320 6265 656e 2063 616e  der has been can
+0000e300: 6365 6c6c 6564 2077 6974 686f 7574 2062  celled without b
+0000e310: 6569 6e67 2066 696c 6c65 642c 2046 616c  eing filled, Fal
+0000e320: 7365 206f 7468 6572 7769 7365 2e0a 2020  se otherwise..  
+0000e330: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000e340: 2020 7265 7475 726e 2028 6f72 6465 722e    return (order.
+0000e350: 6765 7428 2773 7461 7475 7327 2920 696e  get('status') in
+0000e360: 204e 4f4e 5f4f 5045 4e5f 4558 4348 414e   NON_OPEN_EXCHAN
+0000e370: 4745 5f53 5441 5445 530a 2020 2020 2020  GE_STATES.      
+0000e380: 2020 2020 2020 2020 2020 616e 6420 6f72            and or
+0000e390: 6465 722e 6765 7428 2766 696c 6c65 6427  der.get('filled'
+0000e3a0: 2920 3d3d 2030 2e30 290a 0a20 2020 2040  ) == 0.0)..    @
+0000e3b0: 7265 7472 6965 720a 2020 2020 6465 6620  retrier.    def 
+0000e3c0: 6361 6e63 656c 5f6f 7264 6572 2873 656c  cancel_order(sel
+0000e3d0: 662c 206f 7264 6572 5f69 643a 2073 7472  f, order_id: str
+0000e3e0: 2c20 7061 6972 3a20 7374 722c 2070 6172  , pair: str, par
+0000e3f0: 616d 733a 2044 6963 7420 3d20 7b7d 2920  ams: Dict = {}) 
+0000e400: 2d3e 2044 6963 743a 0a20 2020 2020 2020  -> Dict:.       
+0000e410: 2069 6620 7365 6c66 2e5f 636f 6e66 6967   if self._config
+0000e420: 5b27 6472 795f 7275 6e27 5d3a 0a20 2020  ['dry_run']:.   
+0000e430: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+0000e440: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+0000e450: 6465 7220 3d20 7365 6c66 2e66 6574 6368  der = self.fetch
+0000e460: 5f64 7279 5f72 756e 5f6f 7264 6572 286f  _dry_run_order(o
+0000e470: 7264 6572 5f69 6429 0a0a 2020 2020 2020  rder_id)..      
+0000e480: 2020 2020 2020 2020 2020 6f72 6465 722e            order.
+0000e490: 7570 6461 7465 287b 2773 7461 7475 7327  update({'status'
+0000e4a0: 3a20 2763 616e 6365 6c65 6427 2c20 2766  : 'canceled', 'f
+0000e4b0: 696c 6c65 6427 3a20 302e 302c 2027 7265  illed': 0.0, 're
+0000e4c0: 6d61 696e 696e 6727 3a20 6f72 6465 725b  maining': order[
+0000e4d0: 2761 6d6f 756e 7427 5d7d 290a 2020 2020  'amount']}).    
+0000e4e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000e4f0: 726e 206f 7264 6572 0a20 2020 2020 2020  rn order.       
+0000e500: 2020 2020 2065 7863 6570 7420 496e 7661       except Inva
+0000e510: 6c69 644f 7264 6572 4578 6365 7074 696f  lidOrderExceptio
+0000e520: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
+0000e530: 2020 2072 6574 7572 6e20 7b7d 0a0a 2020     return {}..  
+0000e540: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000e550: 2020 2020 2020 206f 7264 6572 203d 2073         order = s
+0000e560: 656c 662e 5f61 7069 2e63 616e 6365 6c5f  elf._api.cancel_
+0000e570: 6f72 6465 7228 6f72 6465 725f 6964 2c20  order(order_id, 
+0000e580: 7061 6972 2c20 7061 7261 6d73 3d70 6172  pair, params=par
+0000e590: 616d 7329 0a20 2020 2020 2020 2020 2020  ams).           
+0000e5a0: 2073 656c 662e 5f6c 6f67 5f65 7863 6861   self._log_excha
+0000e5b0: 6e67 655f 7265 7370 6f6e 7365 2827 6361  nge_response('ca
+0000e5c0: 6e63 656c 5f6f 7264 6572 272c 206f 7264  ncel_order', ord
+0000e5d0: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
+0000e5e0: 6f72 6465 7220 3d20 7365 6c66 2e5f 6f72  order = self._or
+0000e5f0: 6465 725f 636f 6e74 7261 6374 735f 746f  der_contracts_to
+0000e600: 5f61 6d6f 756e 7428 6f72 6465 7229 0a20  _amount(order). 
+0000e610: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000e620: 6e20 6f72 6465 720a 2020 2020 2020 2020  n order.        
+0000e630: 6578 6365 7074 2063 6378 742e 496e 7661  except ccxt.Inva
+0000e640: 6c69 644f 7264 6572 2061 7320 653a 0a20  lidOrder as e:. 
+0000e650: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000e660: 2049 6e76 616c 6964 4f72 6465 7245 7863   InvalidOrderExc
+0000e670: 6570 7469 6f6e 280a 2020 2020 2020 2020  eption(.        
+0000e680: 2020 2020 2020 2020 6627 436f 756c 6420          f'Could 
+0000e690: 6e6f 7420 6361 6e63 656c 206f 7264 6572  not cancel order
+0000e6a0: 2e20 4d65 7373 6167 653a 207b 657d 2729  . Message: {e}')
+0000e6b0: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
+0000e6c0: 6578 6365 7074 2063 6378 742e 4444 6f53  except ccxt.DDoS
+0000e6d0: 5072 6f74 6563 7469 6f6e 2061 7320 653a  Protection as e:
+0000e6e0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000e6f0: 7365 2044 446f 7350 726f 7465 6374 696f  se DDosProtectio
+0000e700: 6e28 6529 2066 726f 6d20 650a 2020 2020  n(e) from e.    
+0000e710: 2020 2020 6578 6365 7074 2028 6363 7874      except (ccxt
+0000e720: 2e4e 6574 776f 726b 4572 726f 722c 2063  .NetworkError, c
+0000e730: 6378 742e 4578 6368 616e 6765 4572 726f  cxt.ExchangeErro
+0000e740: 7229 2061 7320 653a 0a20 2020 2020 2020  r) as e:.       
+0000e750: 2020 2020 2072 6169 7365 2054 656d 706f       raise Tempo
+0000e760: 7261 7279 4572 726f 7228 0a20 2020 2020  raryError(.     
+0000e770: 2020 2020 2020 2020 2020 2066 2743 6f75             f'Cou
+0000e780: 6c64 206e 6f74 2063 616e 6365 6c20 6f72  ld not cancel or
+0000e790: 6465 7220 6475 6520 746f 207b 652e 5f5f  der due to {e.__
+0000e7a0: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+0000e7b0: 7d2e 204d 6573 7361 6765 3a20 7b65 7d27  }. Message: {e}'
+0000e7c0: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
+0000e7d0: 2065 7863 6570 7420 6363 7874 2e42 6173   except ccxt.Bas
+0000e7e0: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
+0000e7f0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+0000e800: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
+0000e810: 696f 6e28 6529 2066 726f 6d20 650a 0a20  ion(e) from e.. 
+0000e820: 2020 2064 6566 2063 616e 6365 6c5f 7374     def cancel_st
+0000e830: 6f70 6c6f 7373 5f6f 7264 6572 2873 656c  oploss_order(sel
+0000e840: 662c 206f 7264 6572 5f69 643a 2073 7472  f, order_id: str
+0000e850: 2c20 7061 6972 3a20 7374 722c 2070 6172  , pair: str, par
+0000e860: 616d 733a 2044 6963 7420 3d20 7b7d 2920  ams: Dict = {}) 
+0000e870: 2d3e 2044 6963 743a 0a20 2020 2020 2020  -> Dict:.       
+0000e880: 2072 6574 7572 6e20 7365 6c66 2e63 616e   return self.can
+0000e890: 6365 6c5f 6f72 6465 7228 6f72 6465 725f  cel_order(order_
+0000e8a0: 6964 2c20 7061 6972 2c20 7061 7261 6d73  id, pair, params
+0000e8b0: 290a 0a20 2020 2064 6566 2069 735f 6361  )..    def is_ca
+0000e8c0: 6e63 656c 5f6f 7264 6572 5f72 6573 756c  ncel_order_resul
+0000e8d0: 745f 7375 6974 6162 6c65 2873 656c 662c  t_suitable(self,
+0000e8e0: 2063 6f72 6465 7229 202d 3e20 626f 6f6c   corder) -> bool
+0000e8f0: 3a0a 2020 2020 2020 2020 6966 206e 6f74  :.        if not
+0000e900: 2069 7369 6e73 7461 6e63 6528 636f 7264   isinstance(cord
+0000e910: 6572 2c20 6469 6374 293a 0a20 2020 2020  er, dict):.     
+0000e920: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+0000e930: 6c73 650a 0a20 2020 2020 2020 2072 6571  lse..        req
+0000e940: 7569 7265 6420 3d20 2827 6665 6527 2c20  uired = ('fee', 
+0000e950: 2773 7461 7475 7327 2c20 2761 6d6f 756e  'status', 'amoun
+0000e960: 7427 290a 2020 2020 2020 2020 7265 7475  t').        retu
+0000e970: 726e 2061 6c6c 2863 6f72 6465 722e 6765  rn all(corder.ge
+0000e980: 7428 6b2c 204e 6f6e 6529 2069 7320 6e6f  t(k, None) is no
+0000e990: 7420 4e6f 6e65 2066 6f72 206b 2069 6e20  t None for k in 
+0000e9a0: 7265 7175 6972 6564 290a 0a20 2020 2064  required)..    d
+0000e9b0: 6566 2063 616e 6365 6c5f 6f72 6465 725f  ef cancel_order_
+0000e9c0: 7769 7468 5f72 6573 756c 7428 7365 6c66  with_result(self
+0000e9d0: 2c20 6f72 6465 725f 6964 3a20 7374 722c  , order_id: str,
+0000e9e0: 2070 6169 723a 2073 7472 2c20 616d 6f75   pair: str, amou
+0000e9f0: 6e74 3a20 666c 6f61 7429 202d 3e20 4469  nt: float) -> Di
+0000ea00: 6374 3a0a 2020 2020 2020 2020 2222 220a  ct:.        """.
+0000ea10: 2020 2020 2020 2020 4361 6e63 656c 206f          Cancel o
+0000ea20: 7264 6572 2072 6574 7572 6e69 6e67 2061  rder returning a
+0000ea30: 2072 6573 756c 742e 0a20 2020 2020 2020   result..       
+0000ea40: 2043 7265 6174 6573 2061 2066 616b 6520   Creates a fake 
+0000ea50: 7265 7375 6c74 2069 6620 6361 6e63 656c  result if cancel
+0000ea60: 206f 7264 6572 2072 6574 7572 6e73 2061   order returns a
+0000ea70: 206e 6f6e 2d75 7361 626c 6520 7265 7375   non-usable resu
+0000ea80: 6c74 0a20 2020 2020 2020 2061 6e64 2066  lt.        and f
+0000ea90: 6574 6368 5f6f 7264 6572 2064 6f65 7320  etch_order does 
+0000eaa0: 6e6f 7420 776f 726b 2028 6365 7274 6169  not work (certai
+0000eab0: 6e20 6578 6368 616e 6765 7320 646f 6e27  n exchanges don'
+0000eac0: 7420 7265 7475 726e 2063 616e 6365 6c6c  t return cancell
+0000ead0: 6564 206f 7264 6572 7329 0a20 2020 2020  ed orders).     
+0000eae0: 2020 203a 7061 7261 6d20 6f72 6465 725f     :param order_
+0000eaf0: 6964 3a20 4f72 6465 7269 6420 746f 2063  id: Orderid to c
+0000eb00: 616e 6365 6c0a 2020 2020 2020 2020 3a70  ancel.        :p
+0000eb10: 6172 616d 2070 6169 723a 2050 6169 7220  aram pair: Pair 
+0000eb20: 636f 7272 6573 706f 6e64 696e 6720 746f  corresponding to
+0000eb30: 206f 7264 6572 5f69 640a 2020 2020 2020   order_id.      
+0000eb40: 2020 3a70 6172 616d 2061 6d6f 756e 743a    :param amount:
+0000eb50: 2041 6d6f 756e 7420 746f 2075 7365 2066   Amount to use f
+0000eb60: 6f72 2066 616b 6520 7265 7370 6f6e 7365  or fake response
+0000eb70: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+0000eb80: 3a20 5265 7375 6c74 2066 726f 6d20 6569  : Result from ei
+0000eb90: 7468 6572 2063 616e 6365 6c5f 6f72 6465  ther cancel_orde
+0000eba0: 7220 6966 2075 7361 626c 652c 206f 7220  r if usable, or 
+0000ebb0: 6665 7463 685f 6f72 6465 720a 2020 2020  fetch_order.    
+0000ebc0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000ebd0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0000ebe0: 2063 6f72 6465 7220 3d20 7365 6c66 2e63   corder = self.c
+0000ebf0: 616e 6365 6c5f 6f72 6465 7228 6f72 6465  ancel_order(orde
+0000ec00: 725f 6964 2c20 7061 6972 290a 2020 2020  r_id, pair).    
+0000ec10: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000ec20: 6973 5f63 616e 6365 6c5f 6f72 6465 725f  is_cancel_order_
+0000ec30: 7265 7375 6c74 5f73 7569 7461 626c 6528  result_suitable(
+0000ec40: 636f 7264 6572 293a 0a20 2020 2020 2020  corder):.       
+0000ec50: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000ec60: 636f 7264 6572 0a20 2020 2020 2020 2065  corder.        e
+0000ec70: 7863 6570 7420 496e 7661 6c69 644f 7264  xcept InvalidOrd
+0000ec80: 6572 4578 6365 7074 696f 6e3a 0a20 2020  erException:.   
+0000ec90: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+0000eca0: 7761 726e 696e 6728 6622 436f 756c 6420  warning(f"Could 
+0000ecb0: 6e6f 7420 6361 6e63 656c 206f 7264 6572  not cancel order
+0000ecc0: 207b 6f72 6465 725f 6964 7d20 666f 7220   {order_id} for 
+0000ecd0: 7b70 6169 727d 2e22 290a 2020 2020 2020  {pair}.").      
+0000ece0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0000ecf0: 2020 206f 7264 6572 203d 2073 656c 662e     order = self.
+0000ed00: 6665 7463 685f 6f72 6465 7228 6f72 6465  fetch_order(orde
+0000ed10: 725f 6964 2c20 7061 6972 290a 2020 2020  r_id, pair).    
+0000ed20: 2020 2020 6578 6365 7074 2049 6e76 616c      except Inval
+0000ed30: 6964 4f72 6465 7245 7863 6570 7469 6f6e  idOrderException
+0000ed40: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+0000ed50: 6767 6572 2e77 6172 6e69 6e67 2866 2243  gger.warning(f"C
+0000ed60: 6f75 6c64 206e 6f74 2066 6574 6368 2063  ould not fetch c
+0000ed70: 616e 6365 6c6c 6564 206f 7264 6572 207b  ancelled order {
+0000ed80: 6f72 6465 725f 6964 7d2e 2229 0a20 2020  order_id}.").   
+0000ed90: 2020 2020 2020 2020 206f 7264 6572 203d           order =
+0000eda0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
+0000edb0: 2020 2027 6964 273a 206f 7264 6572 5f69     'id': order_i
+0000edc0: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+0000edd0: 2020 2027 7374 6174 7573 273a 2027 6361     'status': 'ca
+0000ede0: 6e63 656c 6564 272c 0a20 2020 2020 2020  nceled',.       
+0000edf0: 2020 2020 2020 2020 2027 616d 6f75 6e74           'amount
+0000ee00: 273a 2061 6d6f 756e 742c 0a20 2020 2020  ': amount,.     
+0000ee10: 2020 2020 2020 2020 2020 2027 6669 6c6c             'fill
+0000ee20: 6564 273a 2030 2e30 2c0a 2020 2020 2020  ed': 0.0,.      
+0000ee30: 2020 2020 2020 2020 2020 2766 6565 273a            'fee':
+0000ee40: 207b 7d2c 0a20 2020 2020 2020 2020 2020   {},.           
+0000ee50: 2020 2020 2027 696e 666f 273a 207b 7d0a       'info': {}.
+0000ee60: 2020 2020 2020 2020 2020 2020 7d0a 0a20              }.. 
+0000ee70: 2020 2020 2020 2072 6574 7572 6e20 6f72         return or
+0000ee80: 6465 720a 0a20 2020 2064 6566 2063 616e  der..    def can
+0000ee90: 6365 6c5f 7374 6f70 6c6f 7373 5f6f 7264  cel_stoploss_ord
+0000eea0: 6572 5f77 6974 685f 7265 7375 6c74 2873  er_with_result(s
+0000eeb0: 656c 662c 206f 7264 6572 5f69 643a 2073  elf, order_id: s
+0000eec0: 7472 2c20 7061 6972 3a20 7374 722c 2061  tr, pair: str, a
+0000eed0: 6d6f 756e 743a 2066 6c6f 6174 2920 2d3e  mount: float) ->
+0000eee0: 2044 6963 743a 0a20 2020 2020 2020 2022   Dict:.        "
+0000eef0: 2222 0a20 2020 2020 2020 2043 616e 6365  "".        Cance
+0000ef00: 6c20 7374 6f70 6c6f 7373 206f 7264 6572  l stoploss order
+0000ef10: 2072 6574 7572 6e69 6e67 2061 2072 6573   returning a res
+0000ef20: 756c 742e 0a20 2020 2020 2020 2043 7265  ult..        Cre
+0000ef30: 6174 6573 2061 2066 616b 6520 7265 7375  ates a fake resu
+0000ef40: 6c74 2069 6620 6361 6e63 656c 206f 7264  lt if cancel ord
+0000ef50: 6572 2072 6574 7572 6e73 2061 206e 6f6e  er returns a non
+0000ef60: 2d75 7361 626c 6520 7265 7375 6c74 0a20  -usable result. 
+0000ef70: 2020 2020 2020 2061 6e64 2066 6574 6368         and fetch
+0000ef80: 5f6f 7264 6572 2064 6f65 7320 6e6f 7420  _order does not 
+0000ef90: 776f 726b 2028 6365 7274 6169 6e20 6578  work (certain ex
+0000efa0: 6368 616e 6765 7320 646f 6e27 7420 7265  changes don't re
+0000efb0: 7475 726e 2063 616e 6365 6c6c 6564 206f  turn cancelled o
+0000efc0: 7264 6572 7329 0a20 2020 2020 2020 203a  rders).        :
+0000efd0: 7061 7261 6d20 6f72 6465 725f 6964 3a20  param order_id: 
+0000efe0: 7374 6f70 6c6f 7373 2d6f 7264 6572 2d69  stoploss-order-i
+0000eff0: 6420 746f 2063 616e 6365 6c0a 2020 2020  d to cancel.    
+0000f000: 2020 2020 3a70 6172 616d 2070 6169 723a      :param pair:
+0000f010: 2050 6169 7220 636f 7272 6573 706f 6e64   Pair correspond
+0000f020: 696e 6720 746f 206f 7264 6572 5f69 640a  ing to order_id.
+0000f030: 2020 2020 2020 2020 3a70 6172 616d 2061          :param a
+0000f040: 6d6f 756e 743a 2041 6d6f 756e 7420 746f  mount: Amount to
+0000f050: 2075 7365 2066 6f72 2066 616b 6520 7265   use for fake re
+0000f060: 7370 6f6e 7365 0a20 2020 2020 2020 203a  sponse.        :
+0000f070: 7265 7475 726e 3a20 5265 7375 6c74 2066  return: Result f
+0000f080: 726f 6d20 6569 7468 6572 2063 616e 6365  rom either cance
+0000f090: 6c5f 6f72 6465 7220 6966 2075 7361 626c  l_order if usabl
+0000f0a0: 652c 206f 7220 6665 7463 685f 6f72 6465  e, or fetch_orde
+0000f0b0: 720a 2020 2020 2020 2020 2222 220a 2020  r.        """.  
+0000f0c0: 2020 2020 2020 636f 7264 6572 203d 2073        corder = s
+0000f0d0: 656c 662e 6361 6e63 656c 5f73 746f 706c  elf.cancel_stopl
+0000f0e0: 6f73 735f 6f72 6465 7228 6f72 6465 725f  oss_order(order_
+0000f0f0: 6964 2c20 7061 6972 290a 2020 2020 2020  id, pair).      
+0000f100: 2020 6966 2073 656c 662e 6973 5f63 616e    if self.is_can
+0000f110: 6365 6c5f 6f72 6465 725f 7265 7375 6c74  cel_order_result
+0000f120: 5f73 7569 7461 626c 6528 636f 7264 6572  _suitable(corder
+0000f130: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+0000f140: 6574 7572 6e20 636f 7264 6572 0a20 2020  eturn corder.   
+0000f150: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0000f160: 2020 2020 2020 6f72 6465 7220 3d20 7365        order = se
+0000f170: 6c66 2e66 6574 6368 5f73 746f 706c 6f73  lf.fetch_stoplos
+0000f180: 735f 6f72 6465 7228 6f72 6465 725f 6964  s_order(order_id
+0000f190: 2c20 7061 6972 290a 2020 2020 2020 2020  , pair).        
+0000f1a0: 6578 6365 7074 2049 6e76 616c 6964 4f72  except InvalidOr
+0000f1b0: 6465 7245 7863 6570 7469 6f6e 3a0a 2020  derException:.  
+0000f1c0: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+0000f1d0: 2e77 6172 6e69 6e67 2866 2243 6f75 6c64  .warning(f"Could
+0000f1e0: 206e 6f74 2066 6574 6368 2063 616e 6365   not fetch cance
+0000f1f0: 6c6c 6564 2073 746f 706c 6f73 7320 6f72  lled stoploss or
+0000f200: 6465 7220 7b6f 7264 6572 5f69 647d 2e22  der {order_id}."
+0000f210: 290a 2020 2020 2020 2020 2020 2020 6f72  ).            or
+0000f220: 6465 7220 3d20 7b27 6665 6527 3a20 7b7d  der = {'fee': {}
+0000f230: 2c20 2773 7461 7475 7327 3a20 2763 616e  , 'status': 'can
+0000f240: 6365 6c65 6427 2c20 2761 6d6f 756e 7427  celed', 'amount'
+0000f250: 3a20 616d 6f75 6e74 2c20 2769 6e66 6f27  : amount, 'info'
+0000f260: 3a20 7b7d 7d0a 0a20 2020 2020 2020 2072  : {}}..        r
+0000f270: 6574 7572 6e20 6f72 6465 720a 0a20 2020  eturn order..   
+0000f280: 2040 7265 7472 6965 720a 2020 2020 6465   @retrier.    de
+0000f290: 6620 6765 745f 6261 6c61 6e63 6573 2873  f get_balances(s
+0000f2a0: 656c 6629 202d 3e20 6469 6374 3a0a 0a20  elf) -> dict:.. 
+0000f2b0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0000f2c0: 2020 2020 2020 2020 6261 6c61 6e63 6573          balances
+0000f2d0: 203d 2073 656c 662e 5f61 7069 2e66 6574   = self._api.fet
+0000f2e0: 6368 5f62 616c 616e 6365 2829 0a20 2020  ch_balance().   
+0000f2f0: 2020 2020 2020 2020 2023 2052 656d 6f76           # Remov
+0000f300: 6520 6164 6469 7469 6f6e 616c 2069 6e66  e additional inf
+0000f310: 6f20 6672 6f6d 2063 6378 7420 7265 7375  o from ccxt resu
+0000f320: 6c74 730a 2020 2020 2020 2020 2020 2020  lts.            
+0000f330: 6261 6c61 6e63 6573 2e70 6f70 2822 696e  balances.pop("in
+0000f340: 666f 222c 204e 6f6e 6529 0a20 2020 2020  fo", None).     
+0000f350: 2020 2020 2020 2062 616c 616e 6365 732e         balances.
+0000f360: 706f 7028 2266 7265 6522 2c20 4e6f 6e65  pop("free", None
+0000f370: 290a 2020 2020 2020 2020 2020 2020 6261  ).            ba
+0000f380: 6c61 6e63 6573 2e70 6f70 2822 746f 7461  lances.pop("tota
+0000f390: 6c22 2c20 4e6f 6e65 290a 2020 2020 2020  l", None).      
+0000f3a0: 2020 2020 2020 6261 6c61 6e63 6573 2e70        balances.p
+0000f3b0: 6f70 2822 7573 6564 222c 204e 6f6e 6529  op("used", None)
+0000f3c0: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0000f3d0: 7475 726e 2062 616c 616e 6365 730a 2020  turn balances.  
+0000f3e0: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
+0000f3f0: 742e 4444 6f53 5072 6f74 6563 7469 6f6e  t.DDoSProtection
+0000f400: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+0000f410: 2020 2072 6169 7365 2044 446f 7350 726f     raise DDosPro
+0000f420: 7465 6374 696f 6e28 6529 2066 726f 6d20  tection(e) from 
+0000f430: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+0000f440: 2028 6363 7874 2e4e 6574 776f 726b 4572   (ccxt.NetworkEr
+0000f450: 726f 722c 2063 6378 742e 4578 6368 616e  ror, ccxt.Exchan
+0000f460: 6765 4572 726f 7229 2061 7320 653a 0a20  geError) as e:. 
+0000f470: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000f480: 2054 656d 706f 7261 7279 4572 726f 7228   TemporaryError(
+0000f490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f4a0: 2066 2743 6f75 6c64 206e 6f74 2067 6574   f'Could not get
+0000f4b0: 2062 616c 616e 6365 2064 7565 2074 6f20   balance due to 
+0000f4c0: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
+0000f4d0: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
+0000f4e0: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
+0000f4f0: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
+0000f500: 742e 4261 7365 4572 726f 7220 6173 2065  t.BaseError as e
+0000f510: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0000f520: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+0000f530: 7863 6570 7469 6f6e 2865 2920 6672 6f6d  xception(e) from
+0000f540: 2065 0a0a 2020 2020 4072 6574 7269 6572   e..    @retrier
+0000f550: 0a20 2020 2064 6566 2066 6574 6368 5f70  .    def fetch_p
+0000f560: 6f73 6974 696f 6e73 2873 656c 662c 2070  ositions(self, p
+0000f570: 6169 723a 204f 7074 696f 6e61 6c5b 7374  air: Optional[st
+0000f580: 725d 203d 204e 6f6e 6529 202d 3e20 4c69  r] = None) -> Li
+0000f590: 7374 5b44 6963 745d 3a0a 2020 2020 2020  st[Dict]:.      
+0000f5a0: 2020 2222 220a 2020 2020 2020 2020 4665    """.        Fe
+0000f5b0: 7463 6820 706f 7369 7469 6f6e 7320 6672  tch positions fr
+0000f5c0: 6f6d 2074 6865 2065 7863 6861 6e67 652e  om the exchange.
+0000f5d0: 0a20 2020 2020 2020 2049 6620 6e6f 2070  .        If no p
+0000f5e0: 6169 7220 6973 2067 6976 656e 2c20 616c  air is given, al
+0000f5f0: 6c20 706f 7369 7469 6f6e 7320 6172 6520  l positions are 
+0000f600: 7265 7475 726e 6564 2e0a 2020 2020 2020  returned..      
+0000f610: 2020 3a70 6172 616d 2070 6169 723a 2050    :param pair: P
+0000f620: 6169 7220 666f 7220 7468 6520 7175 6572  air for the quer
+0000f630: 790a 2020 2020 2020 2020 2222 220a 2020  y.        """.  
+0000f640: 2020 2020 2020 6966 2073 656c 662e 5f63        if self._c
+0000f650: 6f6e 6669 675b 2764 7279 5f72 756e 275d  onfig['dry_run']
+0000f660: 206f 7220 7365 6c66 2e74 7261 6469 6e67   or self.trading
+0000f670: 5f6d 6f64 6520 213d 2054 7261 6469 6e67  _mode != Trading
+0000f680: 4d6f 6465 2e46 5554 5552 4553 3a0a 2020  Mode.FUTURES:.  
+0000f690: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000f6a0: 205b 5d0a 2020 2020 2020 2020 7472 793a   [].        try:
+0000f6b0: 0a20 2020 2020 2020 2020 2020 2073 796d  .            sym
+0000f6c0: 626f 6c73 203d 205b 5d0a 2020 2020 2020  bols = [].      
+0000f6d0: 2020 2020 2020 6966 2070 6169 723a 0a20        if pair:. 
+0000f6e0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000f6f0: 796d 626f 6c73 2e61 7070 656e 6428 7061  ymbols.append(pa
+0000f700: 6972 290a 2020 2020 2020 2020 2020 2020  ir).            
+0000f710: 706f 7369 7469 6f6e 733a 204c 6973 745b  positions: List[
+0000f720: 4469 6374 5d20 3d20 7365 6c66 2e5f 6170  Dict] = self._ap
+0000f730: 692e 6665 7463 685f 706f 7369 7469 6f6e  i.fetch_position
+0000f740: 7328 7379 6d62 6f6c 7329 0a20 2020 2020  s(symbols).     
+0000f750: 2020 2020 2020 2073 656c 662e 5f6c 6f67         self._log
+0000f760: 5f65 7863 6861 6e67 655f 7265 7370 6f6e  _exchange_respon
+0000f770: 7365 2827 6665 7463 685f 706f 7369 7469  se('fetch_positi
+0000f780: 6f6e 7327 2c20 706f 7369 7469 6f6e 7329  ons', positions)
+0000f790: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000f7a0: 7572 6e20 706f 7369 7469 6f6e 730a 2020  urn positions.  
+0000f7b0: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
+0000f7c0: 742e 4444 6f53 5072 6f74 6563 7469 6f6e  t.DDoSProtection
+0000f7d0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+0000f7e0: 2020 2072 6169 7365 2044 446f 7350 726f     raise DDosPro
+0000f7f0: 7465 6374 696f 6e28 6529 2066 726f 6d20  tection(e) from 
+0000f800: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+0000f810: 2028 6363 7874 2e4e 6574 776f 726b 4572   (ccxt.NetworkEr
+0000f820: 726f 722c 2063 6378 742e 4578 6368 616e  ror, ccxt.Exchan
+0000f830: 6765 4572 726f 7229 2061 7320 653a 0a20  geError) as e:. 
+0000f840: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000f850: 2054 656d 706f 7261 7279 4572 726f 7228   TemporaryError(
+0000f860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f870: 2066 2743 6f75 6c64 206e 6f74 2067 6574   f'Could not get
+0000f880: 2070 6f73 6974 696f 6e73 2064 7565 2074   positions due t
+0000f890: 6f20 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f  o {e.__class__._
+0000f8a0: 5f6e 616d 655f 5f7d 2e20 4d65 7373 6167  _name__}. Messag
+0000f8b0: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
+0000f8c0: 2020 2020 2020 2020 6578 6365 7074 2063          except c
+0000f8d0: 6378 742e 4261 7365 4572 726f 7220 6173  cxt.BaseError as
+0000f8e0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0000f8f0: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
+0000f900: 6c45 7863 6570 7469 6f6e 2865 2920 6672  lException(e) fr
+0000f910: 6f6d 2065 0a0a 2020 2020 4072 6574 7269  om e..    @retri
+0000f920: 6572 2872 6574 7269 6573 3d30 290a 2020  er(retries=0).  
+0000f930: 2020 6465 6620 6665 7463 685f 6f72 6465    def fetch_orde
+0000f940: 7273 2873 656c 662c 2070 6169 723a 2073  rs(self, pair: s
+0000f950: 7472 2c20 7369 6e63 653a 2064 6174 6574  tr, since: datet
+0000f960: 696d 6529 202d 3e20 4c69 7374 5b44 6963  ime) -> List[Dic
+0000f970: 745d 3a0a 2020 2020 2020 2020 2222 220a  t]:.        """.
+0000f980: 2020 2020 2020 2020 4665 7463 6820 616c          Fetch al
+0000f990: 6c20 6f72 6465 7273 2066 6f72 2061 2070  l orders for a p
+0000f9a0: 6169 7220 2273 696e 6365 220a 2020 2020  air "since".    
+0000f9b0: 2020 2020 3a70 6172 616d 2070 6169 723a      :param pair:
+0000f9c0: 2050 6169 7220 666f 7220 7468 6520 7175   Pair for the qu
+0000f9d0: 6572 790a 2020 2020 2020 2020 3a70 6172  ery.        :par
+0000f9e0: 616d 2073 696e 6365 3a20 5374 6172 7469  am since: Starti
+0000f9f0: 6e67 2074 696d 6520 666f 7220 7468 6520  ng time for the 
+0000fa00: 7175 6572 790a 2020 2020 2020 2020 2222  query.        ""
+0000fa10: 220a 2020 2020 2020 2020 6966 2073 656c  ".        if sel
+0000fa20: 662e 5f63 6f6e 6669 675b 2764 7279 5f72  f._config['dry_r
+0000fa30: 756e 275d 3a0a 2020 2020 2020 2020 2020  un']:.          
+0000fa40: 2020 7265 7475 726e 205b 5d0a 0a20 2020    return []..   
+0000fa50: 2020 2020 2064 6566 2066 6574 6368 5f6f       def fetch_o
+0000fa60: 7264 6572 735f 656d 756c 6174 6528 2920  rders_emulate() 
+0000fa70: 2d3e 204c 6973 745b 4469 6374 5d3a 0a20  -> List[Dict]:. 
+0000fa80: 2020 2020 2020 2020 2020 206f 7264 6572             order
+0000fa90: 7320 3d20 5b5d 0a20 2020 2020 2020 2020  s = [].         
+0000faa0: 2020 2069 6620 7365 6c66 2e65 7863 6861     if self.excha
+0000fab0: 6e67 655f 6861 7328 2766 6574 6368 436c  nge_has('fetchCl
+0000fac0: 6f73 6564 4f72 6465 7273 2729 3a0a 2020  osedOrders'):.  
+0000fad0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+0000fae0: 6465 7273 203d 2073 656c 662e 5f61 7069  ders = self._api
+0000faf0: 2e66 6574 6368 5f63 6c6f 7365 645f 6f72  .fetch_closed_or
+0000fb00: 6465 7273 2870 6169 722c 2073 696e 6365  ders(pair, since
+0000fb10: 3d73 696e 6365 5f6d 7329 0a20 2020 2020  =since_ms).     
+0000fb20: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+0000fb30: 6c66 2e65 7863 6861 6e67 655f 6861 7328  lf.exchange_has(
+0000fb40: 2766 6574 6368 4f70 656e 4f72 6465 7273  'fetchOpenOrders
+0000fb50: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
+0000fb60: 2020 2020 2020 2020 6f72 6465 7273 5f6f          orders_o
+0000fb70: 7065 6e20 3d20 7365 6c66 2e5f 6170 692e  pen = self._api.
+0000fb80: 6665 7463 685f 6f70 656e 5f6f 7264 6572  fetch_open_order
+0000fb90: 7328 7061 6972 2c20 7369 6e63 653d 7369  s(pair, since=si
+0000fba0: 6e63 655f 6d73 290a 2020 2020 2020 2020  nce_ms).        
+0000fbb0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+0000fbc0: 7273 2e65 7874 656e 6428 6f72 6465 7273  rs.extend(orders
+0000fbd0: 5f6f 7065 6e29 0a20 2020 2020 2020 2020  _open).         
+0000fbe0: 2020 2072 6574 7572 6e20 6f72 6465 7273     return orders
+0000fbf0: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
+0000fc00: 2020 2020 2020 2020 2020 2073 696e 6365             since
+0000fc10: 5f6d 7320 3d20 696e 7428 2873 696e 6365  _ms = int((since
+0000fc20: 2e74 696d 6573 7461 6d70 2829 202d 2031  .timestamp() - 1
+0000fc30: 3029 202a 2031 3030 3029 0a20 2020 2020  0) * 1000).     
+0000fc40: 2020 2020 2020 2069 6620 7365 6c66 2e65         if self.e
+0000fc50: 7863 6861 6e67 655f 6861 7328 2766 6574  xchange_has('fet
+0000fc60: 6368 4f72 6465 7273 2729 3a0a 2020 2020  chOrders'):.    
+0000fc70: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+0000fc80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fc90: 2020 2020 206f 7264 6572 733a 204c 6973       orders: Lis
+0000fca0: 745b 4469 6374 5d20 3d20 7365 6c66 2e5f  t[Dict] = self._
+0000fcb0: 6170 692e 6665 7463 685f 6f72 6465 7273  api.fetch_orders
+0000fcc0: 2870 6169 722c 2073 696e 6365 3d73 696e  (pair, since=sin
+0000fcd0: 6365 5f6d 7329 0a20 2020 2020 2020 2020  ce_ms).         
+0000fce0: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
+0000fcf0: 7874 2e4e 6f74 5375 7070 6f72 7465 643a  xt.NotSupported:
+0000fd00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fd10: 2020 2020 2023 2053 6f6d 6520 6578 6368       # Some exch
+0000fd20: 616e 6765 7320 646f 6e27 7420 7375 7070  anges don't supp
+0000fd30: 6f72 7420 6665 7463 684f 7264 6572 730a  ort fetchOrders.
+0000fd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fd50: 2020 2020 2320 6174 7465 6d70 7420 746f      # attempt to
+0000fd60: 2066 6574 6368 206f 7065 6e20 616e 6420   fetch open and 
+0000fd70: 636c 6f73 6564 206f 7264 6572 7320 7365  closed orders se
+0000fd80: 7061 7261 7465 6c79 0a20 2020 2020 2020  parately.       
+0000fd90: 2020 2020 2020 2020 2020 2020 206f 7264               ord
+0000fda0: 6572 7320 3d20 6665 7463 685f 6f72 6465  ers = fetch_orde
+0000fdb0: 7273 5f65 6d75 6c61 7465 2829 0a20 2020  rs_emulate().   
+0000fdc0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000fdd0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+0000fde0: 7264 6572 7320 3d20 6665 7463 685f 6f72  rders = fetch_or
+0000fdf0: 6465 7273 5f65 6d75 6c61 7465 2829 0a20  ders_emulate(). 
+0000fe00: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000fe10: 5f6c 6f67 5f65 7863 6861 6e67 655f 7265  _log_exchange_re
+0000fe20: 7370 6f6e 7365 2827 6665 7463 685f 6f72  sponse('fetch_or
+0000fe30: 6465 7273 272c 206f 7264 6572 7329 0a20  ders', orders). 
+0000fe40: 2020 2020 2020 2020 2020 206f 7264 6572             order
+0000fe50: 7320 3d20 5b73 656c 662e 5f6f 7264 6572  s = [self._order
+0000fe60: 5f63 6f6e 7472 6163 7473 5f74 6f5f 616d  _contracts_to_am
+0000fe70: 6f75 6e74 286f 2920 666f 7220 6f20 696e  ount(o) for o in
+0000fe80: 206f 7264 6572 735d 0a20 2020 2020 2020   orders].       
+0000fe90: 2020 2020 2072 6574 7572 6e20 6f72 6465       return orde
+0000fea0: 7273 0a20 2020 2020 2020 2065 7863 6570  rs.        excep
+0000feb0: 7420 6363 7874 2e44 446f 5350 726f 7465  t ccxt.DDoSProte
+0000fec0: 6374 696f 6e20 6173 2065 3a0a 2020 2020  ction as e:.    
+0000fed0: 2020 2020 2020 2020 7261 6973 6520 4444          raise DD
+0000fee0: 6f73 5072 6f74 6563 7469 6f6e 2865 2920  osProtection(e) 
+0000fef0: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
+0000ff00: 7863 6570 7420 2863 6378 742e 4e65 7477  xcept (ccxt.Netw
+0000ff10: 6f72 6b45 7272 6f72 2c20 6363 7874 2e45  orkError, ccxt.E
+0000ff20: 7863 6861 6e67 6545 7272 6f72 2920 6173  xchangeError) as
+0000ff30: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0000ff40: 7261 6973 6520 5465 6d70 6f72 6172 7945  raise TemporaryE
+0000ff50: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+0000ff60: 2020 2020 2020 6627 436f 756c 6420 6e6f        f'Could no
+0000ff70: 7420 6665 7463 6820 706f 7369 7469 6f6e  t fetch position
+0000ff80: 7320 6475 6520 746f 207b 652e 5f5f 636c  s due to {e.__cl
+0000ff90: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d2e  ass__.__name__}.
+0000ffa0: 204d 6573 7361 6765 3a20 7b65 7d27 2920   Message: {e}') 
+0000ffb0: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
+0000ffc0: 7863 6570 7420 6363 7874 2e42 6173 6545  xcept ccxt.BaseE
+0000ffd0: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
+0000ffe0: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
+0000fff0: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
+00010000: 6e28 6529 2066 726f 6d20 650a 0a20 2020  n(e) from e..   
+00010010: 2040 7265 7472 6965 720a 2020 2020 6465   @retrier.    de
+00010020: 6620 6665 7463 685f 7472 6164 696e 675f  f fetch_trading_
+00010030: 6665 6573 2873 656c 6629 202d 3e20 4469  fees(self) -> Di
+00010040: 6374 5b73 7472 2c20 416e 795d 3a0a 2020  ct[str, Any]:.  
+00010050: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00010060: 2020 4665 7463 6820 7573 6572 2061 6363    Fetch user acc
+00010070: 6f75 6e74 2074 7261 6469 6e67 2066 6565  ount trading fee
+00010080: 730a 2020 2020 2020 2020 4361 6e20 6265  s.        Can be
+00010090: 2063 6163 6865 642c 2073 686f 756c 6420   cached, should 
+000100a0: 6e6f 7420 7570 6461 7465 206f 6674 656e  not update often
+000100b0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+000100c0: 2020 2020 2020 6966 2028 7365 6c66 2e5f        if (self._
+000100d0: 636f 6e66 6967 5b27 6472 795f 7275 6e27  config['dry_run'
+000100e0: 5d20 6f72 2073 656c 662e 7472 6164 696e  ] or self.tradin
+000100f0: 675f 6d6f 6465 2021 3d20 5472 6164 696e  g_mode != Tradin
+00010100: 674d 6f64 652e 4655 5455 5245 530a 2020  gMode.FUTURES.  
+00010110: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00010120: 206e 6f74 2073 656c 662e 6578 6368 616e   not self.exchan
+00010130: 6765 5f68 6173 2827 6665 7463 6854 7261  ge_has('fetchTra
+00010140: 6469 6e67 4665 6573 2729 293a 0a20 2020  dingFees')):.   
+00010150: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00010160: 7b7d 0a20 2020 2020 2020 2074 7279 3a0a  {}.        try:.
+00010170: 2020 2020 2020 2020 2020 2020 7472 6164              trad
+00010180: 696e 675f 6665 6573 3a20 4469 6374 5b73  ing_fees: Dict[s
+00010190: 7472 2c20 416e 795d 203d 2073 656c 662e  tr, Any] = self.
+000101a0: 5f61 7069 2e66 6574 6368 5f74 7261 6469  _api.fetch_tradi
+000101b0: 6e67 5f66 6565 7328 290a 2020 2020 2020  ng_fees().      
+000101c0: 2020 2020 2020 7365 6c66 2e5f 6c6f 675f        self._log_
+000101d0: 6578 6368 616e 6765 5f72 6573 706f 6e73  exchange_respons
+000101e0: 6528 2766 6574 6368 5f74 7261 6469 6e67  e('fetch_trading
+000101f0: 5f66 6565 7327 2c20 7472 6164 696e 675f  _fees', trading_
+00010200: 6665 6573 290a 2020 2020 2020 2020 2020  fees).          
+00010210: 2020 7265 7475 726e 2074 7261 6469 6e67    return trading
+00010220: 5f66 6565 730a 2020 2020 2020 2020 6578  _fees.        ex
+00010230: 6365 7074 2063 6378 742e 4444 6f53 5072  cept ccxt.DDoSPr
+00010240: 6f74 6563 7469 6f6e 2061 7320 653a 0a20  otection as e:. 
+00010250: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00010260: 2044 446f 7350 726f 7465 6374 696f 6e28   DDosProtection(
+00010270: 6529 2066 726f 6d20 650a 2020 2020 2020  e) from e.      
+00010280: 2020 6578 6365 7074 2028 6363 7874 2e4e    except (ccxt.N
+00010290: 6574 776f 726b 4572 726f 722c 2063 6378  etworkError, ccx
+000102a0: 742e 4578 6368 616e 6765 4572 726f 7229  t.ExchangeError)
+000102b0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+000102c0: 2020 2072 6169 7365 2054 656d 706f 7261     raise Tempora
+000102d0: 7279 4572 726f 7228 0a20 2020 2020 2020  ryError(.       
+000102e0: 2020 2020 2020 2020 2066 2743 6f75 6c64           f'Could
+000102f0: 206e 6f74 2066 6574 6368 2074 7261 6469   not fetch tradi
+00010300: 6e67 2066 6565 7320 6475 6520 746f 207b  ng fees due to {
+00010310: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
+00010320: 6d65 5f5f 7d2e 204d 6573 7361 6765 3a20  me__}. Message: 
+00010330: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
+00010340: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
+00010350: 2e42 6173 6545 7272 6f72 2061 7320 653a  .BaseError as e:
+00010360: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00010370: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
+00010380: 6365 7074 696f 6e28 6529 2066 726f 6d20  ception(e) from 
+00010390: 650a 0a20 2020 2040 7265 7472 6965 720a  e..    @retrier.
+000103a0: 2020 2020 6465 6620 6665 7463 685f 6269      def fetch_bi
+000103b0: 6473 5f61 736b 7328 7365 6c66 2c20 7379  ds_asks(self, sy
+000103c0: 6d62 6f6c 733a 204f 7074 696f 6e61 6c5b  mbols: Optional[
+000103d0: 4c69 7374 5b73 7472 5d5d 203d 204e 6f6e  List[str]] = Non
+000103e0: 652c 2063 6163 6865 643a 2062 6f6f 6c20  e, cached: bool 
+000103f0: 3d20 4661 6c73 6529 202d 3e20 4469 6374  = False) -> Dict
+00010400: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00010410: 2020 2020 2020 3a70 6172 616d 2063 6163        :param cac
+00010420: 6865 643a 2041 6c6c 6f77 2063 6163 6865  hed: Allow cache
+00010430: 6420 7265 7375 6c74 0a20 2020 2020 2020  d result.       
+00010440: 203a 7265 7475 726e 3a20 6665 7463 685f   :return: fetch_
+00010450: 7469 636b 6572 7320 7265 7375 6c74 0a20  tickers result. 
+00010460: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00010470: 2020 2069 6620 6e6f 7420 7365 6c66 2e65     if not self.e
+00010480: 7863 6861 6e67 655f 6861 7328 2766 6574  xchange_has('fet
+00010490: 6368 4269 6473 4173 6b73 2729 3a0a 2020  chBidsAsks'):.  
+000104a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000104b0: 207b 7d0a 2020 2020 2020 2020 6966 2063   {}.        if c
+000104c0: 6163 6865 643a 0a20 2020 2020 2020 2020  ached:.         
+000104d0: 2020 2077 6974 6820 7365 6c66 2e5f 6361     with self._ca
+000104e0: 6368 655f 6c6f 636b 3a0a 2020 2020 2020  che_lock:.      
+000104f0: 2020 2020 2020 2020 2020 7469 636b 6572            ticker
+00010500: 7320 3d20 7365 6c66 2e5f 6665 7463 685f  s = self._fetch_
+00010510: 7469 636b 6572 735f 6361 6368 652e 6765  tickers_cache.ge
+00010520: 7428 2766 6574 6368 5f62 6964 735f 6173  t('fetch_bids_as
+00010530: 6b73 2729 0a20 2020 2020 2020 2020 2020  ks').           
+00010540: 2069 6620 7469 636b 6572 733a 0a20 2020   if tickers:.   
+00010550: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00010560: 7572 6e20 7469 636b 6572 730a 2020 2020  urn tickers.    
+00010570: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00010580: 2020 2020 2074 6963 6b65 7273 203d 2073       tickers = s
+00010590: 656c 662e 5f61 7069 2e66 6574 6368 5f62  elf._api.fetch_b
+000105a0: 6964 735f 6173 6b73 2873 796d 626f 6c73  ids_asks(symbols
+000105b0: 290a 2020 2020 2020 2020 2020 2020 7769  ).            wi
+000105c0: 7468 2073 656c 662e 5f63 6163 6865 5f6c  th self._cache_l
+000105d0: 6f63 6b3a 0a20 2020 2020 2020 2020 2020  ock:.           
+000105e0: 2020 2020 2073 656c 662e 5f66 6574 6368       self._fetch
+000105f0: 5f74 6963 6b65 7273 5f63 6163 6865 5b27  _tickers_cache['
+00010600: 6665 7463 685f 6269 6473 5f61 736b 7327  fetch_bids_asks'
+00010610: 5d20 3d20 7469 636b 6572 730a 2020 2020  ] = tickers.    
+00010620: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+00010630: 6963 6b65 7273 0a20 2020 2020 2020 2065  ickers.        e
+00010640: 7863 6570 7420 6363 7874 2e4e 6f74 5375  xcept ccxt.NotSu
+00010650: 7070 6f72 7465 6420 6173 2065 3a0a 2020  pported as e:.  
+00010660: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00010670: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
+00010680: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
+00010690: 2020 2020 2020 6627 4578 6368 616e 6765        f'Exchange
+000106a0: 207b 7365 6c66 2e5f 6170 692e 6e61 6d65   {self._api.name
+000106b0: 7d20 646f 6573 206e 6f74 2073 7570 706f  } does not suppo
+000106c0: 7274 2066 6574 6368 696e 6720 6269 6473  rt fetching bids
+000106d0: 2f61 736b 7320 696e 2062 6174 6368 2e20  /asks in batch. 
+000106e0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+000106f0: 2020 6627 4d65 7373 6167 653a 207b 657d    f'Message: {e}
+00010700: 2729 2066 726f 6d20 650a 2020 2020 2020  ') from e.      
+00010710: 2020 6578 6365 7074 2063 6378 742e 4444    except ccxt.DD
+00010720: 6f53 5072 6f74 6563 7469 6f6e 2061 7320  oSProtection as 
+00010730: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00010740: 6169 7365 2044 446f 7350 726f 7465 6374  aise DDosProtect
+00010750: 696f 6e28 6529 2066 726f 6d20 650a 2020  ion(e) from e.  
+00010760: 2020 2020 2020 6578 6365 7074 2028 6363        except (cc
+00010770: 7874 2e4e 6574 776f 726b 4572 726f 722c  xt.NetworkError,
+00010780: 2063 6378 742e 4578 6368 616e 6765 4572   ccxt.ExchangeEr
+00010790: 726f 7229 2061 7320 653a 0a20 2020 2020  ror) as e:.     
+000107a0: 2020 2020 2020 2072 6169 7365 2054 656d         raise Tem
+000107b0: 706f 7261 7279 4572 726f 7228 0a20 2020  poraryError(.   
+000107c0: 2020 2020 2020 2020 2020 2020 2066 2743               f'C
+000107d0: 6f75 6c64 206e 6f74 206c 6f61 6420 6269  ould not load bi
+000107e0: 6473 2f61 736b 7320 6475 6520 746f 207b  ds/asks due to {
+000107f0: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
+00010800: 6d65 5f5f 7d2e 204d 6573 7361 6765 3a20  me__}. Message: 
+00010810: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
+00010820: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
+00010830: 2e42 6173 6545 7272 6f72 2061 7320 653a  .BaseError as e:
+00010840: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00010850: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
+00010860: 6365 7074 696f 6e28 6529 2066 726f 6d20  ception(e) from 
+00010870: 650a 0a20 2020 2040 7265 7472 6965 720a  e..    @retrier.
+00010880: 2020 2020 6465 6620 6765 745f 7469 636b      def get_tick
+00010890: 6572 7328 7365 6c66 2c20 7379 6d62 6f6c  ers(self, symbol
+000108a0: 733a 204f 7074 696f 6e61 6c5b 4c69 7374  s: Optional[List
+000108b0: 5b73 7472 5d5d 203d 204e 6f6e 652c 2063  [str]] = None, c
+000108c0: 6163 6865 643a 2062 6f6f 6c20 3d20 4661  ached: bool = Fa
+000108d0: 6c73 6529 202d 3e20 5469 636b 6572 733a  lse) -> Tickers:
+000108e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000108f0: 2020 2020 203a 7061 7261 6d20 6361 6368       :param cach
+00010900: 6564 3a20 416c 6c6f 7720 6361 6368 6564  ed: Allow cached
+00010910: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
+00010920: 3a72 6574 7572 6e3a 2066 6574 6368 5f74  :return: fetch_t
+00010930: 6963 6b65 7273 2072 6573 756c 740a 2020  ickers result.  
+00010940: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00010950: 2020 7469 636b 6572 733a 2054 6963 6b65    tickers: Ticke
+00010960: 7273 0a20 2020 2020 2020 2069 6620 6e6f  rs.        if no
+00010970: 7420 7365 6c66 2e65 7863 6861 6e67 655f  t self.exchange_
+00010980: 6861 7328 2766 6574 6368 5469 636b 6572  has('fetchTicker
+00010990: 7327 293a 0a20 2020 2020 2020 2020 2020  s'):.           
+000109a0: 2072 6574 7572 6e20 7b7d 0a20 2020 2020   return {}.     
+000109b0: 2020 2069 6620 6361 6368 6564 3a0a 2020     if cached:.  
+000109c0: 2020 2020 2020 2020 2020 7769 7468 2073            with s
+000109d0: 656c 662e 5f63 6163 6865 5f6c 6f63 6b3a  elf._cache_lock:
+000109e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000109f0: 2074 6963 6b65 7273 203d 2073 656c 662e   tickers = self.
+00010a00: 5f66 6574 6368 5f74 6963 6b65 7273 5f63  _fetch_tickers_c
+00010a10: 6163 6865 2e67 6574 2827 6665 7463 685f  ache.get('fetch_
+00010a20: 7469 636b 6572 7327 2920 2023 2074 7970  tickers')  # typ
+00010a30: 653a 2069 676e 6f72 650a 2020 2020 2020  e: ignore.      
+00010a40: 2020 2020 2020 6966 2074 6963 6b65 7273        if tickers
+00010a50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010a60: 2020 7265 7475 726e 2074 6963 6b65 7273    return tickers
+00010a70: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00010a80: 2020 2020 2020 2020 2020 7469 636b 6572            ticker
+00010a90: 7320 3d20 7365 6c66 2e5f 6170 692e 6665  s = self._api.fe
+00010aa0: 7463 685f 7469 636b 6572 7328 7379 6d62  tch_tickers(symb
+00010ab0: 6f6c 7329 0a20 2020 2020 2020 2020 2020  ols).           
+00010ac0: 2077 6974 6820 7365 6c66 2e5f 6361 6368   with self._cach
+00010ad0: 655f 6c6f 636b 3a0a 2020 2020 2020 2020  e_lock:.        
+00010ae0: 2020 2020 2020 2020 7365 6c66 2e5f 6665          self._fe
+00010af0: 7463 685f 7469 636b 6572 735f 6361 6368  tch_tickers_cach
+00010b00: 655b 2766 6574 6368 5f74 6963 6b65 7273  e['fetch_tickers
+00010b10: 275d 203d 2074 6963 6b65 7273 0a20 2020  '] = tickers.   
+00010b20: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00010b30: 7469 636b 6572 730a 2020 2020 2020 2020  tickers.        
+00010b40: 6578 6365 7074 2063 6378 742e 4e6f 7453  except ccxt.NotS
+00010b50: 7570 706f 7274 6564 2061 7320 653a 0a20  upported as e:. 
+00010b60: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00010b70: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
+00010b80: 7074 696f 6e28 0a20 2020 2020 2020 2020  ption(.         
+00010b90: 2020 2020 2020 2066 2745 7863 6861 6e67         f'Exchang
+00010ba0: 6520 7b73 656c 662e 5f61 7069 2e6e 616d  e {self._api.nam
+00010bb0: 657d 2064 6f65 7320 6e6f 7420 7375 7070  e} does not supp
+00010bc0: 6f72 7420 6665 7463 6869 6e67 2074 6963  ort fetching tic
+00010bd0: 6b65 7273 2069 6e20 6261 7463 682e 2027  kers in batch. '
+00010be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010bf0: 2066 274d 6573 7361 6765 3a20 7b65 7d27   f'Message: {e}'
+00010c00: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
+00010c10: 2065 7863 6570 7420 6363 7874 2e44 446f   except ccxt.DDo
+00010c20: 5350 726f 7465 6374 696f 6e20 6173 2065  SProtection as e
+00010c30: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00010c40: 6973 6520 4444 6f73 5072 6f74 6563 7469  ise DDosProtecti
+00010c50: 6f6e 2865 2920 6672 6f6d 2065 0a20 2020  on(e) from e.   
+00010c60: 2020 2020 2065 7863 6570 7420 2863 6378       except (ccx
+00010c70: 742e 4e65 7477 6f72 6b45 7272 6f72 2c20  t.NetworkError, 
+00010c80: 6363 7874 2e45 7863 6861 6e67 6545 7272  ccxt.ExchangeErr
+00010c90: 6f72 2920 6173 2065 3a0a 2020 2020 2020  or) as e:.      
+00010ca0: 2020 2020 2020 7261 6973 6520 5465 6d70        raise Temp
+00010cb0: 6f72 6172 7945 7272 6f72 280a 2020 2020  oraryError(.    
+00010cc0: 2020 2020 2020 2020 2020 2020 6627 436f              f'Co
+00010cd0: 756c 6420 6e6f 7420 6c6f 6164 2074 6963  uld not load tic
+00010ce0: 6b65 7273 2064 7565 2074 6f20 7b65 2e5f  kers due to {e._
+00010cf0: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
+00010d00: 5f7d 2e20 4d65 7373 6167 653a 207b 657d  _}. Message: {e}
+00010d10: 2729 2066 726f 6d20 650a 2020 2020 2020  ') from e.      
+00010d20: 2020 6578 6365 7074 2063 6378 742e 4261    except ccxt.Ba
+00010d30: 7365 4572 726f 7220 6173 2065 3a0a 2020  seError as e:.  
+00010d40: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00010d50: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
+00010d60: 7469 6f6e 2865 2920 6672 6f6d 2065 0a0a  tion(e) from e..
+00010d70: 2020 2020 2320 5072 6963 696e 6720 696e      # Pricing in
+00010d80: 666f 0a0a 2020 2020 4072 6574 7269 6572  fo..    @retrier
+00010d90: 0a20 2020 2064 6566 2066 6574 6368 5f74  .    def fetch_t
+00010da0: 6963 6b65 7228 7365 6c66 2c20 7061 6972  icker(self, pair
+00010db0: 3a20 7374 7229 202d 3e20 5469 636b 6572  : str) -> Ticker
+00010dc0: 3a0a 2020 2020 2020 2020 7472 793a 0a20  :.        try:. 
+00010dd0: 2020 2020 2020 2020 2020 2069 6620 2870             if (p
+00010de0: 6169 7220 6e6f 7420 696e 2073 656c 662e  air not in self.
+00010df0: 6d61 726b 6574 7320 6f72 0a20 2020 2020  markets or.     
+00010e00: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00010e10: 656c 662e 6d61 726b 6574 735b 7061 6972  elf.markets[pair
+00010e20: 5d2e 6765 7428 2761 6374 6976 6527 2c20  ].get('active', 
+00010e30: 4661 6c73 6529 2069 7320 4661 6c73 6529  False) is False)
+00010e40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010e50: 2020 7261 6973 6520 4578 6368 616e 6765    raise Exchange
+00010e60: 4572 726f 7228 6622 5061 6972 207b 7061  Error(f"Pair {pa
+00010e70: 6972 7d20 6e6f 7420 6176 6169 6c61 626c  ir} not availabl
+00010e80: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
+00010e90: 6461 7461 3a20 5469 636b 6572 203d 2073  data: Ticker = s
+00010ea0: 656c 662e 5f61 7069 2e66 6574 6368 5f74  elf._api.fetch_t
+00010eb0: 6963 6b65 7228 7061 6972 290a 2020 2020  icker(pair).    
+00010ec0: 2020 2020 2020 2020 7265 7475 726e 2064          return d
+00010ed0: 6174 610a 2020 2020 2020 2020 6578 6365  ata.        exce
+00010ee0: 7074 2063 6378 742e 4444 6f53 5072 6f74  pt ccxt.DDoSProt
+00010ef0: 6563 7469 6f6e 2061 7320 653a 0a20 2020  ection as e:.   
+00010f00: 2020 2020 2020 2020 2072 6169 7365 2044           raise D
+00010f10: 446f 7350 726f 7465 6374 696f 6e28 6529  DosProtection(e)
+00010f20: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
+00010f30: 6578 6365 7074 2028 6363 7874 2e4e 6574  except (ccxt.Net
+00010f40: 776f 726b 4572 726f 722c 2063 6378 742e  workError, ccxt.
+00010f50: 4578 6368 616e 6765 4572 726f 7229 2061  ExchangeError) a
+00010f60: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+00010f70: 2072 6169 7365 2054 656d 706f 7261 7279   raise Temporary
+00010f80: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00010f90: 2020 2020 2020 2066 2743 6f75 6c64 206e         f'Could n
+00010fa0: 6f74 206c 6f61 6420 7469 636b 6572 2064  ot load ticker d
+00010fb0: 7565 2074 6f20 7b65 2e5f 5f63 6c61 7373  ue to {e.__class
+00010fc0: 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20 4d65  __.__name__}. Me
+00010fd0: 7373 6167 653a 207b 657d 2729 2066 726f  ssage: {e}') fro
+00010fe0: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
+00010ff0: 7074 2063 6378 742e 4261 7365 4572 726f  pt ccxt.BaseErro
+00011000: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
+00011010: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
+00011020: 696f 6e61 6c45 7863 6570 7469 6f6e 2865  ionalException(e
+00011030: 2920 6672 6f6d 2065 0a0a 2020 2020 4073  ) from e..    @s
+00011040: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
+00011050: 6465 6620 6765 745f 6e65 7874 5f6c 696d  def get_next_lim
+00011060: 6974 5f69 6e5f 6c69 7374 286c 696d 6974  it_in_list(limit
+00011070: 3a20 696e 742c 206c 696d 6974 5f72 616e  : int, limit_ran
+00011080: 6765 3a20 4f70 7469 6f6e 616c 5b4c 6973  ge: Optional[Lis
+00011090: 745b 696e 745d 5d2c 0a20 2020 2020 2020  t[int]],.       
 000110a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000110b0: 2072 616e 6765 5f72 6571 7569 7265 643a   range_required:
-000110c0: 2062 6f6f 6c20 3d20 5472 7565 293a 0a20   bool = True):. 
-000110d0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000110e0: 2020 2047 6574 206e 6578 7420 6772 6561     Get next grea
-000110f0: 7465 7220 7661 6c75 6520 696e 2074 6865  ter value in the
-00011100: 206c 6973 742e 0a20 2020 2020 2020 2055   list..        U
-00011110: 7365 6420 6279 2066 6574 6368 5f6c 325f  sed by fetch_l2_
-00011120: 6f72 6465 725f 626f 6f6b 2069 6620 7468  order_book if th
-00011130: 6520 6170 6920 6f6e 6c79 2073 7570 706f  e api only suppo
-00011140: 7274 7320 6120 6c69 6d69 7465 6420 7261  rts a limited ra
-00011150: 6e67 650a 2020 2020 2020 2020 2222 220a  nge.        """.
-00011160: 2020 2020 2020 2020 6966 206e 6f74 206c          if not l
-00011170: 696d 6974 5f72 616e 6765 3a0a 2020 2020  imit_range:.    
-00011180: 2020 2020 2020 2020 7265 7475 726e 206c          return l
-00011190: 696d 6974 0a0a 2020 2020 2020 2020 7265  imit..        re
-000111a0: 7375 6c74 203d 206d 696e 285b 7820 666f  sult = min([x fo
-000111b0: 7220 7820 696e 206c 696d 6974 5f72 616e  r x in limit_ran
-000111c0: 6765 2069 6620 6c69 6d69 7420 3c3d 2078  ge if limit <= x
-000111d0: 5d20 2b20 5b6d 6178 286c 696d 6974 5f72  ] + [max(limit_r
-000111e0: 616e 6765 295d 290a 2020 2020 2020 2020  ange)]).        
-000111f0: 6966 206e 6f74 2072 616e 6765 5f72 6571  if not range_req
-00011200: 7569 7265 6420 616e 6420 6c69 6d69 7420  uired and limit 
-00011210: 3e20 7265 7375 6c74 3a0a 2020 2020 2020  > result:.      
-00011220: 2020 2020 2020 2320 5261 6e67 6520 6973        # Range is
-00011230: 206e 6f74 2072 6571 7569 7265 6420 2d20   not required - 
-00011240: 7765 2063 616e 2075 7365 204e 6f6e 6520  we can use None 
-00011250: 6173 2070 6172 616d 6574 6572 2e0a 2020  as parameter..  
-00011260: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00011270: 204e 6f6e 650a 2020 2020 2020 2020 7265   None.        re
-00011280: 7475 726e 2072 6573 756c 740a 0a20 2020  turn result..   
-00011290: 2040 7265 7472 6965 720a 2020 2020 6465   @retrier.    de
-000112a0: 6620 6665 7463 685f 6c32 5f6f 7264 6572  f fetch_l2_order
-000112b0: 5f62 6f6f 6b28 7365 6c66 2c20 7061 6972  _book(self, pair
-000112c0: 3a20 7374 722c 206c 696d 6974 3a20 696e  : str, limit: in
-000112d0: 7420 3d20 3130 3029 202d 3e20 4f72 6465  t = 100) -> Orde
-000112e0: 7242 6f6f 6b3a 0a20 2020 2020 2020 2022  rBook:.        "
-000112f0: 2222 0a20 2020 2020 2020 2047 6574 204c  "".        Get L
-00011300: 3220 6f72 6465 7220 626f 6f6b 2066 726f  2 order book fro
-00011310: 6d20 6578 6368 616e 6765 2e0a 2020 2020  m exchange..    
-00011320: 2020 2020 4361 6e20 6265 206c 696d 6974      Can be limit
-00011330: 6564 2074 6f20 6120 6365 7274 6169 6e20  ed to a certain 
-00011340: 616d 6f75 6e74 2028 6966 2073 7570 706f  amount (if suppo
-00011350: 7274 6564 292e 0a20 2020 2020 2020 2052  rted)..        R
-00011360: 6574 7572 6e73 2061 2064 6963 7420 696e  eturns a dict in
-00011370: 2074 6865 2066 6f72 6d61 740a 2020 2020   the format.    
-00011380: 2020 2020 7b27 6173 6b73 273a 205b 7072      {'asks': [pr
-00011390: 6963 652c 2076 6f6c 756d 655d 2c20 2762  ice, volume], 'b
-000113a0: 6964 7327 3a20 5b70 7269 6365 2c20 766f  ids': [price, vo
-000113b0: 6c75 6d65 5d7d 0a20 2020 2020 2020 2022  lume]}.        "
-000113c0: 2222 0a20 2020 2020 2020 206c 696d 6974  "".        limit
-000113d0: 3120 3d20 7365 6c66 2e67 6574 5f6e 6578  1 = self.get_nex
-000113e0: 745f 6c69 6d69 745f 696e 5f6c 6973 7428  t_limit_in_list(
-000113f0: 6c69 6d69 742c 2073 656c 662e 5f66 745f  limit, self._ft_
-00011400: 6861 735b 276c 325f 6c69 6d69 745f 7261  has['l2_limit_ra
-00011410: 6e67 6527 5d2c 0a20 2020 2020 2020 2020  nge'],.         
+000110b0: 2020 2020 2020 2020 7261 6e67 655f 7265          range_re
+000110c0: 7175 6972 6564 3a20 626f 6f6c 203d 2054  quired: bool = T
+000110d0: 7275 6529 3a0a 2020 2020 2020 2020 2222  rue):.        ""
+000110e0: 220a 2020 2020 2020 2020 4765 7420 6e65  ".        Get ne
+000110f0: 7874 2067 7265 6174 6572 2076 616c 7565  xt greater value
+00011100: 2069 6e20 7468 6520 6c69 7374 2e0a 2020   in the list..  
+00011110: 2020 2020 2020 5573 6564 2062 7920 6665        Used by fe
+00011120: 7463 685f 6c32 5f6f 7264 6572 5f62 6f6f  tch_l2_order_boo
+00011130: 6b20 6966 2074 6865 2061 7069 206f 6e6c  k if the api onl
+00011140: 7920 7375 7070 6f72 7473 2061 206c 696d  y supports a lim
+00011150: 6974 6564 2072 616e 6765 0a20 2020 2020  ited range.     
+00011160: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00011170: 6620 6e6f 7420 6c69 6d69 745f 7261 6e67  f not limit_rang
+00011180: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00011190: 6574 7572 6e20 6c69 6d69 740a 0a20 2020  eturn limit..   
+000111a0: 2020 2020 2072 6573 756c 7420 3d20 6d69       result = mi
+000111b0: 6e28 5b78 2066 6f72 2078 2069 6e20 6c69  n([x for x in li
+000111c0: 6d69 745f 7261 6e67 6520 6966 206c 696d  mit_range if lim
+000111d0: 6974 203c 3d20 785d 202b 205b 6d61 7828  it <= x] + [max(
+000111e0: 6c69 6d69 745f 7261 6e67 6529 5d29 0a20  limit_range)]). 
+000111f0: 2020 2020 2020 2069 6620 6e6f 7420 7261         if not ra
+00011200: 6e67 655f 7265 7175 6972 6564 2061 6e64  nge_required and
+00011210: 206c 696d 6974 203e 2072 6573 756c 743a   limit > result:
+00011220: 0a20 2020 2020 2020 2020 2020 2023 2052  .            # R
+00011230: 616e 6765 2069 7320 6e6f 7420 7265 7175  ange is not requ
+00011240: 6972 6564 202d 2077 6520 6361 6e20 7573  ired - we can us
+00011250: 6520 4e6f 6e65 2061 7320 7061 7261 6d65  e None as parame
+00011260: 7465 722e 0a20 2020 2020 2020 2020 2020  ter..           
+00011270: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
+00011280: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
+00011290: 6c74 0a0a 2020 2020 4072 6574 7269 6572  lt..    @retrier
+000112a0: 0a20 2020 2064 6566 2066 6574 6368 5f6c  .    def fetch_l
+000112b0: 325f 6f72 6465 725f 626f 6f6b 2873 656c  2_order_book(sel
+000112c0: 662c 2070 6169 723a 2073 7472 2c20 6c69  f, pair: str, li
+000112d0: 6d69 743a 2069 6e74 203d 2031 3030 2920  mit: int = 100) 
+000112e0: 2d3e 204f 7264 6572 426f 6f6b 3a0a 2020  -> OrderBook:.  
+000112f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00011300: 2020 4765 7420 4c32 206f 7264 6572 2062    Get L2 order b
+00011310: 6f6f 6b20 6672 6f6d 2065 7863 6861 6e67  ook from exchang
+00011320: 652e 0a20 2020 2020 2020 2043 616e 2062  e..        Can b
+00011330: 6520 6c69 6d69 7465 6420 746f 2061 2063  e limited to a c
+00011340: 6572 7461 696e 2061 6d6f 756e 7420 2869  ertain amount (i
+00011350: 6620 7375 7070 6f72 7465 6429 2e0a 2020  f supported)..  
+00011360: 2020 2020 2020 5265 7475 726e 7320 6120        Returns a 
+00011370: 6469 6374 2069 6e20 7468 6520 666f 726d  dict in the form
+00011380: 6174 0a20 2020 2020 2020 207b 2761 736b  at.        {'ask
+00011390: 7327 3a20 5b70 7269 6365 2c20 766f 6c75  s': [price, volu
+000113a0: 6d65 5d2c 2027 6269 6473 273a 205b 7072  me], 'bids': [pr
+000113b0: 6963 652c 2076 6f6c 756d 655d 7d0a 2020  ice, volume]}.  
+000113c0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000113d0: 2020 6c69 6d69 7431 203d 2073 656c 662e    limit1 = self.
+000113e0: 6765 745f 6e65 7874 5f6c 696d 6974 5f69  get_next_limit_i
+000113f0: 6e5f 6c69 7374 286c 696d 6974 2c20 7365  n_list(limit, se
+00011400: 6c66 2e5f 6674 5f68 6173 5b27 6c32 5f6c  lf._ft_has['l2_l
+00011410: 696d 6974 5f72 616e 6765 275d 2c0a 2020  imit_range'],.  
 00011420: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00011430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011440: 2020 2020 7365 6c66 2e5f 6674 5f68 6173      self._ft_has
-00011450: 5b27 6c32 5f6c 696d 6974 5f72 616e 6765  ['l2_limit_range
-00011460: 5f72 6571 7569 7265 6427 5d29 0a20 2020  _required']).   
-00011470: 2020 2020 2074 7279 3a0a 0a20 2020 2020       try:..     
-00011480: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00011490: 6c66 2e5f 6170 692e 6665 7463 685f 6c32  lf._api.fetch_l2
-000114a0: 5f6f 7264 6572 5f62 6f6f 6b28 7061 6972  _order_book(pair
-000114b0: 2c20 6c69 6d69 7431 290a 2020 2020 2020  , limit1).      
-000114c0: 2020 6578 6365 7074 2063 6378 742e 4e6f    except ccxt.No
-000114d0: 7453 7570 706f 7274 6564 2061 7320 653a  tSupported as e:
-000114e0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-000114f0: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
-00011500: 6365 7074 696f 6e28 0a20 2020 2020 2020  ception(.       
-00011510: 2020 2020 2020 2020 2066 2745 7863 6861           f'Excha
-00011520: 6e67 6520 7b73 656c 662e 5f61 7069 2e6e  nge {self._api.n
-00011530: 616d 657d 2064 6f65 7320 6e6f 7420 7375  ame} does not su
-00011540: 7070 6f72 7420 6665 7463 6869 6e67 206f  pport fetching o
-00011550: 7264 6572 2062 6f6f 6b2e 270a 2020 2020  rder book.'.    
-00011560: 2020 2020 2020 2020 2020 2020 6627 4d65              f'Me
-00011570: 7373 6167 653a 207b 657d 2729 2066 726f  ssage: {e}') fro
-00011580: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
-00011590: 7074 2063 6378 742e 4444 6f53 5072 6f74  pt ccxt.DDoSProt
-000115a0: 6563 7469 6f6e 2061 7320 653a 0a20 2020  ection as e:.   
-000115b0: 2020 2020 2020 2020 2072 6169 7365 2044           raise D
-000115c0: 446f 7350 726f 7465 6374 696f 6e28 6529  DosProtection(e)
-000115d0: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-000115e0: 6578 6365 7074 2028 6363 7874 2e4e 6574  except (ccxt.Net
-000115f0: 776f 726b 4572 726f 722c 2063 6378 742e  workError, ccxt.
-00011600: 4578 6368 616e 6765 4572 726f 7229 2061  ExchangeError) a
-00011610: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-00011620: 2072 6169 7365 2054 656d 706f 7261 7279   raise Temporary
-00011630: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00011640: 2020 2020 2020 2066 2743 6f75 6c64 206e         f'Could n
-00011650: 6f74 2067 6574 206f 7264 6572 2062 6f6f  ot get order boo
-00011660: 6b20 6475 6520 746f 207b 652e 5f5f 636c  k due to {e.__cl
-00011670: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d2e  ass__.__name__}.
-00011680: 204d 6573 7361 6765 3a20 7b65 7d27 2920   Message: {e}') 
-00011690: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
-000116a0: 7863 6570 7420 6363 7874 2e42 6173 6545  xcept ccxt.BaseE
-000116b0: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
-000116c0: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
-000116d0: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
-000116e0: 6e28 6529 2066 726f 6d20 650a 0a20 2020  n(e) from e..   
-000116f0: 2064 6566 205f 6765 745f 7072 6963 655f   def _get_price_
-00011700: 7369 6465 2873 656c 662c 2073 6964 653a  side(self, side:
-00011710: 2073 7472 2c20 6973 5f73 686f 7274 3a20   str, is_short: 
-00011720: 626f 6f6c 2c20 636f 6e66 5f73 7472 6174  bool, conf_strat
-00011730: 6567 793a 2044 6963 7429 202d 3e20 4269  egy: Dict) -> Bi
-00011740: 6441 736b 3a0a 2020 2020 2020 2020 7072  dAsk:.        pr
-00011750: 6963 655f 7369 6465 203d 2063 6f6e 665f  ice_side = conf_
-00011760: 7374 7261 7465 6779 5b27 7072 6963 655f  strategy['price_
-00011770: 7369 6465 275d 0a0a 2020 2020 2020 2020  side']..        
-00011780: 6966 2070 7269 6365 5f73 6964 6520 696e  if price_side in
-00011790: 2028 2773 616d 6527 2c20 276f 7468 6572   ('same', 'other
-000117a0: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-000117b0: 7072 6963 655f 6d61 7020 3d20 7b0a 2020  price_map = {.  
-000117c0: 2020 2020 2020 2020 2020 2020 2020 2827                ('
-000117d0: 656e 7472 7927 2c20 276c 6f6e 6727 2c20  entry', 'long', 
-000117e0: 2773 616d 6527 293a 2027 6269 6427 2c0a  'same'): 'bid',.
-000117f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011800: 2827 656e 7472 7927 2c20 276c 6f6e 6727  ('entry', 'long'
-00011810: 2c20 276f 7468 6572 2729 3a20 2761 736b  , 'other'): 'ask
-00011820: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-00011830: 2020 2028 2765 6e74 7279 272c 2027 7368     ('entry', 'sh
-00011840: 6f72 7427 2c20 2773 616d 6527 293a 2027  ort', 'same'): '
-00011850: 6173 6b27 2c0a 2020 2020 2020 2020 2020  ask',.          
-00011860: 2020 2020 2020 2827 656e 7472 7927 2c20        ('entry', 
-00011870: 2773 686f 7274 272c 2027 6f74 6865 7227  'short', 'other'
-00011880: 293a 2027 6269 6427 2c0a 2020 2020 2020  ): 'bid',.      
-00011890: 2020 2020 2020 2020 2020 2827 6578 6974            ('exit
-000118a0: 272c 2027 6c6f 6e67 272c 2027 7361 6d65  ', 'long', 'same
-000118b0: 2729 3a20 2761 736b 272c 0a20 2020 2020  '): 'ask',.     
-000118c0: 2020 2020 2020 2020 2020 2028 2765 7869             ('exi
-000118d0: 7427 2c20 276c 6f6e 6727 2c20 276f 7468  t', 'long', 'oth
-000118e0: 6572 2729 3a20 2762 6964 272c 0a20 2020  er'): 'bid',.   
-000118f0: 2020 2020 2020 2020 2020 2020 2028 2765               ('e
-00011900: 7869 7427 2c20 2773 686f 7274 272c 2027  xit', 'short', '
-00011910: 7361 6d65 2729 3a20 2762 6964 272c 0a20  same'): 'bid',. 
-00011920: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00011930: 2765 7869 7427 2c20 2773 686f 7274 272c  'exit', 'short',
-00011940: 2027 6f74 6865 7227 293a 2027 6173 6b27   'other'): 'ask'
-00011950: 2c0a 2020 2020 2020 2020 2020 2020 7d0a  ,.            }.
-00011960: 2020 2020 2020 2020 2020 2020 7072 6963              pric
-00011970: 655f 7369 6465 203d 2070 7269 6365 5f6d  e_side = price_m
-00011980: 6170 5b28 7369 6465 2c20 2773 686f 7274  ap[(side, 'short
-00011990: 2720 6966 2069 735f 7368 6f72 7420 656c  ' if is_short el
-000119a0: 7365 2027 6c6f 6e67 272c 2070 7269 6365  se 'long', price
-000119b0: 5f73 6964 6529 5d0a 2020 2020 2020 2020  _side)].        
-000119c0: 7265 7475 726e 2070 7269 6365 5f73 6964  return price_sid
-000119d0: 650a 0a20 2020 2064 6566 2067 6574 5f72  e..    def get_r
-000119e0: 6174 6528 7365 6c66 2c20 7061 6972 3a20  ate(self, pair: 
-000119f0: 7374 722c 2072 6566 7265 7368 3a20 626f  str, refresh: bo
-00011a00: 6f6c 2c0a 2020 2020 2020 2020 2020 2020  ol,.            
-00011a10: 2020 2020 2073 6964 653a 2045 6e74 7279       side: Entry
-00011a20: 4578 6974 2c20 6973 5f73 686f 7274 3a20  Exit, is_short: 
-00011a30: 626f 6f6c 2c0a 2020 2020 2020 2020 2020  bool,.          
-00011a40: 2020 2020 2020 206f 7264 6572 5f62 6f6f         order_boo
-00011a50: 6b3a 204f 7074 696f 6e61 6c5b 4f72 6465  k: Optional[Orde
-00011a60: 7242 6f6f 6b5d 203d 204e 6f6e 652c 2074  rBook] = None, t
-00011a70: 6963 6b65 723a 204f 7074 696f 6e61 6c5b  icker: Optional[
-00011a80: 5469 636b 6572 5d20 3d20 4e6f 6e65 2920  Ticker] = None) 
-00011a90: 2d3e 2066 6c6f 6174 3a0a 2020 2020 2020  -> float:.      
-00011aa0: 2020 2222 220a 2020 2020 2020 2020 4361    """.        Ca
-00011ab0: 6c63 756c 6174 6573 2062 6964 2f61 736b  lculates bid/ask
-00011ac0: 2074 6172 6765 740a 2020 2020 2020 2020   target.        
-00011ad0: 6269 6420 7261 7465 202d 2062 6574 7765  bid rate - betwe
-00011ae0: 656e 2063 7572 7265 6e74 2061 736b 2070  en current ask p
-00011af0: 7269 6365 2061 6e64 206c 6173 7420 7072  rice and last pr
-00011b00: 6963 650a 2020 2020 2020 2020 6173 6b20  ice.        ask 
-00011b10: 7261 7465 202d 2065 6974 6865 7220 7573  rate - either us
-00011b20: 696e 6720 7469 636b 6572 2062 6964 206f  ing ticker bid o
-00011b30: 7220 6669 7273 7420 6269 6420 6261 7365  r first bid base
-00011b40: 6420 6f6e 206f 7264 6572 626f 6f6b 0a20  d on orderbook. 
-00011b50: 2020 2020 2020 206f 7220 7265 6d61 696e         or remain
-00011b60: 2073 7461 7469 6320 696e 2061 6e79 206f   static in any o
-00011b70: 7468 6572 2063 6173 6520 7369 6e63 6520  ther case since 
-00011b80: 6974 2773 206e 6f74 2075 7064 6174 696e  it's not updatin
-00011b90: 672e 0a20 2020 2020 2020 203a 7061 7261  g..        :para
-00011ba0: 6d20 7061 6972 3a20 5061 6972 2074 6f20  m pair: Pair to 
-00011bb0: 6765 7420 7261 7465 2066 6f72 0a20 2020  get rate for.   
-00011bc0: 2020 2020 203a 7061 7261 6d20 7265 6672       :param refr
-00011bd0: 6573 683a 2061 6c6c 6f77 2063 6163 6865  esh: allow cache
-00011be0: 6420 6461 7461 0a20 2020 2020 2020 203a  d data.        :
-00011bf0: 7061 7261 6d20 7369 6465 3a20 2262 7579  param side: "buy
-00011c00: 2220 6f72 2022 7365 6c6c 220a 2020 2020  " or "sell".    
-00011c10: 2020 2020 3a72 6574 7572 6e3a 2066 6c6f      :return: flo
-00011c20: 6174 3a20 5072 6963 650a 2020 2020 2020  at: Price.      
-00011c30: 2020 3a72 6169 7365 7320 5072 6963 696e    :raises Pricin
-00011c40: 6745 7272 6f72 2069 6620 6f72 6465 7262  gError if orderb
-00011c50: 6f6f 6b20 7072 6963 6520 636f 756c 6420  ook price could 
-00011c60: 6e6f 7420 6265 2064 6574 6572 6d69 6e65  not be determine
-00011c70: 642e 0a20 2020 2020 2020 2022 2222 0a20  d..        """. 
-00011c80: 2020 2020 2020 206e 616d 6520 3d20 7369         name = si
-00011c90: 6465 2e63 6170 6974 616c 697a 6528 290a  de.capitalize().
-00011ca0: 2020 2020 2020 2020 7374 7261 745f 6e61          strat_na
-00011cb0: 6d65 203d 2027 656e 7472 795f 7072 6963  me = 'entry_pric
-00011cc0: 696e 6727 2069 6620 7369 6465 203d 3d20  ing' if side == 
-00011cd0: 2265 6e74 7279 2220 656c 7365 2027 6578  "entry" else 'ex
-00011ce0: 6974 5f70 7269 6369 6e67 270a 0a20 2020  it_pricing'..   
-00011cf0: 2020 2020 2063 6163 6865 5f72 6174 653a       cache_rate:
-00011d00: 2054 544c 4361 6368 6520 3d20 7365 6c66   TTLCache = self
-00011d10: 2e5f 656e 7472 795f 7261 7465 5f63 6163  ._entry_rate_cac
-00011d20: 6865 2069 6620 7369 6465 203d 3d20 2265  he if side == "e
-00011d30: 6e74 7279 2220 656c 7365 2073 656c 662e  ntry" else self.
-00011d40: 5f65 7869 745f 7261 7465 5f63 6163 6865  _exit_rate_cache
-00011d50: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00011d60: 7265 6672 6573 683a 0a20 2020 2020 2020  refresh:.       
-00011d70: 2020 2020 2077 6974 6820 7365 6c66 2e5f       with self._
-00011d80: 6361 6368 655f 6c6f 636b 3a0a 2020 2020  cache_lock:.    
-00011d90: 2020 2020 2020 2020 2020 2020 7261 7465              rate
-00011da0: 203d 2063 6163 6865 5f72 6174 652e 6765   = cache_rate.ge
-00011db0: 7428 7061 6972 290a 2020 2020 2020 2020  t(pair).        
-00011dc0: 2020 2020 2320 4368 6563 6b20 6966 2063      # Check if c
-00011dd0: 6163 6865 2068 6173 2062 6565 6e20 696e  ache has been in
-00011de0: 7661 6c69 6461 7465 640a 2020 2020 2020  validated.      
-00011df0: 2020 2020 2020 6966 2072 6174 653a 0a20        if rate:. 
-00011e00: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00011e10: 6f67 6765 722e 6465 6275 6728 6622 5573  ogger.debug(f"Us
-00011e20: 696e 6720 6361 6368 6564 207b 7369 6465  ing cached {side
-00011e30: 7d20 7261 7465 2066 6f72 207b 7061 6972  } rate for {pair
-00011e40: 7d2e 2229 0a20 2020 2020 2020 2020 2020  }.").           
-00011e50: 2020 2020 2072 6574 7572 6e20 7261 7465       return rate
-00011e60: 0a0a 2020 2020 2020 2020 636f 6e66 5f73  ..        conf_s
-00011e70: 7472 6174 6567 7920 3d20 7365 6c66 2e5f  trategy = self._
-00011e80: 636f 6e66 6967 2e67 6574 2873 7472 6174  config.get(strat
-00011e90: 5f6e 616d 652c 207b 7d29 0a0a 2020 2020  _name, {})..    
-00011ea0: 2020 2020 7072 6963 655f 7369 6465 203d      price_side =
-00011eb0: 2073 656c 662e 5f67 6574 5f70 7269 6365   self._get_price
-00011ec0: 5f73 6964 6528 7369 6465 2c20 6973 5f73  _side(side, is_s
-00011ed0: 686f 7274 2c20 636f 6e66 5f73 7472 6174  hort, conf_strat
-00011ee0: 6567 7929 0a0a 2020 2020 2020 2020 7072  egy)..        pr
-00011ef0: 6963 655f 7369 6465 5f77 6f72 6420 3d20  ice_side_word = 
-00011f00: 7072 6963 655f 7369 6465 2e63 6170 6974  price_side.capit
-00011f10: 616c 697a 6528 290a 0a20 2020 2020 2020  alize()..       
-00011f20: 2069 6620 636f 6e66 5f73 7472 6174 6567   if conf_strateg
-00011f30: 792e 6765 7428 2775 7365 5f6f 7264 6572  y.get('use_order
-00011f40: 5f62 6f6f 6b27 2c20 4661 6c73 6529 3a0a  _book', False):.
-00011f50: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
-00011f60: 6572 5f62 6f6f 6b5f 746f 7020 3d20 636f  er_book_top = co
-00011f70: 6e66 5f73 7472 6174 6567 792e 6765 7428  nf_strategy.get(
-00011f80: 276f 7264 6572 5f62 6f6f 6b5f 746f 7027  'order_book_top'
-00011f90: 2c20 3129 0a20 2020 2020 2020 2020 2020  , 1).           
-00011fa0: 2069 6620 6f72 6465 725f 626f 6f6b 2069   if order_book i
-00011fb0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00011fc0: 2020 2020 2020 2020 6f72 6465 725f 626f          order_bo
-00011fd0: 6f6b 203d 2073 656c 662e 6665 7463 685f  ok = self.fetch_
-00011fe0: 6c32 5f6f 7264 6572 5f62 6f6f 6b28 7061  l2_order_book(pa
-00011ff0: 6972 2c20 6f72 6465 725f 626f 6f6b 5f74  ir, order_book_t
-00012000: 6f70 290a 2020 2020 2020 2020 2020 2020  op).            
-00012010: 6c6f 6767 6572 2e64 6562 7567 2827 6f72  logger.debug('or
-00012020: 6465 725f 626f 6f6b 2025 7327 2c20 6f72  der_book %s', or
-00012030: 6465 725f 626f 6f6b 290a 2020 2020 2020  der_book).      
-00012040: 2020 2020 2020 2320 746f 7020 3120 3d20        # top 1 = 
-00012050: 696e 6465 7820 300a 2020 2020 2020 2020  index 0.        
-00012060: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00012070: 2020 2020 2020 2020 206f 6273 6964 653a           obside:
-00012080: 204f 424c 6974 6572 616c 203d 2027 6269   OBLiteral = 'bi
-00012090: 6473 2720 6966 2070 7269 6365 5f73 6964  ds' if price_sid
-000120a0: 6520 3d3d 2027 6269 6427 2065 6c73 6520  e == 'bid' else 
-000120b0: 2761 736b 7327 0a20 2020 2020 2020 2020  'asks'.         
-000120c0: 2020 2020 2020 2072 6174 6520 3d20 6f72         rate = or
-000120d0: 6465 725f 626f 6f6b 5b6f 6273 6964 655d  der_book[obside]
-000120e0: 5b6f 7264 6572 5f62 6f6f 6b5f 746f 7020  [order_book_top 
-000120f0: 2d20 315d 5b30 5d0a 2020 2020 2020 2020  - 1][0].        
-00012100: 2020 2020 6578 6365 7074 2028 496e 6465      except (Inde
-00012110: 7845 7272 6f72 2c20 4b65 7945 7272 6f72  xError, KeyError
-00012120: 2920 6173 2065 3a0a 2020 2020 2020 2020  ) as e:.        
-00012130: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
-00012140: 6172 6e69 6e67 280a 2020 2020 2020 2020  arning(.        
-00012150: 2020 2020 2020 2020 2020 2020 6622 7b70              f"{p
-00012160: 6169 727d 202d 207b 6e61 6d65 7d20 5072  air} - {name} Pr
-00012170: 6963 6520 6174 206c 6f63 6174 696f 6e20  ice at location 
-00012180: 7b6f 7264 6572 5f62 6f6f 6b5f 746f 707d  {order_book_top}
-00012190: 2066 726f 6d20 6f72 6465 7262 6f6f 6b20   from orderbook 
-000121a0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000121b0: 2020 2020 2020 6622 636f 756c 6420 6e6f        f"could no
-000121c0: 7420 6265 2064 6574 6572 6d69 6e65 642e  t be determined.
-000121d0: 204f 7264 6572 626f 6f6b 3a20 7b6f 7264   Orderbook: {ord
-000121e0: 6572 5f62 6f6f 6b7d 220a 2020 2020 2020  er_book}".      
-000121f0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00012200: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00012210: 6520 5072 6963 696e 6745 7272 6f72 2066  e PricingError f
-00012220: 726f 6d20 650a 2020 2020 2020 2020 2020  rom e.          
-00012230: 2020 6c6f 6767 6572 2e64 6562 7567 2866    logger.debug(f
-00012240: 227b 7061 6972 7d20 2d20 7b6e 616d 657d  "{pair} - {name}
-00012250: 2070 7269 6365 2066 726f 6d20 6f72 6465   price from orde
-00012260: 7262 6f6f 6b20 7b70 7269 6365 5f73 6964  rbook {price_sid
-00012270: 655f 776f 7264 7d22 0a20 2020 2020 2020  e_word}".       
+00011440: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00011450: 5f66 745f 6861 735b 276c 325f 6c69 6d69  _ft_has['l2_limi
+00011460: 745f 7261 6e67 655f 7265 7175 6972 6564  t_range_required
+00011470: 275d 290a 2020 2020 2020 2020 7472 793a  ']).        try:
+00011480: 0a0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+00011490: 7475 726e 2073 656c 662e 5f61 7069 2e66  turn self._api.f
+000114a0: 6574 6368 5f6c 325f 6f72 6465 725f 626f  etch_l2_order_bo
+000114b0: 6f6b 2870 6169 722c 206c 696d 6974 3129  ok(pair, limit1)
+000114c0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+000114d0: 6363 7874 2e4e 6f74 5375 7070 6f72 7465  ccxt.NotSupporte
+000114e0: 6420 6173 2065 3a0a 2020 2020 2020 2020  d as e:.        
+000114f0: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
+00011500: 696f 6e61 6c45 7863 6570 7469 6f6e 280a  ionalException(.
+00011510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011520: 6627 4578 6368 616e 6765 207b 7365 6c66  f'Exchange {self
+00011530: 2e5f 6170 692e 6e61 6d65 7d20 646f 6573  ._api.name} does
+00011540: 206e 6f74 2073 7570 706f 7274 2066 6574   not support fet
+00011550: 6368 696e 6720 6f72 6465 7220 626f 6f6b  ching order book
+00011560: 2e27 0a20 2020 2020 2020 2020 2020 2020  .'.             
+00011570: 2020 2066 274d 6573 7361 6765 3a20 7b65     f'Message: {e
+00011580: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
+00011590: 2020 2065 7863 6570 7420 6363 7874 2e44     except ccxt.D
+000115a0: 446f 5350 726f 7465 6374 696f 6e20 6173  DoSProtection as
+000115b0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+000115c0: 7261 6973 6520 4444 6f73 5072 6f74 6563  raise DDosProtec
+000115d0: 7469 6f6e 2865 2920 6672 6f6d 2065 0a20  tion(e) from e. 
+000115e0: 2020 2020 2020 2065 7863 6570 7420 2863         except (c
+000115f0: 6378 742e 4e65 7477 6f72 6b45 7272 6f72  cxt.NetworkError
+00011600: 2c20 6363 7874 2e45 7863 6861 6e67 6545  , ccxt.ExchangeE
+00011610: 7272 6f72 2920 6173 2065 3a0a 2020 2020  rror) as e:.    
+00011620: 2020 2020 2020 2020 7261 6973 6520 5465          raise Te
+00011630: 6d70 6f72 6172 7945 7272 6f72 280a 2020  mporaryError(.  
+00011640: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+00011650: 436f 756c 6420 6e6f 7420 6765 7420 6f72  Could not get or
+00011660: 6465 7220 626f 6f6b 2064 7565 2074 6f20  der book due to 
+00011670: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
+00011680: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
+00011690: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
+000116a0: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
+000116b0: 742e 4261 7365 4572 726f 7220 6173 2065  t.BaseError as e
+000116c0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+000116d0: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+000116e0: 7863 6570 7469 6f6e 2865 2920 6672 6f6d  xception(e) from
+000116f0: 2065 0a0a 2020 2020 6465 6620 5f67 6574   e..    def _get
+00011700: 5f70 7269 6365 5f73 6964 6528 7365 6c66  _price_side(self
+00011710: 2c20 7369 6465 3a20 7374 722c 2069 735f  , side: str, is_
+00011720: 7368 6f72 743a 2062 6f6f 6c2c 2063 6f6e  short: bool, con
+00011730: 665f 7374 7261 7465 6779 3a20 4469 6374  f_strategy: Dict
+00011740: 2920 2d3e 2042 6964 4173 6b3a 0a20 2020  ) -> BidAsk:.   
+00011750: 2020 2020 2070 7269 6365 5f73 6964 6520       price_side 
+00011760: 3d20 636f 6e66 5f73 7472 6174 6567 795b  = conf_strategy[
+00011770: 2770 7269 6365 5f73 6964 6527 5d0a 0a20  'price_side'].. 
+00011780: 2020 2020 2020 2069 6620 7072 6963 655f         if price_
+00011790: 7369 6465 2069 6e20 2827 7361 6d65 272c  side in ('same',
+000117a0: 2027 6f74 6865 7227 293a 0a20 2020 2020   'other'):.     
+000117b0: 2020 2020 2020 2070 7269 6365 5f6d 6170         price_map
+000117c0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
+000117d0: 2020 2020 2028 2765 6e74 7279 272c 2027       ('entry', '
+000117e0: 6c6f 6e67 272c 2027 7361 6d65 2729 3a20  long', 'same'): 
+000117f0: 2762 6964 272c 0a20 2020 2020 2020 2020  'bid',.         
+00011800: 2020 2020 2020 2028 2765 6e74 7279 272c         ('entry',
+00011810: 2027 6c6f 6e67 272c 2027 6f74 6865 7227   'long', 'other'
+00011820: 293a 2027 6173 6b27 2c0a 2020 2020 2020  ): 'ask',.      
+00011830: 2020 2020 2020 2020 2020 2827 656e 7472            ('entr
+00011840: 7927 2c20 2773 686f 7274 272c 2027 7361  y', 'short', 'sa
+00011850: 6d65 2729 3a20 2761 736b 272c 0a20 2020  me'): 'ask',.   
+00011860: 2020 2020 2020 2020 2020 2020 2028 2765               ('e
+00011870: 6e74 7279 272c 2027 7368 6f72 7427 2c20  ntry', 'short', 
+00011880: 276f 7468 6572 2729 3a20 2762 6964 272c  'other'): 'bid',
+00011890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000118a0: 2028 2765 7869 7427 2c20 276c 6f6e 6727   ('exit', 'long'
+000118b0: 2c20 2773 616d 6527 293a 2027 6173 6b27  , 'same'): 'ask'
+000118c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000118d0: 2020 2827 6578 6974 272c 2027 6c6f 6e67    ('exit', 'long
+000118e0: 272c 2027 6f74 6865 7227 293a 2027 6269  ', 'other'): 'bi
+000118f0: 6427 2c0a 2020 2020 2020 2020 2020 2020  d',.            
+00011900: 2020 2020 2827 6578 6974 272c 2027 7368      ('exit', 'sh
+00011910: 6f72 7427 2c20 2773 616d 6527 293a 2027  ort', 'same'): '
+00011920: 6269 6427 2c0a 2020 2020 2020 2020 2020  bid',.          
+00011930: 2020 2020 2020 2827 6578 6974 272c 2027        ('exit', '
+00011940: 7368 6f72 7427 2c20 276f 7468 6572 2729  short', 'other')
+00011950: 3a20 2761 736b 272c 0a20 2020 2020 2020  : 'ask',.       
+00011960: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
+00011970: 2020 2070 7269 6365 5f73 6964 6520 3d20     price_side = 
+00011980: 7072 6963 655f 6d61 705b 2873 6964 652c  price_map[(side,
+00011990: 2027 7368 6f72 7427 2069 6620 6973 5f73   'short' if is_s
+000119a0: 686f 7274 2065 6c73 6520 276c 6f6e 6727  hort else 'long'
+000119b0: 2c20 7072 6963 655f 7369 6465 295d 0a20  , price_side)]. 
+000119c0: 2020 2020 2020 2072 6574 7572 6e20 7072         return pr
+000119d0: 6963 655f 7369 6465 0a0a 2020 2020 6465  ice_side..    de
+000119e0: 6620 6765 745f 7261 7465 2873 656c 662c  f get_rate(self,
+000119f0: 2070 6169 723a 2073 7472 2c20 7265 6672   pair: str, refr
+00011a00: 6573 683a 2062 6f6f 6c2c 0a20 2020 2020  esh: bool,.     
+00011a10: 2020 2020 2020 2020 2020 2020 7369 6465              side
+00011a20: 3a20 456e 7472 7945 7869 742c 2069 735f  : EntryExit, is_
+00011a30: 7368 6f72 743a 2062 6f6f 6c2c 0a20 2020  short: bool,.   
+00011a40: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00011a50: 6465 725f 626f 6f6b 3a20 4f70 7469 6f6e  der_book: Option
+00011a60: 616c 5b4f 7264 6572 426f 6f6b 5d20 3d20  al[OrderBook] = 
+00011a70: 4e6f 6e65 2c20 7469 636b 6572 3a20 4f70  None, ticker: Op
+00011a80: 7469 6f6e 616c 5b54 6963 6b65 725d 203d  tional[Ticker] =
+00011a90: 204e 6f6e 6529 202d 3e20 666c 6f61 743a   None) -> float:
+00011aa0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00011ab0: 2020 2020 2043 616c 6375 6c61 7465 7320       Calculates 
+00011ac0: 6269 642f 6173 6b20 7461 7267 6574 0a20  bid/ask target. 
+00011ad0: 2020 2020 2020 2062 6964 2072 6174 6520         bid rate 
+00011ae0: 2d20 6265 7477 6565 6e20 6375 7272 656e  - between curren
+00011af0: 7420 6173 6b20 7072 6963 6520 616e 6420  t ask price and 
+00011b00: 6c61 7374 2070 7269 6365 0a20 2020 2020  last price.     
+00011b10: 2020 2061 736b 2072 6174 6520 2d20 6569     ask rate - ei
+00011b20: 7468 6572 2075 7369 6e67 2074 6963 6b65  ther using ticke
+00011b30: 7220 6269 6420 6f72 2066 6972 7374 2062  r bid or first b
+00011b40: 6964 2062 6173 6564 206f 6e20 6f72 6465  id based on orde
+00011b50: 7262 6f6f 6b0a 2020 2020 2020 2020 6f72  rbook.        or
+00011b60: 2072 656d 6169 6e20 7374 6174 6963 2069   remain static i
+00011b70: 6e20 616e 7920 6f74 6865 7220 6361 7365  n any other case
+00011b80: 2073 696e 6365 2069 7427 7320 6e6f 7420   since it's not 
+00011b90: 7570 6461 7469 6e67 2e0a 2020 2020 2020  updating..      
+00011ba0: 2020 3a70 6172 616d 2070 6169 723a 2050    :param pair: P
+00011bb0: 6169 7220 746f 2067 6574 2072 6174 6520  air to get rate 
+00011bc0: 666f 720a 2020 2020 2020 2020 3a70 6172  for.        :par
+00011bd0: 616d 2072 6566 7265 7368 3a20 616c 6c6f  am refresh: allo
+00011be0: 7720 6361 6368 6564 2064 6174 610a 2020  w cached data.  
+00011bf0: 2020 2020 2020 3a70 6172 616d 2073 6964        :param sid
+00011c00: 653a 2022 6275 7922 206f 7220 2273 656c  e: "buy" or "sel
+00011c10: 6c22 0a20 2020 2020 2020 203a 7265 7475  l".        :retu
+00011c20: 726e 3a20 666c 6f61 743a 2050 7269 6365  rn: float: Price
+00011c30: 0a20 2020 2020 2020 203a 7261 6973 6573  .        :raises
+00011c40: 2050 7269 6369 6e67 4572 726f 7220 6966   PricingError if
+00011c50: 206f 7264 6572 626f 6f6b 2070 7269 6365   orderbook price
+00011c60: 2063 6f75 6c64 206e 6f74 2062 6520 6465   could not be de
+00011c70: 7465 726d 696e 6564 2e0a 2020 2020 2020  termined..      
+00011c80: 2020 2222 220a 2020 2020 2020 2020 6e61    """.        na
+00011c90: 6d65 203d 2073 6964 652e 6361 7069 7461  me = side.capita
+00011ca0: 6c69 7a65 2829 0a20 2020 2020 2020 2073  lize().        s
+00011cb0: 7472 6174 5f6e 616d 6520 3d20 2765 6e74  trat_name = 'ent
+00011cc0: 7279 5f70 7269 6369 6e67 2720 6966 2073  ry_pricing' if s
+00011cd0: 6964 6520 3d3d 2022 656e 7472 7922 2065  ide == "entry" e
+00011ce0: 6c73 6520 2765 7869 745f 7072 6963 696e  lse 'exit_pricin
+00011cf0: 6727 0a0a 2020 2020 2020 2020 6361 6368  g'..        cach
+00011d00: 655f 7261 7465 3a20 5454 4c43 6163 6865  e_rate: TTLCache
+00011d10: 203d 2073 656c 662e 5f65 6e74 7279 5f72   = self._entry_r
+00011d20: 6174 655f 6361 6368 6520 6966 2073 6964  ate_cache if sid
+00011d30: 6520 3d3d 2022 656e 7472 7922 2065 6c73  e == "entry" els
+00011d40: 6520 7365 6c66 2e5f 6578 6974 5f72 6174  e self._exit_rat
+00011d50: 655f 6361 6368 650a 2020 2020 2020 2020  e_cache.        
+00011d60: 6966 206e 6f74 2072 6566 7265 7368 3a0a  if not refresh:.
+00011d70: 2020 2020 2020 2020 2020 2020 7769 7468              with
+00011d80: 2073 656c 662e 5f63 6163 6865 5f6c 6f63   self._cache_loc
+00011d90: 6b3a 0a20 2020 2020 2020 2020 2020 2020  k:.             
+00011da0: 2020 2072 6174 6520 3d20 6361 6368 655f     rate = cache_
+00011db0: 7261 7465 2e67 6574 2870 6169 7229 0a20  rate.get(pair). 
+00011dc0: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
+00011dd0: 636b 2069 6620 6361 6368 6520 6861 7320  ck if cache has 
+00011de0: 6265 656e 2069 6e76 616c 6964 6174 6564  been invalidated
+00011df0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00011e00: 7261 7465 3a0a 2020 2020 2020 2020 2020  rate:.          
+00011e10: 2020 2020 2020 6c6f 6767 6572 2e64 6562        logger.deb
+00011e20: 7567 2866 2255 7369 6e67 2063 6163 6865  ug(f"Using cache
+00011e30: 6420 7b73 6964 657d 2072 6174 6520 666f  d {side} rate fo
+00011e40: 7220 7b70 6169 727d 2e22 290a 2020 2020  r {pair}.").    
+00011e50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00011e60: 726e 2072 6174 650a 0a20 2020 2020 2020  rn rate..       
+00011e70: 2063 6f6e 665f 7374 7261 7465 6779 203d   conf_strategy =
+00011e80: 2073 656c 662e 5f63 6f6e 6669 672e 6765   self._config.ge
+00011e90: 7428 7374 7261 745f 6e61 6d65 2c20 7b7d  t(strat_name, {}
+00011ea0: 290a 0a20 2020 2020 2020 2070 7269 6365  )..        price
+00011eb0: 5f73 6964 6520 3d20 7365 6c66 2e5f 6765  _side = self._ge
+00011ec0: 745f 7072 6963 655f 7369 6465 2873 6964  t_price_side(sid
+00011ed0: 652c 2069 735f 7368 6f72 742c 2063 6f6e  e, is_short, con
+00011ee0: 665f 7374 7261 7465 6779 290a 0a20 2020  f_strategy)..   
+00011ef0: 2020 2020 2070 7269 6365 5f73 6964 655f       price_side_
+00011f00: 776f 7264 203d 2070 7269 6365 5f73 6964  word = price_sid
+00011f10: 652e 6361 7069 7461 6c69 7a65 2829 0a0a  e.capitalize()..
+00011f20: 2020 2020 2020 2020 6966 2063 6f6e 665f          if conf_
+00011f30: 7374 7261 7465 6779 2e67 6574 2827 7573  strategy.get('us
+00011f40: 655f 6f72 6465 725f 626f 6f6b 272c 2046  e_order_book', F
+00011f50: 616c 7365 293a 0a0a 2020 2020 2020 2020  alse):..        
+00011f60: 2020 2020 6f72 6465 725f 626f 6f6b 5f74      order_book_t
+00011f70: 6f70 203d 2063 6f6e 665f 7374 7261 7465  op = conf_strate
+00011f80: 6779 2e67 6574 2827 6f72 6465 725f 626f  gy.get('order_bo
+00011f90: 6f6b 5f74 6f70 272c 2031 290a 2020 2020  ok_top', 1).    
+00011fa0: 2020 2020 2020 2020 6966 206f 7264 6572          if order
+00011fb0: 5f62 6f6f 6b20 6973 204e 6f6e 653a 0a20  _book is None:. 
+00011fc0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00011fd0: 7264 6572 5f62 6f6f 6b20 3d20 7365 6c66  rder_book = self
+00011fe0: 2e66 6574 6368 5f6c 325f 6f72 6465 725f  .fetch_l2_order_
+00011ff0: 626f 6f6b 2870 6169 722c 206f 7264 6572  book(pair, order
+00012000: 5f62 6f6f 6b5f 746f 7029 0a20 2020 2020  _book_top).     
+00012010: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
+00012020: 6275 6728 276f 7264 6572 5f62 6f6f 6b20  bug('order_book 
+00012030: 2573 272c 206f 7264 6572 5f62 6f6f 6b29  %s', order_book)
+00012040: 0a20 2020 2020 2020 2020 2020 2023 2074  .            # t
+00012050: 6f70 2031 203d 2069 6e64 6578 2030 0a20  op 1 = index 0. 
+00012060: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+00012070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012080: 6f62 7369 6465 3a20 4f42 4c69 7465 7261  obside: OBLitera
+00012090: 6c20 3d20 2762 6964 7327 2069 6620 7072  l = 'bids' if pr
+000120a0: 6963 655f 7369 6465 203d 3d20 2762 6964  ice_side == 'bid
+000120b0: 2720 656c 7365 2027 6173 6b73 270a 2020  ' else 'asks'.  
+000120c0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+000120d0: 7465 203d 206f 7264 6572 5f62 6f6f 6b5b  te = order_book[
+000120e0: 6f62 7369 6465 5d5b 6f72 6465 725f 626f  obside][order_bo
+000120f0: 6f6b 5f74 6f70 202d 2031 5d5b 305d 0a20  ok_top - 1][0]. 
+00012100: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00012110: 7420 2849 6e64 6578 4572 726f 722c 204b  t (IndexError, K
+00012120: 6579 4572 726f 7229 2061 7320 653a 0a20  eyError) as e:. 
+00012130: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00012140: 6f67 6765 722e 7761 726e 696e 6728 0a20  ogger.warning(. 
+00012150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012160: 2020 2066 227b 7061 6972 7d20 2d20 7b6e     f"{pair} - {n
+00012170: 616d 657d 2050 7269 6365 2061 7420 6c6f  ame} Price at lo
+00012180: 6361 7469 6f6e 207b 6f72 6465 725f 626f  cation {order_bo
+00012190: 6f6b 5f74 6f70 7d20 6672 6f6d 206f 7264  ok_top} from ord
+000121a0: 6572 626f 6f6b 2022 0a20 2020 2020 2020  erbook ".       
+000121b0: 2020 2020 2020 2020 2020 2020 2066 2263               f"c
+000121c0: 6f75 6c64 206e 6f74 2062 6520 6465 7465  ould not be dete
+000121d0: 726d 696e 6564 2e20 4f72 6465 7262 6f6f  rmined. Orderboo
+000121e0: 6b3a 207b 6f72 6465 725f 626f 6f6b 7d22  k: {order_book}"
+000121f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012200: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00012210: 2020 2072 6169 7365 2050 7269 6369 6e67     raise Pricing
+00012220: 4572 726f 7220 6672 6f6d 2065 0a20 2020  Error from e.   
+00012230: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+00012240: 6465 6275 6728 6622 7b70 6169 727d 202d  debug(f"{pair} -
+00012250: 207b 6e61 6d65 7d20 7072 6963 6520 6672   {name} price fr
+00012260: 6f6d 206f 7264 6572 626f 6f6b 207b 7072  om orderbook {pr
+00012270: 6963 655f 7369 6465 5f77 6f72 647d 220a  ice_side_word}".
 00012280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012290: 2020 6622 7369 6465 202d 2074 6f70 207b    f"side - top {
-000122a0: 6f72 6465 725f 626f 6f6b 5f74 6f70 7d20  order_book_top} 
-000122b0: 6f72 6465 7220 626f 6f6b 207b 7369 6465  order book {side
-000122c0: 7d20 7261 7465 207b 7261 7465 3a2e 3866  } rate {rate:.8f
-000122d0: 7d22 290a 2020 2020 2020 2020 656c 7365  }").        else
-000122e0: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
-000122f0: 6767 6572 2e64 6562 7567 2866 2255 7369  gger.debug(f"Usi
-00012300: 6e67 204c 6173 7420 7b70 7269 6365 5f73  ng Last {price_s
-00012310: 6964 655f 776f 7264 7d20 2f20 4c61 7374  ide_word} / Last
-00012320: 2050 7269 6365 2229 0a20 2020 2020 2020   Price").       
-00012330: 2020 2020 2069 6620 7469 636b 6572 2069       if ticker i
-00012340: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00012350: 2020 2020 2020 2020 7469 636b 6572 203d          ticker =
-00012360: 2073 656c 662e 6665 7463 685f 7469 636b   self.fetch_tick
-00012370: 6572 2870 6169 7229 0a20 2020 2020 2020  er(pair).       
-00012380: 2020 2020 2074 6963 6b65 725f 7261 7465       ticker_rate
-00012390: 203d 2074 6963 6b65 725b 7072 6963 655f   = ticker[price_
-000123a0: 7369 6465 5d0a 2020 2020 2020 2020 2020  side].          
-000123b0: 2020 6966 2074 6963 6b65 725b 276c 6173    if ticker['las
-000123c0: 7427 5d20 616e 6420 7469 636b 6572 5f72  t'] and ticker_r
-000123d0: 6174 653a 0a20 2020 2020 2020 2020 2020  ate:.           
-000123e0: 2020 2020 2069 6620 7369 6465 203d 3d20       if side == 
-000123f0: 2765 6e74 7279 2720 616e 6420 7469 636b  'entry' and tick
-00012400: 6572 5f72 6174 6520 3e20 7469 636b 6572  er_rate > ticker
-00012410: 5b27 6c61 7374 275d 3a0a 2020 2020 2020  ['last']:.      
-00012420: 2020 2020 2020 2020 2020 2020 2020 6261                ba
-00012430: 6c61 6e63 6520 3d20 636f 6e66 5f73 7472  lance = conf_str
-00012440: 6174 6567 792e 6765 7428 2770 7269 6365  ategy.get('price
-00012450: 5f6c 6173 745f 6261 6c61 6e63 6527 2c20  _last_balance', 
-00012460: 302e 3029 0a20 2020 2020 2020 2020 2020  0.0).           
-00012470: 2020 2020 2020 2020 2074 6963 6b65 725f           ticker_
-00012480: 7261 7465 203d 2074 6963 6b65 725f 7261  rate = ticker_ra
-00012490: 7465 202b 2062 616c 616e 6365 202a 2028  te + balance * (
-000124a0: 7469 636b 6572 5b27 6c61 7374 275d 202d  ticker['last'] -
-000124b0: 2074 6963 6b65 725f 7261 7465 290a 2020   ticker_rate).  
-000124c0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000124d0: 6966 2073 6964 6520 3d3d 2027 6578 6974  if side == 'exit
-000124e0: 2720 616e 6420 7469 636b 6572 5f72 6174  ' and ticker_rat
-000124f0: 6520 3c20 7469 636b 6572 5b27 6c61 7374  e < ticker['last
-00012500: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
-00012510: 2020 2020 2020 2020 6261 6c61 6e63 6520          balance 
-00012520: 3d20 636f 6e66 5f73 7472 6174 6567 792e  = conf_strategy.
-00012530: 6765 7428 2770 7269 6365 5f6c 6173 745f  get('price_last_
-00012540: 6261 6c61 6e63 6527 2c20 302e 3029 0a20  balance', 0.0). 
-00012550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012560: 2020 2074 6963 6b65 725f 7261 7465 203d     ticker_rate =
-00012570: 2074 6963 6b65 725f 7261 7465 202d 2062   ticker_rate - b
-00012580: 616c 616e 6365 202a 2028 7469 636b 6572  alance * (ticker
-00012590: 5f72 6174 6520 2d20 7469 636b 6572 5b27  _rate - ticker['
-000125a0: 6c61 7374 275d 290a 2020 2020 2020 2020  last']).        
-000125b0: 2020 2020 7261 7465 203d 2074 6963 6b65      rate = ticke
-000125c0: 725f 7261 7465 0a0a 2020 2020 2020 2020  r_rate..        
-000125d0: 6966 2072 6174 6520 6973 204e 6f6e 653a  if rate is None:
-000125e0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-000125f0: 7365 2050 7269 6369 6e67 4572 726f 7228  se PricingError(
-00012600: 6622 7b6e 616d 657d 2d52 6174 6520 666f  f"{name}-Rate fo
-00012610: 7220 7b70 6169 727d 2077 6173 2065 6d70  r {pair} was emp
-00012620: 7479 2e22 290a 2020 2020 2020 2020 7769  ty.").        wi
-00012630: 7468 2073 656c 662e 5f63 6163 6865 5f6c  th self._cache_l
-00012640: 6f63 6b3a 0a20 2020 2020 2020 2020 2020  ock:.           
-00012650: 2063 6163 6865 5f72 6174 655b 7061 6972   cache_rate[pair
-00012660: 5d20 3d20 7261 7465 0a0a 2020 2020 2020  ] = rate..      
-00012670: 2020 7265 7475 726e 2072 6174 650a 0a20    return rate.. 
-00012680: 2020 2064 6566 2067 6574 5f72 6174 6573     def get_rates
-00012690: 2873 656c 662c 2070 6169 723a 2073 7472  (self, pair: str
-000126a0: 2c20 7265 6672 6573 683a 2062 6f6f 6c2c  , refresh: bool,
-000126b0: 2069 735f 7368 6f72 743a 2062 6f6f 6c29   is_short: bool)
-000126c0: 202d 3e20 5475 706c 655b 666c 6f61 742c   -> Tuple[float,
-000126d0: 2066 6c6f 6174 5d3a 0a20 2020 2020 2020   float]:.       
-000126e0: 2065 6e74 7279 5f72 6174 6520 3d20 4e6f   entry_rate = No
-000126f0: 6e65 0a20 2020 2020 2020 2065 7869 745f  ne.        exit_
-00012700: 7261 7465 203d 204e 6f6e 650a 2020 2020  rate = None.    
-00012710: 2020 2020 6966 206e 6f74 2072 6566 7265      if not refre
-00012720: 7368 3a0a 2020 2020 2020 2020 2020 2020  sh:.            
-00012730: 7769 7468 2073 656c 662e 5f63 6163 6865  with self._cache
-00012740: 5f6c 6f63 6b3a 0a20 2020 2020 2020 2020  _lock:.         
-00012750: 2020 2020 2020 2065 6e74 7279 5f72 6174         entry_rat
-00012760: 6520 3d20 7365 6c66 2e5f 656e 7472 795f  e = self._entry_
-00012770: 7261 7465 5f63 6163 6865 2e67 6574 2870  rate_cache.get(p
-00012780: 6169 7229 0a20 2020 2020 2020 2020 2020  air).           
-00012790: 2020 2020 2065 7869 745f 7261 7465 203d       exit_rate =
-000127a0: 2073 656c 662e 5f65 7869 745f 7261 7465   self._exit_rate
-000127b0: 5f63 6163 6865 2e67 6574 2870 6169 7229  _cache.get(pair)
-000127c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000127d0: 656e 7472 795f 7261 7465 3a0a 2020 2020  entry_rate:.    
-000127e0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-000127f0: 6572 2e64 6562 7567 2866 2255 7369 6e67  er.debug(f"Using
-00012800: 2063 6163 6865 6420 6275 7920 7261 7465   cached buy rate
-00012810: 2066 6f72 207b 7061 6972 7d2e 2229 0a20   for {pair}."). 
-00012820: 2020 2020 2020 2020 2020 2069 6620 6578             if ex
-00012830: 6974 5f72 6174 653a 0a20 2020 2020 2020  it_rate:.       
-00012840: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-00012850: 6465 6275 6728 6622 5573 696e 6720 6361  debug(f"Using ca
-00012860: 6368 6564 2073 656c 6c20 7261 7465 2066  ched sell rate f
-00012870: 6f72 207b 7061 6972 7d2e 2229 0a0a 2020  or {pair}.")..  
-00012880: 2020 2020 2020 656e 7472 795f 7072 6963        entry_pric
-00012890: 696e 6720 3d20 7365 6c66 2e5f 636f 6e66  ing = self._conf
-000128a0: 6967 2e67 6574 2827 656e 7472 795f 7072  ig.get('entry_pr
-000128b0: 6963 696e 6727 2c20 7b7d 290a 2020 2020  icing', {}).    
-000128c0: 2020 2020 6578 6974 5f70 7269 6369 6e67      exit_pricing
-000128d0: 203d 2073 656c 662e 5f63 6f6e 6669 672e   = self._config.
-000128e0: 6765 7428 2765 7869 745f 7072 6963 696e  get('exit_pricin
-000128f0: 6727 2c20 7b7d 290a 2020 2020 2020 2020  g', {}).        
-00012900: 6f72 6465 725f 626f 6f6b 203d 2074 6963  order_book = tic
-00012910: 6b65 7220 3d20 4e6f 6e65 0a20 2020 2020  ker = None.     
-00012920: 2020 2069 6620 6e6f 7420 656e 7472 795f     if not entry_
-00012930: 7261 7465 2061 6e64 2065 6e74 7279 5f70  rate and entry_p
-00012940: 7269 6369 6e67 2e67 6574 2827 7573 655f  ricing.get('use_
-00012950: 6f72 6465 725f 626f 6f6b 272c 2046 616c  order_book', Fal
-00012960: 7365 293a 0a20 2020 2020 2020 2020 2020  se):.           
-00012970: 206f 7264 6572 5f62 6f6f 6b5f 746f 7020   order_book_top 
-00012980: 3d20 6d61 7828 656e 7472 795f 7072 6963  = max(entry_pric
-00012990: 696e 672e 6765 7428 276f 7264 6572 5f62  ing.get('order_b
-000129a0: 6f6f 6b5f 746f 7027 2c20 3129 2c0a 2020  ook_top', 1),.  
-000129b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000129c0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000129d0: 7869 745f 7072 6963 696e 672e 6765 7428  xit_pricing.get(
-000129e0: 276f 7264 6572 5f62 6f6f 6b5f 746f 7027  'order_book_top'
-000129f0: 2c20 3129 290a 2020 2020 2020 2020 2020  , 1)).          
-00012a00: 2020 6f72 6465 725f 626f 6f6b 203d 2073    order_book = s
-00012a10: 656c 662e 6665 7463 685f 6c32 5f6f 7264  elf.fetch_l2_ord
-00012a20: 6572 5f62 6f6f 6b28 7061 6972 2c20 6f72  er_book(pair, or
-00012a30: 6465 725f 626f 6f6b 5f74 6f70 290a 2020  der_book_top).  
-00012a40: 2020 2020 2020 2020 2020 656e 7472 795f            entry_
-00012a50: 7261 7465 203d 2073 656c 662e 6765 745f  rate = self.get_
-00012a60: 7261 7465 2870 6169 722c 2072 6566 7265  rate(pair, refre
-00012a70: 7368 2c20 2765 6e74 7279 272c 2069 735f  sh, 'entry', is_
-00012a80: 7368 6f72 742c 206f 7264 6572 5f62 6f6f  short, order_boo
-00012a90: 6b3d 6f72 6465 725f 626f 6f6b 290a 2020  k=order_book).  
-00012aa0: 2020 2020 2020 656c 6966 206e 6f74 2065        elif not e
-00012ab0: 6e74 7279 5f72 6174 653a 0a20 2020 2020  ntry_rate:.     
-00012ac0: 2020 2020 2020 2074 6963 6b65 7220 3d20         ticker = 
-00012ad0: 7365 6c66 2e66 6574 6368 5f74 6963 6b65  self.fetch_ticke
-00012ae0: 7228 7061 6972 290a 2020 2020 2020 2020  r(pair).        
-00012af0: 2020 2020 656e 7472 795f 7261 7465 203d      entry_rate =
-00012b00: 2073 656c 662e 6765 745f 7261 7465 2870   self.get_rate(p
-00012b10: 6169 722c 2072 6566 7265 7368 2c20 2765  air, refresh, 'e
-00012b20: 6e74 7279 272c 2069 735f 7368 6f72 742c  ntry', is_short,
-00012b30: 2074 6963 6b65 723d 7469 636b 6572 290a   ticker=ticker).
-00012b40: 2020 2020 2020 2020 6966 206e 6f74 2065          if not e
-00012b50: 7869 745f 7261 7465 3a0a 2020 2020 2020  xit_rate:.      
-00012b60: 2020 2020 2020 6578 6974 5f72 6174 6520        exit_rate 
-00012b70: 3d20 7365 6c66 2e67 6574 5f72 6174 6528  = self.get_rate(
-00012b80: 7061 6972 2c20 7265 6672 6573 682c 2027  pair, refresh, '
-00012b90: 6578 6974 272c 0a20 2020 2020 2020 2020  exit',.         
+00012290: 2020 2020 2020 2020 2066 2273 6964 6520           f"side 
+000122a0: 2d20 746f 7020 7b6f 7264 6572 5f62 6f6f  - top {order_boo
+000122b0: 6b5f 746f 707d 206f 7264 6572 2062 6f6f  k_top} order boo
+000122c0: 6b20 7b73 6964 657d 2072 6174 6520 7b72  k {side} rate {r
+000122d0: 6174 653a 2e38 667d 2229 0a20 2020 2020  ate:.8f}").     
+000122e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000122f0: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
+00012300: 6728 6622 5573 696e 6720 4c61 7374 207b  g(f"Using Last {
+00012310: 7072 6963 655f 7369 6465 5f77 6f72 647d  price_side_word}
+00012320: 202f 204c 6173 7420 5072 6963 6522 290a   / Last Price").
+00012330: 2020 2020 2020 2020 2020 2020 6966 2074              if t
+00012340: 6963 6b65 7220 6973 204e 6f6e 653a 0a20  icker is None:. 
+00012350: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00012360: 6963 6b65 7220 3d20 7365 6c66 2e66 6574  icker = self.fet
+00012370: 6368 5f74 6963 6b65 7228 7061 6972 290a  ch_ticker(pair).
+00012380: 2020 2020 2020 2020 2020 2020 7469 636b              tick
+00012390: 6572 5f72 6174 6520 3d20 7469 636b 6572  er_rate = ticker
+000123a0: 5b70 7269 6365 5f73 6964 655d 0a20 2020  [price_side].   
+000123b0: 2020 2020 2020 2020 2069 6620 7469 636b           if tick
+000123c0: 6572 5b27 6c61 7374 275d 2061 6e64 2074  er['last'] and t
+000123d0: 6963 6b65 725f 7261 7465 3a0a 2020 2020  icker_rate:.    
+000123e0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+000123f0: 6964 6520 3d3d 2027 656e 7472 7927 2061  ide == 'entry' a
+00012400: 6e64 2074 6963 6b65 725f 7261 7465 203e  nd ticker_rate >
+00012410: 2074 6963 6b65 725b 276c 6173 7427 5d3a   ticker['last']:
+00012420: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012430: 2020 2020 2062 616c 616e 6365 203d 2063       balance = c
+00012440: 6f6e 665f 7374 7261 7465 6779 2e67 6574  onf_strategy.get
+00012450: 2827 7072 6963 655f 6c61 7374 5f62 616c  ('price_last_bal
+00012460: 616e 6365 272c 2030 2e30 290a 2020 2020  ance', 0.0).    
+00012470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012480: 7469 636b 6572 5f72 6174 6520 3d20 7469  ticker_rate = ti
+00012490: 636b 6572 5f72 6174 6520 2b20 6261 6c61  cker_rate + bala
+000124a0: 6e63 6520 2a20 2874 6963 6b65 725b 276c  nce * (ticker['l
+000124b0: 6173 7427 5d20 2d20 7469 636b 6572 5f72  ast'] - ticker_r
+000124c0: 6174 6529 0a20 2020 2020 2020 2020 2020  ate).           
+000124d0: 2020 2020 2065 6c69 6620 7369 6465 203d       elif side =
+000124e0: 3d20 2765 7869 7427 2061 6e64 2074 6963  = 'exit' and tic
+000124f0: 6b65 725f 7261 7465 203c 2074 6963 6b65  ker_rate < ticke
+00012500: 725b 276c 6173 7427 5d3a 0a20 2020 2020  r['last']:.     
+00012510: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00012520: 616c 616e 6365 203d 2063 6f6e 665f 7374  alance = conf_st
+00012530: 7261 7465 6779 2e67 6574 2827 7072 6963  rategy.get('pric
+00012540: 655f 6c61 7374 5f62 616c 616e 6365 272c  e_last_balance',
+00012550: 2030 2e30 290a 2020 2020 2020 2020 2020   0.0).          
+00012560: 2020 2020 2020 2020 2020 7469 636b 6572            ticker
+00012570: 5f72 6174 6520 3d20 7469 636b 6572 5f72  _rate = ticker_r
+00012580: 6174 6520 2d20 6261 6c61 6e63 6520 2a20  ate - balance * 
+00012590: 2874 6963 6b65 725f 7261 7465 202d 2074  (ticker_rate - t
+000125a0: 6963 6b65 725b 276c 6173 7427 5d29 0a20  icker['last']). 
+000125b0: 2020 2020 2020 2020 2020 2072 6174 6520             rate 
+000125c0: 3d20 7469 636b 6572 5f72 6174 650a 0a20  = ticker_rate.. 
+000125d0: 2020 2020 2020 2069 6620 7261 7465 2069         if rate i
+000125e0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+000125f0: 2020 2020 7261 6973 6520 5072 6963 696e      raise Pricin
+00012600: 6745 7272 6f72 2866 227b 6e61 6d65 7d2d  gError(f"{name}-
+00012610: 5261 7465 2066 6f72 207b 7061 6972 7d20  Rate for {pair} 
+00012620: 7761 7320 656d 7074 792e 2229 0a20 2020  was empty.").   
+00012630: 2020 2020 2077 6974 6820 7365 6c66 2e5f       with self._
+00012640: 6361 6368 655f 6c6f 636b 3a0a 2020 2020  cache_lock:.    
+00012650: 2020 2020 2020 2020 6361 6368 655f 7261          cache_ra
+00012660: 7465 5b70 6169 725d 203d 2072 6174 650a  te[pair] = rate.
+00012670: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00012680: 7261 7465 0a0a 2020 2020 6465 6620 6765  rate..    def ge
+00012690: 745f 7261 7465 7328 7365 6c66 2c20 7061  t_rates(self, pa
+000126a0: 6972 3a20 7374 722c 2072 6566 7265 7368  ir: str, refresh
+000126b0: 3a20 626f 6f6c 2c20 6973 5f73 686f 7274  : bool, is_short
+000126c0: 3a20 626f 6f6c 2920 2d3e 2054 7570 6c65  : bool) -> Tuple
+000126d0: 5b66 6c6f 6174 2c20 666c 6f61 745d 3a0a  [float, float]:.
+000126e0: 2020 2020 2020 2020 656e 7472 795f 7261          entry_ra
+000126f0: 7465 203d 204e 6f6e 650a 2020 2020 2020  te = None.      
+00012700: 2020 6578 6974 5f72 6174 6520 3d20 4e6f    exit_rate = No
+00012710: 6e65 0a20 2020 2020 2020 2069 6620 6e6f  ne.        if no
+00012720: 7420 7265 6672 6573 683a 0a20 2020 2020  t refresh:.     
+00012730: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
+00012740: 2e5f 6361 6368 655f 6c6f 636b 3a0a 2020  ._cache_lock:.  
+00012750: 2020 2020 2020 2020 2020 2020 2020 656e                en
+00012760: 7472 795f 7261 7465 203d 2073 656c 662e  try_rate = self.
+00012770: 5f65 6e74 7279 5f72 6174 655f 6361 6368  _entry_rate_cach
+00012780: 652e 6765 7428 7061 6972 290a 2020 2020  e.get(pair).    
+00012790: 2020 2020 2020 2020 2020 2020 6578 6974              exit
+000127a0: 5f72 6174 6520 3d20 7365 6c66 2e5f 6578  _rate = self._ex
+000127b0: 6974 5f72 6174 655f 6361 6368 652e 6765  it_rate_cache.ge
+000127c0: 7428 7061 6972 290a 2020 2020 2020 2020  t(pair).        
+000127d0: 2020 2020 6966 2065 6e74 7279 5f72 6174      if entry_rat
+000127e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000127f0: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
+00012800: 6622 5573 696e 6720 6361 6368 6564 2062  f"Using cached b
+00012810: 7579 2072 6174 6520 666f 7220 7b70 6169  uy rate for {pai
+00012820: 727d 2e22 290a 2020 2020 2020 2020 2020  r}.").          
+00012830: 2020 6966 2065 7869 745f 7261 7465 3a0a    if exit_rate:.
+00012840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012850: 6c6f 6767 6572 2e64 6562 7567 2866 2255  logger.debug(f"U
+00012860: 7369 6e67 2063 6163 6865 6420 7365 6c6c  sing cached sell
+00012870: 2072 6174 6520 666f 7220 7b70 6169 727d   rate for {pair}
+00012880: 2e22 290a 0a20 2020 2020 2020 2065 6e74  .")..        ent
+00012890: 7279 5f70 7269 6369 6e67 203d 2073 656c  ry_pricing = sel
+000128a0: 662e 5f63 6f6e 6669 672e 6765 7428 2765  f._config.get('e
+000128b0: 6e74 7279 5f70 7269 6369 6e67 272c 207b  ntry_pricing', {
+000128c0: 7d29 0a20 2020 2020 2020 2065 7869 745f  }).        exit_
+000128d0: 7072 6963 696e 6720 3d20 7365 6c66 2e5f  pricing = self._
+000128e0: 636f 6e66 6967 2e67 6574 2827 6578 6974  config.get('exit
+000128f0: 5f70 7269 6369 6e67 272c 207b 7d29 0a20  _pricing', {}). 
+00012900: 2020 2020 2020 206f 7264 6572 5f62 6f6f         order_boo
+00012910: 6b20 3d20 7469 636b 6572 203d 204e 6f6e  k = ticker = Non
+00012920: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
+00012930: 2065 6e74 7279 5f72 6174 6520 616e 6420   entry_rate and 
+00012940: 656e 7472 795f 7072 6963 696e 672e 6765  entry_pricing.ge
+00012950: 7428 2775 7365 5f6f 7264 6572 5f62 6f6f  t('use_order_boo
+00012960: 6b27 2c20 4661 6c73 6529 3a0a 2020 2020  k', False):.    
+00012970: 2020 2020 2020 2020 6f72 6465 725f 626f          order_bo
+00012980: 6f6b 5f74 6f70 203d 206d 6178 2865 6e74  ok_top = max(ent
+00012990: 7279 5f70 7269 6369 6e67 2e67 6574 2827  ry_pricing.get('
+000129a0: 6f72 6465 725f 626f 6f6b 5f74 6f70 272c  order_book_top',
+000129b0: 2031 292c 0a20 2020 2020 2020 2020 2020   1),.           
+000129c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129d0: 2020 2020 2020 6578 6974 5f70 7269 6369        exit_prici
+000129e0: 6e67 2e67 6574 2827 6f72 6465 725f 626f  ng.get('order_bo
+000129f0: 6f6b 5f74 6f70 272c 2031 2929 0a20 2020  ok_top', 1)).   
+00012a00: 2020 2020 2020 2020 206f 7264 6572 5f62           order_b
+00012a10: 6f6f 6b20 3d20 7365 6c66 2e66 6574 6368  ook = self.fetch
+00012a20: 5f6c 325f 6f72 6465 725f 626f 6f6b 2870  _l2_order_book(p
+00012a30: 6169 722c 206f 7264 6572 5f62 6f6f 6b5f  air, order_book_
+00012a40: 746f 7029 0a20 2020 2020 2020 2020 2020  top).           
+00012a50: 2065 6e74 7279 5f72 6174 6520 3d20 7365   entry_rate = se
+00012a60: 6c66 2e67 6574 5f72 6174 6528 7061 6972  lf.get_rate(pair
+00012a70: 2c20 7265 6672 6573 682c 2027 656e 7472  , refresh, 'entr
+00012a80: 7927 2c20 6973 5f73 686f 7274 2c20 6f72  y', is_short, or
+00012a90: 6465 725f 626f 6f6b 3d6f 7264 6572 5f62  der_book=order_b
+00012aa0: 6f6f 6b29 0a20 2020 2020 2020 2065 6c69  ook).        eli
+00012ab0: 6620 6e6f 7420 656e 7472 795f 7261 7465  f not entry_rate
+00012ac0: 3a0a 2020 2020 2020 2020 2020 2020 7469  :.            ti
+00012ad0: 636b 6572 203d 2073 656c 662e 6665 7463  cker = self.fetc
+00012ae0: 685f 7469 636b 6572 2870 6169 7229 0a20  h_ticker(pair). 
+00012af0: 2020 2020 2020 2020 2020 2065 6e74 7279             entry
+00012b00: 5f72 6174 6520 3d20 7365 6c66 2e67 6574  _rate = self.get
+00012b10: 5f72 6174 6528 7061 6972 2c20 7265 6672  _rate(pair, refr
+00012b20: 6573 682c 2027 656e 7472 7927 2c20 6973  esh, 'entry', is
+00012b30: 5f73 686f 7274 2c20 7469 636b 6572 3d74  _short, ticker=t
+00012b40: 6963 6b65 7229 0a20 2020 2020 2020 2069  icker).        i
+00012b50: 6620 6e6f 7420 6578 6974 5f72 6174 653a  f not exit_rate:
+00012b60: 0a20 2020 2020 2020 2020 2020 2065 7869  .            exi
+00012b70: 745f 7261 7465 203d 2073 656c 662e 6765  t_rate = self.ge
+00012b80: 745f 7261 7465 2870 6169 722c 2072 6566  t_rate(pair, ref
+00012b90: 7265 7368 2c20 2765 7869 7427 2c0a 2020  resh, 'exit',.  
 00012ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012bb0: 2020 2020 2020 2020 2020 2020 2069 735f               is_
-00012bc0: 7368 6f72 742c 206f 7264 6572 5f62 6f6f  short, order_boo
-00012bd0: 6b3d 6f72 6465 725f 626f 6f6b 2c20 7469  k=order_book, ti
-00012be0: 636b 6572 3d74 6963 6b65 7229 0a20 2020  cker=ticker).   
-00012bf0: 2020 2020 2072 6574 7572 6e20 656e 7472       return entr
-00012c00: 795f 7261 7465 2c20 6578 6974 5f72 6174  y_rate, exit_rat
-00012c10: 650a 0a20 2020 2023 2046 6565 2068 616e  e..    # Fee han
-00012c20: 646c 696e 670a 0a20 2020 2040 7265 7472  dling..    @retr
-00012c30: 6965 720a 2020 2020 6465 6620 6765 745f  ier.    def get_
-00012c40: 7472 6164 6573 5f66 6f72 5f6f 7264 6572  trades_for_order
-00012c50: 2873 656c 662c 206f 7264 6572 5f69 643a  (self, order_id:
-00012c60: 2073 7472 2c20 7061 6972 3a20 7374 722c   str, pair: str,
-00012c70: 2073 696e 6365 3a20 6461 7465 7469 6d65   since: datetime
-00012c80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00012c90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00012ca0: 6172 616d 733a 204f 7074 696f 6e61 6c5b  arams: Optional[
-00012cb0: 4469 6374 5d20 3d20 4e6f 6e65 2920 2d3e  Dict] = None) ->
-00012cc0: 204c 6973 743a 0a20 2020 2020 2020 2022   List:.        "
-00012cd0: 2222 0a20 2020 2020 2020 2046 6574 6368  "".        Fetch
-00012ce0: 204f 7264 6572 7320 7573 696e 6720 7468   Orders using th
-00012cf0: 6520 2266 6574 6368 5f6d 795f 7472 6164  e "fetch_my_trad
-00012d00: 6573 2220 656e 6470 6f69 6e74 2061 6e64  es" endpoint and
-00012d10: 2066 696c 7465 7220 7468 656d 2062 7920   filter them by 
-00012d20: 6f72 6465 722d 6964 2e0a 2020 2020 2020  order-id..      
-00012d30: 2020 5468 6520 2273 696e 6365 2220 6172    The "since" ar
-00012d40: 6775 6d65 6e74 2070 6173 7365 6420 696e  gument passed in
-00012d50: 2069 7320 636f 6d69 6e67 2066 726f 6d20   is coming from 
-00012d60: 7468 6520 6461 7461 6261 7365 2061 6e64  the database and
-00012d70: 2069 7320 696e 2055 5443 2c0a 2020 2020   is in UTC,.    
-00012d80: 2020 2020 6173 2074 696d 657a 6f6e 652d      as timezone-
-00012d90: 6e61 7469 7665 2064 6174 6574 696d 6520  native datetime 
-00012da0: 6f62 6a65 6374 2e0a 2020 2020 2020 2020  object..        
-00012db0: 4672 6f6d 2074 6865 2070 7974 686f 6e20  From the python 
-00012dc0: 646f 6375 6d65 6e74 6174 696f 6e3a 0a20  documentation:. 
-00012dd0: 2020 2020 2020 2020 2020 203e 204e 6169             > Nai
-00012de0: 7665 2064 6174 6574 696d 6520 696e 7374  ve datetime inst
-00012df0: 616e 6365 7320 6172 6520 6173 7375 6d65  ances are assume
-00012e00: 6420 746f 2072 6570 7265 7365 6e74 206c  d to represent l
-00012e10: 6f63 616c 2074 696d 650a 2020 2020 2020  ocal time.      
-00012e20: 2020 5468 6572 6566 6f72 652c 2063 616c    Therefore, cal
-00012e30: 6c69 6e67 2022 7369 6e63 652e 7469 6d65  ling "since.time
-00012e40: 7374 616d 7028 2922 2077 696c 6c20 6765  stamp()" will ge
-00012e50: 7420 7468 6520 5554 4320 7469 6d65 7374  t the UTC timest
-00012e60: 616d 702c 2061 6674 6572 2061 7070 6c79  amp, after apply
-00012e70: 696e 6720 7468 650a 2020 2020 2020 2020  ing the.        
-00012e80: 7472 616e 7366 6f72 6d61 7469 6f6e 2066  transformation f
-00012e90: 726f 6d20 6c6f 6361 6c20 7469 6d65 7a6f  rom local timezo
-00012ea0: 6e65 2074 6f20 5554 432e 0a20 2020 2020  ne to UTC..     
-00012eb0: 2020 2054 6869 7320 776f 726b 7320 666f     This works fo
-00012ec0: 7220 7469 6d65 7a6f 6e65 7320 5554 432b  r timezones UTC+
-00012ed0: 2073 696e 6365 2074 6865 6e20 7468 6520   since then the 
-00012ee0: 7265 7375 6c74 2077 696c 6c20 636f 6e74  result will cont
-00012ef0: 6169 6e20 7472 6164 6573 2066 726f 6d20  ain trades from 
-00012f00: 6120 6665 7720 686f 7572 730a 2020 2020  a few hours.    
-00012f10: 2020 2020 696e 7374 6561 6420 6f66 2066      instead of f
-00012f20: 726f 6d20 7468 6520 6c61 7374 2035 2073  rom the last 5 s
-00012f30: 6563 6f6e 6473 2c20 686f 7765 7665 7220  econds, however 
-00012f40: 6661 696c 7320 666f 7220 5554 432d 2074  fails for UTC- t
-00012f50: 696d 657a 6f6e 6573 2c0a 2020 2020 2020  imezones,.      
-00012f60: 2020 7369 6e63 6520 7765 2772 6520 7468    since we're th
-00012f70: 656e 2061 736b 696e 6720 666f 7220 7472  en asking for tr
-00012f80: 6164 6573 2077 6974 6820 6120 2273 696e  ades with a "sin
-00012f90: 6365 2220 6172 6775 6d65 6e74 2069 6e20  ce" argument in 
-00012fa0: 7468 6520 6675 7475 7265 2e0a 0a20 2020  the future...   
-00012fb0: 2020 2020 203a 7061 7261 6d20 6f72 6465       :param orde
-00012fc0: 725f 6964 206f 7264 6572 5f69 643a 204f  r_id order_id: O
-00012fd0: 7264 6572 2d69 6420 6173 2067 6976 656e  rder-id as given
-00012fe0: 2077 6865 6e20 6372 6561 7469 6e67 2074   when creating t
-00012ff0: 6865 206f 7264 6572 0a20 2020 2020 2020  he order.       
-00013000: 203a 7061 7261 6d20 7061 6972 3a20 5061   :param pair: Pa
-00013010: 6972 2074 6865 206f 7264 6572 2069 7320  ir the order is 
-00013020: 666f 720a 2020 2020 2020 2020 3a70 6172  for.        :par
-00013030: 616d 2073 696e 6365 3a20 6461 7465 7469  am since: dateti
-00013040: 6d65 206f 626a 6563 7420 6f66 2074 6865  me object of the
-00013050: 206f 7264 6572 2063 7265 6174 696f 6e20   order creation 
-00013060: 7469 6d65 2e20 4173 7375 6d65 7320 6f62  time. Assumes ob
-00013070: 6a65 6374 2069 7320 696e 2055 5443 2e0a  ject is in UTC..
-00013080: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00013090: 2020 2020 6966 2073 656c 662e 5f63 6f6e      if self._con
-000130a0: 6669 675b 2764 7279 5f72 756e 275d 3a0a  fig['dry_run']:.
-000130b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000130c0: 726e 205b 5d0a 2020 2020 2020 2020 6966  rn [].        if
-000130d0: 206e 6f74 2073 656c 662e 6578 6368 616e   not self.exchan
-000130e0: 6765 5f68 6173 2827 6665 7463 684d 7954  ge_has('fetchMyT
-000130f0: 7261 6465 7327 293a 0a20 2020 2020 2020  rades'):.       
-00013100: 2020 2020 2072 6574 7572 6e20 5b5d 0a20       return []. 
-00013110: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00013120: 2020 2020 2020 2020 2320 416c 6c6f 7720          # Allow 
-00013130: 3573 206f 6666 7365 7420 746f 2063 6174  5s offset to cat
-00013140: 6368 2073 6c69 6768 7420 7469 6d65 206f  ch slight time o
-00013150: 6666 7365 7473 2028 6469 7363 6f76 6572  ffsets (discover
-00013160: 6564 2069 6e20 2331 3138 3529 0a20 2020  ed in #1185).   
-00013170: 2020 2020 2020 2020 2023 2073 696e 6365           # since
-00013180: 206e 6565 6473 2074 6f20 6265 2069 6e74   needs to be int
-00013190: 2069 6e20 6d69 6c6c 6973 6563 6f6e 6473   in milliseconds
-000131a0: 0a20 2020 2020 2020 2020 2020 205f 7061  .            _pa
-000131b0: 7261 6d73 203d 2070 6172 616d 7320 6966  rams = params if
-000131c0: 2070 6172 616d 7320 656c 7365 207b 7d0a   params else {}.
-000131d0: 2020 2020 2020 2020 2020 2020 6d79 5f74              my_t
-000131e0: 7261 6465 7320 3d20 7365 6c66 2e5f 6170  rades = self._ap
-000131f0: 692e 6665 7463 685f 6d79 5f74 7261 6465  i.fetch_my_trade
-00013200: 7328 0a20 2020 2020 2020 2020 2020 2020  s(.             
-00013210: 2020 2070 6169 722c 2069 6e74 2828 7369     pair, int((si
-00013220: 6e63 652e 7265 706c 6163 6528 747a 696e  nce.replace(tzin
-00013230: 666f 3d74 696d 657a 6f6e 652e 7574 6329  fo=timezone.utc)
-00013240: 2e74 696d 6573 7461 6d70 2829 202d 2035  .timestamp() - 5
-00013250: 2920 2a20 3130 3030 292c 0a20 2020 2020  ) * 1000),.     
-00013260: 2020 2020 2020 2020 2020 2070 6172 616d             param
-00013270: 733d 5f70 6172 616d 7329 0a20 2020 2020  s=_params).     
-00013280: 2020 2020 2020 206d 6174 6368 6564 5f74         matched_t
-00013290: 7261 6465 7320 3d20 5b74 7261 6465 2066  rades = [trade f
-000132a0: 6f72 2074 7261 6465 2069 6e20 6d79 5f74  or trade in my_t
-000132b0: 7261 6465 7320 6966 2074 7261 6465 5b27  rades if trade['
-000132c0: 6f72 6465 7227 5d20 3d3d 206f 7264 6572  order'] == order
-000132d0: 5f69 645d 0a0a 2020 2020 2020 2020 2020  _id]..          
-000132e0: 2020 7365 6c66 2e5f 6c6f 675f 6578 6368    self._log_exch
-000132f0: 616e 6765 5f72 6573 706f 6e73 6528 2767  ange_response('g
-00013300: 6574 5f74 7261 6465 735f 666f 725f 6f72  et_trades_for_or
-00013310: 6465 7227 2c20 6d61 7463 6865 645f 7472  der', matched_tr
-00013320: 6164 6573 290a 0a20 2020 2020 2020 2020  ades)..         
-00013330: 2020 206d 6174 6368 6564 5f74 7261 6465     matched_trade
-00013340: 7320 3d20 7365 6c66 2e5f 7472 6164 6573  s = self._trades
-00013350: 5f63 6f6e 7472 6163 7473 5f74 6f5f 616d  _contracts_to_am
-00013360: 6f75 6e74 286d 6174 6368 6564 5f74 7261  ount(matched_tra
-00013370: 6465 7329 0a0a 2020 2020 2020 2020 2020  des)..          
-00013380: 2020 7265 7475 726e 206d 6174 6368 6564    return matched
-00013390: 5f74 7261 6465 730a 2020 2020 2020 2020  _trades.        
-000133a0: 6578 6365 7074 2063 6378 742e 4444 6f53  except ccxt.DDoS
-000133b0: 5072 6f74 6563 7469 6f6e 2061 7320 653a  Protection as e:
-000133c0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-000133d0: 7365 2044 446f 7350 726f 7465 6374 696f  se DDosProtectio
-000133e0: 6e28 6529 2066 726f 6d20 650a 2020 2020  n(e) from e.    
-000133f0: 2020 2020 6578 6365 7074 2028 6363 7874      except (ccxt
-00013400: 2e4e 6574 776f 726b 4572 726f 722c 2063  .NetworkError, c
-00013410: 6378 742e 4578 6368 616e 6765 4572 726f  cxt.ExchangeErro
-00013420: 7229 2061 7320 653a 0a20 2020 2020 2020  r) as e:.       
-00013430: 2020 2020 2072 6169 7365 2054 656d 706f       raise Tempo
-00013440: 7261 7279 4572 726f 7228 0a20 2020 2020  raryError(.     
-00013450: 2020 2020 2020 2020 2020 2066 2743 6f75             f'Cou
-00013460: 6c64 206e 6f74 2067 6574 2074 7261 6465  ld not get trade
-00013470: 7320 6475 6520 746f 207b 652e 5f5f 636c  s due to {e.__cl
-00013480: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d2e  ass__.__name__}.
-00013490: 204d 6573 7361 6765 3a20 7b65 7d27 2920   Message: {e}') 
-000134a0: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
-000134b0: 7863 6570 7420 6363 7874 2e42 6173 6545  xcept ccxt.BaseE
-000134c0: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
-000134d0: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
-000134e0: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
-000134f0: 6e28 6529 2066 726f 6d20 650a 0a20 2020  n(e) from e..   
-00013500: 2064 6566 2067 6574 5f6f 7264 6572 5f69   def get_order_i
-00013510: 645f 636f 6e64 6974 696f 6e61 6c28 7365  d_conditional(se
-00013520: 6c66 2c20 6f72 6465 723a 2044 6963 745b  lf, order: Dict[
-00013530: 7374 722c 2041 6e79 5d29 202d 3e20 7374  str, Any]) -> st
-00013540: 723a 0a20 2020 2020 2020 2072 6574 7572  r:.        retur
-00013550: 6e20 6f72 6465 725b 2769 6427 5d0a 0a20  n order['id'].. 
-00013560: 2020 2040 7265 7472 6965 720a 2020 2020     @retrier.    
-00013570: 6465 6620 6765 745f 6665 6528 7365 6c66  def get_fee(self
-00013580: 2c20 7379 6d62 6f6c 3a20 7374 722c 2074  , symbol: str, t
-00013590: 7970 653a 2073 7472 203d 2027 272c 2073  ype: str = '', s
-000135a0: 6964 653a 2073 7472 203d 2027 272c 2061  ide: str = '', a
-000135b0: 6d6f 756e 743a 2066 6c6f 6174 203d 2031  mount: float = 1
-000135c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000135d0: 2020 7072 6963 653a 2066 6c6f 6174 203d    price: float =
-000135e0: 2031 2c20 7461 6b65 725f 6f72 5f6d 616b   1, taker_or_mak
-000135f0: 6572 3a20 4d61 6b65 7254 616b 6572 203d  er: MakerTaker =
-00013600: 2027 6d61 6b65 7227 2920 2d3e 2066 6c6f   'maker') -> flo
-00013610: 6174 3a0a 2020 2020 2020 2020 2222 220a  at:.        """.
-00013620: 2020 2020 2020 2020 5265 7472 6965 7665          Retrieve
-00013630: 2066 6565 2066 726f 6d20 6578 6368 616e   fee from exchan
-00013640: 6765 0a20 2020 2020 2020 203a 7061 7261  ge.        :para
-00013650: 6d20 7379 6d62 6f6c 3a20 5061 6972 0a20  m symbol: Pair. 
-00013660: 2020 2020 2020 203a 7061 7261 6d20 7479         :param ty
-00013670: 7065 3a20 5479 7065 206f 6620 6f72 6465  pe: Type of orde
-00013680: 7220 286d 6172 6b65 742c 206c 696d 6974  r (market, limit
-00013690: 2c20 2e2e 2e29 0a20 2020 2020 2020 203a  , ...).        :
-000136a0: 7061 7261 6d20 7369 6465 3a20 5369 6465  param side: Side
-000136b0: 206f 6620 6f72 6465 7220 2862 7579 2c20   of order (buy, 
-000136c0: 7365 6c6c 290a 2020 2020 2020 2020 3a70  sell).        :p
-000136d0: 6172 616d 2061 6d6f 756e 743a 2041 6d6f  aram amount: Amo
-000136e0: 756e 7420 6f66 206f 7264 6572 0a20 2020  unt of order.   
-000136f0: 2020 2020 203a 7061 7261 6d20 7072 6963       :param pric
-00013700: 653a 2050 7269 6365 206f 6620 6f72 6465  e: Price of orde
-00013710: 720a 2020 2020 2020 2020 3a70 6172 616d  r.        :param
-00013720: 2074 616b 6572 5f6f 725f 6d61 6b65 723a   taker_or_maker:
-00013730: 2027 6d61 6b65 7227 206f 7220 2774 616b   'maker' or 'tak
-00013740: 6572 2720 2869 676e 6f72 6564 2069 6620  er' (ignored if 
-00013750: 2274 7970 6522 2069 7320 7072 6f76 6964  "type" is provid
-00013760: 6564 290a 2020 2020 2020 2020 2222 220a  ed).        """.
-00013770: 2020 2020 2020 2020 6966 2074 7970 6520          if type 
-00013780: 616e 6420 7479 7065 203d 3d20 276d 6172  and type == 'mar
-00013790: 6b65 7427 3a0a 2020 2020 2020 2020 2020  ket':.          
-000137a0: 2020 7461 6b65 725f 6f72 5f6d 616b 6572    taker_or_maker
-000137b0: 203d 2027 7461 6b65 7227 0a20 2020 2020   = 'taker'.     
-000137c0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-000137d0: 2020 2020 6966 2073 656c 662e 5f63 6f6e      if self._con
-000137e0: 6669 675b 2764 7279 5f72 756e 275d 2061  fig['dry_run'] a
-000137f0: 6e64 2073 656c 662e 5f63 6f6e 6669 672e  nd self._config.
-00013800: 6765 7428 2766 6565 272c 204e 6f6e 6529  get('fee', None)
-00013810: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00013820: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00013830: 7475 726e 2073 656c 662e 5f63 6f6e 6669  turn self._confi
-00013840: 675b 2766 6565 275d 0a20 2020 2020 2020  g['fee'].       
-00013850: 2020 2020 2023 2076 616c 6964 6174 6520       # validate 
-00013860: 7468 6174 206d 6172 6b65 7473 2061 7265  that markets are
-00013870: 206c 6f61 6465 6420 6265 666f 7265 2074   loaded before t
-00013880: 7279 696e 6720 746f 2067 6574 2066 6565  rying to get fee
-00013890: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000138a0: 7365 6c66 2e5f 6170 692e 6d61 726b 6574  self._api.market
-000138b0: 7320 6973 204e 6f6e 6520 6f72 206c 656e  s is None or len
-000138c0: 2873 656c 662e 5f61 7069 2e6d 6172 6b65  (self._api.marke
-000138d0: 7473 2920 3d3d 2030 3a0a 2020 2020 2020  ts) == 0:.      
-000138e0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-000138f0: 6170 692e 6c6f 6164 5f6d 6172 6b65 7473  api.load_markets
-00013900: 2870 6172 616d 733d 7b7d 290a 0a20 2020  (params={})..   
-00013910: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00013920: 7365 6c66 2e5f 6170 692e 6361 6c63 756c  self._api.calcul
-00013930: 6174 655f 6665 6528 7379 6d62 6f6c 3d73  ate_fee(symbol=s
-00013940: 796d 626f 6c2c 2074 7970 653d 7479 7065  ymbol, type=type
-00013950: 2c20 7369 6465 3d73 6964 652c 2061 6d6f  , side=side, amo
-00013960: 756e 743d 616d 6f75 6e74 2c0a 2020 2020  unt=amount,.    
-00013970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012bc0: 2020 2020 6973 5f73 686f 7274 2c20 6f72      is_short, or
+00012bd0: 6465 725f 626f 6f6b 3d6f 7264 6572 5f62  der_book=order_b
+00012be0: 6f6f 6b2c 2074 6963 6b65 723d 7469 636b  ook, ticker=tick
+00012bf0: 6572 290a 2020 2020 2020 2020 7265 7475  er).        retu
+00012c00: 726e 2065 6e74 7279 5f72 6174 652c 2065  rn entry_rate, e
+00012c10: 7869 745f 7261 7465 0a0a 2020 2020 2320  xit_rate..    # 
+00012c20: 4665 6520 6861 6e64 6c69 6e67 0a0a 2020  Fee handling..  
+00012c30: 2020 4072 6574 7269 6572 0a20 2020 2064    @retrier.    d
+00012c40: 6566 2067 6574 5f74 7261 6465 735f 666f  ef get_trades_fo
+00012c50: 725f 6f72 6465 7228 7365 6c66 2c20 6f72  r_order(self, or
+00012c60: 6465 725f 6964 3a20 7374 722c 2070 6169  der_id: str, pai
+00012c70: 723a 2073 7472 2c20 7369 6e63 653a 2064  r: str, since: d
+00012c80: 6174 6574 696d 652c 0a20 2020 2020 2020  atetime,.       
+00012c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012ca0: 2020 2020 2020 7061 7261 6d73 3a20 4f70        params: Op
+00012cb0: 7469 6f6e 616c 5b44 6963 745d 203d 204e  tional[Dict] = N
+00012cc0: 6f6e 6529 202d 3e20 4c69 7374 3a0a 2020  one) -> List:.  
+00012cd0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00012ce0: 2020 4665 7463 6820 4f72 6465 7273 2075    Fetch Orders u
+00012cf0: 7369 6e67 2074 6865 2022 6665 7463 685f  sing the "fetch_
+00012d00: 6d79 5f74 7261 6465 7322 2065 6e64 706f  my_trades" endpo
+00012d10: 696e 7420 616e 6420 6669 6c74 6572 2074  int and filter t
+00012d20: 6865 6d20 6279 206f 7264 6572 2d69 642e  hem by order-id.
+00012d30: 0a20 2020 2020 2020 2054 6865 2022 7369  .        The "si
+00012d40: 6e63 6522 2061 7267 756d 656e 7420 7061  nce" argument pa
+00012d50: 7373 6564 2069 6e20 6973 2063 6f6d 696e  ssed in is comin
+00012d60: 6720 6672 6f6d 2074 6865 2064 6174 6162  g from the datab
+00012d70: 6173 6520 616e 6420 6973 2069 6e20 5554  ase and is in UT
+00012d80: 432c 0a20 2020 2020 2020 2061 7320 7469  C,.        as ti
+00012d90: 6d65 7a6f 6e65 2d6e 6174 6976 6520 6461  mezone-native da
+00012da0: 7465 7469 6d65 206f 626a 6563 742e 0a20  tetime object.. 
+00012db0: 2020 2020 2020 2046 726f 6d20 7468 6520         From the 
+00012dc0: 7079 7468 6f6e 2064 6f63 756d 656e 7461  python documenta
+00012dd0: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
+00012de0: 2020 3e20 4e61 6976 6520 6461 7465 7469    > Naive dateti
+00012df0: 6d65 2069 6e73 7461 6e63 6573 2061 7265  me instances are
+00012e00: 2061 7373 756d 6564 2074 6f20 7265 7072   assumed to repr
+00012e10: 6573 656e 7420 6c6f 6361 6c20 7469 6d65  esent local time
+00012e20: 0a20 2020 2020 2020 2054 6865 7265 666f  .        Therefo
+00012e30: 7265 2c20 6361 6c6c 696e 6720 2273 696e  re, calling "sin
+00012e40: 6365 2e74 696d 6573 7461 6d70 2829 2220  ce.timestamp()" 
+00012e50: 7769 6c6c 2067 6574 2074 6865 2055 5443  will get the UTC
+00012e60: 2074 696d 6573 7461 6d70 2c20 6166 7465   timestamp, afte
+00012e70: 7220 6170 706c 7969 6e67 2074 6865 0a20  r applying the. 
+00012e80: 2020 2020 2020 2074 7261 6e73 666f 726d         transform
+00012e90: 6174 696f 6e20 6672 6f6d 206c 6f63 616c  ation from local
+00012ea0: 2074 696d 657a 6f6e 6520 746f 2055 5443   timezone to UTC
+00012eb0: 2e0a 2020 2020 2020 2020 5468 6973 2077  ..        This w
+00012ec0: 6f72 6b73 2066 6f72 2074 696d 657a 6f6e  orks for timezon
+00012ed0: 6573 2055 5443 2b20 7369 6e63 6520 7468  es UTC+ since th
+00012ee0: 656e 2074 6865 2072 6573 756c 7420 7769  en the result wi
+00012ef0: 6c6c 2063 6f6e 7461 696e 2074 7261 6465  ll contain trade
+00012f00: 7320 6672 6f6d 2061 2066 6577 2068 6f75  s from a few hou
+00012f10: 7273 0a20 2020 2020 2020 2069 6e73 7465  rs.        inste
+00012f20: 6164 206f 6620 6672 6f6d 2074 6865 206c  ad of from the l
+00012f30: 6173 7420 3520 7365 636f 6e64 732c 2068  ast 5 seconds, h
+00012f40: 6f77 6576 6572 2066 6169 6c73 2066 6f72  owever fails for
+00012f50: 2055 5443 2d20 7469 6d65 7a6f 6e65 732c   UTC- timezones,
+00012f60: 0a20 2020 2020 2020 2073 696e 6365 2077  .        since w
+00012f70: 6527 7265 2074 6865 6e20 6173 6b69 6e67  e're then asking
+00012f80: 2066 6f72 2074 7261 6465 7320 7769 7468   for trades with
+00012f90: 2061 2022 7369 6e63 6522 2061 7267 756d   a "since" argum
+00012fa0: 656e 7420 696e 2074 6865 2066 7574 7572  ent in the futur
+00012fb0: 652e 0a0a 2020 2020 2020 2020 3a70 6172  e...        :par
+00012fc0: 616d 206f 7264 6572 5f69 6420 6f72 6465  am order_id orde
+00012fd0: 725f 6964 3a20 4f72 6465 722d 6964 2061  r_id: Order-id a
+00012fe0: 7320 6769 7665 6e20 7768 656e 2063 7265  s given when cre
+00012ff0: 6174 696e 6720 7468 6520 6f72 6465 720a  ating the order.
+00013000: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+00013010: 6169 723a 2050 6169 7220 7468 6520 6f72  air: Pair the or
+00013020: 6465 7220 6973 2066 6f72 0a20 2020 2020  der is for.     
+00013030: 2020 203a 7061 7261 6d20 7369 6e63 653a     :param since:
+00013040: 2064 6174 6574 696d 6520 6f62 6a65 6374   datetime object
+00013050: 206f 6620 7468 6520 6f72 6465 7220 6372   of the order cr
+00013060: 6561 7469 6f6e 2074 696d 652e 2041 7373  eation time. Ass
+00013070: 756d 6573 206f 626a 6563 7420 6973 2069  umes object is i
+00013080: 6e20 5554 432e 0a20 2020 2020 2020 2022  n UTC..        "
+00013090: 2222 0a20 2020 2020 2020 2069 6620 7365  "".        if se
+000130a0: 6c66 2e5f 636f 6e66 6967 5b27 6472 795f  lf._config['dry_
+000130b0: 7275 6e27 5d3a 0a20 2020 2020 2020 2020  run']:.         
+000130c0: 2020 2072 6574 7572 6e20 5b5d 0a20 2020     return [].   
+000130d0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+000130e0: 2e65 7863 6861 6e67 655f 6861 7328 2766  .exchange_has('f
+000130f0: 6574 6368 4d79 5472 6164 6573 2729 3a0a  etchMyTrades'):.
+00013100: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00013110: 726e 205b 5d0a 2020 2020 2020 2020 7472  rn [].        tr
+00013120: 793a 0a20 2020 2020 2020 2020 2020 2023  y:.            #
+00013130: 2041 6c6c 6f77 2035 7320 6f66 6673 6574   Allow 5s offset
+00013140: 2074 6f20 6361 7463 6820 736c 6967 6874   to catch slight
+00013150: 2074 696d 6520 6f66 6673 6574 7320 2864   time offsets (d
+00013160: 6973 636f 7665 7265 6420 696e 2023 3131  iscovered in #11
+00013170: 3835 290a 2020 2020 2020 2020 2020 2020  85).            
+00013180: 2320 7369 6e63 6520 6e65 6564 7320 746f  # since needs to
+00013190: 2062 6520 696e 7420 696e 206d 696c 6c69   be int in milli
+000131a0: 7365 636f 6e64 730a 2020 2020 2020 2020  seconds.        
+000131b0: 2020 2020 5f70 6172 616d 7320 3d20 7061      _params = pa
+000131c0: 7261 6d73 2069 6620 7061 7261 6d73 2065  rams if params e
+000131d0: 6c73 6520 7b7d 0a20 2020 2020 2020 2020  lse {}.         
+000131e0: 2020 206d 795f 7472 6164 6573 203d 2073     my_trades = s
+000131f0: 656c 662e 5f61 7069 2e66 6574 6368 5f6d  elf._api.fetch_m
+00013200: 795f 7472 6164 6573 280a 2020 2020 2020  y_trades(.      
+00013210: 2020 2020 2020 2020 2020 7061 6972 2c20            pair, 
+00013220: 696e 7428 2873 696e 6365 2e72 6570 6c61  int((since.repla
+00013230: 6365 2874 7a69 6e66 6f3d 7469 6d65 7a6f  ce(tzinfo=timezo
+00013240: 6e65 2e75 7463 292e 7469 6d65 7374 616d  ne.utc).timestam
+00013250: 7028 2920 2d20 3529 202a 2031 3030 3029  p() - 5) * 1000)
+00013260: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00013270: 2020 7061 7261 6d73 3d5f 7061 7261 6d73    params=_params
+00013280: 290a 2020 2020 2020 2020 2020 2020 6d61  ).            ma
+00013290: 7463 6865 645f 7472 6164 6573 203d 205b  tched_trades = [
+000132a0: 7472 6164 6520 666f 7220 7472 6164 6520  trade for trade 
+000132b0: 696e 206d 795f 7472 6164 6573 2069 6620  in my_trades if 
+000132c0: 7472 6164 655b 276f 7264 6572 275d 203d  trade['order'] =
+000132d0: 3d20 6f72 6465 725f 6964 5d0a 0a20 2020  = order_id]..   
+000132e0: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
+000132f0: 6f67 5f65 7863 6861 6e67 655f 7265 7370  og_exchange_resp
+00013300: 6f6e 7365 2827 6765 745f 7472 6164 6573  onse('get_trades
+00013310: 5f66 6f72 5f6f 7264 6572 272c 206d 6174  _for_order', mat
+00013320: 6368 6564 5f74 7261 6465 7329 0a0a 2020  ched_trades)..  
+00013330: 2020 2020 2020 2020 2020 6d61 7463 6865            matche
+00013340: 645f 7472 6164 6573 203d 2073 656c 662e  d_trades = self.
+00013350: 5f74 7261 6465 735f 636f 6e74 7261 6374  _trades_contract
+00013360: 735f 746f 5f61 6d6f 756e 7428 6d61 7463  s_to_amount(matc
+00013370: 6865 645f 7472 6164 6573 290a 0a20 2020  hed_trades)..   
+00013380: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00013390: 6d61 7463 6865 645f 7472 6164 6573 0a20  matched_trades. 
+000133a0: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
+000133b0: 7874 2e44 446f 5350 726f 7465 6374 696f  xt.DDoSProtectio
+000133c0: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
+000133d0: 2020 2020 7261 6973 6520 4444 6f73 5072      raise DDosPr
+000133e0: 6f74 6563 7469 6f6e 2865 2920 6672 6f6d  otection(e) from
+000133f0: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
+00013400: 7420 2863 6378 742e 4e65 7477 6f72 6b45  t (ccxt.NetworkE
+00013410: 7272 6f72 2c20 6363 7874 2e45 7863 6861  rror, ccxt.Excha
+00013420: 6e67 6545 7272 6f72 2920 6173 2065 3a0a  ngeError) as e:.
+00013430: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00013440: 6520 5465 6d70 6f72 6172 7945 7272 6f72  e TemporaryError
+00013450: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00013460: 2020 6627 436f 756c 6420 6e6f 7420 6765    f'Could not ge
+00013470: 7420 7472 6164 6573 2064 7565 2074 6f20  t trades due to 
+00013480: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
+00013490: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
+000134a0: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
+000134b0: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
+000134c0: 742e 4261 7365 4572 726f 7220 6173 2065  t.BaseError as e
+000134d0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+000134e0: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+000134f0: 7863 6570 7469 6f6e 2865 2920 6672 6f6d  xception(e) from
+00013500: 2065 0a0a 2020 2020 6465 6620 6765 745f   e..    def get_
+00013510: 6f72 6465 725f 6964 5f63 6f6e 6469 7469  order_id_conditi
+00013520: 6f6e 616c 2873 656c 662c 206f 7264 6572  onal(self, order
+00013530: 3a20 4469 6374 5b73 7472 2c20 416e 795d  : Dict[str, Any]
+00013540: 2920 2d3e 2073 7472 3a0a 2020 2020 2020  ) -> str:.      
+00013550: 2020 7265 7475 726e 206f 7264 6572 5b27    return order['
+00013560: 6964 275d 0a0a 2020 2020 4072 6574 7269  id']..    @retri
+00013570: 6572 0a20 2020 2064 6566 2067 6574 5f66  er.    def get_f
+00013580: 6565 2873 656c 662c 2073 796d 626f 6c3a  ee(self, symbol:
+00013590: 2073 7472 2c20 7479 7065 3a20 7374 7220   str, type: str 
+000135a0: 3d20 2727 2c20 7369 6465 3a20 7374 7220  = '', side: str 
+000135b0: 3d20 2727 2c20 616d 6f75 6e74 3a20 666c  = '', amount: fl
+000135c0: 6f61 7420 3d20 312c 0a20 2020 2020 2020  oat = 1,.       
+000135d0: 2020 2020 2020 2020 2070 7269 6365 3a20           price: 
+000135e0: 666c 6f61 7420 3d20 312c 2074 616b 6572  float = 1, taker
+000135f0: 5f6f 725f 6d61 6b65 723a 204d 616b 6572  _or_maker: Maker
+00013600: 5461 6b65 7220 3d20 276d 616b 6572 2729  Taker = 'maker')
+00013610: 202d 3e20 666c 6f61 743a 0a20 2020 2020   -> float:.     
+00013620: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
+00013630: 6574 7269 6576 6520 6665 6520 6672 6f6d  etrieve fee from
+00013640: 2065 7863 6861 6e67 650a 2020 2020 2020   exchange.      
+00013650: 2020 3a70 6172 616d 2073 796d 626f 6c3a    :param symbol:
+00013660: 2050 6169 720a 2020 2020 2020 2020 3a70   Pair.        :p
+00013670: 6172 616d 2074 7970 653a 2054 7970 6520  aram type: Type 
+00013680: 6f66 206f 7264 6572 2028 6d61 726b 6574  of order (market
+00013690: 2c20 6c69 6d69 742c 202e 2e2e 290a 2020  , limit, ...).  
+000136a0: 2020 2020 2020 3a70 6172 616d 2073 6964        :param sid
+000136b0: 653a 2053 6964 6520 6f66 206f 7264 6572  e: Side of order
+000136c0: 2028 6275 792c 2073 656c 6c29 0a20 2020   (buy, sell).   
+000136d0: 2020 2020 203a 7061 7261 6d20 616d 6f75       :param amou
+000136e0: 6e74 3a20 416d 6f75 6e74 206f 6620 6f72  nt: Amount of or
+000136f0: 6465 720a 2020 2020 2020 2020 3a70 6172  der.        :par
+00013700: 616d 2070 7269 6365 3a20 5072 6963 6520  am price: Price 
+00013710: 6f66 206f 7264 6572 0a20 2020 2020 2020  of order.       
+00013720: 203a 7061 7261 6d20 7461 6b65 725f 6f72   :param taker_or
+00013730: 5f6d 616b 6572 3a20 276d 616b 6572 2720  _maker: 'maker' 
+00013740: 6f72 2027 7461 6b65 7227 2028 6967 6e6f  or 'taker' (igno
+00013750: 7265 6420 6966 2022 7479 7065 2220 6973  red if "type" is
+00013760: 2070 726f 7669 6465 6429 0a20 2020 2020   provided).     
+00013770: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00013780: 6620 7479 7065 2061 6e64 2074 7970 6520  f type and type 
+00013790: 3d3d 2027 6d61 726b 6574 273a 0a20 2020  == 'market':.   
+000137a0: 2020 2020 2020 2020 2074 616b 6572 5f6f           taker_o
+000137b0: 725f 6d61 6b65 7220 3d20 2774 616b 6572  r_maker = 'taker
+000137c0: 270a 2020 2020 2020 2020 7472 793a 0a20  '.        try:. 
+000137d0: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+000137e0: 6c66 2e5f 636f 6e66 6967 5b27 6472 795f  lf._config['dry_
+000137f0: 7275 6e27 5d20 616e 6420 7365 6c66 2e5f  run'] and self._
+00013800: 636f 6e66 6967 2e67 6574 2827 6665 6527  config.get('fee'
+00013810: 2c20 4e6f 6e65 2920 6973 206e 6f74 204e  , None) is not N
+00013820: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+00013830: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00013840: 2e5f 636f 6e66 6967 5b27 6665 6527 5d0a  ._config['fee'].
+00013850: 2020 2020 2020 2020 2020 2020 2320 7661              # va
+00013860: 6c69 6461 7465 2074 6861 7420 6d61 726b  lidate that mark
+00013870: 6574 7320 6172 6520 6c6f 6164 6564 2062  ets are loaded b
+00013880: 6566 6f72 6520 7472 7969 6e67 2074 6f20  efore trying to 
+00013890: 6765 7420 6665 650a 2020 2020 2020 2020  get fee.        
+000138a0: 2020 2020 6966 2073 656c 662e 5f61 7069      if self._api
+000138b0: 2e6d 6172 6b65 7473 2069 7320 4e6f 6e65  .markets is None
+000138c0: 206f 7220 6c65 6e28 7365 6c66 2e5f 6170   or len(self._ap
+000138d0: 692e 6d61 726b 6574 7329 203d 3d20 303a  i.markets) == 0:
+000138e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000138f0: 2073 656c 662e 5f61 7069 2e6c 6f61 645f   self._api.load_
+00013900: 6d61 726b 6574 7328 7061 7261 6d73 3d7b  markets(params={
+00013910: 7d29 0a0a 2020 2020 2020 2020 2020 2020  })..            
+00013920: 7265 7475 726e 2073 656c 662e 5f61 7069  return self._api
+00013930: 2e63 616c 6375 6c61 7465 5f66 6565 2873  .calculate_fee(s
+00013940: 796d 626f 6c3d 7379 6d62 6f6c 2c20 7479  ymbol=symbol, ty
+00013950: 7065 3d74 7970 652c 2073 6964 653d 7369  pe=type, side=si
+00013960: 6465 2c20 616d 6f75 6e74 3d61 6d6f 756e  de, amount=amoun
+00013970: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
 00013980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013990: 2020 2020 2020 2070 7269 6365 3d70 7269         price=pri
-000139a0: 6365 2c20 7461 6b65 724f 724d 616b 6572  ce, takerOrMaker
-000139b0: 3d74 616b 6572 5f6f 725f 6d61 6b65 7229  =taker_or_maker)
-000139c0: 5b27 7261 7465 275d 0a20 2020 2020 2020  ['rate'].       
-000139d0: 2065 7863 6570 7420 6363 7874 2e44 446f   except ccxt.DDo
-000139e0: 5350 726f 7465 6374 696f 6e20 6173 2065  SProtection as e
-000139f0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00013a00: 6973 6520 4444 6f73 5072 6f74 6563 7469  ise DDosProtecti
-00013a10: 6f6e 2865 2920 6672 6f6d 2065 0a20 2020  on(e) from e.   
-00013a20: 2020 2020 2065 7863 6570 7420 2863 6378       except (ccx
-00013a30: 742e 4e65 7477 6f72 6b45 7272 6f72 2c20  t.NetworkError, 
-00013a40: 6363 7874 2e45 7863 6861 6e67 6545 7272  ccxt.ExchangeErr
-00013a50: 6f72 2920 6173 2065 3a0a 2020 2020 2020  or) as e:.      
-00013a60: 2020 2020 2020 7261 6973 6520 5465 6d70        raise Temp
-00013a70: 6f72 6172 7945 7272 6f72 280a 2020 2020  oraryError(.    
-00013a80: 2020 2020 2020 2020 2020 2020 6627 436f              f'Co
-00013a90: 756c 6420 6e6f 7420 6765 7420 6665 6520  uld not get fee 
-00013aa0: 696e 666f 2064 7565 2074 6f20 7b65 2e5f  info due to {e._
-00013ab0: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-00013ac0: 5f7d 2e20 4d65 7373 6167 653a 207b 657d  _}. Message: {e}
-00013ad0: 2729 2066 726f 6d20 650a 2020 2020 2020  ') from e.      
-00013ae0: 2020 6578 6365 7074 2063 6378 742e 4261    except ccxt.Ba
-00013af0: 7365 4572 726f 7220 6173 2065 3a0a 2020  seError as e:.  
-00013b00: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00013b10: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
-00013b20: 7469 6f6e 2865 2920 6672 6f6d 2065 0a0a  tion(e) from e..
-00013b30: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
-00013b40: 640a 2020 2020 6465 6620 6f72 6465 725f  d.    def order_
-00013b50: 6861 735f 6665 6528 6f72 6465 723a 2044  has_fee(order: D
-00013b60: 6963 7429 202d 3e20 626f 6f6c 3a0a 2020  ict) -> bool:.  
-00013b70: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00013b80: 2020 5665 7269 6669 6573 2069 6620 7468    Verifies if th
-00013b90: 6520 7061 7373 6564 2069 6e20 6f72 6465  e passed in orde
-00013ba0: 7220 6469 6374 2068 6173 2074 6865 206e  r dict has the n
-00013bb0: 6565 6465 6420 6b65 7973 2074 6f20 6578  eeded keys to ex
-00013bc0: 7472 6163 7420 6665 6573 2c0a 2020 2020  tract fees,.    
-00013bd0: 2020 2020 616e 6420 7468 6174 2074 6865      and that the
-00013be0: 7365 206b 6579 7320 2863 7572 7265 6e63  se keys (currenc
-00013bf0: 792c 2063 6f73 7429 2061 7265 206e 6f74  y, cost) are not
-00013c00: 2065 6d70 7479 2e0a 2020 2020 2020 2020   empty..        
-00013c10: 3a70 6172 616d 206f 7264 6572 3a20 4f72  :param order: Or
-00013c20: 6465 7220 6f72 2074 7261 6465 2028 6f6e  der or trade (on
-00013c30: 6520 7472 6164 6529 2064 6963 740a 2020  e trade) dict.  
-00013c40: 2020 2020 2020 3a72 6574 7572 6e3a 2054        :return: T
-00013c50: 7275 6520 6966 2074 6865 2066 6565 2073  rue if the fee s
-00013c60: 7562 7374 7275 6374 7572 6520 636f 6e74  ubstructure cont
-00013c70: 6169 6e73 2063 7572 7265 6e63 7920 616e  ains currency an
-00013c80: 6420 636f 7374 2c20 6661 6c73 6520 6f74  d cost, false ot
-00013c90: 6865 7277 6973 650a 2020 2020 2020 2020  herwise.        
-00013ca0: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
-00013cb0: 6f74 2069 7369 6e73 7461 6e63 6528 6f72  ot isinstance(or
-00013cc0: 6465 722c 2064 6963 7429 3a0a 2020 2020  der, dict):.    
-00013cd0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00013ce0: 616c 7365 0a20 2020 2020 2020 2072 6574  alse.        ret
-00013cf0: 7572 6e20 2827 6665 6527 2069 6e20 6f72  urn ('fee' in or
-00013d00: 6465 7220 616e 6420 6f72 6465 725b 2766  der and order['f
-00013d10: 6565 275d 2069 7320 6e6f 7420 4e6f 6e65  ee'] is not None
-00013d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013d30: 2061 6e64 2028 6f72 6465 725b 2766 6565   and (order['fee
-00013d40: 275d 2e6b 6579 7328 2920 3e3d 207b 2763  '].keys() >= {'c
-00013d50: 7572 7265 6e63 7927 2c20 2763 6f73 7427  urrency', 'cost'
-00013d60: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
-00013d70: 2020 2061 6e64 206f 7264 6572 5b27 6665     and order['fe
-00013d80: 6527 5d5b 2763 7572 7265 6e63 7927 5d20  e']['currency'] 
-00013d90: 6973 206e 6f74 204e 6f6e 650a 2020 2020  is not None.    
-00013da0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-00013db0: 6f72 6465 725b 2766 6565 275d 5b27 636f  order['fee']['co
-00013dc0: 7374 275d 2069 7320 6e6f 7420 4e6f 6e65  st'] is not None
-00013dd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013de0: 2029 0a0a 2020 2020 6465 6620 6361 6c63   )..    def calc
-00013df0: 756c 6174 655f 6665 655f 7261 7465 280a  ulate_fee_rate(.
-00013e00: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00013e10: 2c20 6665 653a 2044 6963 742c 2073 796d  , fee: Dict, sym
-00013e20: 626f 6c3a 2073 7472 2c20 636f 7374 3a20  bol: str, cost: 
-00013e30: 666c 6f61 742c 2061 6d6f 756e 743a 2066  float, amount: f
-00013e40: 6c6f 6174 2920 2d3e 204f 7074 696f 6e61  loat) -> Optiona
-00013e50: 6c5b 666c 6f61 745d 3a0a 2020 2020 2020  l[float]:.      
-00013e60: 2020 2222 220a 2020 2020 2020 2020 4361    """.        Ca
-00013e70: 6c63 756c 6174 6520 6665 6520 7261 7465  lculate fee rate
-00013e80: 2069 6620 6974 2773 206e 6f74 2067 6976   if it's not giv
-00013e90: 656e 2062 7920 7468 6520 6578 6368 616e  en by the exchan
-00013ea0: 6765 2e0a 2020 2020 2020 2020 3a70 6172  ge..        :par
-00013eb0: 616d 2066 6565 3a20 6363 7874 2046 6565  am fee: ccxt Fee
-00013ec0: 2064 6963 7420 2d20 6d75 7374 2063 6f6e   dict - must con
-00013ed0: 7461 696e 2063 6f73 7420 2f20 6375 7272  tain cost / curr
-00013ee0: 656e 6379 202f 2072 6174 650a 2020 2020  ency / rate.    
-00013ef0: 2020 2020 3a70 6172 616d 2073 796d 626f      :param symbo
-00013f00: 6c3a 2053 796d 626f 6c20 6f66 2074 6865  l: Symbol of the
-00013f10: 206f 7264 6572 0a20 2020 2020 2020 203a   order.        :
-00013f20: 7061 7261 6d20 636f 7374 3a20 546f 7461  param cost: Tota
-00013f30: 6c20 636f 7374 206f 6620 7468 6520 6f72  l cost of the or
-00013f40: 6465 720a 2020 2020 2020 2020 3a70 6172  der.        :par
-00013f50: 616d 2061 6d6f 756e 743a 2041 6d6f 756e  am amount: Amoun
-00013f60: 7420 6f66 2074 6865 206f 7264 6572 0a20  t of the order. 
-00013f70: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00013f80: 2020 2069 6620 6665 652e 6765 7428 2772     if fee.get('r
-00013f90: 6174 6527 2920 6973 206e 6f74 204e 6f6e  ate') is not Non
-00013fa0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00013fb0: 6574 7572 6e20 6665 652e 6765 7428 2772  eturn fee.get('r
-00013fc0: 6174 6527 290a 2020 2020 2020 2020 6665  ate').        fe
-00013fd0: 655f 6375 7272 203d 2066 6565 2e67 6574  e_curr = fee.get
-00013fe0: 2827 6375 7272 656e 6379 2729 0a20 2020  ('currency').   
-00013ff0: 2020 2020 2069 6620 6665 655f 6375 7272       if fee_curr
-00014000: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-00014010: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-00014020: 650a 2020 2020 2020 2020 6665 655f 636f  e.        fee_co
-00014030: 7374 203d 2066 6c6f 6174 2866 6565 5b27  st = float(fee['
-00014040: 636f 7374 275d 290a 2020 2020 2020 2020  cost']).        
-00014050: 6966 2073 656c 662e 5f66 745f 6861 735b  if self._ft_has[
-00014060: 2766 6565 5f63 6f73 745f 696e 5f63 6f6e  'fee_cost_in_con
-00014070: 7472 6163 7473 275d 3a0a 2020 2020 2020  tracts']:.      
-00014080: 2020 2020 2020 2320 436f 6e76 6572 7420        # Convert 
-00014090: 636f 7374 2076 6961 2022 636f 6e74 7261  cost via "contra
-000140a0: 6374 7322 2063 6f6e 7665 7273 696f 6e0a  cts" conversion.
-000140b0: 2020 2020 2020 2020 2020 2020 6665 655f              fee_
-000140c0: 636f 7374 203d 2073 656c 662e 5f63 6f6e  cost = self._con
-000140d0: 7472 6163 7473 5f74 6f5f 616d 6f75 6e74  tracts_to_amount
-000140e0: 2873 796d 626f 6c2c 2066 6565 5b27 636f  (symbol, fee['co
-000140f0: 7374 275d 290a 0a20 2020 2020 2020 2023  st'])..        #
-00014100: 2043 616c 6375 6c61 7465 2066 6565 2062   Calculate fee b
-00014110: 6173 6564 206f 6e20 6f72 6465 7220 6465  ased on order de
-00014120: 7461 696c 730a 2020 2020 2020 2020 6966  tails.        if
-00014130: 2066 6565 5f63 7572 7220 3d3d 2073 656c   fee_curr == sel
-00014140: 662e 6765 745f 7061 6972 5f62 6173 655f  f.get_pair_base_
-00014150: 6375 7272 656e 6379 2873 796d 626f 6c29  currency(symbol)
-00014160: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00014170: 4261 7365 2063 7572 7265 6e63 7920 2d20  Base currency - 
-00014180: 6469 7669 6465 2062 7920 616d 6f75 6e74  divide by amount
-00014190: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000141a0: 7572 6e20 726f 756e 6428 6665 655f 636f  urn round(fee_co
-000141b0: 7374 202f 2061 6d6f 756e 742c 2038 290a  st / amount, 8).
-000141c0: 2020 2020 2020 2020 656c 6966 2066 6565          elif fee
-000141d0: 5f63 7572 7220 3d3d 2073 656c 662e 6765  _curr == self.ge
-000141e0: 745f 7061 6972 5f71 756f 7465 5f63 7572  t_pair_quote_cur
-000141f0: 7265 6e63 7928 7379 6d62 6f6c 293a 0a20  rency(symbol):. 
-00014200: 2020 2020 2020 2020 2020 2023 2051 756f             # Quo
-00014210: 7465 2063 7572 7265 6e63 7920 2d20 6469  te currency - di
-00014220: 7669 6465 2062 7920 636f 7374 0a20 2020  vide by cost.   
-00014230: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00014240: 726f 756e 6428 6665 655f 636f 7374 202f  round(fee_cost /
-00014250: 2063 6f73 742c 2038 2920 6966 2063 6f73   cost, 8) if cos
-00014260: 7420 656c 7365 204e 6f6e 650a 2020 2020  t else None.    
-00014270: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00014280: 2020 2020 2020 2320 4966 2046 6565 2063        # If Fee c
-00014290: 7572 7265 6e63 7920 6973 2061 2064 6966  urrency is a dif
-000142a0: 6665 7265 6e74 2063 7572 7265 6e63 790a  ferent currency.
-000142b0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-000142c0: 6f74 2063 6f73 743a 0a20 2020 2020 2020  ot cost:.       
-000142d0: 2020 2020 2020 2020 2023 2049 6620 636f           # If co
-000142e0: 7374 2069 7320 4e6f 6e65 206f 7220 302e  st is None or 0.
-000142f0: 3020 2d3e 2066 616c 7379 2c20 7265 7475  0 -> falsy, retu
-00014300: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
-00014310: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00014320: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00014330: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00014340: 2020 2020 2063 6f6d 6220 3d20 7365 6c66       comb = self
-00014350: 2e67 6574 5f76 616c 6964 5f70 6169 725f  .get_valid_pair_
-00014360: 636f 6d62 696e 6174 696f 6e28 6665 655f  combination(fee_
-00014370: 6375 7272 2c20 7365 6c66 2e5f 636f 6e66  curr, self._conf
-00014380: 6967 5b27 7374 616b 655f 6375 7272 656e  ig['stake_curren
-00014390: 6379 275d 290a 2020 2020 2020 2020 2020  cy']).          
-000143a0: 2020 2020 2020 7469 636b 203d 2073 656c        tick = sel
-000143b0: 662e 6665 7463 685f 7469 636b 6572 2863  f.fetch_ticker(c
-000143c0: 6f6d 6229 0a0a 2020 2020 2020 2020 2020  omb)..          
-000143d0: 2020 2020 2020 6665 655f 746f 5f71 756f        fee_to_quo
-000143e0: 7465 5f72 6174 6520 3d20 7361 6665 5f76  te_rate = safe_v
-000143f0: 616c 7565 5f66 616c 6c62 6163 6b32 2874  alue_fallback2(t
-00014400: 6963 6b2c 2074 6963 6b2c 2027 6c61 7374  ick, tick, 'last
-00014410: 272c 2027 6173 6b27 290a 2020 2020 2020  ', 'ask').      
-00014420: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00014430: 6861 6e67 6545 7272 6f72 3a0a 2020 2020  hangeError:.    
-00014440: 2020 2020 2020 2020 2020 2020 6665 655f              fee_
-00014450: 746f 5f71 756f 7465 5f72 6174 6520 3d20  to_quote_rate = 
-00014460: 7365 6c66 2e5f 636f 6e66 6967 5b27 6578  self._config['ex
-00014470: 6368 616e 6765 275d 2e67 6574 2827 756e  change'].get('un
-00014480: 6b6e 6f77 6e5f 6665 655f 7261 7465 272c  known_fee_rate',
-00014490: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
-000144a0: 2020 2020 2020 2069 6620 6e6f 7420 6665         if not fe
-000144b0: 655f 746f 5f71 756f 7465 5f72 6174 653a  e_to_quote_rate:
-000144c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000144d0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-000144e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000144f0: 7572 6e20 726f 756e 6428 2866 6565 5f63  urn round((fee_c
-00014500: 6f73 7420 2a20 6665 655f 746f 5f71 756f  ost * fee_to_quo
-00014510: 7465 5f72 6174 6529 202f 2063 6f73 742c  te_rate) / cost,
-00014520: 2038 290a 0a20 2020 2064 6566 2065 7874   8)..    def ext
-00014530: 7261 6374 5f63 6f73 745f 6375 7272 5f72  ract_cost_curr_r
-00014540: 6174 6528 7365 6c66 2c20 6665 653a 2044  ate(self, fee: D
-00014550: 6963 742c 2073 796d 626f 6c3a 2073 7472  ict, symbol: str
-00014560: 2c20 636f 7374 3a20 666c 6f61 742c 0a20  , cost: float,. 
-00014570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014580: 2020 2020 2020 2020 2020 2020 2020 616d                am
-00014590: 6f75 6e74 3a20 666c 6f61 7429 202d 3e20  ount: float) -> 
-000145a0: 5475 706c 655b 666c 6f61 742c 2073 7472  Tuple[float, str
-000145b0: 2c20 4f70 7469 6f6e 616c 5b66 6c6f 6174  , Optional[float
-000145c0: 5d5d 3a0a 2020 2020 2020 2020 2222 220a  ]]:.        """.
-000145d0: 2020 2020 2020 2020 4578 7472 6163 7420          Extract 
-000145e0: 7475 706c 6520 6f66 2063 6f73 742c 2063  tuple of cost, c
-000145f0: 7572 7265 6e63 792c 2072 6174 652e 0a20  urrency, rate.. 
-00014600: 2020 2020 2020 2052 6571 7569 7265 7320         Requires 
-00014610: 6f72 6465 725f 6861 735f 6665 6520 746f  order_has_fee to
-00014620: 2072 756e 2066 6972 7374 210a 2020 2020   run first!.    
-00014630: 2020 2020 3a70 6172 616d 2066 6565 3a20      :param fee: 
-00014640: 6363 7874 2046 6565 2064 6963 7420 2d20  ccxt Fee dict - 
-00014650: 6d75 7374 2063 6f6e 7461 696e 2063 6f73  must contain cos
-00014660: 7420 2f20 6375 7272 656e 6379 202f 2072  t / currency / r
-00014670: 6174 650a 2020 2020 2020 2020 3a70 6172  ate.        :par
-00014680: 616d 2073 796d 626f 6c3a 2053 796d 626f  am symbol: Symbo
-00014690: 6c20 6f66 2074 6865 206f 7264 6572 0a20  l of the order. 
-000146a0: 2020 2020 2020 203a 7061 7261 6d20 636f         :param co
-000146b0: 7374 3a20 546f 7461 6c20 636f 7374 206f  st: Total cost o
-000146c0: 6620 7468 6520 6f72 6465 720a 2020 2020  f the order.    
-000146d0: 2020 2020 3a70 6172 616d 2061 6d6f 756e      :param amoun
-000146e0: 743a 2041 6d6f 756e 7420 6f66 2074 6865  t: Amount of the
-000146f0: 206f 7264 6572 0a20 2020 2020 2020 203a   order.        :
-00014700: 7265 7475 726e 3a20 5475 706c 6520 7769  return: Tuple wi
-00014710: 7468 2063 6f73 742c 2063 7572 7265 6e63  th cost, currenc
-00014720: 792c 2072 6174 6520 6f66 2074 6865 2067  y, rate of the g
-00014730: 6976 656e 2066 6565 2064 6963 740a 2020  iven fee dict.  
-00014740: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00014750: 2020 7265 7475 726e 2028 666c 6f61 7428    return (float(
-00014760: 6665 655b 2763 6f73 7427 5d29 2c0a 2020  fee['cost']),.  
-00014770: 2020 2020 2020 2020 2020 2020 2020 6665                fe
-00014780: 655b 2763 7572 7265 6e63 7927 5d2c 0a20  e['currency'],. 
-00014790: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-000147a0: 656c 662e 6361 6c63 756c 6174 655f 6665  elf.calculate_fe
-000147b0: 655f 7261 7465 280a 2020 2020 2020 2020  e_rate(.        
-000147c0: 2020 2020 2020 2020 2020 2020 6665 652c              fee,
-000147d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000147e0: 2020 2020 2073 796d 626f 6c2c 0a20 2020       symbol,.   
-000147f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014800: 2063 6f73 742c 0a20 2020 2020 2020 2020   cost,.         
-00014810: 2020 2020 2020 2020 2020 2061 6d6f 756e             amoun
-00014820: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-00014830: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00014840: 2020 2020 2020 2020 290a 0a20 2020 2023          )..    #
-00014850: 2048 6973 746f 7269 6320 6461 7461 0a0a   Historic data..
-00014860: 2020 2020 6465 6620 6765 745f 6869 7374      def get_hist
-00014870: 6f72 6963 5f6f 686c 6376 2873 656c 662c  oric_ohlcv(self,
-00014880: 2070 6169 723a 2073 7472 2c20 7469 6d65   pair: str, time
-00014890: 6672 616d 653a 2073 7472 2c0a 2020 2020  frame: str,.    
-000148a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148b0: 2020 2020 2020 2073 696e 6365 5f6d 733a         since_ms:
-000148c0: 2069 6e74 2c20 6361 6e64 6c65 5f74 7970   int, candle_typ
-000148d0: 653a 2043 616e 646c 6554 7970 652c 0a20  e: CandleType,. 
-000148e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000148f0: 2020 2020 2020 2020 2020 6973 5f6e 6577            is_new
-00014900: 5f70 6169 723a 2062 6f6f 6c20 3d20 4661  _pair: bool = Fa
-00014910: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
+00013990: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+000139a0: 6963 653d 7072 6963 652c 2074 616b 6572  ice=price, taker
+000139b0: 4f72 4d61 6b65 723d 7461 6b65 725f 6f72  OrMaker=taker_or
+000139c0: 5f6d 616b 6572 295b 2772 6174 6527 5d0a  _maker)['rate'].
+000139d0: 2020 2020 2020 2020 6578 6365 7074 2063          except c
+000139e0: 6378 742e 4444 6f53 5072 6f74 6563 7469  cxt.DDoSProtecti
+000139f0: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+00013a00: 2020 2020 2072 6169 7365 2044 446f 7350       raise DDosP
+00013a10: 726f 7465 6374 696f 6e28 6529 2066 726f  rotection(e) fro
+00013a20: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
+00013a30: 7074 2028 6363 7874 2e4e 6574 776f 726b  pt (ccxt.Network
+00013a40: 4572 726f 722c 2063 6378 742e 4578 6368  Error, ccxt.Exch
+00013a50: 616e 6765 4572 726f 7229 2061 7320 653a  angeError) as e:
+00013a60: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00013a70: 7365 2054 656d 706f 7261 7279 4572 726f  se TemporaryErro
+00013a80: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+00013a90: 2020 2066 2743 6f75 6c64 206e 6f74 2067     f'Could not g
+00013aa0: 6574 2066 6565 2069 6e66 6f20 6475 6520  et fee info due 
+00013ab0: 746f 207b 652e 5f5f 636c 6173 735f 5f2e  to {e.__class__.
+00013ac0: 5f5f 6e61 6d65 5f5f 7d2e 204d 6573 7361  __name__}. Messa
+00013ad0: 6765 3a20 7b65 7d27 2920 6672 6f6d 2065  ge: {e}') from e
+00013ae0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00013af0: 6363 7874 2e42 6173 6545 7272 6f72 2061  ccxt.BaseError a
+00013b00: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+00013b10: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
+00013b20: 616c 4578 6365 7074 696f 6e28 6529 2066  alException(e) f
+00013b30: 726f 6d20 650a 0a20 2020 2040 7374 6174  rom e..    @stat
+00013b40: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+00013b50: 206f 7264 6572 5f68 6173 5f66 6565 286f   order_has_fee(o
+00013b60: 7264 6572 3a20 4469 6374 2920 2d3e 2062  rder: Dict) -> b
+00013b70: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
+00013b80: 0a20 2020 2020 2020 2056 6572 6966 6965  .        Verifie
+00013b90: 7320 6966 2074 6865 2070 6173 7365 6420  s if the passed 
+00013ba0: 696e 206f 7264 6572 2064 6963 7420 6861  in order dict ha
+00013bb0: 7320 7468 6520 6e65 6564 6564 206b 6579  s the needed key
+00013bc0: 7320 746f 2065 7874 7261 6374 2066 6565  s to extract fee
+00013bd0: 732c 0a20 2020 2020 2020 2061 6e64 2074  s,.        and t
+00013be0: 6861 7420 7468 6573 6520 6b65 7973 2028  hat these keys (
+00013bf0: 6375 7272 656e 6379 2c20 636f 7374 2920  currency, cost) 
+00013c00: 6172 6520 6e6f 7420 656d 7074 792e 0a20  are not empty.. 
+00013c10: 2020 2020 2020 203a 7061 7261 6d20 6f72         :param or
+00013c20: 6465 723a 204f 7264 6572 206f 7220 7472  der: Order or tr
+00013c30: 6164 6520 286f 6e65 2074 7261 6465 2920  ade (one trade) 
+00013c40: 6469 6374 0a20 2020 2020 2020 203a 7265  dict.        :re
+00013c50: 7475 726e 3a20 5472 7565 2069 6620 7468  turn: True if th
+00013c60: 6520 6665 6520 7375 6273 7472 7563 7475  e fee substructu
+00013c70: 7265 2063 6f6e 7461 696e 7320 6375 7272  re contains curr
+00013c80: 656e 6379 2061 6e64 2063 6f73 742c 2066  ency and cost, f
+00013c90: 616c 7365 206f 7468 6572 7769 7365 0a20  alse otherwise. 
+00013ca0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00013cb0: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
+00013cc0: 616e 6365 286f 7264 6572 2c20 6469 6374  ance(order, dict
+00013cd0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00013ce0: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+00013cf0: 2020 2020 7265 7475 726e 2028 2766 6565      return ('fee
+00013d00: 2720 696e 206f 7264 6572 2061 6e64 206f  ' in order and o
+00013d10: 7264 6572 5b27 6665 6527 5d20 6973 206e  rder['fee'] is n
+00013d20: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
+00013d30: 2020 2020 2020 2020 616e 6420 286f 7264          and (ord
+00013d40: 6572 5b27 6665 6527 5d2e 6b65 7973 2829  er['fee'].keys()
+00013d50: 203e 3d20 7b27 6375 7272 656e 6379 272c   >= {'currency',
+00013d60: 2027 636f 7374 277d 290a 2020 2020 2020   'cost'}).      
+00013d70: 2020 2020 2020 2020 2020 616e 6420 6f72            and or
+00013d80: 6465 725b 2766 6565 275d 5b27 6375 7272  der['fee']['curr
+00013d90: 656e 6379 275d 2069 7320 6e6f 7420 4e6f  ency'] is not No
+00013da0: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
+00013db0: 2020 2061 6e64 206f 7264 6572 5b27 6665     and order['fe
+00013dc0: 6527 5d5b 2763 6f73 7427 5d20 6973 206e  e']['cost'] is n
+00013dd0: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
+00013de0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00013df0: 6566 2063 616c 6375 6c61 7465 5f66 6565  ef calculate_fee
+00013e00: 5f72 6174 6528 0a20 2020 2020 2020 2020  _rate(.         
+00013e10: 2020 2073 656c 662c 2066 6565 3a20 4469     self, fee: Di
+00013e20: 6374 2c20 7379 6d62 6f6c 3a20 7374 722c  ct, symbol: str,
+00013e30: 2063 6f73 743a 2066 6c6f 6174 2c20 616d   cost: float, am
+00013e40: 6f75 6e74 3a20 666c 6f61 7429 202d 3e20  ount: float) -> 
+00013e50: 4f70 7469 6f6e 616c 5b66 6c6f 6174 5d3a  Optional[float]:
+00013e60: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013e70: 2020 2020 2043 616c 6375 6c61 7465 2066       Calculate f
+00013e80: 6565 2072 6174 6520 6966 2069 7427 7320  ee rate if it's 
+00013e90: 6e6f 7420 6769 7665 6e20 6279 2074 6865  not given by the
+00013ea0: 2065 7863 6861 6e67 652e 0a20 2020 2020   exchange..     
+00013eb0: 2020 203a 7061 7261 6d20 6665 653a 2063     :param fee: c
+00013ec0: 6378 7420 4665 6520 6469 6374 202d 206d  cxt Fee dict - m
+00013ed0: 7573 7420 636f 6e74 6169 6e20 636f 7374  ust contain cost
+00013ee0: 202f 2063 7572 7265 6e63 7920 2f20 7261   / currency / ra
+00013ef0: 7465 0a20 2020 2020 2020 203a 7061 7261  te.        :para
+00013f00: 6d20 7379 6d62 6f6c 3a20 5379 6d62 6f6c  m symbol: Symbol
+00013f10: 206f 6620 7468 6520 6f72 6465 720a 2020   of the order.  
+00013f20: 2020 2020 2020 3a70 6172 616d 2063 6f73        :param cos
+00013f30: 743a 2054 6f74 616c 2063 6f73 7420 6f66  t: Total cost of
+00013f40: 2074 6865 206f 7264 6572 0a20 2020 2020   the order.     
+00013f50: 2020 203a 7061 7261 6d20 616d 6f75 6e74     :param amount
+00013f60: 3a20 416d 6f75 6e74 206f 6620 7468 6520  : Amount of the 
+00013f70: 6f72 6465 720a 2020 2020 2020 2020 2222  order.        ""
+00013f80: 220a 2020 2020 2020 2020 6966 2066 6565  ".        if fee
+00013f90: 2e67 6574 2827 7261 7465 2729 2069 7320  .get('rate') is 
+00013fa0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00013fb0: 2020 2020 2020 7265 7475 726e 2066 6565        return fee
+00013fc0: 2e67 6574 2827 7261 7465 2729 0a20 2020  .get('rate').   
+00013fd0: 2020 2020 2066 6565 5f63 7572 7220 3d20       fee_curr = 
+00013fe0: 6665 652e 6765 7428 2763 7572 7265 6e63  fee.get('currenc
+00013ff0: 7927 290a 2020 2020 2020 2020 6966 2066  y').        if f
+00014000: 6565 5f63 7572 7220 6973 204e 6f6e 653a  ee_curr is None:
+00014010: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00014020: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
+00014030: 2066 6565 5f63 6f73 7420 3d20 666c 6f61   fee_cost = floa
+00014040: 7428 6665 655b 2763 6f73 7427 5d29 0a20  t(fee['cost']). 
+00014050: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
+00014060: 6674 5f68 6173 5b27 6665 655f 636f 7374  ft_has['fee_cost
+00014070: 5f69 6e5f 636f 6e74 7261 6374 7327 5d3a  _in_contracts']:
+00014080: 0a20 2020 2020 2020 2020 2020 2023 2043  .            # C
+00014090: 6f6e 7665 7274 2063 6f73 7420 7669 6120  onvert cost via 
+000140a0: 2263 6f6e 7472 6163 7473 2220 636f 6e76  "contracts" conv
+000140b0: 6572 7369 6f6e 0a20 2020 2020 2020 2020  ersion.         
+000140c0: 2020 2066 6565 5f63 6f73 7420 3d20 7365     fee_cost = se
+000140d0: 6c66 2e5f 636f 6e74 7261 6374 735f 746f  lf._contracts_to
+000140e0: 5f61 6d6f 756e 7428 7379 6d62 6f6c 2c20  _amount(symbol, 
+000140f0: 6665 655b 2763 6f73 7427 5d29 0a0a 2020  fee['cost'])..  
+00014100: 2020 2020 2020 2320 4361 6c63 756c 6174        # Calculat
+00014110: 6520 6665 6520 6261 7365 6420 6f6e 206f  e fee based on o
+00014120: 7264 6572 2064 6574 6169 6c73 0a20 2020  rder details.   
+00014130: 2020 2020 2069 6620 6665 655f 6375 7272       if fee_curr
+00014140: 203d 3d20 7365 6c66 2e67 6574 5f70 6169   == self.get_pai
+00014150: 725f 6261 7365 5f63 7572 7265 6e63 7928  r_base_currency(
+00014160: 7379 6d62 6f6c 293a 0a20 2020 2020 2020  symbol):.       
+00014170: 2020 2020 2023 2042 6173 6520 6375 7272       # Base curr
+00014180: 656e 6379 202d 2064 6976 6964 6520 6279  ency - divide by
+00014190: 2061 6d6f 756e 740a 2020 2020 2020 2020   amount.        
+000141a0: 2020 2020 7265 7475 726e 2072 6f75 6e64      return round
+000141b0: 2866 6565 5f63 6f73 7420 2f20 616d 6f75  (fee_cost / amou
+000141c0: 6e74 2c20 3829 0a20 2020 2020 2020 2065  nt, 8).        e
+000141d0: 6c69 6620 6665 655f 6375 7272 203d 3d20  lif fee_curr == 
+000141e0: 7365 6c66 2e67 6574 5f70 6169 725f 7175  self.get_pair_qu
+000141f0: 6f74 655f 6375 7272 656e 6379 2873 796d  ote_currency(sym
+00014200: 626f 6c29 3a0a 2020 2020 2020 2020 2020  bol):.          
+00014210: 2020 2320 5175 6f74 6520 6375 7272 656e    # Quote curren
+00014220: 6379 202d 2064 6976 6964 6520 6279 2063  cy - divide by c
+00014230: 6f73 740a 2020 2020 2020 2020 2020 2020  ost.            
+00014240: 7265 7475 726e 2072 6f75 6e64 2866 6565  return round(fee
+00014250: 5f63 6f73 7420 2f20 636f 7374 2c20 3829  _cost / cost, 8)
+00014260: 2069 6620 636f 7374 2065 6c73 6520 4e6f   if cost else No
+00014270: 6e65 0a20 2020 2020 2020 2065 6c73 653a  ne.        else:
+00014280: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
+00014290: 6620 4665 6520 6375 7272 656e 6379 2069  f Fee currency i
+000142a0: 7320 6120 6469 6666 6572 656e 7420 6375  s a different cu
+000142b0: 7272 656e 6379 0a20 2020 2020 2020 2020  rrency.         
+000142c0: 2020 2069 6620 6e6f 7420 636f 7374 3a0a     if not cost:.
+000142d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000142e0: 2320 4966 2063 6f73 7420 6973 204e 6f6e  # If cost is Non
+000142f0: 6520 6f72 2030 2e30 202d 3e20 6661 6c73  e or 0.0 -> fals
+00014300: 792c 2072 6574 7572 6e20 4e6f 6e65 0a20  y, return None. 
+00014310: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00014320: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
+00014330: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00014340: 2020 2020 2020 2020 2020 2020 636f 6d62              comb
+00014350: 203d 2073 656c 662e 6765 745f 7661 6c69   = self.get_vali
+00014360: 645f 7061 6972 5f63 6f6d 6269 6e61 7469  d_pair_combinati
+00014370: 6f6e 2866 6565 5f63 7572 722c 2073 656c  on(fee_curr, sel
+00014380: 662e 5f63 6f6e 6669 675b 2773 7461 6b65  f._config['stake
+00014390: 5f63 7572 7265 6e63 7927 5d29 0a20 2020  _currency']).   
+000143a0: 2020 2020 2020 2020 2020 2020 2074 6963               tic
+000143b0: 6b20 3d20 7365 6c66 2e66 6574 6368 5f74  k = self.fetch_t
+000143c0: 6963 6b65 7228 636f 6d62 290a 0a20 2020  icker(comb)..   
+000143d0: 2020 2020 2020 2020 2020 2020 2066 6565               fee
+000143e0: 5f74 6f5f 7175 6f74 655f 7261 7465 203d  _to_quote_rate =
+000143f0: 2073 6166 655f 7661 6c75 655f 6661 6c6c   safe_value_fall
+00014400: 6261 636b 3228 7469 636b 2c20 7469 636b  back2(tick, tick
+00014410: 2c20 276c 6173 7427 2c20 2761 736b 2729  , 'last', 'ask')
+00014420: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00014430: 6570 7420 4578 6368 616e 6765 4572 726f  ept ExchangeErro
+00014440: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+00014450: 2020 2066 6565 5f74 6f5f 7175 6f74 655f     fee_to_quote_
+00014460: 7261 7465 203d 2073 656c 662e 5f63 6f6e  rate = self._con
+00014470: 6669 675b 2765 7863 6861 6e67 6527 5d2e  fig['exchange'].
+00014480: 6765 7428 2775 6e6b 6e6f 776e 5f66 6565  get('unknown_fee
+00014490: 5f72 6174 6527 2c20 4e6f 6e65 290a 2020  _rate', None).  
+000144a0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000144b0: 206e 6f74 2066 6565 5f74 6f5f 7175 6f74   not fee_to_quot
+000144c0: 655f 7261 7465 3a0a 2020 2020 2020 2020  e_rate:.        
+000144d0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000144e0: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
+000144f0: 2020 2020 7265 7475 726e 2072 6f75 6e64      return round
+00014500: 2828 6665 655f 636f 7374 202a 2066 6565  ((fee_cost * fee
+00014510: 5f74 6f5f 7175 6f74 655f 7261 7465 2920  _to_quote_rate) 
+00014520: 2f20 636f 7374 2c20 3829 0a0a 2020 2020  / cost, 8)..    
+00014530: 6465 6620 6578 7472 6163 745f 636f 7374  def extract_cost
+00014540: 5f63 7572 725f 7261 7465 2873 656c 662c  _curr_rate(self,
+00014550: 2066 6565 3a20 4469 6374 2c20 7379 6d62   fee: Dict, symb
+00014560: 6f6c 3a20 7374 722c 2063 6f73 743a 2066  ol: str, cost: f
+00014570: 6c6f 6174 2c0a 2020 2020 2020 2020 2020  loat,.          
+00014580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014590: 2020 2020 2061 6d6f 756e 743a 2066 6c6f       amount: flo
+000145a0: 6174 2920 2d3e 2054 7570 6c65 5b66 6c6f  at) -> Tuple[flo
+000145b0: 6174 2c20 7374 722c 204f 7074 696f 6e61  at, str, Optiona
+000145c0: 6c5b 666c 6f61 745d 5d3a 0a20 2020 2020  l[float]]:.     
+000145d0: 2020 2022 2222 0a20 2020 2020 2020 2045     """.        E
+000145e0: 7874 7261 6374 2074 7570 6c65 206f 6620  xtract tuple of 
+000145f0: 636f 7374 2c20 6375 7272 656e 6379 2c20  cost, currency, 
+00014600: 7261 7465 2e0a 2020 2020 2020 2020 5265  rate..        Re
+00014610: 7175 6972 6573 206f 7264 6572 5f68 6173  quires order_has
+00014620: 5f66 6565 2074 6f20 7275 6e20 6669 7273  _fee to run firs
+00014630: 7421 0a20 2020 2020 2020 203a 7061 7261  t!.        :para
+00014640: 6d20 6665 653a 2063 6378 7420 4665 6520  m fee: ccxt Fee 
+00014650: 6469 6374 202d 206d 7573 7420 636f 6e74  dict - must cont
+00014660: 6169 6e20 636f 7374 202f 2063 7572 7265  ain cost / curre
+00014670: 6e63 7920 2f20 7261 7465 0a20 2020 2020  ncy / rate.     
+00014680: 2020 203a 7061 7261 6d20 7379 6d62 6f6c     :param symbol
+00014690: 3a20 5379 6d62 6f6c 206f 6620 7468 6520  : Symbol of the 
+000146a0: 6f72 6465 720a 2020 2020 2020 2020 3a70  order.        :p
+000146b0: 6172 616d 2063 6f73 743a 2054 6f74 616c  aram cost: Total
+000146c0: 2063 6f73 7420 6f66 2074 6865 206f 7264   cost of the ord
+000146d0: 6572 0a20 2020 2020 2020 203a 7061 7261  er.        :para
+000146e0: 6d20 616d 6f75 6e74 3a20 416d 6f75 6e74  m amount: Amount
+000146f0: 206f 6620 7468 6520 6f72 6465 720a 2020   of the order.  
+00014700: 2020 2020 2020 3a72 6574 7572 6e3a 2054        :return: T
+00014710: 7570 6c65 2077 6974 6820 636f 7374 2c20  uple with cost, 
+00014720: 6375 7272 656e 6379 2c20 7261 7465 206f  currency, rate o
+00014730: 6620 7468 6520 6769 7665 6e20 6665 6520  f the given fee 
+00014740: 6469 6374 0a20 2020 2020 2020 2022 2222  dict.        """
+00014750: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00014760: 2866 6c6f 6174 2866 6565 5b27 636f 7374  (float(fee['cost
+00014770: 275d 292c 0a20 2020 2020 2020 2020 2020  ']),.           
+00014780: 2020 2020 2066 6565 5b27 6375 7272 656e       fee['curren
+00014790: 6379 275d 2c0a 2020 2020 2020 2020 2020  cy'],.          
+000147a0: 2020 2020 2020 7365 6c66 2e63 616c 6375        self.calcu
+000147b0: 6c61 7465 5f66 6565 5f72 6174 6528 0a20  late_fee_rate(. 
+000147c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000147d0: 2020 2066 6565 2c0a 2020 2020 2020 2020     fee,.        
+000147e0: 2020 2020 2020 2020 2020 2020 7379 6d62              symb
+000147f0: 6f6c 2c0a 2020 2020 2020 2020 2020 2020  ol,.            
+00014800: 2020 2020 2020 2020 636f 7374 2c0a 2020          cost,.  
+00014810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014820: 2020 616d 6f75 6e74 0a20 2020 2020 2020    amount.       
+00014830: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00014840: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00014850: 0a0a 2020 2020 2320 4869 7374 6f72 6963  ..    # Historic
+00014860: 2064 6174 610a 0a20 2020 2064 6566 2067   data..    def g
+00014870: 6574 5f68 6973 746f 7269 635f 6f68 6c63  et_historic_ohlc
+00014880: 7628 7365 6c66 2c20 7061 6972 3a20 7374  v(self, pair: st
+00014890: 722c 2074 696d 6566 7261 6d65 3a20 7374  r, timeframe: st
+000148a0: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+000148b0: 2020 2020 2020 2020 2020 2020 2020 7369                si
+000148c0: 6e63 655f 6d73 3a20 696e 742c 2063 616e  nce_ms: int, can
+000148d0: 646c 655f 7479 7065 3a20 4361 6e64 6c65  dle_type: Candle
+000148e0: 5479 7065 2c0a 2020 2020 2020 2020 2020  Type,.          
+000148f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014900: 2069 735f 6e65 775f 7061 6972 3a20 626f   is_new_pair: bo
+00014910: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
 00014920: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014930: 756e 7469 6c5f 6d73 3a20 4f70 7469 6f6e  until_ms: Option
-00014940: 616c 5b69 6e74 5d20 3d20 4e6f 6e65 2920  al[int] = None) 
-00014950: 2d3e 204c 6973 743a 0a20 2020 2020 2020  -> List:.       
-00014960: 2022 2222 0a20 2020 2020 2020 2047 6574   """.        Get
-00014970: 2063 616e 646c 6520 6869 7374 6f72 7920   candle history 
-00014980: 7573 696e 6720 6173 796e 6369 6f20 616e  using asyncio an
-00014990: 6420 7265 7475 726e 7320 7468 6520 6c69  d returns the li
-000149a0: 7374 206f 6620 6361 6e64 6c65 732e 0a20  st of candles.. 
-000149b0: 2020 2020 2020 2048 616e 646c 6573 2061         Handles a
-000149c0: 6c6c 2061 7379 6e63 2077 6f72 6b20 666f  ll async work fo
-000149d0: 7220 7468 6973 2e0a 2020 2020 2020 2020  r this..        
-000149e0: 4173 796e 6320 6f76 6572 206f 6e65 2070  Async over one p
-000149f0: 6169 722c 2061 7373 756d 696e 6720 7765  air, assuming we
-00014a00: 2067 6574 2060 7365 6c66 2e6f 686c 6376   get `self.ohlcv
-00014a10: 5f63 616e 646c 655f 6c69 6d69 7428 2960  _candle_limit()`
-00014a20: 2063 616e 646c 6573 2070 6572 2063 616c   candles per cal
-00014a30: 6c2e 0a20 2020 2020 2020 203a 7061 7261  l..        :para
-00014a40: 6d20 7061 6972 3a20 5061 6972 2074 6f20  m pair: Pair to 
-00014a50: 646f 776e 6c6f 6164 0a20 2020 2020 2020  download.       
-00014a60: 203a 7061 7261 6d20 7469 6d65 6672 616d   :param timefram
-00014a70: 653a 2054 696d 6566 7261 6d65 2074 6f20  e: Timeframe to 
-00014a80: 6765 7420 6461 7461 2066 6f72 0a20 2020  get data for.   
-00014a90: 2020 2020 203a 7061 7261 6d20 7369 6e63       :param sinc
-00014aa0: 655f 6d73 3a20 5469 6d65 7374 616d 7020  e_ms: Timestamp 
-00014ab0: 696e 206d 696c 6c69 7365 636f 6e64 7320  in milliseconds 
-00014ac0: 746f 2067 6574 2068 6973 746f 7279 2066  to get history f
-00014ad0: 726f 6d0a 2020 2020 2020 2020 3a70 6172  rom.        :par
-00014ae0: 616d 2075 6e74 696c 5f6d 733a 2054 696d  am until_ms: Tim
-00014af0: 6573 7461 6d70 2069 6e20 6d69 6c6c 6973  estamp in millis
-00014b00: 6563 6f6e 6473 2074 6f20 6765 7420 6869  econds to get hi
-00014b10: 7374 6f72 7920 7570 2074 6f0a 2020 2020  story up to.    
-00014b20: 2020 2020 3a70 6172 616d 2063 616e 646c      :param candl
-00014b30: 655f 7479 7065 3a20 2727 2c20 6d61 726b  e_type: '', mark
-00014b40: 2c20 696e 6465 782c 2070 7265 6d69 756d  , index, premium
-00014b50: 496e 6465 782c 206f 7220 6675 6e64 696e  Index, or fundin
-00014b60: 675f 7261 7465 0a20 2020 2020 2020 203a  g_rate.        :
-00014b70: 7265 7475 726e 3a20 4c69 7374 2077 6974  return: List wit
-00014b80: 6820 6361 6e64 6c65 2028 4f48 4c43 5629  h candle (OHLCV)
-00014b90: 2064 6174 610a 2020 2020 2020 2020 2222   data.        ""
-00014ba0: 220a 2020 2020 2020 2020 7061 6972 2c20  ".        pair, 
-00014bb0: 5f2c 205f 2c20 6461 7461 2c20 5f20 3d20  _, _, data, _ = 
-00014bc0: 7365 6c66 2e6c 6f6f 702e 7275 6e5f 756e  self.loop.run_un
-00014bd0: 7469 6c5f 636f 6d70 6c65 7465 280a 2020  til_complete(.  
-00014be0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00014bf0: 6173 796e 635f 6765 745f 6869 7374 6f72  async_get_histor
-00014c00: 6963 5f6f 686c 6376 2870 6169 723d 7061  ic_ohlcv(pair=pa
-00014c10: 6972 2c20 7469 6d65 6672 616d 653d 7469  ir, timeframe=ti
-00014c20: 6d65 6672 616d 652c 0a20 2020 2020 2020  meframe,.       
+00014930: 2020 2020 2020 2075 6e74 696c 5f6d 733a         until_ms:
+00014940: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
+00014950: 204e 6f6e 6529 202d 3e20 4c69 7374 3a0a   None) -> List:.
+00014960: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00014970: 2020 2020 4765 7420 6361 6e64 6c65 2068      Get candle h
+00014980: 6973 746f 7279 2075 7369 6e67 2061 7379  istory using asy
+00014990: 6e63 696f 2061 6e64 2072 6574 7572 6e73  ncio and returns
+000149a0: 2074 6865 206c 6973 7420 6f66 2063 616e   the list of can
+000149b0: 646c 6573 2e0a 2020 2020 2020 2020 4861  dles..        Ha
+000149c0: 6e64 6c65 7320 616c 6c20 6173 796e 6320  ndles all async 
+000149d0: 776f 726b 2066 6f72 2074 6869 732e 0a20  work for this.. 
+000149e0: 2020 2020 2020 2041 7379 6e63 206f 7665         Async ove
+000149f0: 7220 6f6e 6520 7061 6972 2c20 6173 7375  r one pair, assu
+00014a00: 6d69 6e67 2077 6520 6765 7420 6073 656c  ming we get `sel
+00014a10: 662e 6f68 6c63 765f 6361 6e64 6c65 5f6c  f.ohlcv_candle_l
+00014a20: 696d 6974 2829 6020 6361 6e64 6c65 7320  imit()` candles 
+00014a30: 7065 7220 6361 6c6c 2e0a 2020 2020 2020  per call..      
+00014a40: 2020 3a70 6172 616d 2070 6169 723a 2050    :param pair: P
+00014a50: 6169 7220 746f 2064 6f77 6e6c 6f61 640a  air to download.
+00014a60: 2020 2020 2020 2020 3a70 6172 616d 2074          :param t
+00014a70: 696d 6566 7261 6d65 3a20 5469 6d65 6672  imeframe: Timefr
+00014a80: 616d 6520 746f 2067 6574 2064 6174 6120  ame to get data 
+00014a90: 666f 720a 2020 2020 2020 2020 3a70 6172  for.        :par
+00014aa0: 616d 2073 696e 6365 5f6d 733a 2054 696d  am since_ms: Tim
+00014ab0: 6573 7461 6d70 2069 6e20 6d69 6c6c 6973  estamp in millis
+00014ac0: 6563 6f6e 6473 2074 6f20 6765 7420 6869  econds to get hi
+00014ad0: 7374 6f72 7920 6672 6f6d 0a20 2020 2020  story from.     
+00014ae0: 2020 203a 7061 7261 6d20 756e 7469 6c5f     :param until_
+00014af0: 6d73 3a20 5469 6d65 7374 616d 7020 696e  ms: Timestamp in
+00014b00: 206d 696c 6c69 7365 636f 6e64 7320 746f   milliseconds to
+00014b10: 2067 6574 2068 6973 746f 7279 2075 7020   get history up 
+00014b20: 746f 0a20 2020 2020 2020 203a 7061 7261  to.        :para
+00014b30: 6d20 6361 6e64 6c65 5f74 7970 653a 2027  m candle_type: '
+00014b40: 272c 206d 6172 6b2c 2069 6e64 6578 2c20  ', mark, index, 
+00014b50: 7072 656d 6975 6d49 6e64 6578 2c20 6f72  premiumIndex, or
+00014b60: 2066 756e 6469 6e67 5f72 6174 650a 2020   funding_rate.  
+00014b70: 2020 2020 2020 3a72 6574 7572 6e3a 204c        :return: L
+00014b80: 6973 7420 7769 7468 2063 616e 646c 6520  ist with candle 
+00014b90: 284f 484c 4356 2920 6461 7461 0a20 2020  (OHLCV) data.   
+00014ba0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00014bb0: 2070 6169 722c 205f 2c20 5f2c 2064 6174   pair, _, _, dat
+00014bc0: 612c 205f 203d 2073 656c 662e 6c6f 6f70  a, _ = self.loop
+00014bd0: 2e72 756e 5f75 6e74 696c 5f63 6f6d 706c  .run_until_compl
+00014be0: 6574 6528 0a20 2020 2020 2020 2020 2020  ete(.           
+00014bf0: 2073 656c 662e 5f61 7379 6e63 5f67 6574   self._async_get
+00014c00: 5f68 6973 746f 7269 635f 6f68 6c63 7628  _historic_ohlcv(
+00014c10: 7061 6972 3d70 6169 722c 2074 696d 6566  pair=pair, timef
+00014c20: 7261 6d65 3d74 696d 6566 7261 6d65 2c0a  rame=timeframe,.
 00014c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00014c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014c50: 2020 2020 7369 6e63 655f 6d73 3d73 696e      since_ms=sin
-00014c60: 6365 5f6d 732c 2075 6e74 696c 5f6d 733d  ce_ms, until_ms=
-00014c70: 756e 7469 6c5f 6d73 2c0a 2020 2020 2020  until_ms,.      
-00014c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c50: 2020 2020 2020 2020 2020 2073 696e 6365             since
+00014c60: 5f6d 733d 7369 6e63 655f 6d73 2c20 756e  _ms=since_ms, un
+00014c70: 7469 6c5f 6d73 3d75 6e74 696c 5f6d 732c  til_ms=until_ms,
+00014c80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00014c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ca0: 2020 2020 2069 735f 6e65 775f 7061 6972       is_new_pair
-00014cb0: 3d69 735f 6e65 775f 7061 6972 2c20 6361  =is_new_pair, ca
-00014cc0: 6e64 6c65 5f74 7970 653d 6361 6e64 6c65  ndle_type=candle
-00014cd0: 5f74 7970 6529 290a 2020 2020 2020 2020  _type)).        
-00014ce0: 6c6f 6767 6572 2e69 6e66 6f28 6622 446f  logger.info(f"Do
-00014cf0: 776e 6c6f 6164 6564 2064 6174 6120 666f  wnloaded data fo
-00014d00: 7220 7b70 6169 727d 2077 6974 6820 6c65  r {pair} with le
-00014d10: 6e67 7468 207b 6c65 6e28 6461 7461 297d  ngth {len(data)}
-00014d20: 2e22 290a 2020 2020 2020 2020 7265 7475  .").        retu
-00014d30: 726e 2064 6174 610a 0a20 2020 2061 7379  rn data..    asy
-00014d40: 6e63 2064 6566 205f 6173 796e 635f 6765  nc def _async_ge
-00014d50: 745f 6869 7374 6f72 6963 5f6f 686c 6376  t_historic_ohlcv
-00014d60: 2873 656c 662c 2070 6169 723a 2073 7472  (self, pair: str
-00014d70: 2c20 7469 6d65 6672 616d 653a 2073 7472  , timeframe: str
-00014d80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014ca0: 2020 2020 2020 2020 2020 2020 6973 5f6e              is_n
+00014cb0: 6577 5f70 6169 723d 6973 5f6e 6577 5f70  ew_pair=is_new_p
+00014cc0: 6169 722c 2063 616e 646c 655f 7479 7065  air, candle_type
+00014cd0: 3d63 616e 646c 655f 7479 7065 2929 0a20  =candle_type)). 
+00014ce0: 2020 2020 2020 206c 6f67 6765 722e 696e         logger.in
+00014cf0: 666f 2866 2244 6f77 6e6c 6f61 6465 6420  fo(f"Downloaded 
+00014d00: 6461 7461 2066 6f72 207b 7061 6972 7d20  data for {pair} 
+00014d10: 7769 7468 206c 656e 6774 6820 7b6c 656e  with length {len
+00014d20: 2864 6174 6129 7d2e 2229 0a20 2020 2020  (data)}.").     
+00014d30: 2020 2072 6574 7572 6e20 6461 7461 0a0a     return data..
+00014d40: 2020 2020 6173 796e 6320 6465 6620 5f61      async def _a
+00014d50: 7379 6e63 5f67 6574 5f68 6973 746f 7269  sync_get_histori
+00014d60: 635f 6f68 6c63 7628 7365 6c66 2c20 7061  c_ohlcv(self, pa
+00014d70: 6972 3a20 7374 722c 2074 696d 6566 7261  ir: str, timefra
+00014d80: 6d65 3a20 7374 722c 0a20 2020 2020 2020  me: str,.       
 00014d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014da0: 2020 2020 2020 2020 2020 7369 6e63 655f            since_
-00014db0: 6d73 3a20 696e 742c 2063 616e 646c 655f  ms: int, candle_
-00014dc0: 7479 7065 3a20 4361 6e64 6c65 5479 7065  type: CandleType
-00014dd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014db0: 2073 696e 6365 5f6d 733a 2069 6e74 2c20   since_ms: int, 
+00014dc0: 6361 6e64 6c65 5f74 7970 653a 2043 616e  candle_type: Can
+00014dd0: 646c 6554 7970 652c 0a20 2020 2020 2020  dleType,.       
 00014de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014df0: 2020 2020 2020 2020 2020 6973 5f6e 6577            is_new
-00014e00: 5f70 6169 723a 2062 6f6f 6c20 3d20 4661  _pair: bool = Fa
-00014e10: 6c73 652c 2072 6169 7365 5f3a 2062 6f6f  lse, raise_: boo
-00014e20: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
-00014e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e00: 2069 735f 6e65 775f 7061 6972 3a20 626f   is_new_pair: bo
+00014e10: 6f6c 203d 2046 616c 7365 2c20 7261 6973  ol = False, rais
+00014e20: 655f 3a20 626f 6f6c 203d 2046 616c 7365  e_: bool = False
+00014e30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 00014e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e50: 2020 2075 6e74 696c 5f6d 733a 204f 7074     until_ms: Opt
-00014e60: 696f 6e61 6c5b 696e 745d 203d 204e 6f6e  ional[int] = Non
-00014e70: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00014e50: 2020 2020 2020 2020 2020 756e 7469 6c5f            until_
+00014e60: 6d73 3a20 4f70 7469 6f6e 616c 5b69 6e74  ms: Optional[int
+00014e70: 5d20 3d20 4e6f 6e65 0a20 2020 2020 2020  ] = None.       
 00014e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e90: 2020 2020 2020 2020 2020 2920 2d3e 204f            ) -> O
-00014ea0: 484c 4356 5265 7370 6f6e 7365 3a0a 2020  HLCVResponse:.  
-00014eb0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00014ec0: 2020 446f 776e 6c6f 6164 2068 6973 746f    Download histo
-00014ed0: 7269 6320 6f68 6c63 760a 2020 2020 2020  ric ohlcv.      
-00014ee0: 2020 3a70 6172 616d 2069 735f 6e65 775f    :param is_new_
-00014ef0: 7061 6972 3a20 7573 6564 2062 7920 6269  pair: used by bi
-00014f00: 6e61 6e63 6520 7375 6263 6c61 7373 2074  nance subclass t
-00014f10: 6f20 616c 6c6f 7720 2266 6173 7422 206e  o allow "fast" n
-00014f20: 6577 2070 6169 7220 646f 776e 6c6f 6164  ew pair download
-00014f30: 696e 670a 2020 2020 2020 2020 3a70 6172  ing.        :par
-00014f40: 616d 2063 616e 646c 655f 7479 7065 3a20  am candle_type: 
-00014f50: 416e 7920 6f66 2074 6865 2065 6e75 6d20  Any of the enum 
-00014f60: 4361 6e64 6c65 5479 7065 2028 6d75 7374  CandleType (must
-00014f70: 206d 6174 6368 2074 7261 6469 6e67 206d   match trading m
-00014f80: 6f64 6521 290a 2020 2020 2020 2020 2222  ode!).        ""
-00014f90: 220a 0a20 2020 2020 2020 206f 6e65 5f63  "..        one_c
-00014fa0: 616c 6c20 3d20 7469 6d65 6672 616d 655f  all = timeframe_
-00014fb0: 746f 5f6d 7365 6373 2874 696d 6566 7261  to_msecs(timefra
-00014fc0: 6d65 2920 2a20 7365 6c66 2e6f 686c 6376  me) * self.ohlcv
-00014fd0: 5f63 616e 646c 655f 6c69 6d69 7428 0a20  _candle_limit(. 
-00014fe0: 2020 2020 2020 2020 2020 2074 696d 6566             timef
-00014ff0: 7261 6d65 2c20 6361 6e64 6c65 5f74 7970  rame, candle_typ
-00015000: 652c 2073 696e 6365 5f6d 7329 0a20 2020  e, since_ms).   
-00015010: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
-00015020: 6728 0a20 2020 2020 2020 2020 2020 2022  g(.            "
-00015030: 6f6e 655f 6361 6c6c 3a20 2573 206d 7365  one_call: %s mse
-00015040: 6373 2028 2573 2922 2c0a 2020 2020 2020  cs (%s)",.      
-00015050: 2020 2020 2020 6f6e 655f 6361 6c6c 2c0a        one_call,.
-00015060: 2020 2020 2020 2020 2020 2020 6474 5f68              dt_h
-00015070: 756d 616e 697a 6528 6474 5f6e 6f77 2829  umanize(dt_now()
-00015080: 202d 2074 696d 6564 656c 7461 286d 696c   - timedelta(mil
-00015090: 6c69 7365 636f 6e64 733d 6f6e 655f 6361  liseconds=one_ca
-000150a0: 6c6c 292c 206f 6e6c 795f 6469 7374 616e  ll), only_distan
-000150b0: 6365 3d54 7275 6529 0a20 2020 2020 2020  ce=True).       
-000150c0: 2029 0a20 2020 2020 2020 2069 6e70 7574   ).        input
-000150d0: 5f63 6f72 6f75 7469 6e65 7320 3d20 5b73  _coroutines = [s
-000150e0: 656c 662e 5f61 7379 6e63 5f67 6574 5f63  elf._async_get_c
-000150f0: 616e 646c 655f 6869 7374 6f72 7928 0a20  andle_history(. 
-00015100: 2020 2020 2020 2020 2020 2070 6169 722c             pair,
-00015110: 2074 696d 6566 7261 6d65 2c20 6361 6e64   timeframe, cand
-00015120: 6c65 5f74 7970 652c 2073 696e 6365 2920  le_type, since) 
-00015130: 666f 7220 7369 6e63 6520 696e 0a20 2020  for since in.   
-00015140: 2020 2020 2020 2020 2072 616e 6765 2873           range(s
-00015150: 696e 6365 5f6d 732c 2075 6e74 696c 5f6d  ince_ms, until_m
-00015160: 7320 6f72 2064 745f 7473 2829 2c20 6f6e  s or dt_ts(), on
-00015170: 655f 6361 6c6c 295d 0a0a 2020 2020 2020  e_call)]..      
-00015180: 2020 6461 7461 3a20 4c69 7374 203d 205b    data: List = [
-00015190: 5d0a 2020 2020 2020 2020 2320 4368 756e  ].        # Chun
-000151a0: 6b20 7265 7175 6573 7473 2069 6e74 6f20  k requests into 
-000151b0: 6261 7463 6865 7320 6f66 2031 3030 2074  batches of 100 t
-000151c0: 6f20 6176 6f69 6420 6f76 6572 7765 6c6d  o avoid overwelm
-000151d0: 696e 6720 6363 7874 2054 6872 6f74 746c  ing ccxt Throttl
-000151e0: 696e 670a 2020 2020 2020 2020 666f 7220  ing.        for 
-000151f0: 696e 7075 745f 636f 726f 2069 6e20 6368  input_coro in ch
-00015200: 756e 6b73 2869 6e70 7574 5f63 6f72 6f75  unks(input_corou
-00015210: 7469 6e65 732c 2031 3030 293a 0a0a 2020  tines, 100):..  
-00015220: 2020 2020 2020 2020 2020 7265 7375 6c74            result
-00015230: 7320 3d20 6177 6169 7420 6173 796e 6369  s = await asynci
-00015240: 6f2e 6761 7468 6572 282a 696e 7075 745f  o.gather(*input_
-00015250: 636f 726f 2c20 7265 7475 726e 5f65 7863  coro, return_exc
-00015260: 6570 7469 6f6e 733d 5472 7565 290a 2020  eptions=True).  
-00015270: 2020 2020 2020 2020 2020 666f 7220 7265            for re
-00015280: 7320 696e 2072 6573 756c 7473 3a0a 2020  s in results:.  
-00015290: 2020 2020 2020 2020 2020 2020 2020 6966                if
-000152a0: 2069 7369 6e73 7461 6e63 6528 7265 732c   isinstance(res,
-000152b0: 2045 7863 6570 7469 6f6e 293a 0a20 2020   Exception):.   
-000152c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152d0: 206c 6f67 6765 722e 7761 726e 696e 6728   logger.warning(
-000152e0: 6622 4173 796e 6320 636f 6465 2072 6169  f"Async code rai
-000152f0: 7365 6420 616e 2065 7863 6570 7469 6f6e  sed an exception
-00015300: 3a20 7b72 6570 7228 7265 7329 7d22 290a  : {repr(res)}").
-00015310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015320: 2020 2020 6966 2072 6169 7365 5f3a 0a20      if raise_:. 
-00015330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015340: 2020 2020 2020 2072 6169 7365 0a20 2020         raise.   
-00015350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015360: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-00015370: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00015380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015390: 2020 2020 2320 4465 636f 6e73 7472 7563      # Deconstruc
-000153a0: 7420 7475 706c 6520 6966 2069 7427 7320  t tuple if it's 
-000153b0: 6e6f 7420 616e 2065 7863 6570 7469 6f6e  not an exception
-000153c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000153d0: 2020 2020 2070 2c20 5f2c 2063 2c20 6e65       p, _, c, ne
-000153e0: 775f 6461 7461 2c20 5f20 3d20 7265 730a  w_data, _ = res.
-000153f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015400: 2020 2020 6966 2070 203d 3d20 7061 6972      if p == pair
-00015410: 2061 6e64 2063 203d 3d20 6361 6e64 6c65   and c == candle
-00015420: 5f74 7970 653a 0a20 2020 2020 2020 2020  _type:.         
-00015430: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00015440: 6174 612e 6578 7465 6e64 286e 6577 5f64  ata.extend(new_d
-00015450: 6174 6129 0a20 2020 2020 2020 2023 2053  ata).        # S
-00015460: 6f72 7420 6461 7461 2061 6761 696e 2061  ort data again a
-00015470: 6674 6572 2065 7874 656e 6469 6e67 2074  fter extending t
-00015480: 6865 2072 6573 756c 7420 2d20 6162 6f76  he result - abov
-00015490: 6520 6361 6c6c 7320 7265 7475 726e 2069  e calls return i
-000154a0: 6e20 2261 7379 6e63 206f 7264 6572 220a  n "async order".
-000154b0: 2020 2020 2020 2020 6461 7461 203d 2073          data = s
-000154c0: 6f72 7465 6428 6461 7461 2c20 6b65 793d  orted(data, key=
-000154d0: 6c61 6d62 6461 2078 3a20 785b 305d 290a  lambda x: x[0]).
-000154e0: 2020 2020 2020 2020 7265 7475 726e 2070          return p
-000154f0: 6169 722c 2074 696d 6566 7261 6d65 2c20  air, timeframe, 
-00015500: 6361 6e64 6c65 5f74 7970 652c 2064 6174  candle_type, dat
-00015510: 612c 2073 656c 662e 5f6f 686c 6376 5f70  a, self._ohlcv_p
-00015520: 6172 7469 616c 5f63 616e 646c 650a 0a20  artial_candle.. 
-00015530: 2020 2064 6566 205f 6275 696c 645f 636f     def _build_co
-00015540: 726f 7574 696e 6528 0a20 2020 2020 2020  routine(.       
-00015550: 2020 2020 2073 656c 662c 2070 6169 723a       self, pair:
-00015560: 2073 7472 2c20 7469 6d65 6672 616d 653a   str, timeframe:
-00015570: 2073 7472 2c20 6361 6e64 6c65 5f74 7970   str, candle_typ
-00015580: 653a 2043 616e 646c 6554 7970 652c 0a20  e: CandleType,. 
-00015590: 2020 2020 2020 2020 2020 2073 696e 6365             since
-000155a0: 5f6d 733a 204f 7074 696f 6e61 6c5b 696e  _ms: Optional[in
-000155b0: 745d 2c20 6361 6368 653a 2062 6f6f 6c29  t], cache: bool)
-000155c0: 202d 3e20 436f 726f 7574 696e 655b 416e   -> Coroutine[An
-000155d0: 792c 2041 6e79 2c20 4f48 4c43 5652 6573  y, Any, OHLCVRes
-000155e0: 706f 6e73 655d 3a0a 2020 2020 2020 2020  ponse]:.        
-000155f0: 6e6f 745f 616c 6c5f 6461 7461 203d 2063  not_all_data = c
-00015600: 6163 6865 2061 6e64 2073 656c 662e 7265  ache and self.re
-00015610: 7175 6972 6564 5f63 616e 646c 655f 6361  quired_candle_ca
-00015620: 6c6c 5f63 6f75 6e74 203e 2031 0a20 2020  ll_count > 1.   
-00015630: 2020 2020 2069 6620 6361 6368 6520 616e       if cache an
-00015640: 6420 2870 6169 722c 2074 696d 6566 7261  d (pair, timefra
-00015650: 6d65 2c20 6361 6e64 6c65 5f74 7970 6529  me, candle_type)
-00015660: 2069 6e20 7365 6c66 2e5f 6b6c 696e 6573   in self._klines
-00015670: 3a0a 2020 2020 2020 2020 2020 2020 6361  :.            ca
-00015680: 6e64 6c65 5f6c 696d 6974 203d 2073 656c  ndle_limit = sel
-00015690: 662e 6f68 6c63 765f 6361 6e64 6c65 5f6c  f.ohlcv_candle_l
-000156a0: 696d 6974 2874 696d 6566 7261 6d65 2c20  imit(timeframe, 
-000156b0: 6361 6e64 6c65 5f74 7970 6529 0a20 2020  candle_type).   
-000156c0: 2020 2020 2020 2020 206d 696e 5f64 6174           min_dat
-000156d0: 6520 3d20 6461 7465 5f6d 696e 7573 5f63  e = date_minus_c
-000156e0: 616e 646c 6573 2874 696d 6566 7261 6d65  andles(timeframe
-000156f0: 2c20 6361 6e64 6c65 5f6c 696d 6974 202d  , candle_limit -
-00015700: 2035 292e 7469 6d65 7374 616d 7028 290a   5).timestamp().
-00015710: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
-00015720: 6563 6b20 6966 2031 2063 616c 6c20 6361  eck if 1 call ca
-00015730: 6e20 6765 7420 7573 2075 7064 6174 6564  n get us updated
-00015740: 2063 616e 646c 6573 2077 6974 686f 7574   candles without
-00015750: 2068 6f6c 6520 696e 2074 6865 2064 6174   hole in the dat
-00015760: 612e 0a20 2020 2020 2020 2020 2020 2069  a..            i
-00015770: 6620 6d69 6e5f 6461 7465 203c 2073 656c  f min_date < sel
-00015780: 662e 5f70 6169 7273 5f6c 6173 745f 7265  f._pairs_last_re
-00015790: 6672 6573 685f 7469 6d65 2e67 6574 2828  fresh_time.get((
-000157a0: 7061 6972 2c20 7469 6d65 6672 616d 652c  pair, timeframe,
-000157b0: 2063 616e 646c 655f 7479 7065 292c 2030   candle_type), 0
-000157c0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000157d0: 2020 2023 2043 6163 6865 2063 616e 2062     # Cache can b
-000157e0: 6520 7573 6564 202d 2064 6f20 6f6e 652d  e used - do one-
-000157f0: 6f66 6620 6361 6c6c 2e0a 2020 2020 2020  off call..      
-00015800: 2020 2020 2020 2020 2020 6e6f 745f 616c            not_al
-00015810: 6c5f 6461 7461 203d 2046 616c 7365 0a20  l_data = False. 
-00015820: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-00015830: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015840: 2023 2054 696d 6520 6a75 6d70 2064 6574   # Time jump det
-00015850: 6563 7465 642c 2065 7669 6374 2063 6163  ected, evict cac
-00015860: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
-00015870: 2020 206c 6f67 6765 722e 696e 666f 280a     logger.info(.
-00015880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015890: 2020 2020 6622 5469 6d65 206a 756d 7020      f"Time jump 
-000158a0: 6465 7465 6374 6564 2e20 4576 6963 7469  detected. Evicti
-000158b0: 6e67 2063 6163 6865 2066 6f72 207b 7061  ng cache for {pa
-000158c0: 6972 7d2c 207b 7469 6d65 6672 616d 657d  ir}, {timeframe}
-000158d0: 2c20 7b63 616e 646c 655f 7479 7065 7d22  , {candle_type}"
-000158e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000158f0: 2020 6465 6c20 7365 6c66 2e5f 6b6c 696e    del self._klin
-00015900: 6573 5b28 7061 6972 2c20 7469 6d65 6672  es[(pair, timefr
-00015910: 616d 652c 2063 616e 646c 655f 7479 7065  ame, candle_type
-00015920: 295d 0a0a 2020 2020 2020 2020 6966 2028  )]..        if (
-00015930: 6e6f 7420 7369 6e63 655f 6d73 2061 6e64  not since_ms and
-00015940: 2028 7365 6c66 2e5f 6674 5f68 6173 5b22   (self._ft_has["
-00015950: 6f68 6c63 765f 7265 7175 6972 655f 7369  ohlcv_require_si
-00015960: 6e63 6522 5d20 6f72 206e 6f74 5f61 6c6c  nce"] or not_all
-00015970: 5f64 6174 6129 293a 0a20 2020 2020 2020  _data)):.       
-00015980: 2020 2020 2023 204d 756c 7469 706c 6520       # Multiple 
-00015990: 6361 6c6c 7320 666f 7220 6f6e 6520 7061  calls for one pa
-000159a0: 6972 202d 2074 6f20 6765 7420 6d6f 7265  ir - to get more
-000159b0: 2068 6973 746f 7279 0a20 2020 2020 2020   history.       
-000159c0: 2020 2020 206f 6e65 5f63 616c 6c20 3d20       one_call = 
-000159d0: 7469 6d65 6672 616d 655f 746f 5f6d 7365  timeframe_to_mse
-000159e0: 6373 2874 696d 6566 7261 6d65 2920 2a20  cs(timeframe) * 
-000159f0: 7365 6c66 2e6f 686c 6376 5f63 616e 646c  self.ohlcv_candl
-00015a00: 655f 6c69 6d69 7428 0a20 2020 2020 2020  e_limit(.       
-00015a10: 2020 2020 2020 2020 2074 696d 6566 7261           timefra
-00015a20: 6d65 2c20 6361 6e64 6c65 5f74 7970 652c  me, candle_type,
-00015a30: 2073 696e 6365 5f6d 7329 0a20 2020 2020   since_ms).     
-00015a40: 2020 2020 2020 206d 6f76 655f 746f 203d         move_to =
-00015a50: 206f 6e65 5f63 616c 6c20 2a20 7365 6c66   one_call * self
-00015a60: 2e72 6571 7569 7265 645f 6361 6e64 6c65  .required_candle
-00015a70: 5f63 616c 6c5f 636f 756e 740a 2020 2020  _call_count.    
-00015a80: 2020 2020 2020 2020 6e6f 7720 3d20 7469          now = ti
-00015a90: 6d65 6672 616d 655f 746f 5f6e 6578 745f  meframe_to_next_
-00015aa0: 6461 7465 2874 696d 6566 7261 6d65 290a  date(timeframe).
-00015ab0: 2020 2020 2020 2020 2020 2020 7369 6e63              sinc
-00015ac0: 655f 6d73 203d 2069 6e74 2828 6e6f 7720  e_ms = int((now 
-00015ad0: 2d20 7469 6d65 6465 6c74 6128 7365 636f  - timedelta(seco
-00015ae0: 6e64 733d 6d6f 7665 5f74 6f20 2f2f 2031  nds=move_to // 1
-00015af0: 3030 3029 292e 7469 6d65 7374 616d 7028  000)).timestamp(
-00015b00: 2920 2a20 3130 3030 290a 0a20 2020 2020  ) * 1000)..     
-00015b10: 2020 2069 6620 7369 6e63 655f 6d73 3a0a     if since_ms:.
-00015b20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00015b30: 726e 2073 656c 662e 5f61 7379 6e63 5f67  rn self._async_g
-00015b40: 6574 5f68 6973 746f 7269 635f 6f68 6c63  et_historic_ohlc
-00015b50: 7628 0a20 2020 2020 2020 2020 2020 2020  v(.             
-00015b60: 2020 2070 6169 722c 2074 696d 6566 7261     pair, timefra
-00015b70: 6d65 2c20 7369 6e63 655f 6d73 3d73 696e  me, since_ms=sin
-00015b80: 6365 5f6d 732c 2072 6169 7365 5f3d 5472  ce_ms, raise_=Tr
-00015b90: 7565 2c20 6361 6e64 6c65 5f74 7970 653d  ue, candle_type=
-00015ba0: 6361 6e64 6c65 5f74 7970 6529 0a20 2020  candle_type).   
-00015bb0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00015bc0: 2020 2020 2020 2023 204f 6e65 2063 616c         # One cal
-00015bd0: 6c20 2e2e 2e20 2272 6567 756c 6172 2220  l ... "regular" 
-00015be0: 7265 6672 6573 680a 2020 2020 2020 2020  refresh.        
-00015bf0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00015c00: 5f61 7379 6e63 5f67 6574 5f63 616e 646c  _async_get_candl
-00015c10: 655f 6869 7374 6f72 7928 0a20 2020 2020  e_history(.     
-00015c20: 2020 2020 2020 2020 2020 2070 6169 722c             pair,
-00015c30: 2074 696d 6566 7261 6d65 2c20 7369 6e63   timeframe, sinc
-00015c40: 655f 6d73 3d73 696e 6365 5f6d 732c 2063  e_ms=since_ms, c
-00015c50: 616e 646c 655f 7479 7065 3d63 616e 646c  andle_type=candl
-00015c60: 655f 7479 7065 290a 0a20 2020 2064 6566  e_type)..    def
-00015c70: 205f 6275 696c 645f 6f68 6c63 765f 646c   _build_ohlcv_dl
-00015c80: 5f6a 6f62 7328 0a20 2020 2020 2020 2020  _jobs(.         
-00015c90: 2020 2073 656c 662c 2070 6169 725f 6c69     self, pair_li
-00015ca0: 7374 3a20 4c69 7374 5061 6972 7357 6974  st: ListPairsWit
-00015cb0: 6854 696d 6566 7261 6d65 732c 2073 696e  hTimeframes, sin
-00015cc0: 6365 5f6d 733a 204f 7074 696f 6e61 6c5b  ce_ms: Optional[
-00015cd0: 696e 745d 2c0a 2020 2020 2020 2020 2020  int],.          
-00015ce0: 2020 6361 6368 653a 2062 6f6f 6c29 202d    cache: bool) -
-00015cf0: 3e20 5475 706c 655b 4c69 7374 5b43 6f72  > Tuple[List[Cor
-00015d00: 6f75 7469 6e65 5d2c 204c 6973 745b 5475  outine], List[Tu
-00015d10: 706c 655b 7374 722c 2073 7472 2c20 4361  ple[str, str, Ca
-00015d20: 6e64 6c65 5479 7065 5d5d 5d3a 0a20 2020  ndleType]]]:.   
-00015d30: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00015d40: 2042 7569 6c64 2043 6f72 6f75 7469 6e65   Build Coroutine
-00015d50: 7320 746f 2065 7865 6375 7465 2061 7320  s to execute as 
-00015d60: 7061 7274 206f 6620 7265 6672 6573 685f  part of refresh_
-00015d70: 6c61 7465 7374 5f6f 686c 6376 0a20 2020  latest_ohlcv.   
-00015d80: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00015d90: 2069 6e70 7574 5f63 6f72 6f75 7469 6e65   input_coroutine
-00015da0: 733a 204c 6973 745b 436f 726f 7574 696e  s: List[Coroutin
-00015db0: 655b 416e 792c 2041 6e79 2c20 4f48 4c43  e[Any, Any, OHLC
-00015dc0: 5652 6573 706f 6e73 655d 5d20 3d20 5b5d  VResponse]] = []
-00015dd0: 0a20 2020 2020 2020 2063 6163 6865 645f  .        cached_
-00015de0: 7061 6972 7320 3d20 5b5d 0a20 2020 2020  pairs = [].     
-00015df0: 2020 2066 6f72 2070 6169 722c 2074 696d     for pair, tim
-00015e00: 6566 7261 6d65 2c20 6361 6e64 6c65 5f74  eframe, candle_t
-00015e10: 7970 6520 696e 2073 6574 2870 6169 725f  ype in set(pair_
-00015e20: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
-00015e30: 2020 2069 6620 2874 696d 6566 7261 6d65     if (timeframe
-00015e40: 206e 6f74 2069 6e20 7365 6c66 2e74 696d   not in self.tim
-00015e50: 6566 7261 6d65 730a 2020 2020 2020 2020  eframes.        
-00015e60: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-00015e70: 6361 6e64 6c65 5f74 7970 6520 696e 2028  candle_type in (
-00015e80: 4361 6e64 6c65 5479 7065 2e53 504f 542c  CandleType.SPOT,
-00015e90: 2043 616e 646c 6554 7970 652e 4655 5455   CandleType.FUTU
-00015ea0: 5245 5329 293a 0a20 2020 2020 2020 2020  RES)):.         
-00015eb0: 2020 2020 2020 206c 6f67 6765 722e 7761         logger.wa
-00015ec0: 726e 696e 6728 0a20 2020 2020 2020 2020  rning(.         
-00015ed0: 2020 2020 2020 2020 2020 2066 2243 616e             f"Can
-00015ee0: 6e6f 7420 646f 776e 6c6f 6164 2028 7b70  not download ({p
-00015ef0: 6169 727d 2c20 7b74 696d 6566 7261 6d65  air}, {timeframe
-00015f00: 7d29 2063 6f6d 6269 6e61 7469 6f6e 2061  }) combination a
-00015f10: 7320 7468 6973 2074 696d 6566 7261 6d65  s this timeframe
-00015f20: 2069 7320 220a 2020 2020 2020 2020 2020   is ".          
-00015f30: 2020 2020 2020 2020 2020 6622 6e6f 7420            f"not 
-00015f40: 6176 6169 6c61 626c 6520 6f6e 207b 7365  available on {se
-00015f50: 6c66 2e6e 616d 657d 2e20 4176 6169 6c61  lf.name}. Availa
-00015f60: 626c 6520 7469 6d65 6672 616d 6573 2061  ble timeframes a
-00015f70: 7265 2022 0a20 2020 2020 2020 2020 2020  re ".           
-00015f80: 2020 2020 2020 2020 2066 227b 272c 2027           f"{', '
-00015f90: 2e6a 6f69 6e28 7365 6c66 2e74 696d 6566  .join(self.timef
-00015fa0: 7261 6d65 7329 7d2e 2229 0a20 2020 2020  rames)}.").     
-00015fb0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00015fc0: 6e75 650a 0a20 2020 2020 2020 2020 2020  nue..           
-00015fd0: 2069 6620 2828 7061 6972 2c20 7469 6d65   if ((pair, time
-00015fe0: 6672 616d 652c 2063 616e 646c 655f 7479  frame, candle_ty
-00015ff0: 7065 2920 6e6f 7420 696e 2073 656c 662e  pe) not in self.
-00016000: 5f6b 6c69 6e65 7320 6f72 206e 6f74 2063  _klines or not c
-00016010: 6163 6865 0a20 2020 2020 2020 2020 2020  ache.           
-00016020: 2020 2020 2020 2020 206f 7220 7365 6c66           or self
-00016030: 2e5f 6e6f 775f 6973 5f74 696d 655f 746f  ._now_is_time_to
-00016040: 5f72 6566 7265 7368 2870 6169 722c 2074  _refresh(pair, t
-00016050: 696d 6566 7261 6d65 2c20 6361 6e64 6c65  imeframe, candle
-00016060: 5f74 7970 6529 293a 0a0a 2020 2020 2020  _type)):..      
-00016070: 2020 2020 2020 2020 2020 696e 7075 745f            input_
-00016080: 636f 726f 7574 696e 6573 2e61 7070 656e  coroutines.appen
-00016090: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
-000160a0: 2020 2020 2020 2073 656c 662e 5f62 7569         self._bui
-000160b0: 6c64 5f63 6f72 6f75 7469 6e65 2870 6169  ld_coroutine(pai
-000160c0: 722c 2074 696d 6566 7261 6d65 2c20 6361  r, timeframe, ca
-000160d0: 6e64 6c65 5f74 7970 652c 2073 696e 6365  ndle_type, since
-000160e0: 5f6d 732c 2063 6163 6865 2929 0a0a 2020  _ms, cache))..  
-000160f0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00016100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016110: 6c6f 6767 6572 2e64 6562 7567 280a 2020  logger.debug(.  
-00016120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016130: 2020 6622 5573 696e 6720 6361 6368 6564    f"Using cached
-00016140: 2063 616e 646c 6520 284f 484c 4356 2920   candle (OHLCV) 
-00016150: 6461 7461 2066 6f72 207b 7061 6972 7d2c  data for {pair},
-00016160: 207b 7469 6d65 6672 616d 657d 2c20 7b63   {timeframe}, {c
-00016170: 616e 646c 655f 7479 7065 7d20 2e2e 2e22  andle_type} ..."
-00016180: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016190: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-000161a0: 2020 2063 6163 6865 645f 7061 6972 732e     cached_pairs.
-000161b0: 6170 7065 6e64 2828 7061 6972 2c20 7469  append((pair, ti
-000161c0: 6d65 6672 616d 652c 2063 616e 646c 655f  meframe, candle_
-000161d0: 7479 7065 2929 0a0a 2020 2020 2020 2020  type))..        
-000161e0: 7265 7475 726e 2069 6e70 7574 5f63 6f72  return input_cor
-000161f0: 6f75 7469 6e65 732c 2063 6163 6865 645f  outines, cached_
-00016200: 7061 6972 730a 0a20 2020 2064 6566 205f  pairs..    def _
-00016210: 7072 6f63 6573 735f 6f68 6c63 765f 6466  process_ohlcv_df
-00016220: 2873 656c 662c 2070 6169 723a 2073 7472  (self, pair: str
-00016230: 2c20 7469 6d65 6672 616d 653a 2073 7472  , timeframe: str
-00016240: 2c20 635f 7479 7065 3a20 4361 6e64 6c65  , c_type: Candle
-00016250: 5479 7065 2c20 7469 636b 733a 204c 6973  Type, ticks: Lis
-00016260: 745b 4c69 7374 5d2c 0a20 2020 2020 2020  t[List],.       
+00014e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ea0: 2029 202d 3e20 4f48 4c43 5652 6573 706f   ) -> OHLCVRespo
+00014eb0: 6e73 653a 0a20 2020 2020 2020 2022 2222  nse:.        """
+00014ec0: 0a20 2020 2020 2020 2044 6f77 6e6c 6f61  .        Downloa
+00014ed0: 6420 6869 7374 6f72 6963 206f 686c 6376  d historic ohlcv
+00014ee0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00014ef0: 6973 5f6e 6577 5f70 6169 723a 2075 7365  is_new_pair: use
+00014f00: 6420 6279 2062 696e 616e 6365 2073 7562  d by binance sub
+00014f10: 636c 6173 7320 746f 2061 6c6c 6f77 2022  class to allow "
+00014f20: 6661 7374 2220 6e65 7720 7061 6972 2064  fast" new pair d
+00014f30: 6f77 6e6c 6f61 6469 6e67 0a20 2020 2020  ownloading.     
+00014f40: 2020 203a 7061 7261 6d20 6361 6e64 6c65     :param candle
+00014f50: 5f74 7970 653a 2041 6e79 206f 6620 7468  _type: Any of th
+00014f60: 6520 656e 756d 2043 616e 646c 6554 7970  e enum CandleTyp
+00014f70: 6520 286d 7573 7420 6d61 7463 6820 7472  e (must match tr
+00014f80: 6164 696e 6720 6d6f 6465 2129 0a20 2020  ading mode!).   
+00014f90: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+00014fa0: 2020 6f6e 655f 6361 6c6c 203d 2074 696d    one_call = tim
+00014fb0: 6566 7261 6d65 5f74 6f5f 6d73 6563 7328  eframe_to_msecs(
+00014fc0: 7469 6d65 6672 616d 6529 202a 2073 656c  timeframe) * sel
+00014fd0: 662e 6f68 6c63 765f 6361 6e64 6c65 5f6c  f.ohlcv_candle_l
+00014fe0: 696d 6974 280a 2020 2020 2020 2020 2020  imit(.          
+00014ff0: 2020 7469 6d65 6672 616d 652c 2063 616e    timeframe, can
+00015000: 646c 655f 7479 7065 2c20 7369 6e63 655f  dle_type, since_
+00015010: 6d73 290a 2020 2020 2020 2020 6c6f 6767  ms).        logg
+00015020: 6572 2e64 6562 7567 280a 2020 2020 2020  er.debug(.      
+00015030: 2020 2020 2020 226f 6e65 5f63 616c 6c3a        "one_call:
+00015040: 2025 7320 6d73 6563 7320 2825 7329 222c   %s msecs (%s)",
+00015050: 0a20 2020 2020 2020 2020 2020 206f 6e65  .            one
+00015060: 5f63 616c 6c2c 0a20 2020 2020 2020 2020  _call,.         
+00015070: 2020 2064 745f 6875 6d61 6e69 7a65 2864     dt_humanize(d
+00015080: 745f 6e6f 7728 2920 2d20 7469 6d65 6465  t_now() - timede
+00015090: 6c74 6128 6d69 6c6c 6973 6563 6f6e 6473  lta(milliseconds
+000150a0: 3d6f 6e65 5f63 616c 6c29 2c20 6f6e 6c79  =one_call), only
+000150b0: 5f64 6973 7461 6e63 653d 5472 7565 290a  _distance=True).
+000150c0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000150d0: 2020 696e 7075 745f 636f 726f 7574 696e    input_coroutin
+000150e0: 6573 203d 205b 7365 6c66 2e5f 6173 796e  es = [self._asyn
+000150f0: 635f 6765 745f 6361 6e64 6c65 5f68 6973  c_get_candle_his
+00015100: 746f 7279 280a 2020 2020 2020 2020 2020  tory(.          
+00015110: 2020 7061 6972 2c20 7469 6d65 6672 616d    pair, timefram
+00015120: 652c 2063 616e 646c 655f 7479 7065 2c20  e, candle_type, 
+00015130: 7369 6e63 6529 2066 6f72 2073 696e 6365  since) for since
+00015140: 2069 6e0a 2020 2020 2020 2020 2020 2020   in.            
+00015150: 7261 6e67 6528 7369 6e63 655f 6d73 2c20  range(since_ms, 
+00015160: 756e 7469 6c5f 6d73 206f 7220 6474 5f74  until_ms or dt_t
+00015170: 7328 292c 206f 6e65 5f63 616c 6c29 5d0a  s(), one_call)].
+00015180: 0a20 2020 2020 2020 2064 6174 613a 204c  .        data: L
+00015190: 6973 7420 3d20 5b5d 0a20 2020 2020 2020  ist = [].       
+000151a0: 2023 2043 6875 6e6b 2072 6571 7565 7374   # Chunk request
+000151b0: 7320 696e 746f 2062 6174 6368 6573 206f  s into batches o
+000151c0: 6620 3130 3020 746f 2061 766f 6964 206f  f 100 to avoid o
+000151d0: 7665 7277 656c 6d69 6e67 2063 6378 7420  verwelming ccxt 
+000151e0: 5468 726f 7474 6c69 6e67 0a20 2020 2020  Throttling.     
+000151f0: 2020 2066 6f72 2069 6e70 7574 5f63 6f72     for input_cor
+00015200: 6f20 696e 2063 6875 6e6b 7328 696e 7075  o in chunks(inpu
+00015210: 745f 636f 726f 7574 696e 6573 2c20 3130  t_coroutines, 10
+00015220: 3029 3a0a 0a20 2020 2020 2020 2020 2020  0):..           
+00015230: 2072 6573 756c 7473 203d 2061 7761 6974   results = await
+00015240: 2061 7379 6e63 696f 2e67 6174 6865 7228   asyncio.gather(
+00015250: 2a69 6e70 7574 5f63 6f72 6f2c 2072 6574  *input_coro, ret
+00015260: 7572 6e5f 6578 6365 7074 696f 6e73 3d54  urn_exceptions=T
+00015270: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
+00015280: 2066 6f72 2072 6573 2069 6e20 7265 7375   for res in resu
+00015290: 6c74 733a 0a20 2020 2020 2020 2020 2020  lts:.           
+000152a0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+000152b0: 6365 2872 6573 2c20 4578 6365 7074 696f  ce(res, Exceptio
+000152c0: 6e29 3a0a 2020 2020 2020 2020 2020 2020  n):.            
+000152d0: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
+000152e0: 6172 6e69 6e67 2866 2241 7379 6e63 2063  arning(f"Async c
+000152f0: 6f64 6520 7261 6973 6564 2061 6e20 6578  ode raised an ex
+00015300: 6365 7074 696f 6e3a 207b 7265 7072 2872  ception: {repr(r
+00015310: 6573 297d 2229 0a20 2020 2020 2020 2020  es)}").         
+00015320: 2020 2020 2020 2020 2020 2069 6620 7261             if ra
+00015330: 6973 655f 3a0a 2020 2020 2020 2020 2020  ise_:.          
+00015340: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00015350: 6973 650a 2020 2020 2020 2020 2020 2020  ise.            
+00015360: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+00015370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015380: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00015390: 2020 2020 2020 2020 2020 2023 2044 6563             # Dec
+000153a0: 6f6e 7374 7275 6374 2074 7570 6c65 2069  onstruct tuple i
+000153b0: 6620 6974 2773 206e 6f74 2061 6e20 6578  f it's not an ex
+000153c0: 6365 7074 696f 6e0a 2020 2020 2020 2020  ception.        
+000153d0: 2020 2020 2020 2020 2020 2020 702c 205f              p, _
+000153e0: 2c20 632c 206e 6577 5f64 6174 612c 205f  , c, new_data, _
+000153f0: 203d 2072 6573 0a20 2020 2020 2020 2020   = res.         
+00015400: 2020 2020 2020 2020 2020 2069 6620 7020             if p 
+00015410: 3d3d 2070 6169 7220 616e 6420 6320 3d3d  == pair and c ==
+00015420: 2063 616e 646c 655f 7479 7065 3a0a 2020   candle_type:.  
+00015430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015440: 2020 2020 2020 6461 7461 2e65 7874 656e        data.exten
+00015450: 6428 6e65 775f 6461 7461 290a 2020 2020  d(new_data).    
+00015460: 2020 2020 2320 536f 7274 2064 6174 6120      # Sort data 
+00015470: 6167 6169 6e20 6166 7465 7220 6578 7465  again after exte
+00015480: 6e64 696e 6720 7468 6520 7265 7375 6c74  nding the result
+00015490: 202d 2061 626f 7665 2063 616c 6c73 2072   - above calls r
+000154a0: 6574 7572 6e20 696e 2022 6173 796e 6320  eturn in "async 
+000154b0: 6f72 6465 7222 0a20 2020 2020 2020 2064  order".        d
+000154c0: 6174 6120 3d20 736f 7274 6564 2864 6174  ata = sorted(dat
+000154d0: 612c 206b 6579 3d6c 616d 6264 6120 783a  a, key=lambda x:
+000154e0: 2078 5b30 5d29 0a20 2020 2020 2020 2072   x[0]).        r
+000154f0: 6574 7572 6e20 7061 6972 2c20 7469 6d65  eturn pair, time
+00015500: 6672 616d 652c 2063 616e 646c 655f 7479  frame, candle_ty
+00015510: 7065 2c20 6461 7461 2c20 7365 6c66 2e5f  pe, data, self._
+00015520: 6f68 6c63 765f 7061 7274 6961 6c5f 6361  ohlcv_partial_ca
+00015530: 6e64 6c65 0a0a 2020 2020 6465 6620 5f62  ndle..    def _b
+00015540: 7569 6c64 5f63 6f72 6f75 7469 6e65 280a  uild_coroutine(.
+00015550: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00015560: 2c20 7061 6972 3a20 7374 722c 2074 696d  , pair: str, tim
+00015570: 6566 7261 6d65 3a20 7374 722c 2063 616e  eframe: str, can
+00015580: 646c 655f 7479 7065 3a20 4361 6e64 6c65  dle_type: Candle
+00015590: 5479 7065 2c0a 2020 2020 2020 2020 2020  Type,.          
+000155a0: 2020 7369 6e63 655f 6d73 3a20 4f70 7469    since_ms: Opti
+000155b0: 6f6e 616c 5b69 6e74 5d2c 2063 6163 6865  onal[int], cache
+000155c0: 3a20 626f 6f6c 2920 2d3e 2043 6f72 6f75  : bool) -> Corou
+000155d0: 7469 6e65 5b41 6e79 2c20 416e 792c 204f  tine[Any, Any, O
+000155e0: 484c 4356 5265 7370 6f6e 7365 5d3a 0a20  HLCVResponse]:. 
+000155f0: 2020 2020 2020 206e 6f74 5f61 6c6c 5f64         not_all_d
+00015600: 6174 6120 3d20 6361 6368 6520 616e 6420  ata = cache and 
+00015610: 7365 6c66 2e72 6571 7569 7265 645f 6361  self.required_ca
+00015620: 6e64 6c65 5f63 616c 6c5f 636f 756e 7420  ndle_call_count 
+00015630: 3e20 310a 2020 2020 2020 2020 6966 2063  > 1.        if c
+00015640: 6163 6865 2061 6e64 2028 7061 6972 2c20  ache and (pair, 
+00015650: 7469 6d65 6672 616d 652c 2063 616e 646c  timeframe, candl
+00015660: 655f 7479 7065 2920 696e 2073 656c 662e  e_type) in self.
+00015670: 5f6b 6c69 6e65 733a 0a20 2020 2020 2020  _klines:.       
+00015680: 2020 2020 2063 616e 646c 655f 6c69 6d69       candle_limi
+00015690: 7420 3d20 7365 6c66 2e6f 686c 6376 5f63  t = self.ohlcv_c
+000156a0: 616e 646c 655f 6c69 6d69 7428 7469 6d65  andle_limit(time
+000156b0: 6672 616d 652c 2063 616e 646c 655f 7479  frame, candle_ty
+000156c0: 7065 290a 2020 2020 2020 2020 2020 2020  pe).            
+000156d0: 6d69 6e5f 6461 7465 203d 2064 6174 655f  min_date = date_
+000156e0: 6d69 6e75 735f 6361 6e64 6c65 7328 7469  minus_candles(ti
+000156f0: 6d65 6672 616d 652c 2063 616e 646c 655f  meframe, candle_
+00015700: 6c69 6d69 7420 2d20 3529 2e74 696d 6573  limit - 5).times
+00015710: 7461 6d70 2829 0a20 2020 2020 2020 2020  tamp().         
+00015720: 2020 2023 2043 6865 636b 2069 6620 3120     # Check if 1 
+00015730: 6361 6c6c 2063 616e 2067 6574 2075 7320  call can get us 
+00015740: 7570 6461 7465 6420 6361 6e64 6c65 7320  updated candles 
+00015750: 7769 7468 6f75 7420 686f 6c65 2069 6e20  without hole in 
+00015760: 7468 6520 6461 7461 2e0a 2020 2020 2020  the data..      
+00015770: 2020 2020 2020 6966 206d 696e 5f64 6174        if min_dat
+00015780: 6520 3c20 7365 6c66 2e5f 7061 6972 735f  e < self._pairs_
+00015790: 6c61 7374 5f72 6566 7265 7368 5f74 696d  last_refresh_tim
+000157a0: 652e 6765 7428 2870 6169 722c 2074 696d  e.get((pair, tim
+000157b0: 6566 7261 6d65 2c20 6361 6e64 6c65 5f74  eframe, candle_t
+000157c0: 7970 6529 2c20 3029 3a0a 2020 2020 2020  ype), 0):.      
+000157d0: 2020 2020 2020 2020 2020 2320 4361 6368            # Cach
+000157e0: 6520 6361 6e20 6265 2075 7365 6420 2d20  e can be used - 
+000157f0: 646f 206f 6e65 2d6f 6666 2063 616c 6c2e  do one-off call.
+00015800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015810: 206e 6f74 5f61 6c6c 5f64 6174 6120 3d20   not_all_data = 
+00015820: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00015830: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00015840: 2020 2020 2020 2020 2320 5469 6d65 206a          # Time j
+00015850: 756d 7020 6465 7465 6374 6564 2c20 6576  ump detected, ev
+00015860: 6963 7420 6361 6368 650a 2020 2020 2020  ict cache.      
+00015870: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+00015880: 2e69 6e66 6f28 0a20 2020 2020 2020 2020  .info(.         
+00015890: 2020 2020 2020 2020 2020 2066 2254 696d             f"Tim
+000158a0: 6520 6a75 6d70 2064 6574 6563 7465 642e  e jump detected.
+000158b0: 2045 7669 6374 696e 6720 6361 6368 6520   Evicting cache 
+000158c0: 666f 7220 7b70 6169 727d 2c20 7b74 696d  for {pair}, {tim
+000158d0: 6566 7261 6d65 7d2c 207b 6361 6e64 6c65  eframe}, {candle
+000158e0: 5f74 7970 657d 2229 0a20 2020 2020 2020  _type}").       
+000158f0: 2020 2020 2020 2020 2064 656c 2073 656c           del sel
+00015900: 662e 5f6b 6c69 6e65 735b 2870 6169 722c  f._klines[(pair,
+00015910: 2074 696d 6566 7261 6d65 2c20 6361 6e64   timeframe, cand
+00015920: 6c65 5f74 7970 6529 5d0a 0a20 2020 2020  le_type)]..     
+00015930: 2020 2069 6620 286e 6f74 2073 696e 6365     if (not since
+00015940: 5f6d 7320 616e 6420 2873 656c 662e 5f66  _ms and (self._f
+00015950: 745f 6861 735b 226f 686c 6376 5f72 6571  t_has["ohlcv_req
+00015960: 7569 7265 5f73 696e 6365 225d 206f 7220  uire_since"] or 
+00015970: 6e6f 745f 616c 6c5f 6461 7461 2929 3a0a  not_all_data)):.
+00015980: 2020 2020 2020 2020 2020 2020 2320 4d75              # Mu
+00015990: 6c74 6970 6c65 2063 616c 6c73 2066 6f72  ltiple calls for
+000159a0: 206f 6e65 2070 6169 7220 2d20 746f 2067   one pair - to g
+000159b0: 6574 206d 6f72 6520 6869 7374 6f72 790a  et more history.
+000159c0: 2020 2020 2020 2020 2020 2020 6f6e 655f              one_
+000159d0: 6361 6c6c 203d 2074 696d 6566 7261 6d65  call = timeframe
+000159e0: 5f74 6f5f 6d73 6563 7328 7469 6d65 6672  _to_msecs(timefr
+000159f0: 616d 6529 202a 2073 656c 662e 6f68 6c63  ame) * self.ohlc
+00015a00: 765f 6361 6e64 6c65 5f6c 696d 6974 280a  v_candle_limit(.
+00015a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015a20: 7469 6d65 6672 616d 652c 2063 616e 646c  timeframe, candl
+00015a30: 655f 7479 7065 2c20 7369 6e63 655f 6d73  e_type, since_ms
+00015a40: 290a 2020 2020 2020 2020 2020 2020 6d6f  ).            mo
+00015a50: 7665 5f74 6f20 3d20 6f6e 655f 6361 6c6c  ve_to = one_call
+00015a60: 202a 2073 656c 662e 7265 7175 6972 6564   * self.required
+00015a70: 5f63 616e 646c 655f 6361 6c6c 5f63 6f75  _candle_call_cou
+00015a80: 6e74 0a20 2020 2020 2020 2020 2020 206e  nt.            n
+00015a90: 6f77 203d 2074 696d 6566 7261 6d65 5f74  ow = timeframe_t
+00015aa0: 6f5f 6e65 7874 5f64 6174 6528 7469 6d65  o_next_date(time
+00015ab0: 6672 616d 6529 0a20 2020 2020 2020 2020  frame).         
+00015ac0: 2020 2073 696e 6365 5f6d 7320 3d20 696e     since_ms = in
+00015ad0: 7428 286e 6f77 202d 2074 696d 6564 656c  t((now - timedel
+00015ae0: 7461 2873 6563 6f6e 6473 3d6d 6f76 655f  ta(seconds=move_
+00015af0: 746f 202f 2f20 3130 3030 2929 2e74 696d  to // 1000)).tim
+00015b00: 6573 7461 6d70 2829 202a 2031 3030 3029  estamp() * 1000)
+00015b10: 0a0a 2020 2020 2020 2020 6966 2073 696e  ..        if sin
+00015b20: 6365 5f6d 733a 0a20 2020 2020 2020 2020  ce_ms:.         
+00015b30: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00015b40: 6173 796e 635f 6765 745f 6869 7374 6f72  async_get_histor
+00015b50: 6963 5f6f 686c 6376 280a 2020 2020 2020  ic_ohlcv(.      
+00015b60: 2020 2020 2020 2020 2020 7061 6972 2c20            pair, 
+00015b70: 7469 6d65 6672 616d 652c 2073 696e 6365  timeframe, since
+00015b80: 5f6d 733d 7369 6e63 655f 6d73 2c20 7261  _ms=since_ms, ra
+00015b90: 6973 655f 3d54 7275 652c 2063 616e 646c  ise_=True, candl
+00015ba0: 655f 7479 7065 3d63 616e 646c 655f 7479  e_type=candle_ty
+00015bb0: 7065 290a 2020 2020 2020 2020 656c 7365  pe).        else
+00015bc0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00015bd0: 4f6e 6520 6361 6c6c 202e 2e2e 2022 7265  One call ... "re
+00015be0: 6775 6c61 7222 2072 6566 7265 7368 0a20  gular" refresh. 
+00015bf0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00015c00: 6e20 7365 6c66 2e5f 6173 796e 635f 6765  n self._async_ge
+00015c10: 745f 6361 6e64 6c65 5f68 6973 746f 7279  t_candle_history
+00015c20: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00015c30: 2020 7061 6972 2c20 7469 6d65 6672 616d    pair, timefram
+00015c40: 652c 2073 696e 6365 5f6d 733d 7369 6e63  e, since_ms=sinc
+00015c50: 655f 6d73 2c20 6361 6e64 6c65 5f74 7970  e_ms, candle_typ
+00015c60: 653d 6361 6e64 6c65 5f74 7970 6529 0a0a  e=candle_type)..
+00015c70: 2020 2020 6465 6620 5f62 7569 6c64 5f6f      def _build_o
+00015c80: 686c 6376 5f64 6c5f 6a6f 6273 280a 2020  hlcv_dl_jobs(.  
+00015c90: 2020 2020 2020 2020 2020 7365 6c66 2c20            self, 
+00015ca0: 7061 6972 5f6c 6973 743a 204c 6973 7450  pair_list: ListP
+00015cb0: 6169 7273 5769 7468 5469 6d65 6672 616d  airsWithTimefram
+00015cc0: 6573 2c20 7369 6e63 655f 6d73 3a20 4f70  es, since_ms: Op
+00015cd0: 7469 6f6e 616c 5b69 6e74 5d2c 0a20 2020  tional[int],.   
+00015ce0: 2020 2020 2020 2020 2063 6163 6865 3a20           cache: 
+00015cf0: 626f 6f6c 2920 2d3e 2054 7570 6c65 5b4c  bool) -> Tuple[L
+00015d00: 6973 745b 436f 726f 7574 696e 655d 2c20  ist[Coroutine], 
+00015d10: 4c69 7374 5b54 7570 6c65 5b73 7472 2c20  List[Tuple[str, 
+00015d20: 7374 722c 2043 616e 646c 6554 7970 655d  str, CandleType]
+00015d30: 5d5d 3a0a 2020 2020 2020 2020 2222 220a  ]]:.        """.
+00015d40: 2020 2020 2020 2020 4275 696c 6420 436f          Build Co
+00015d50: 726f 7574 696e 6573 2074 6f20 6578 6563  routines to exec
+00015d60: 7574 6520 6173 2070 6172 7420 6f66 2072  ute as part of r
+00015d70: 6566 7265 7368 5f6c 6174 6573 745f 6f68  efresh_latest_oh
+00015d80: 6c63 760a 2020 2020 2020 2020 2222 220a  lcv.        """.
+00015d90: 2020 2020 2020 2020 696e 7075 745f 636f          input_co
+00015da0: 726f 7574 696e 6573 3a20 4c69 7374 5b43  routines: List[C
+00015db0: 6f72 6f75 7469 6e65 5b41 6e79 2c20 416e  oroutine[Any, An
+00015dc0: 792c 204f 484c 4356 5265 7370 6f6e 7365  y, OHLCVResponse
+00015dd0: 5d5d 203d 205b 5d0a 2020 2020 2020 2020  ]] = [].        
+00015de0: 6361 6368 6564 5f70 6169 7273 203d 205b  cached_pairs = [
+00015df0: 5d0a 2020 2020 2020 2020 666f 7220 7061  ].        for pa
+00015e00: 6972 2c20 7469 6d65 6672 616d 652c 2063  ir, timeframe, c
+00015e10: 616e 646c 655f 7479 7065 2069 6e20 7365  andle_type in se
+00015e20: 7428 7061 6972 5f6c 6973 7429 3a0a 2020  t(pair_list):.  
+00015e30: 2020 2020 2020 2020 2020 6966 2028 7469            if (ti
+00015e40: 6d65 6672 616d 6520 6e6f 7420 696e 2073  meframe not in s
+00015e50: 656c 662e 7469 6d65 6672 616d 6573 0a20  elf.timeframes. 
+00015e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e70: 2020 2061 6e64 2063 616e 646c 655f 7479     and candle_ty
+00015e80: 7065 2069 6e20 2843 616e 646c 6554 7970  pe in (CandleTyp
+00015e90: 652e 5350 4f54 2c20 4361 6e64 6c65 5479  e.SPOT, CandleTy
+00015ea0: 7065 2e46 5554 5552 4553 2929 3a0a 2020  pe.FUTURES)):.  
+00015eb0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00015ec0: 6767 6572 2e77 6172 6e69 6e67 280a 2020  gger.warning(.  
+00015ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015ee0: 2020 6622 4361 6e6e 6f74 2064 6f77 6e6c    f"Cannot downl
+00015ef0: 6f61 6420 287b 7061 6972 7d2c 207b 7469  oad ({pair}, {ti
+00015f00: 6d65 6672 616d 657d 2920 636f 6d62 696e  meframe}) combin
+00015f10: 6174 696f 6e20 6173 2074 6869 7320 7469  ation as this ti
+00015f20: 6d65 6672 616d 6520 6973 2022 0a20 2020  meframe is ".   
+00015f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f40: 2066 226e 6f74 2061 7661 696c 6162 6c65   f"not available
+00015f50: 206f 6e20 7b73 656c 662e 6e61 6d65 7d2e   on {self.name}.
+00015f60: 2041 7661 696c 6162 6c65 2074 696d 6566   Available timef
+00015f70: 7261 6d65 7320 6172 6520 220a 2020 2020  rames are ".    
+00015f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f90: 6622 7b27 2c20 272e 6a6f 696e 2873 656c  f"{', '.join(sel
+00015fa0: 662e 7469 6d65 6672 616d 6573 297d 2e22  f.timeframes)}."
+00015fb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015fc0: 2020 636f 6e74 696e 7565 0a0a 2020 2020    continue..    
+00015fd0: 2020 2020 2020 2020 6966 2028 2870 6169          if ((pai
+00015fe0: 722c 2074 696d 6566 7261 6d65 2c20 6361  r, timeframe, ca
+00015ff0: 6e64 6c65 5f74 7970 6529 206e 6f74 2069  ndle_type) not i
+00016000: 6e20 7365 6c66 2e5f 6b6c 696e 6573 206f  n self._klines o
+00016010: 7220 6e6f 7420 6361 6368 650a 2020 2020  r not cache.    
+00016020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016030: 6f72 2073 656c 662e 5f6e 6f77 5f69 735f  or self._now_is_
+00016040: 7469 6d65 5f74 6f5f 7265 6672 6573 6828  time_to_refresh(
+00016050: 7061 6972 2c20 7469 6d65 6672 616d 652c  pair, timeframe,
+00016060: 2063 616e 646c 655f 7479 7065 2929 3a0a   candle_type)):.
+00016070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016080: 2069 6e70 7574 5f63 6f72 6f75 7469 6e65   input_coroutine
+00016090: 732e 6170 7065 6e64 280a 2020 2020 2020  s.append(.      
+000160a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000160b0: 6c66 2e5f 6275 696c 645f 636f 726f 7574  lf._build_corout
+000160c0: 696e 6528 7061 6972 2c20 7469 6d65 6672  ine(pair, timefr
+000160d0: 616d 652c 2063 616e 646c 655f 7479 7065  ame, candle_type
+000160e0: 2c20 7369 6e63 655f 6d73 2c20 6361 6368  , since_ms, cach
+000160f0: 6529 290a 0a20 2020 2020 2020 2020 2020  e))..           
+00016100: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00016110: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
+00016120: 6275 6728 0a20 2020 2020 2020 2020 2020  bug(.           
+00016130: 2020 2020 2020 2020 2066 2255 7369 6e67           f"Using
+00016140: 2063 6163 6865 6420 6361 6e64 6c65 2028   cached candle (
+00016150: 4f48 4c43 5629 2064 6174 6120 666f 7220  OHLCV) data for 
+00016160: 7b70 6169 727d 2c20 7b74 696d 6566 7261  {pair}, {timefra
+00016170: 6d65 7d2c 207b 6361 6e64 6c65 5f74 7970  me}, {candle_typ
+00016180: 657d 202e 2e2e 220a 2020 2020 2020 2020  e} ...".        
+00016190: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000161a0: 2020 2020 2020 2020 2020 6361 6368 6564            cached
+000161b0: 5f70 6169 7273 2e61 7070 656e 6428 2870  _pairs.append((p
+000161c0: 6169 722c 2074 696d 6566 7261 6d65 2c20  air, timeframe, 
+000161d0: 6361 6e64 6c65 5f74 7970 6529 290a 0a20  candle_type)).. 
+000161e0: 2020 2020 2020 2072 6574 7572 6e20 696e         return in
+000161f0: 7075 745f 636f 726f 7574 696e 6573 2c20  put_coroutines, 
+00016200: 6361 6368 6564 5f70 6169 7273 0a0a 2020  cached_pairs..  
+00016210: 2020 6465 6620 5f70 726f 6365 7373 5f6f    def _process_o
+00016220: 686c 6376 5f64 6628 7365 6c66 2c20 7061  hlcv_df(self, pa
+00016230: 6972 3a20 7374 722c 2074 696d 6566 7261  ir: str, timefra
+00016240: 6d65 3a20 7374 722c 2063 5f74 7970 653a  me: str, c_type:
+00016250: 2043 616e 646c 6554 7970 652c 2074 6963   CandleType, tic
+00016260: 6b73 3a20 4c69 7374 5b4c 6973 745d 2c0a  ks: List[List],.
 00016270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016280: 2020 2063 6163 6865 3a20 626f 6f6c 2c20     cache: bool, 
-00016290: 6472 6f70 5f69 6e63 6f6d 706c 6574 653a  drop_incomplete:
-000162a0: 2062 6f6f 6c29 202d 3e20 4461 7461 4672   bool) -> DataFr
-000162b0: 616d 653a 0a20 2020 2020 2020 2023 206b  ame:.        # k
-000162c0: 6565 7069 6e67 206c 6173 7420 6361 6e64  eeping last cand
-000162d0: 6c65 2074 696d 6520 6173 206c 6173 7420  le time as last 
-000162e0: 7265 6672 6573 6865 6420 7469 6d65 206f  refreshed time o
-000162f0: 6620 7468 6520 7061 6972 0a20 2020 2020  f the pair.     
-00016300: 2020 2069 6620 7469 636b 7320 616e 6420     if ticks and 
-00016310: 6361 6368 653a 0a20 2020 2020 2020 2020  cache:.         
-00016320: 2020 2069 6478 203d 202d 3220 6966 2064     idx = -2 if d
-00016330: 726f 705f 696e 636f 6d70 6c65 7465 2061  rop_incomplete a
-00016340: 6e64 206c 656e 2874 6963 6b73 2920 3e20  nd len(ticks) > 
-00016350: 3120 656c 7365 202d 310a 2020 2020 2020  1 else -1.      
-00016360: 2020 2020 2020 7365 6c66 2e5f 7061 6972        self._pair
-00016370: 735f 6c61 7374 5f72 6566 7265 7368 5f74  s_last_refresh_t
-00016380: 696d 655b 2870 6169 722c 2074 696d 6566  ime[(pair, timef
-00016390: 7261 6d65 2c20 635f 7479 7065 295d 203d  rame, c_type)] =
-000163a0: 2074 6963 6b73 5b69 6478 5d5b 305d 202f   ticks[idx][0] /
-000163b0: 2f20 3130 3030 0a20 2020 2020 2020 2023  / 1000.        #
-000163c0: 206b 6565 7069 6e67 2070 6172 7365 6420   keeping parsed 
-000163d0: 6461 7461 6672 616d 6520 696e 2063 6163  dataframe in cac
-000163e0: 6865 0a20 2020 2020 2020 206f 686c 6376  he.        ohlcv
-000163f0: 5f64 6620 3d20 6f68 6c63 765f 746f 5f64  _df = ohlcv_to_d
-00016400: 6174 6166 7261 6d65 2874 6963 6b73 2c20  ataframe(ticks, 
-00016410: 7469 6d65 6672 616d 652c 2070 6169 723d  timeframe, pair=
-00016420: 7061 6972 2c20 6669 6c6c 5f6d 6973 7369  pair, fill_missi
-00016430: 6e67 3d54 7275 652c 0a20 2020 2020 2020  ng=True,.       
+00016280: 2020 2020 2020 2020 2020 6361 6368 653a            cache:
+00016290: 2062 6f6f 6c2c 2064 726f 705f 696e 636f   bool, drop_inco
+000162a0: 6d70 6c65 7465 3a20 626f 6f6c 2920 2d3e  mplete: bool) ->
+000162b0: 2044 6174 6146 7261 6d65 3a0a 2020 2020   DataFrame:.    
+000162c0: 2020 2020 2320 6b65 6570 696e 6720 6c61      # keeping la
+000162d0: 7374 2063 616e 646c 6520 7469 6d65 2061  st candle time a
+000162e0: 7320 6c61 7374 2072 6566 7265 7368 6564  s last refreshed
+000162f0: 2074 696d 6520 6f66 2074 6865 2070 6169   time of the pai
+00016300: 720a 2020 2020 2020 2020 6966 2074 6963  r.        if tic
+00016310: 6b73 2061 6e64 2063 6163 6865 3a0a 2020  ks and cache:.  
+00016320: 2020 2020 2020 2020 2020 6964 7820 3d20            idx = 
+00016330: 2d32 2069 6620 6472 6f70 5f69 6e63 6f6d  -2 if drop_incom
+00016340: 706c 6574 6520 616e 6420 6c65 6e28 7469  plete and len(ti
+00016350: 636b 7329 203e 2031 2065 6c73 6520 2d31  cks) > 1 else -1
+00016360: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00016370: 662e 5f70 6169 7273 5f6c 6173 745f 7265  f._pairs_last_re
+00016380: 6672 6573 685f 7469 6d65 5b28 7061 6972  fresh_time[(pair
+00016390: 2c20 7469 6d65 6672 616d 652c 2063 5f74  , timeframe, c_t
+000163a0: 7970 6529 5d20 3d20 7469 636b 735b 6964  ype)] = ticks[id
+000163b0: 785d 5b30 5d20 2f2f 2031 3030 300a 2020  x][0] // 1000.  
+000163c0: 2020 2020 2020 2320 6b65 6570 696e 6720        # keeping 
+000163d0: 7061 7273 6564 2064 6174 6166 7261 6d65  parsed dataframe
+000163e0: 2069 6e20 6361 6368 650a 2020 2020 2020   in cache.      
+000163f0: 2020 6f68 6c63 765f 6466 203d 206f 686c    ohlcv_df = ohl
+00016400: 6376 5f74 6f5f 6461 7461 6672 616d 6528  cv_to_dataframe(
+00016410: 7469 636b 732c 2074 696d 6566 7261 6d65  ticks, timeframe
+00016420: 2c20 7061 6972 3d70 6169 722c 2066 696c  , pair=pair, fil
+00016430: 6c5f 6d69 7373 696e 673d 5472 7565 2c0a  l_missing=True,.
 00016440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016450: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00016460: 726f 705f 696e 636f 6d70 6c65 7465 3d64  rop_incomplete=d
-00016470: 726f 705f 696e 636f 6d70 6c65 7465 290a  rop_incomplete).
-00016480: 2020 2020 2020 2020 6966 2063 6163 6865          if cache
-00016490: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-000164a0: 2028 7061 6972 2c20 7469 6d65 6672 616d   (pair, timefram
-000164b0: 652c 2063 5f74 7970 6529 2069 6e20 7365  e, c_type) in se
-000164c0: 6c66 2e5f 6b6c 696e 6573 3a0a 2020 2020  lf._klines:.    
-000164d0: 2020 2020 2020 2020 2020 2020 6f6c 6420              old 
-000164e0: 3d20 7365 6c66 2e5f 6b6c 696e 6573 5b28  = self._klines[(
-000164f0: 7061 6972 2c20 7469 6d65 6672 616d 652c  pair, timeframe,
-00016500: 2063 5f74 7970 6529 5d0a 2020 2020 2020   c_type)].      
-00016510: 2020 2020 2020 2020 2020 2320 5265 6173            # Reas
-00016520: 7369 676e 2073 6f20 7765 2072 6574 7572  sign so we retur
-00016530: 6e20 7468 6520 7570 6461 7465 642c 2063  n the updated, c
-00016540: 6f6d 6269 6e65 6420 6466 0a20 2020 2020  ombined df.     
-00016550: 2020 2020 2020 2020 2020 206f 686c 6376             ohlcv
-00016560: 5f64 6620 3d20 636c 6561 6e5f 6f68 6c63  _df = clean_ohlc
-00016570: 765f 6461 7461 6672 616d 6528 636f 6e63  v_dataframe(conc
-00016580: 6174 285b 6f6c 642c 206f 686c 6376 5f64  at([old, ohlcv_d
-00016590: 665d 2c20 6178 6973 3d30 292c 2074 696d  f], axis=0), tim
-000165a0: 6566 7261 6d65 2c20 7061 6972 2c0a 2020  eframe, pair,.  
-000165b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016460: 2020 2020 2020 6472 6f70 5f69 6e63 6f6d        drop_incom
+00016470: 706c 6574 653d 6472 6f70 5f69 6e63 6f6d  plete=drop_incom
+00016480: 706c 6574 6529 0a20 2020 2020 2020 2069  plete).        i
+00016490: 6620 6361 6368 653a 0a20 2020 2020 2020  f cache:.       
+000164a0: 2020 2020 2069 6620 2870 6169 722c 2074       if (pair, t
+000164b0: 696d 6566 7261 6d65 2c20 635f 7479 7065  imeframe, c_type
+000164c0: 2920 696e 2073 656c 662e 5f6b 6c69 6e65  ) in self._kline
+000164d0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+000164e0: 2020 206f 6c64 203d 2073 656c 662e 5f6b     old = self._k
+000164f0: 6c69 6e65 735b 2870 6169 722c 2074 696d  lines[(pair, tim
+00016500: 6566 7261 6d65 2c20 635f 7479 7065 295d  eframe, c_type)]
+00016510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016520: 2023 2052 6561 7373 6967 6e20 736f 2077   # Reassign so w
+00016530: 6520 7265 7475 726e 2074 6865 2075 7064  e return the upd
+00016540: 6174 6564 2c20 636f 6d62 696e 6564 2064  ated, combined d
+00016550: 660a 2020 2020 2020 2020 2020 2020 2020  f.              
+00016560: 2020 6f68 6c63 765f 6466 203d 2063 6c65    ohlcv_df = cle
+00016570: 616e 5f6f 686c 6376 5f64 6174 6166 7261  an_ohlcv_datafra
+00016580: 6d65 2863 6f6e 6361 7428 5b6f 6c64 2c20  me(concat([old, 
+00016590: 6f68 6c63 765f 6466 5d2c 2061 7869 733d  ohlcv_df], axis=
+000165a0: 3029 2c20 7469 6d65 6672 616d 652c 2070  0), timeframe, p
+000165b0: 6169 722c 0a20 2020 2020 2020 2020 2020  air,.           
 000165c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000165d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000165e0: 696c 6c5f 6d69 7373 696e 673d 5472 7565  ill_missing=True
-000165f0: 2c20 6472 6f70 5f69 6e63 6f6d 706c 6574  , drop_incomplet
-00016600: 653d 4661 6c73 6529 0a20 2020 2020 2020  e=False).       
-00016610: 2020 2020 2020 2020 2063 616e 646c 655f           candle_
-00016620: 6c69 6d69 7420 3d20 7365 6c66 2e6f 686c  limit = self.ohl
-00016630: 6376 5f63 616e 646c 655f 6c69 6d69 7428  cv_candle_limit(
-00016640: 7469 6d65 6672 616d 652c 2073 656c 662e  timeframe, self.
-00016650: 5f63 6f6e 6669 675b 2763 616e 646c 655f  _config['candle_
-00016660: 7479 7065 5f64 6566 275d 290a 2020 2020  type_def']).    
-00016670: 2020 2020 2020 2020 2020 2020 2320 4167              # Ag
-00016680: 6520 6f75 7420 6f6c 6420 6361 6e64 6c65  e out old candle
-00016690: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-000166a0: 2020 6f68 6c63 765f 6466 203d 206f 686c    ohlcv_df = ohl
-000166b0: 6376 5f64 662e 7461 696c 2863 616e 646c  cv_df.tail(candl
-000166c0: 655f 6c69 6d69 7420 2b20 7365 6c66 2e5f  e_limit + self._
-000166d0: 7374 6172 7475 705f 6361 6e64 6c65 5f63  startup_candle_c
-000166e0: 6f75 6e74 290a 2020 2020 2020 2020 2020  ount).          
-000166f0: 2020 2020 2020 6f68 6c63 765f 6466 203d        ohlcv_df =
-00016700: 206f 686c 6376 5f64 662e 7265 7365 745f   ohlcv_df.reset_
-00016710: 696e 6465 7828 6472 6f70 3d54 7275 6529  index(drop=True)
-00016720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016730: 2073 656c 662e 5f6b 6c69 6e65 735b 2870   self._klines[(p
-00016740: 6169 722c 2074 696d 6566 7261 6d65 2c20  air, timeframe, 
-00016750: 635f 7479 7065 295d 203d 206f 686c 6376  c_type)] = ohlcv
-00016760: 5f64 660a 2020 2020 2020 2020 2020 2020  _df.            
-00016770: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00016780: 2020 2020 2020 7365 6c66 2e5f 6b6c 696e        self._klin
-00016790: 6573 5b28 7061 6972 2c20 7469 6d65 6672  es[(pair, timefr
-000167a0: 616d 652c 2063 5f74 7970 6529 5d20 3d20  ame, c_type)] = 
-000167b0: 6f68 6c63 765f 6466 0a20 2020 2020 2020  ohlcv_df.       
-000167c0: 2072 6574 7572 6e20 6f68 6c63 765f 6466   return ohlcv_df
-000167d0: 0a0a 2020 2020 6465 6620 7265 6672 6573  ..    def refres
-000167e0: 685f 6c61 7465 7374 5f6f 686c 6376 2873  h_latest_ohlcv(s
-000167f0: 656c 662c 2070 6169 725f 6c69 7374 3a20  elf, pair_list: 
-00016800: 4c69 7374 5061 6972 7357 6974 6854 696d  ListPairsWithTim
-00016810: 6566 7261 6d65 732c 202a 2c0a 2020 2020  eframes, *,.    
-00016820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016830: 2020 2020 2020 2020 2073 696e 6365 5f6d           since_m
-00016840: 733a 204f 7074 696f 6e61 6c5b 696e 745d  s: Optional[int]
-00016850: 203d 204e 6f6e 652c 2063 6163 6865 3a20   = None, cache: 
-00016860: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
-00016870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016880: 2020 2020 2020 2020 2020 6472 6f70 5f69            drop_i
-00016890: 6e63 6f6d 706c 6574 653a 204f 7074 696f  ncomplete: Optio
-000168a0: 6e61 6c5b 626f 6f6c 5d20 3d20 4e6f 6e65  nal[bool] = None
-000168b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000168c0: 2020 2020 2020 2020 2020 2020 2020 2920                ) 
-000168d0: 2d3e 2044 6963 745b 5061 6972 5769 7468  -> Dict[PairWith
-000168e0: 5469 6d65 6672 616d 652c 2044 6174 6146  Timeframe, DataF
-000168f0: 7261 6d65 5d3a 0a20 2020 2020 2020 2022  rame]:.        "
-00016900: 2222 0a20 2020 2020 2020 2052 6566 7265  "".        Refre
-00016910: 7368 2069 6e2d 6d65 6d6f 7279 204f 484c  sh in-memory OHL
-00016920: 4356 2061 7379 6e63 6872 6f6e 6f75 736c  CV asynchronousl
-00016930: 7920 616e 6420 7365 7420 605f 6b6c 696e  y and set `_klin
-00016940: 6573 6020 7769 7468 2074 6865 2072 6573  es` with the res
-00016950: 756c 740a 2020 2020 2020 2020 4c6f 6f70  ult.        Loop
-00016960: 7320 6173 796e 6368 726f 6e6f 7573 6c79  s asynchronously
-00016970: 206f 7665 7220 7061 6972 5f6c 6973 7420   over pair_list 
-00016980: 616e 6420 646f 776e 6c6f 6164 7320 616c  and downloads al
-00016990: 6c20 7061 6972 7320 6173 796e 6320 2873  l pairs async (s
-000169a0: 656d 692d 7061 7261 6c6c 656c 292e 0a20  emi-parallel).. 
-000169b0: 2020 2020 2020 204f 6e6c 7920 7573 6564         Only used
-000169c0: 2069 6e20 7468 6520 6461 7461 7072 6f76   in the dataprov
-000169d0: 6964 6572 2e72 6566 7265 7368 2829 206d  ider.refresh() m
-000169e0: 6574 686f 642e 0a20 2020 2020 2020 203a  ethod..        :
-000169f0: 7061 7261 6d20 7061 6972 5f6c 6973 743a  param pair_list:
-00016a00: 204c 6973 7420 6f66 2032 2065 6c65 6d65   List of 2 eleme
-00016a10: 6e74 2074 7570 6c65 7320 636f 6e74 6169  nt tuples contai
-00016a20: 6e69 6e67 2070 6169 722c 2069 6e74 6572  ning pair, inter
-00016a30: 7661 6c20 746f 2072 6566 7265 7368 0a20  val to refresh. 
-00016a40: 2020 2020 2020 203a 7061 7261 6d20 7369         :param si
-00016a50: 6e63 655f 6d73 3a20 7469 6d65 2073 696e  nce_ms: time sin
-00016a60: 6365 2077 6865 6e20 746f 2064 6f77 6e6c  ce when to downl
-00016a70: 6f61 642c 2069 6e20 6d69 6c6c 6973 6563  oad, in millisec
-00016a80: 6f6e 6473 0a20 2020 2020 2020 203a 7061  onds.        :pa
-00016a90: 7261 6d20 6361 6368 653a 2041 7373 6967  ram cache: Assig
-00016aa0: 6e20 7265 7375 6c74 2074 6f20 5f6b 6c69  n result to _kli
-00016ab0: 6e65 732e 2055 7365 6675 6c6c 2066 6f72  nes. Usefull for
-00016ac0: 206f 6e65 2d6f 6666 2064 6f77 6e6c 6f61   one-off downloa
-00016ad0: 6473 206c 696b 6520 666f 7220 7061 6972  ds like for pair
-00016ae0: 6c69 7374 730a 2020 2020 2020 2020 3a70  lists.        :p
-00016af0: 6172 616d 2064 726f 705f 696e 636f 6d70  aram drop_incomp
-00016b00: 6c65 7465 3a20 436f 6e74 726f 6c20 6361  lete: Control ca
-00016b10: 6e64 6c65 2064 726f 7070 696e 672e 0a20  ndle dropping.. 
-00016b20: 2020 2020 2020 2020 2020 2053 7065 6369             Speci
-00016b30: 6679 696e 6720 4e6f 6e65 2064 6566 6175  fying None defau
-00016b40: 6c74 7320 746f 205f 6f68 6c63 765f 7061  lts to _ohlcv_pa
-00016b50: 7274 6961 6c5f 6361 6e64 6c65 0a20 2020  rtial_candle.   
-00016b60: 2020 2020 203a 7265 7475 726e 3a20 4469       :return: Di
-00016b70: 6374 206f 6620 5b7b 2870 6169 722c 2074  ct of [{(pair, t
-00016b80: 696d 6566 7261 6d65 293a 2044 6174 6166  imeframe): Dataf
-00016b90: 7261 6d65 7d5d 0a20 2020 2020 2020 2022  rame}].        "
-00016ba0: 2222 0a20 2020 2020 2020 206c 6f67 6765  "".        logge
-00016bb0: 722e 6465 6275 6728 2252 6566 7265 7368  r.debug("Refresh
-00016bc0: 696e 6720 6361 6e64 6c65 2028 4f48 4c43  ing candle (OHLC
-00016bd0: 5629 2064 6174 6120 666f 7220 2564 2070  V) data for %d p
-00016be0: 6169 7273 222c 206c 656e 2870 6169 725f  airs", len(pair_
-00016bf0: 6c69 7374 2929 0a0a 2020 2020 2020 2020  list))..        
-00016c00: 2320 4761 7468 6572 2063 6f72 6f75 7469  # Gather corouti
-00016c10: 6e65 7320 746f 2072 756e 0a20 2020 2020  nes to run.     
-00016c20: 2020 2069 6e70 7574 5f63 6f72 6f75 7469     input_corouti
-00016c30: 6e65 732c 2063 6163 6865 645f 7061 6972  nes, cached_pair
-00016c40: 7320 3d20 7365 6c66 2e5f 6275 696c 645f  s = self._build_
-00016c50: 6f68 6c63 765f 646c 5f6a 6f62 7328 7061  ohlcv_dl_jobs(pa
-00016c60: 6972 5f6c 6973 742c 2073 696e 6365 5f6d  ir_list, since_m
-00016c70: 732c 2063 6163 6865 290a 0a20 2020 2020  s, cache)..     
-00016c80: 2020 2072 6573 756c 7473 5f64 6620 3d20     results_df = 
-00016c90: 7b7d 0a20 2020 2020 2020 2023 2043 6875  {}.        # Chu
-00016ca0: 6e6b 2072 6571 7565 7374 7320 696e 746f  nk requests into
-00016cb0: 2062 6174 6368 6573 206f 6620 3130 3020   batches of 100 
-00016cc0: 746f 2061 766f 6964 206f 7665 7277 656c  to avoid overwel
-00016cd0: 6d69 6e67 2063 6378 7420 5468 726f 7474  ming ccxt Thrott
-00016ce0: 6c69 6e67 0a20 2020 2020 2020 2066 6f72  ling.        for
-00016cf0: 2069 6e70 7574 5f63 6f72 6f20 696e 2063   input_coro in c
-00016d00: 6875 6e6b 7328 696e 7075 745f 636f 726f  hunks(input_coro
-00016d10: 7574 696e 6573 2c20 3130 3029 3a0a 2020  utines, 100):.  
-00016d20: 2020 2020 2020 2020 2020 6173 796e 6320            async 
-00016d30: 6465 6620 6761 7468 6572 5f73 7475 6666  def gather_stuff
-00016d40: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00016d50: 2020 2020 7265 7475 726e 2061 7761 6974      return await
-00016d60: 2061 7379 6e63 696f 2e67 6174 6865 7228   asyncio.gather(
-00016d70: 2a69 6e70 7574 5f63 6f72 6f2c 2072 6574  *input_coro, ret
-00016d80: 7572 6e5f 6578 6365 7074 696f 6e73 3d54  urn_exceptions=T
-00016d90: 7275 6529 0a0a 2020 2020 2020 2020 2020  rue)..          
-00016da0: 2020 7769 7468 2073 656c 662e 5f6c 6f6f    with self._loo
-00016db0: 705f 6c6f 636b 3a0a 2020 2020 2020 2020  p_lock:.        
-00016dc0: 2020 2020 2020 2020 7265 7375 6c74 7320          results 
-00016dd0: 3d20 7365 6c66 2e6c 6f6f 702e 7275 6e5f  = self.loop.run_
-00016de0: 756e 7469 6c5f 636f 6d70 6c65 7465 2867  until_complete(g
-00016df0: 6174 6865 725f 7374 7566 6628 2929 0a0a  ather_stuff())..
-00016e00: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00016e10: 7265 7320 696e 2072 6573 756c 7473 3a0a  res in results:.
-00016e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e30: 6966 2069 7369 6e73 7461 6e63 6528 7265  if isinstance(re
-00016e40: 732c 2045 7863 6570 7469 6f6e 293a 0a20  s, Exception):. 
-00016e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e60: 2020 206c 6f67 6765 722e 7761 726e 696e     logger.warnin
-00016e70: 6728 6622 4173 796e 6320 636f 6465 2072  g(f"Async code r
-00016e80: 6169 7365 6420 616e 2065 7863 6570 7469  aised an excepti
-00016e90: 6f6e 3a20 7b72 6570 7228 7265 7329 7d22  on: {repr(res)}"
-00016ea0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00016eb0: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-00016ec0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00016ed0: 2044 6563 6f6e 7374 7275 6374 2074 7570   Deconstruct tup
-00016ee0: 6c65 2028 6861 7320 3520 656c 656d 656e  le (has 5 elemen
-00016ef0: 7473 290a 2020 2020 2020 2020 2020 2020  ts).            
-00016f00: 2020 2020 7061 6972 2c20 7469 6d65 6672      pair, timefr
-00016f10: 616d 652c 2063 5f74 7970 652c 2074 6963  ame, c_type, tic
-00016f20: 6b73 2c20 6472 6f70 5f68 696e 7420 3d20  ks, drop_hint = 
-00016f30: 7265 730a 2020 2020 2020 2020 2020 2020  res.            
-00016f40: 2020 2020 6472 6f70 5f69 6e63 6f6d 706c      drop_incompl
-00016f50: 6574 655f 203d 2064 726f 705f 6869 6e74  ete_ = drop_hint
-00016f60: 2069 6620 6472 6f70 5f69 6e63 6f6d 706c   if drop_incompl
-00016f70: 6574 6520 6973 204e 6f6e 6520 656c 7365  ete is None else
-00016f80: 2064 726f 705f 696e 636f 6d70 6c65 7465   drop_incomplete
-00016f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016fa0: 206f 686c 6376 5f64 6620 3d20 7365 6c66   ohlcv_df = self
-00016fb0: 2e5f 7072 6f63 6573 735f 6f68 6c63 765f  ._process_ohlcv_
-00016fc0: 6466 280a 2020 2020 2020 2020 2020 2020  df(.            
-00016fd0: 2020 2020 2020 2020 7061 6972 2c20 7469          pair, ti
-00016fe0: 6d65 6672 616d 652c 2063 5f74 7970 652c  meframe, c_type,
-00016ff0: 2074 6963 6b73 2c20 6361 6368 652c 2064   ticks, cache, d
-00017000: 726f 705f 696e 636f 6d70 6c65 7465 5f29  rop_incomplete_)
-00017010: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00017020: 2020 7265 7375 6c74 735f 6466 5b28 7061    results_df[(pa
-00017030: 6972 2c20 7469 6d65 6672 616d 652c 2063  ir, timeframe, c
-00017040: 5f74 7970 6529 5d20 3d20 6f68 6c63 765f  _type)] = ohlcv_
-00017050: 6466 0a0a 2020 2020 2020 2020 2320 5265  df..        # Re
-00017060: 7475 726e 2063 6163 6865 6420 6b6c 696e  turn cached klin
-00017070: 6573 0a20 2020 2020 2020 2066 6f72 2070  es.        for p
-00017080: 6169 722c 2074 696d 6566 7261 6d65 2c20  air, timeframe, 
-00017090: 635f 7479 7065 2069 6e20 6361 6368 6564  c_type in cached
-000170a0: 5f70 6169 7273 3a0a 2020 2020 2020 2020  _pairs:.        
-000170b0: 2020 2020 7265 7375 6c74 735f 6466 5b28      results_df[(
-000170c0: 7061 6972 2c20 7469 6d65 6672 616d 652c  pair, timeframe,
-000170d0: 2063 5f74 7970 6529 5d20 3d20 7365 6c66   c_type)] = self
-000170e0: 2e6b 6c69 6e65 7328 0a20 2020 2020 2020  .klines(.       
-000170f0: 2020 2020 2020 2020 2028 7061 6972 2c20           (pair, 
-00017100: 7469 6d65 6672 616d 652c 2063 5f74 7970  timeframe, c_typ
-00017110: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
-00017120: 2020 2020 636f 7079 3d46 616c 7365 0a20      copy=False. 
-00017130: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00017140: 2020 2020 2020 7265 7475 726e 2072 6573        return res
-00017150: 756c 7473 5f64 660a 0a20 2020 2064 6566  ults_df..    def
-00017160: 205f 6e6f 775f 6973 5f74 696d 655f 746f   _now_is_time_to
-00017170: 5f72 6566 7265 7368 2873 656c 662c 2070  _refresh(self, p
-00017180: 6169 723a 2073 7472 2c20 7469 6d65 6672  air: str, timefr
-00017190: 616d 653a 2073 7472 2c20 6361 6e64 6c65  ame: str, candle
-000171a0: 5f74 7970 653a 2043 616e 646c 6554 7970  _type: CandleTyp
-000171b0: 6529 202d 3e20 626f 6f6c 3a0a 2020 2020  e) -> bool:.    
-000171c0: 2020 2020 2320 5469 6d65 6672 616d 6520      # Timeframe 
-000171d0: 696e 2073 6563 6f6e 6473 0a20 2020 2020  in seconds.     
-000171e0: 2020 2069 6e74 6572 7661 6c5f 696e 5f73     interval_in_s
-000171f0: 6563 203d 2074 696d 6566 7261 6d65 5f74  ec = timeframe_t
-00017200: 6f5f 7365 636f 6e64 7328 7469 6d65 6672  o_seconds(timefr
-00017210: 616d 6529 0a20 2020 2020 2020 2070 6c72  ame).        plr
-00017220: 203d 2073 656c 662e 5f70 6169 7273 5f6c   = self._pairs_l
-00017230: 6173 745f 7265 6672 6573 685f 7469 6d65  ast_refresh_time
-00017240: 2e67 6574 2828 7061 6972 2c20 7469 6d65  .get((pair, time
-00017250: 6672 616d 652c 2063 616e 646c 655f 7479  frame, candle_ty
-00017260: 7065 292c 2030 2920 2b20 696e 7465 7276  pe), 0) + interv
-00017270: 616c 5f69 6e5f 7365 630a 2020 2020 2020  al_in_sec.      
-00017280: 2020 2320 6375 7272 656e 742c 6163 7469    # current,acti
-00017290: 7665 2063 616e 646c 6520 6f70 656e 2064  ve candle open d
-000172a0: 6174 650a 2020 2020 2020 2020 6e6f 7720  ate.        now 
-000172b0: 3d20 696e 7428 7469 6d65 6672 616d 655f  = int(timeframe_
-000172c0: 746f 5f70 7265 765f 6461 7465 2874 696d  to_prev_date(tim
-000172d0: 6566 7261 6d65 292e 7469 6d65 7374 616d  eframe).timestam
-000172e0: 7028 2929 0a20 2020 2020 2020 2072 6574  p()).        ret
-000172f0: 7572 6e20 706c 7220 3c20 6e6f 770a 0a20  urn plr < now.. 
-00017300: 2020 2040 7265 7472 6965 725f 6173 796e     @retrier_asyn
-00017310: 630a 2020 2020 6173 796e 6320 6465 6620  c.    async def 
-00017320: 5f61 7379 6e63 5f67 6574 5f63 616e 646c  _async_get_candl
-00017330: 655f 6869 7374 6f72 7928 0a20 2020 2020  e_history(.     
-00017340: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00017350: 2070 6169 723a 2073 7472 2c0a 2020 2020   pair: str,.    
-00017360: 2020 2020 7469 6d65 6672 616d 653a 2073      timeframe: s
-00017370: 7472 2c0a 2020 2020 2020 2020 6361 6e64  tr,.        cand
-00017380: 6c65 5f74 7970 653a 2043 616e 646c 6554  le_type: CandleT
-00017390: 7970 652c 0a20 2020 2020 2020 2073 696e  ype,.        sin
-000173a0: 6365 5f6d 733a 204f 7074 696f 6e61 6c5b  ce_ms: Optional[
-000173b0: 696e 745d 203d 204e 6f6e 652c 0a20 2020  int] = None,.   
-000173c0: 2029 202d 3e20 4f48 4c43 5652 6573 706f   ) -> OHLCVRespo
-000173d0: 6e73 653a 0a20 2020 2020 2020 2022 2222  nse:.        """
-000173e0: 0a20 2020 2020 2020 2041 7379 6e63 6872  .        Asynchr
-000173f0: 6f6e 6f75 736c 7920 6765 7420 6361 6e64  onously get cand
-00017400: 6c65 2068 6973 746f 7279 2064 6174 6120  le history data 
-00017410: 7573 696e 6720 6665 7463 685f 6f68 6c63  using fetch_ohlc
-00017420: 760a 2020 2020 2020 2020 3a70 6172 616d  v.        :param
-00017430: 2063 616e 646c 655f 7479 7065 3a20 2727   candle_type: ''
-00017440: 2c20 6d61 726b 2c20 696e 6465 782c 2070  , mark, index, p
-00017450: 7265 6d69 756d 496e 6465 782c 206f 7220  remiumIndex, or 
-00017460: 6675 6e64 696e 675f 7261 7465 0a20 2020  funding_rate.   
-00017470: 2020 2020 2072 6574 7572 6e73 2074 7570       returns tup
-00017480: 6c65 3a20 2870 6169 722c 2074 696d 6566  le: (pair, timef
-00017490: 7261 6d65 2c20 6f68 6c63 765f 6c69 7374  rame, ohlcv_list
-000174a0: 290a 2020 2020 2020 2020 2222 220a 2020  ).        """.  
-000174b0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-000174c0: 2020 2020 2020 2023 2046 6574 6368 204f         # Fetch O
-000174d0: 484c 4356 2061 7379 6e63 6872 6f6e 6f75  HLCV asynchronou
-000174e0: 736c 790a 2020 2020 2020 2020 2020 2020  sly.            
-000174f0: 7320 3d20 2728 2720 2b20 6474 5f66 726f  s = '(' + dt_fro
-00017500: 6d5f 7473 2873 696e 6365 5f6d 7329 2e69  m_ts(since_ms).i
-00017510: 736f 666f 726d 6174 2829 202b 2027 2920  soformat() + ') 
-00017520: 2720 6966 2073 696e 6365 5f6d 7320 6973  ' if since_ms is
-00017530: 206e 6f74 204e 6f6e 6520 656c 7365 2027   not None else '
-00017540: 270a 2020 2020 2020 2020 2020 2020 6c6f  '.            lo
-00017550: 6767 6572 2e64 6562 7567 280a 2020 2020  gger.debug(.    
-00017560: 2020 2020 2020 2020 2020 2020 2246 6574              "Fet
-00017570: 6368 696e 6720 7061 6972 2025 732c 2025  ching pair %s, %
-00017580: 732c 2069 6e74 6572 7661 6c20 2573 2c20  s, interval %s, 
-00017590: 7369 6e63 6520 2573 2025 732e 2e2e 222c  since %s %s...",
-000175a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000175b0: 2070 6169 722c 2063 616e 646c 655f 7479   pair, candle_ty
-000175c0: 7065 2c20 7469 6d65 6672 616d 652c 2073  pe, timeframe, s
-000175d0: 696e 6365 5f6d 732c 2073 0a20 2020 2020  ince_ms, s.     
-000175e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000175f0: 2020 2020 2070 6172 616d 7320 3d20 6465       params = de
-00017600: 6570 636f 7079 2873 656c 662e 5f66 745f  epcopy(self._ft_
-00017610: 6861 732e 6765 7428 276f 686c 6376 5f70  has.get('ohlcv_p
-00017620: 6172 616d 7327 2c20 7b7d 2929 0a20 2020  arams', {})).   
-00017630: 2020 2020 2020 2020 2063 616e 646c 655f           candle_
-00017640: 6c69 6d69 7420 3d20 7365 6c66 2e6f 686c  limit = self.ohl
-00017650: 6376 5f63 616e 646c 655f 6c69 6d69 7428  cv_candle_limit(
-00017660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017670: 2074 696d 6566 7261 6d65 2c20 6361 6e64   timeframe, cand
-00017680: 6c65 5f74 7970 653d 6361 6e64 6c65 5f74  le_type=candle_t
-00017690: 7970 652c 2073 696e 6365 5f6d 733d 7369  ype, since_ms=si
-000176a0: 6e63 655f 6d73 290a 0a20 2020 2020 2020  nce_ms)..       
-000176b0: 2020 2020 2069 6620 6361 6e64 6c65 5f74       if candle_t
-000176c0: 7970 6520 616e 6420 6361 6e64 6c65 5f74  ype and candle_t
-000176d0: 7970 6520 213d 2043 616e 646c 6554 7970  ype != CandleTyp
-000176e0: 652e 5350 4f54 3a0a 2020 2020 2020 2020  e.SPOT:.        
-000176f0: 2020 2020 2020 2020 7061 7261 6d73 2e75          params.u
-00017700: 7064 6174 6528 7b27 7072 6963 6527 3a20  pdate({'price': 
-00017710: 6361 6e64 6c65 5f74 7970 652e 7661 6c75  candle_type.valu
-00017720: 657d 290a 2020 2020 2020 2020 2020 2020  e}).            
-00017730: 6966 2063 616e 646c 655f 7479 7065 2021  if candle_type !
-00017740: 3d20 4361 6e64 6c65 5479 7065 2e46 554e  = CandleType.FUN
-00017750: 4449 4e47 5f52 4154 453a 0a20 2020 2020  DING_RATE:.     
-00017760: 2020 2020 2020 2020 2020 2064 6174 6120             data 
-00017770: 3d20 6177 6169 7420 7365 6c66 2e5f 6170  = await self._ap
-00017780: 695f 6173 796e 632e 6665 7463 685f 6f68  i_async.fetch_oh
-00017790: 6c63 7628 0a20 2020 2020 2020 2020 2020  lcv(.           
-000177a0: 2020 2020 2020 2020 2070 6169 722c 2074           pair, t
-000177b0: 696d 6566 7261 6d65 3d74 696d 6566 7261  imeframe=timefra
-000177c0: 6d65 2c20 7369 6e63 653d 7369 6e63 655f  me, since=since_
-000177d0: 6d73 2c0a 2020 2020 2020 2020 2020 2020  ms,.            
-000177e0: 2020 2020 2020 2020 6c69 6d69 743d 6361          limit=ca
-000177f0: 6e64 6c65 5f6c 696d 6974 2c20 7061 7261  ndle_limit, para
-00017800: 6d73 3d70 6172 616d 7329 0a20 2020 2020  ms=params).     
-00017810: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00017820: 2020 2020 2020 2020 2020 2020 2023 2046               # F
-00017830: 756e 6469 6e67 2072 6174 650a 2020 2020  unding rate.    
-00017840: 2020 2020 2020 2020 2020 2020 6461 7461              data
-00017850: 203d 2061 7761 6974 2073 656c 662e 5f66   = await self._f
-00017860: 6574 6368 5f66 756e 6469 6e67 5f72 6174  etch_funding_rat
-00017870: 655f 6869 7374 6f72 7928 0a20 2020 2020  e_history(.     
-00017880: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00017890: 6169 723d 7061 6972 2c0a 2020 2020 2020  air=pair,.      
-000178a0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-000178b0: 6d65 6672 616d 653d 7469 6d65 6672 616d  meframe=timefram
-000178c0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-000178d0: 2020 2020 2020 206c 696d 6974 3d63 616e         limit=can
-000178e0: 646c 655f 6c69 6d69 742c 0a20 2020 2020  dle_limit,.     
-000178f0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00017900: 696e 6365 5f6d 733d 7369 6e63 655f 6d73  ince_ms=since_ms
-00017910: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00017920: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00017930: 2320 536f 6d65 2065 7863 6861 6e67 6573  # Some exchanges
-00017940: 2073 6f72 7420 4f48 4c43 5620 696e 2041   sort OHLCV in A
-00017950: 5343 206f 7264 6572 2061 6e64 206f 7468  SC order and oth
-00017960: 6572 7320 696e 2044 4553 432e 0a20 2020  ers in DESC..   
-00017970: 2020 2020 2020 2020 2023 2045 783a 2042           # Ex: B
-00017980: 6974 7472 6578 2072 6574 7572 6e73 2074  ittrex returns t
-00017990: 6865 206c 6973 7420 6f66 204f 484c 4356  he list of OHLCV
-000179a0: 2069 6e20 4153 4320 6f72 6465 7220 286f   in ASC order (o
-000179b0: 6c64 6573 7420 6669 7273 742c 206e 6577  ldest first, new
-000179c0: 6573 7420 6c61 7374 290a 2020 2020 2020  est last).      
-000179d0: 2020 2020 2020 2320 7768 696c 6520 4744        # while GD
-000179e0: 4158 2072 6574 7572 6e73 2074 6865 206c  AX returns the l
-000179f0: 6973 7420 6f66 204f 484c 4356 2069 6e20  ist of OHLCV in 
-00017a00: 4445 5343 206f 7264 6572 2028 6e65 7765  DESC order (newe
-00017a10: 7374 2066 6972 7374 2c20 6f6c 6465 7374  st first, oldest
-00017a20: 206c 6173 7429 0a20 2020 2020 2020 2020   last).         
-00017a30: 2020 2023 204f 6e6c 7920 736f 7274 2069     # Only sort i
-00017a40: 6620 6e65 6365 7373 6172 7920 746f 2073  f necessary to s
-00017a50: 6176 6520 636f 6d70 7574 696e 6720 7469  ave computing ti
-00017a60: 6d65 0a20 2020 2020 2020 2020 2020 2074  me.            t
-00017a70: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00017a80: 2020 2020 6966 2064 6174 6120 616e 6420      if data and 
-00017a90: 6461 7461 5b30 5d5b 305d 203e 2064 6174  data[0][0] > dat
-00017aa0: 615b 2d31 5d5b 305d 3a0a 2020 2020 2020  a[-1][0]:.      
-00017ab0: 2020 2020 2020 2020 2020 2020 2020 6461                da
-00017ac0: 7461 203d 2073 6f72 7465 6428 6461 7461  ta = sorted(data
-00017ad0: 2c20 6b65 793d 6c61 6d62 6461 2078 3a20  , key=lambda x: 
-00017ae0: 785b 305d 290a 2020 2020 2020 2020 2020  x[0]).          
-00017af0: 2020 6578 6365 7074 2049 6e64 6578 4572    except IndexEr
-00017b00: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
-00017b10: 2020 2020 206c 6f67 6765 722e 6578 6365       logger.exce
-00017b20: 7074 696f 6e28 2245 7272 6f72 206c 6f61  ption("Error loa
-00017b30: 6469 6e67 2025 732e 2052 6573 756c 7420  ding %s. Result 
-00017b40: 7761 7320 2573 2e22 2c20 7061 6972 2c20  was %s.", pair, 
-00017b50: 6461 7461 290a 2020 2020 2020 2020 2020  data).          
-00017b60: 2020 2020 2020 7265 7475 726e 2070 6169        return pai
-00017b70: 722c 2074 696d 6566 7261 6d65 2c20 6361  r, timeframe, ca
-00017b80: 6e64 6c65 5f74 7970 652c 205b 5d2c 2073  ndle_type, [], s
-00017b90: 656c 662e 5f6f 686c 6376 5f70 6172 7469  elf._ohlcv_parti
-00017ba0: 616c 5f63 616e 646c 650a 2020 2020 2020  al_candle.      
-00017bb0: 2020 2020 2020 6c6f 6767 6572 2e64 6562        logger.deb
-00017bc0: 7567 2822 446f 6e65 2066 6574 6368 696e  ug("Done fetchin
-00017bd0: 6720 7061 6972 2025 732c 2069 6e74 6572  g pair %s, inter
-00017be0: 7661 6c20 2573 202e 2e2e 222c 2070 6169  val %s ...", pai
-00017bf0: 722c 2074 696d 6566 7261 6d65 290a 2020  r, timeframe).  
-00017c00: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00017c10: 2070 6169 722c 2074 696d 6566 7261 6d65   pair, timeframe
-00017c20: 2c20 6361 6e64 6c65 5f74 7970 652c 2064  , candle_type, d
-00017c30: 6174 612c 2073 656c 662e 5f6f 686c 6376  ata, self._ohlcv
-00017c40: 5f70 6172 7469 616c 5f63 616e 646c 650a  _partial_candle.
-00017c50: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00017c60: 6363 7874 2e4e 6f74 5375 7070 6f72 7465  ccxt.NotSupporte
-00017c70: 6420 6173 2065 3a0a 2020 2020 2020 2020  d as e:.        
-00017c80: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
-00017c90: 696f 6e61 6c45 7863 6570 7469 6f6e 280a  ionalException(.
-00017ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017cb0: 6627 4578 6368 616e 6765 207b 7365 6c66  f'Exchange {self
-00017cc0: 2e5f 6170 692e 6e61 6d65 7d20 646f 6573  ._api.name} does
-00017cd0: 206e 6f74 2073 7570 706f 7274 2066 6574   not support fet
-00017ce0: 6368 696e 6720 6869 7374 6f72 6963 616c  ching historical
-00017cf0: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
-00017d00: 2020 2066 2763 616e 646c 6520 284f 484c     f'candle (OHL
-00017d10: 4356 2920 6461 7461 2e20 4d65 7373 6167  CV) data. Messag
-00017d20: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
-00017d30: 2020 2020 2020 2020 6578 6365 7074 2063          except c
-00017d40: 6378 742e 4444 6f53 5072 6f74 6563 7469  cxt.DDoSProtecti
-00017d50: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
-00017d60: 2020 2020 2072 6169 7365 2044 446f 7350       raise DDosP
-00017d70: 726f 7465 6374 696f 6e28 6529 2066 726f  rotection(e) fro
-00017d80: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
-00017d90: 7074 2028 6363 7874 2e4e 6574 776f 726b  pt (ccxt.Network
-00017da0: 4572 726f 722c 2063 6378 742e 4578 6368  Error, ccxt.Exch
-00017db0: 616e 6765 4572 726f 7229 2061 7320 653a  angeError) as e:
-00017dc0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00017dd0: 7365 2054 656d 706f 7261 7279 4572 726f  se TemporaryErro
-00017de0: 7228 6627 436f 756c 6420 6e6f 7420 6665  r(f'Could not fe
-00017df0: 7463 6820 6869 7374 6f72 6963 616c 2063  tch historical c
-00017e00: 616e 646c 6520 284f 484c 4356 2920 6461  andle (OHLCV) da
-00017e10: 7461 2027 0a20 2020 2020 2020 2020 2020  ta '.           
+000165d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000165e0: 2020 2020 2020 6669 6c6c 5f6d 6973 7369        fill_missi
+000165f0: 6e67 3d54 7275 652c 2064 726f 705f 696e  ng=True, drop_in
+00016600: 636f 6d70 6c65 7465 3d46 616c 7365 290a  complete=False).
+00016610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016620: 6361 6e64 6c65 5f6c 696d 6974 203d 2073  candle_limit = s
+00016630: 656c 662e 6f68 6c63 765f 6361 6e64 6c65  elf.ohlcv_candle
+00016640: 5f6c 696d 6974 2874 696d 6566 7261 6d65  _limit(timeframe
+00016650: 2c20 7365 6c66 2e5f 636f 6e66 6967 5b27  , self._config['
+00016660: 6361 6e64 6c65 5f74 7970 655f 6465 6627  candle_type_def'
+00016670: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00016680: 2020 2023 2041 6765 206f 7574 206f 6c64     # Age out old
+00016690: 2063 616e 646c 6573 0a20 2020 2020 2020   candles.       
+000166a0: 2020 2020 2020 2020 206f 686c 6376 5f64           ohlcv_d
+000166b0: 6620 3d20 6f68 6c63 765f 6466 2e74 6169  f = ohlcv_df.tai
+000166c0: 6c28 6361 6e64 6c65 5f6c 696d 6974 202b  l(candle_limit +
+000166d0: 2073 656c 662e 5f73 7461 7274 7570 5f63   self._startup_c
+000166e0: 616e 646c 655f 636f 756e 7429 0a20 2020  andle_count).   
+000166f0: 2020 2020 2020 2020 2020 2020 206f 686c               ohl
+00016700: 6376 5f64 6620 3d20 6f68 6c63 765f 6466  cv_df = ohlcv_df
+00016710: 2e72 6573 6574 5f69 6e64 6578 2864 726f  .reset_index(dro
+00016720: 703d 5472 7565 290a 2020 2020 2020 2020  p=True).        
+00016730: 2020 2020 2020 2020 7365 6c66 2e5f 6b6c          self._kl
+00016740: 696e 6573 5b28 7061 6972 2c20 7469 6d65  ines[(pair, time
+00016750: 6672 616d 652c 2063 5f74 7970 6529 5d20  frame, c_type)] 
+00016760: 3d20 6f68 6c63 765f 6466 0a20 2020 2020  = ohlcv_df.     
+00016770: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00016780: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00016790: 662e 5f6b 6c69 6e65 735b 2870 6169 722c  f._klines[(pair,
+000167a0: 2074 696d 6566 7261 6d65 2c20 635f 7479   timeframe, c_ty
+000167b0: 7065 295d 203d 206f 686c 6376 5f64 660a  pe)] = ohlcv_df.
+000167c0: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+000167d0: 686c 6376 5f64 660a 0a20 2020 2064 6566  hlcv_df..    def
+000167e0: 2072 6566 7265 7368 5f6c 6174 6573 745f   refresh_latest_
+000167f0: 6f68 6c63 7628 7365 6c66 2c20 7061 6972  ohlcv(self, pair
+00016800: 5f6c 6973 743a 204c 6973 7450 6169 7273  _list: ListPairs
+00016810: 5769 7468 5469 6d65 6672 616d 6573 2c20  WithTimeframes, 
+00016820: 2a2c 0a20 2020 2020 2020 2020 2020 2020  *,.             
+00016830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016840: 7369 6e63 655f 6d73 3a20 4f70 7469 6f6e  since_ms: Option
+00016850: 616c 5b69 6e74 5d20 3d20 4e6f 6e65 2c20  al[int] = None, 
+00016860: 6361 6368 653a 2062 6f6f 6c20 3d20 5472  cache: bool = Tr
+00016870: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+00016880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016890: 2064 726f 705f 696e 636f 6d70 6c65 7465   drop_incomplete
+000168a0: 3a20 4f70 7469 6f6e 616c 5b62 6f6f 6c5d  : Optional[bool]
+000168b0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+000168c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000168d0: 2020 2020 2029 202d 3e20 4469 6374 5b50       ) -> Dict[P
+000168e0: 6169 7257 6974 6854 696d 6566 7261 6d65  airWithTimeframe
+000168f0: 2c20 4461 7461 4672 616d 655d 3a0a 2020  , DataFrame]:.  
+00016900: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00016910: 2020 5265 6672 6573 6820 696e 2d6d 656d    Refresh in-mem
+00016920: 6f72 7920 4f48 4c43 5620 6173 796e 6368  ory OHLCV asynch
+00016930: 726f 6e6f 7573 6c79 2061 6e64 2073 6574  ronously and set
+00016940: 2060 5f6b 6c69 6e65 7360 2077 6974 6820   `_klines` with 
+00016950: 7468 6520 7265 7375 6c74 0a20 2020 2020  the result.     
+00016960: 2020 204c 6f6f 7073 2061 7379 6e63 6872     Loops asynchr
+00016970: 6f6e 6f75 736c 7920 6f76 6572 2070 6169  onously over pai
+00016980: 725f 6c69 7374 2061 6e64 2064 6f77 6e6c  r_list and downl
+00016990: 6f61 6473 2061 6c6c 2070 6169 7273 2061  oads all pairs a
+000169a0: 7379 6e63 2028 7365 6d69 2d70 6172 616c  sync (semi-paral
+000169b0: 6c65 6c29 2e0a 2020 2020 2020 2020 4f6e  lel)..        On
+000169c0: 6c79 2075 7365 6420 696e 2074 6865 2064  ly used in the d
+000169d0: 6174 6170 726f 7669 6465 722e 7265 6672  ataprovider.refr
+000169e0: 6573 6828 2920 6d65 7468 6f64 2e0a 2020  esh() method..  
+000169f0: 2020 2020 2020 3a70 6172 616d 2070 6169        :param pai
+00016a00: 725f 6c69 7374 3a20 4c69 7374 206f 6620  r_list: List of 
+00016a10: 3220 656c 656d 656e 7420 7475 706c 6573  2 element tuples
+00016a20: 2063 6f6e 7461 696e 696e 6720 7061 6972   containing pair
+00016a30: 2c20 696e 7465 7276 616c 2074 6f20 7265  , interval to re
+00016a40: 6672 6573 680a 2020 2020 2020 2020 3a70  fresh.        :p
+00016a50: 6172 616d 2073 696e 6365 5f6d 733a 2074  aram since_ms: t
+00016a60: 696d 6520 7369 6e63 6520 7768 656e 2074  ime since when t
+00016a70: 6f20 646f 776e 6c6f 6164 2c20 696e 206d  o download, in m
+00016a80: 696c 6c69 7365 636f 6e64 730a 2020 2020  illiseconds.    
+00016a90: 2020 2020 3a70 6172 616d 2063 6163 6865      :param cache
+00016aa0: 3a20 4173 7369 676e 2072 6573 756c 7420  : Assign result 
+00016ab0: 746f 205f 6b6c 696e 6573 2e20 5573 6566  to _klines. Usef
+00016ac0: 756c 6c20 666f 7220 6f6e 652d 6f66 6620  ull for one-off 
+00016ad0: 646f 776e 6c6f 6164 7320 6c69 6b65 2066  downloads like f
+00016ae0: 6f72 2070 6169 726c 6973 7473 0a20 2020  or pairlists.   
+00016af0: 2020 2020 203a 7061 7261 6d20 6472 6f70       :param drop
+00016b00: 5f69 6e63 6f6d 706c 6574 653a 2043 6f6e  _incomplete: Con
+00016b10: 7472 6f6c 2063 616e 646c 6520 6472 6f70  trol candle drop
+00016b20: 7069 6e67 2e0a 2020 2020 2020 2020 2020  ping..          
+00016b30: 2020 5370 6563 6966 7969 6e67 204e 6f6e    Specifying Non
+00016b40: 6520 6465 6661 756c 7473 2074 6f20 5f6f  e defaults to _o
+00016b50: 686c 6376 5f70 6172 7469 616c 5f63 616e  hlcv_partial_can
+00016b60: 646c 650a 2020 2020 2020 2020 3a72 6574  dle.        :ret
+00016b70: 7572 6e3a 2044 6963 7420 6f66 205b 7b28  urn: Dict of [{(
+00016b80: 7061 6972 2c20 7469 6d65 6672 616d 6529  pair, timeframe)
+00016b90: 3a20 4461 7461 6672 616d 657d 5d0a 2020  : Dataframe}].  
+00016ba0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00016bb0: 2020 6c6f 6767 6572 2e64 6562 7567 2822    logger.debug("
+00016bc0: 5265 6672 6573 6869 6e67 2063 616e 646c  Refreshing candl
+00016bd0: 6520 284f 484c 4356 2920 6461 7461 2066  e (OHLCV) data f
+00016be0: 6f72 2025 6420 7061 6972 7322 2c20 6c65  or %d pairs", le
+00016bf0: 6e28 7061 6972 5f6c 6973 7429 290a 0a20  n(pair_list)).. 
+00016c00: 2020 2020 2020 2023 2047 6174 6865 7220         # Gather 
+00016c10: 636f 726f 7574 696e 6573 2074 6f20 7275  coroutines to ru
+00016c20: 6e0a 2020 2020 2020 2020 696e 7075 745f  n.        input_
+00016c30: 636f 726f 7574 696e 6573 2c20 6361 6368  coroutines, cach
+00016c40: 6564 5f70 6169 7273 203d 2073 656c 662e  ed_pairs = self.
+00016c50: 5f62 7569 6c64 5f6f 686c 6376 5f64 6c5f  _build_ohlcv_dl_
+00016c60: 6a6f 6273 2870 6169 725f 6c69 7374 2c20  jobs(pair_list, 
+00016c70: 7369 6e63 655f 6d73 2c20 6361 6368 6529  since_ms, cache)
+00016c80: 0a0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
+00016c90: 735f 6466 203d 207b 7d0a 2020 2020 2020  s_df = {}.      
+00016ca0: 2020 2320 4368 756e 6b20 7265 7175 6573    # Chunk reques
+00016cb0: 7473 2069 6e74 6f20 6261 7463 6865 7320  ts into batches 
+00016cc0: 6f66 2031 3030 2074 6f20 6176 6f69 6420  of 100 to avoid 
+00016cd0: 6f76 6572 7765 6c6d 696e 6720 6363 7874  overwelming ccxt
+00016ce0: 2054 6872 6f74 746c 696e 670a 2020 2020   Throttling.    
+00016cf0: 2020 2020 666f 7220 696e 7075 745f 636f      for input_co
+00016d00: 726f 2069 6e20 6368 756e 6b73 2869 6e70  ro in chunks(inp
+00016d10: 7574 5f63 6f72 6f75 7469 6e65 732c 2031  ut_coroutines, 1
+00016d20: 3030 293a 0a20 2020 2020 2020 2020 2020  00):.           
+00016d30: 2061 7379 6e63 2064 6566 2067 6174 6865   async def gathe
+00016d40: 725f 7374 7566 6628 293a 0a20 2020 2020  r_stuff():.     
+00016d50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00016d60: 6e20 6177 6169 7420 6173 796e 6369 6f2e  n await asyncio.
+00016d70: 6761 7468 6572 282a 696e 7075 745f 636f  gather(*input_co
+00016d80: 726f 2c20 7265 7475 726e 5f65 7863 6570  ro, return_excep
+00016d90: 7469 6f6e 733d 5472 7565 290a 0a20 2020  tions=True)..   
+00016da0: 2020 2020 2020 2020 2077 6974 6820 7365           with se
+00016db0: 6c66 2e5f 6c6f 6f70 5f6c 6f63 6b3a 0a20  lf._loop_lock:. 
+00016dc0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00016dd0: 6573 756c 7473 203d 2073 656c 662e 6c6f  esults = self.lo
+00016de0: 6f70 2e72 756e 5f75 6e74 696c 5f63 6f6d  op.run_until_com
+00016df0: 706c 6574 6528 6761 7468 6572 5f73 7475  plete(gather_stu
+00016e00: 6666 2829 290a 0a20 2020 2020 2020 2020  ff())..         
+00016e10: 2020 2066 6f72 2072 6573 2069 6e20 7265     for res in re
+00016e20: 7375 6c74 733a 0a20 2020 2020 2020 2020  sults:.         
+00016e30: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00016e40: 616e 6365 2872 6573 2c20 4578 6365 7074  ance(res, Except
+00016e50: 696f 6e29 3a0a 2020 2020 2020 2020 2020  ion):.          
+00016e60: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+00016e70: 2e77 6172 6e69 6e67 2866 2241 7379 6e63  .warning(f"Async
+00016e80: 2063 6f64 6520 7261 6973 6564 2061 6e20   code raised an 
+00016e90: 6578 6365 7074 696f 6e3a 207b 7265 7072  exception: {repr
+00016ea0: 2872 6573 297d 2229 0a20 2020 2020 2020  (res)}").       
+00016eb0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00016ec0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+00016ed0: 2020 2020 2020 2320 4465 636f 6e73 7472        # Deconstr
+00016ee0: 7563 7420 7475 706c 6520 2868 6173 2035  uct tuple (has 5
+00016ef0: 2065 6c65 6d65 6e74 7329 0a20 2020 2020   elements).     
+00016f00: 2020 2020 2020 2020 2020 2070 6169 722c             pair,
+00016f10: 2074 696d 6566 7261 6d65 2c20 635f 7479   timeframe, c_ty
+00016f20: 7065 2c20 7469 636b 732c 2064 726f 705f  pe, ticks, drop_
+00016f30: 6869 6e74 203d 2072 6573 0a20 2020 2020  hint = res.     
+00016f40: 2020 2020 2020 2020 2020 2064 726f 705f             drop_
+00016f50: 696e 636f 6d70 6c65 7465 5f20 3d20 6472  incomplete_ = dr
+00016f60: 6f70 5f68 696e 7420 6966 2064 726f 705f  op_hint if drop_
+00016f70: 696e 636f 6d70 6c65 7465 2069 7320 4e6f  incomplete is No
+00016f80: 6e65 2065 6c73 6520 6472 6f70 5f69 6e63  ne else drop_inc
+00016f90: 6f6d 706c 6574 650a 2020 2020 2020 2020  omplete.        
+00016fa0: 2020 2020 2020 2020 6f68 6c63 765f 6466          ohlcv_df
+00016fb0: 203d 2073 656c 662e 5f70 726f 6365 7373   = self._process
+00016fc0: 5f6f 686c 6376 5f64 6628 0a20 2020 2020  _ohlcv_df(.     
+00016fd0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00016fe0: 6169 722c 2074 696d 6566 7261 6d65 2c20  air, timeframe, 
+00016ff0: 635f 7479 7065 2c20 7469 636b 732c 2063  c_type, ticks, c
+00017000: 6163 6865 2c20 6472 6f70 5f69 6e63 6f6d  ache, drop_incom
+00017010: 706c 6574 655f 290a 0a20 2020 2020 2020  plete_)..       
+00017020: 2020 2020 2020 2020 2072 6573 756c 7473           results
+00017030: 5f64 665b 2870 6169 722c 2074 696d 6566  _df[(pair, timef
+00017040: 7261 6d65 2c20 635f 7479 7065 295d 203d  rame, c_type)] =
+00017050: 206f 686c 6376 5f64 660a 0a20 2020 2020   ohlcv_df..     
+00017060: 2020 2023 2052 6574 7572 6e20 6361 6368     # Return cach
+00017070: 6564 206b 6c69 6e65 730a 2020 2020 2020  ed klines.      
+00017080: 2020 666f 7220 7061 6972 2c20 7469 6d65    for pair, time
+00017090: 6672 616d 652c 2063 5f74 7970 6520 696e  frame, c_type in
+000170a0: 2063 6163 6865 645f 7061 6972 733a 0a20   cached_pairs:. 
+000170b0: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+000170c0: 7473 5f64 665b 2870 6169 722c 2074 696d  ts_df[(pair, tim
+000170d0: 6566 7261 6d65 2c20 635f 7479 7065 295d  eframe, c_type)]
+000170e0: 203d 2073 656c 662e 6b6c 696e 6573 280a   = self.klines(.
+000170f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017100: 2870 6169 722c 2074 696d 6566 7261 6d65  (pair, timeframe
+00017110: 2c20 635f 7479 7065 292c 0a20 2020 2020  , c_type),.     
+00017120: 2020 2020 2020 2020 2020 2063 6f70 793d             copy=
+00017130: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00017140: 2020 290a 0a20 2020 2020 2020 2072 6574    )..        ret
+00017150: 7572 6e20 7265 7375 6c74 735f 6466 0a0a  urn results_df..
+00017160: 2020 2020 6465 6620 5f6e 6f77 5f69 735f      def _now_is_
+00017170: 7469 6d65 5f74 6f5f 7265 6672 6573 6828  time_to_refresh(
+00017180: 7365 6c66 2c20 7061 6972 3a20 7374 722c  self, pair: str,
+00017190: 2074 696d 6566 7261 6d65 3a20 7374 722c   timeframe: str,
+000171a0: 2063 616e 646c 655f 7479 7065 3a20 4361   candle_type: Ca
+000171b0: 6e64 6c65 5479 7065 2920 2d3e 2062 6f6f  ndleType) -> boo
+000171c0: 6c3a 0a20 2020 2020 2020 2023 2054 696d  l:.        # Tim
+000171d0: 6566 7261 6d65 2069 6e20 7365 636f 6e64  eframe in second
+000171e0: 730a 2020 2020 2020 2020 696e 7465 7276  s.        interv
+000171f0: 616c 5f69 6e5f 7365 6320 3d20 7469 6d65  al_in_sec = time
+00017200: 6672 616d 655f 746f 5f73 6563 6f6e 6473  frame_to_seconds
+00017210: 2874 696d 6566 7261 6d65 290a 2020 2020  (timeframe).    
+00017220: 2020 2020 706c 7220 3d20 7365 6c66 2e5f      plr = self._
+00017230: 7061 6972 735f 6c61 7374 5f72 6566 7265  pairs_last_refre
+00017240: 7368 5f74 696d 652e 6765 7428 2870 6169  sh_time.get((pai
+00017250: 722c 2074 696d 6566 7261 6d65 2c20 6361  r, timeframe, ca
+00017260: 6e64 6c65 5f74 7970 6529 2c20 3029 202b  ndle_type), 0) +
+00017270: 2069 6e74 6572 7661 6c5f 696e 5f73 6563   interval_in_sec
+00017280: 0a20 2020 2020 2020 2023 2063 7572 7265  .        # curre
+00017290: 6e74 2c61 6374 6976 6520 6361 6e64 6c65  nt,active candle
+000172a0: 206f 7065 6e20 6461 7465 0a20 2020 2020   open date.     
+000172b0: 2020 206e 6f77 203d 2069 6e74 2874 696d     now = int(tim
+000172c0: 6566 7261 6d65 5f74 6f5f 7072 6576 5f64  eframe_to_prev_d
+000172d0: 6174 6528 7469 6d65 6672 616d 6529 2e74  ate(timeframe).t
+000172e0: 696d 6573 7461 6d70 2829 290a 2020 2020  imestamp()).    
+000172f0: 2020 2020 7265 7475 726e 2070 6c72 203c      return plr <
+00017300: 206e 6f77 0a0a 2020 2020 4072 6574 7269   now..    @retri
+00017310: 6572 5f61 7379 6e63 0a20 2020 2061 7379  er_async.    asy
+00017320: 6e63 2064 6566 205f 6173 796e 635f 6765  nc def _async_ge
+00017330: 745f 6361 6e64 6c65 5f68 6973 746f 7279  t_candle_history
+00017340: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+00017350: 2020 2020 2020 2020 7061 6972 3a20 7374          pair: st
+00017360: 722c 0a20 2020 2020 2020 2074 696d 6566  r,.        timef
+00017370: 7261 6d65 3a20 7374 722c 0a20 2020 2020  rame: str,.     
+00017380: 2020 2063 616e 646c 655f 7479 7065 3a20     candle_type: 
+00017390: 4361 6e64 6c65 5479 7065 2c0a 2020 2020  CandleType,.    
+000173a0: 2020 2020 7369 6e63 655f 6d73 3a20 4f70      since_ms: Op
+000173b0: 7469 6f6e 616c 5b69 6e74 5d20 3d20 4e6f  tional[int] = No
+000173c0: 6e65 2c0a 2020 2020 2920 2d3e 204f 484c  ne,.    ) -> OHL
+000173d0: 4356 5265 7370 6f6e 7365 3a0a 2020 2020  CVResponse:.    
+000173e0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000173f0: 4173 796e 6368 726f 6e6f 7573 6c79 2067  Asynchronously g
+00017400: 6574 2063 616e 646c 6520 6869 7374 6f72  et candle histor
+00017410: 7920 6461 7461 2075 7369 6e67 2066 6574  y data using fet
+00017420: 6368 5f6f 686c 6376 0a20 2020 2020 2020  ch_ohlcv.       
+00017430: 203a 7061 7261 6d20 6361 6e64 6c65 5f74   :param candle_t
+00017440: 7970 653a 2027 272c 206d 6172 6b2c 2069  ype: '', mark, i
+00017450: 6e64 6578 2c20 7072 656d 6975 6d49 6e64  ndex, premiumInd
+00017460: 6578 2c20 6f72 2066 756e 6469 6e67 5f72  ex, or funding_r
+00017470: 6174 650a 2020 2020 2020 2020 7265 7475  ate.        retu
+00017480: 726e 7320 7475 706c 653a 2028 7061 6972  rns tuple: (pair
+00017490: 2c20 7469 6d65 6672 616d 652c 206f 686c  , timeframe, ohl
+000174a0: 6376 5f6c 6973 7429 0a20 2020 2020 2020  cv_list).       
+000174b0: 2022 2222 0a20 2020 2020 2020 2074 7279   """.        try
+000174c0: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+000174d0: 4665 7463 6820 4f48 4c43 5620 6173 796e  Fetch OHLCV asyn
+000174e0: 6368 726f 6e6f 7573 6c79 0a20 2020 2020  chronously.     
+000174f0: 2020 2020 2020 2073 203d 2027 2827 202b         s = '(' +
+00017500: 2064 745f 6672 6f6d 5f74 7328 7369 6e63   dt_from_ts(sinc
+00017510: 655f 6d73 292e 6973 6f66 6f72 6d61 7428  e_ms).isoformat(
+00017520: 2920 2b20 2729 2027 2069 6620 7369 6e63  ) + ') ' if sinc
+00017530: 655f 6d73 2069 7320 6e6f 7420 4e6f 6e65  e_ms is not None
+00017540: 2065 6c73 6520 2727 0a20 2020 2020 2020   else ''.       
+00017550: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
+00017560: 6728 0a20 2020 2020 2020 2020 2020 2020  g(.             
+00017570: 2020 2022 4665 7463 6869 6e67 2070 6169     "Fetching pai
+00017580: 7220 2573 2c20 2573 2c20 696e 7465 7276  r %s, %s, interv
+00017590: 616c 2025 732c 2073 696e 6365 2025 7320  al %s, since %s 
+000175a0: 2573 2e2e 2e22 2c0a 2020 2020 2020 2020  %s...",.        
+000175b0: 2020 2020 2020 2020 7061 6972 2c20 6361          pair, ca
+000175c0: 6e64 6c65 5f74 7970 652c 2074 696d 6566  ndle_type, timef
+000175d0: 7261 6d65 2c20 7369 6e63 655f 6d73 2c20  rame, since_ms, 
+000175e0: 730a 2020 2020 2020 2020 2020 2020 290a  s.            ).
+000175f0: 2020 2020 2020 2020 2020 2020 7061 7261              para
+00017600: 6d73 203d 2064 6565 7063 6f70 7928 7365  ms = deepcopy(se
+00017610: 6c66 2e5f 6674 5f68 6173 2e67 6574 2827  lf._ft_has.get('
+00017620: 6f68 6c63 765f 7061 7261 6d73 272c 207b  ohlcv_params', {
+00017630: 7d29 290a 2020 2020 2020 2020 2020 2020  })).            
+00017640: 6361 6e64 6c65 5f6c 696d 6974 203d 2073  candle_limit = s
+00017650: 656c 662e 6f68 6c63 765f 6361 6e64 6c65  elf.ohlcv_candle
+00017660: 5f6c 696d 6974 280a 2020 2020 2020 2020  _limit(.        
+00017670: 2020 2020 2020 2020 7469 6d65 6672 616d          timefram
+00017680: 652c 2063 616e 646c 655f 7479 7065 3d63  e, candle_type=c
+00017690: 616e 646c 655f 7479 7065 2c20 7369 6e63  andle_type, sinc
+000176a0: 655f 6d73 3d73 696e 6365 5f6d 7329 0a0a  e_ms=since_ms)..
+000176b0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+000176c0: 616e 646c 655f 7479 7065 2061 6e64 2063  andle_type and c
+000176d0: 616e 646c 655f 7479 7065 2021 3d20 4361  andle_type != Ca
+000176e0: 6e64 6c65 5479 7065 2e53 504f 543a 0a20  ndleType.SPOT:. 
+000176f0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00017700: 6172 616d 732e 7570 6461 7465 287b 2770  arams.update({'p
+00017710: 7269 6365 273a 2063 616e 646c 655f 7479  rice': candle_ty
+00017720: 7065 2e76 616c 7565 7d29 0a20 2020 2020  pe.value}).     
+00017730: 2020 2020 2020 2069 6620 6361 6e64 6c65         if candle
+00017740: 5f74 7970 6520 213d 2043 616e 646c 6554  _type != CandleT
+00017750: 7970 652e 4655 4e44 494e 475f 5241 5445  ype.FUNDING_RATE
+00017760: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00017770: 2020 6461 7461 203d 2061 7761 6974 2073    data = await s
+00017780: 656c 662e 5f61 7069 5f61 7379 6e63 2e66  elf._api_async.f
+00017790: 6574 6368 5f6f 686c 6376 280a 2020 2020  etch_ohlcv(.    
+000177a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000177b0: 7061 6972 2c20 7469 6d65 6672 616d 653d  pair, timeframe=
+000177c0: 7469 6d65 6672 616d 652c 2073 696e 6365  timeframe, since
+000177d0: 3d73 696e 6365 5f6d 732c 0a20 2020 2020  =since_ms,.     
+000177e0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+000177f0: 696d 6974 3d63 616e 646c 655f 6c69 6d69  imit=candle_limi
+00017800: 742c 2070 6172 616d 733d 7061 7261 6d73  t, params=params
+00017810: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00017820: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00017830: 2020 2020 2320 4675 6e64 696e 6720 7261      # Funding ra
+00017840: 7465 0a20 2020 2020 2020 2020 2020 2020  te.             
+00017850: 2020 2064 6174 6120 3d20 6177 6169 7420     data = await 
+00017860: 7365 6c66 2e5f 6665 7463 685f 6675 6e64  self._fetch_fund
+00017870: 696e 675f 7261 7465 5f68 6973 746f 7279  ing_rate_history
+00017880: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00017890: 2020 2020 2020 7061 6972 3d70 6169 722c        pair=pair,
+000178a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000178b0: 2020 2020 2074 696d 6566 7261 6d65 3d74       timeframe=t
+000178c0: 696d 6566 7261 6d65 2c0a 2020 2020 2020  imeframe,.      
+000178d0: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+000178e0: 6d69 743d 6361 6e64 6c65 5f6c 696d 6974  mit=candle_limit
+000178f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00017900: 2020 2020 2020 7369 6e63 655f 6d73 3d73        since_ms=s
+00017910: 696e 6365 5f6d 732c 0a20 2020 2020 2020  ince_ms,.       
+00017920: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00017930: 2020 2020 2020 2023 2053 6f6d 6520 6578         # Some ex
+00017940: 6368 616e 6765 7320 736f 7274 204f 484c  changes sort OHL
+00017950: 4356 2069 6e20 4153 4320 6f72 6465 7220  CV in ASC order 
+00017960: 616e 6420 6f74 6865 7273 2069 6e20 4445  and others in DE
+00017970: 5343 2e0a 2020 2020 2020 2020 2020 2020  SC..            
+00017980: 2320 4578 3a20 4269 7474 7265 7820 7265  # Ex: Bittrex re
+00017990: 7475 726e 7320 7468 6520 6c69 7374 206f  turns the list o
+000179a0: 6620 4f48 4c43 5620 696e 2041 5343 206f  f OHLCV in ASC o
+000179b0: 7264 6572 2028 6f6c 6465 7374 2066 6972  rder (oldest fir
+000179c0: 7374 2c20 6e65 7765 7374 206c 6173 7429  st, newest last)
+000179d0: 0a20 2020 2020 2020 2020 2020 2023 2077  .            # w
+000179e0: 6869 6c65 2047 4441 5820 7265 7475 726e  hile GDAX return
+000179f0: 7320 7468 6520 6c69 7374 206f 6620 4f48  s the list of OH
+00017a00: 4c43 5620 696e 2044 4553 4320 6f72 6465  LCV in DESC orde
+00017a10: 7220 286e 6577 6573 7420 6669 7273 742c  r (newest first,
+00017a20: 206f 6c64 6573 7420 6c61 7374 290a 2020   oldest last).  
+00017a30: 2020 2020 2020 2020 2020 2320 4f6e 6c79            # Only
+00017a40: 2073 6f72 7420 6966 206e 6563 6573 7361   sort if necessa
+00017a50: 7279 2074 6f20 7361 7665 2063 6f6d 7075  ry to save compu
+00017a60: 7469 6e67 2074 696d 650a 2020 2020 2020  ting time.      
+00017a70: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00017a80: 2020 2020 2020 2020 2020 2069 6620 6461             if da
+00017a90: 7461 2061 6e64 2064 6174 615b 305d 5b30  ta and data[0][0
+00017aa0: 5d20 3e20 6461 7461 5b2d 315d 5b30 5d3a  ] > data[-1][0]:
+00017ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017ac0: 2020 2020 2064 6174 6120 3d20 736f 7274       data = sort
+00017ad0: 6564 2864 6174 612c 206b 6579 3d6c 616d  ed(data, key=lam
+00017ae0: 6264 6120 783a 2078 5b30 5d29 0a20 2020  bda x: x[0]).   
+00017af0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00017b00: 496e 6465 7845 7272 6f72 3a0a 2020 2020  IndexError:.    
+00017b10: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+00017b20: 6572 2e65 7863 6570 7469 6f6e 2822 4572  er.exception("Er
+00017b30: 726f 7220 6c6f 6164 696e 6720 2573 2e20  ror loading %s. 
+00017b40: 5265 7375 6c74 2077 6173 2025 732e 222c  Result was %s.",
+00017b50: 2070 6169 722c 2064 6174 6129 0a20 2020   pair, data).   
+00017b60: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00017b70: 7572 6e20 7061 6972 2c20 7469 6d65 6672  urn pair, timefr
+00017b80: 616d 652c 2063 616e 646c 655f 7479 7065  ame, candle_type
+00017b90: 2c20 5b5d 2c20 7365 6c66 2e5f 6f68 6c63  , [], self._ohlc
+00017ba0: 765f 7061 7274 6961 6c5f 6361 6e64 6c65  v_partial_candle
+00017bb0: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+00017bc0: 6765 722e 6465 6275 6728 2244 6f6e 6520  ger.debug("Done 
+00017bd0: 6665 7463 6869 6e67 2070 6169 7220 2573  fetching pair %s
+00017be0: 2c20 696e 7465 7276 616c 2025 7320 2e2e  , interval %s ..
+00017bf0: 2e22 2c20 7061 6972 2c20 7469 6d65 6672  .", pair, timefr
+00017c00: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
+00017c10: 2072 6574 7572 6e20 7061 6972 2c20 7469   return pair, ti
+00017c20: 6d65 6672 616d 652c 2063 616e 646c 655f  meframe, candle_
+00017c30: 7479 7065 2c20 6461 7461 2c20 7365 6c66  type, data, self
+00017c40: 2e5f 6f68 6c63 765f 7061 7274 6961 6c5f  ._ohlcv_partial_
+00017c50: 6361 6e64 6c65 0a0a 2020 2020 2020 2020  candle..        
+00017c60: 6578 6365 7074 2063 6378 742e 4e6f 7453  except ccxt.NotS
+00017c70: 7570 706f 7274 6564 2061 7320 653a 0a20  upported as e:. 
+00017c80: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00017c90: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
+00017ca0: 7074 696f 6e28 0a20 2020 2020 2020 2020  ption(.         
+00017cb0: 2020 2020 2020 2066 2745 7863 6861 6e67         f'Exchang
+00017cc0: 6520 7b73 656c 662e 5f61 7069 2e6e 616d  e {self._api.nam
+00017cd0: 657d 2064 6f65 7320 6e6f 7420 7375 7070  e} does not supp
+00017ce0: 6f72 7420 6665 7463 6869 6e67 2068 6973  ort fetching his
+00017cf0: 746f 7269 6361 6c20 270a 2020 2020 2020  torical '.      
+00017d00: 2020 2020 2020 2020 2020 6627 6361 6e64            f'cand
+00017d10: 6c65 2028 4f48 4c43 5629 2064 6174 612e  le (OHLCV) data.
+00017d20: 204d 6573 7361 6765 3a20 7b65 7d27 2920   Message: {e}') 
+00017d30: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
+00017d40: 7863 6570 7420 6363 7874 2e44 446f 5350  xcept ccxt.DDoSP
+00017d50: 726f 7465 6374 696f 6e20 6173 2065 3a0a  rotection as e:.
+00017d60: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00017d70: 6520 4444 6f73 5072 6f74 6563 7469 6f6e  e DDosProtection
+00017d80: 2865 2920 6672 6f6d 2065 0a20 2020 2020  (e) from e.     
+00017d90: 2020 2065 7863 6570 7420 2863 6378 742e     except (ccxt.
+00017da0: 4e65 7477 6f72 6b45 7272 6f72 2c20 6363  NetworkError, cc
+00017db0: 7874 2e45 7863 6861 6e67 6545 7272 6f72  xt.ExchangeError
+00017dc0: 2920 6173 2065 3a0a 2020 2020 2020 2020  ) as e:.        
+00017dd0: 2020 2020 7261 6973 6520 5465 6d70 6f72      raise Tempor
+00017de0: 6172 7945 7272 6f72 2866 2743 6f75 6c64  aryError(f'Could
+00017df0: 206e 6f74 2066 6574 6368 2068 6973 746f   not fetch histo
+00017e00: 7269 6361 6c20 6361 6e64 6c65 2028 4f48  rical candle (OH
+00017e10: 4c43 5629 2064 6174 6120 270a 2020 2020  LCV) data '.    
 00017e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e30: 2020 2020 2020 6627 666f 7220 7061 6972        f'for pair
-00017e40: 207b 7061 6972 7d20 6475 6520 746f 207b   {pair} due to {
-00017e50: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
-00017e60: 6d65 5f5f 7d2e 2027 0a20 2020 2020 2020  me__}. '.       
+00017e30: 2020 2020 2020 2020 2020 2020 2066 2766               f'f
+00017e40: 6f72 2070 6169 7220 7b70 6169 727d 2064  or pair {pair} d
+00017e50: 7565 2074 6f20 7b65 2e5f 5f63 6c61 7373  ue to {e.__class
+00017e60: 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20 270a  __.__name__}. '.
 00017e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e80: 2020 2020 2020 2020 2020 6627 4d65 7373            f'Mess
-00017e90: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
-00017ea0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-00017eb0: 2063 6378 742e 4261 7365 4572 726f 7220   ccxt.BaseError 
-00017ec0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-00017ed0: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
-00017ee0: 6e61 6c45 7863 6570 7469 6f6e 2866 2743  nalException(f'C
-00017ef0: 6f75 6c64 206e 6f74 2066 6574 6368 2068  ould not fetch h
-00017f00: 6973 746f 7269 6361 6c20 6361 6e64 6c65  istorical candle
-00017f10: 2028 4f48 4c43 5629 2064 6174 6120 270a   (OHLCV) data '.
-00017f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e90: 2066 274d 6573 7361 6765 3a20 7b65 7d27   f'Message: {e}'
+00017ea0: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
+00017eb0: 2065 7863 6570 7420 6363 7874 2e42 6173   except ccxt.Bas
+00017ec0: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
+00017ed0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+00017ee0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
+00017ef0: 696f 6e28 6627 436f 756c 6420 6e6f 7420  ion(f'Could not 
+00017f00: 6665 7463 6820 6869 7374 6f72 6963 616c  fetch historical
+00017f10: 2063 616e 646c 6520 284f 484c 4356 2920   candle (OHLCV) 
+00017f20: 6461 7461 2027 0a20 2020 2020 2020 2020  data '.         
 00017f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f40: 2020 2020 2020 2066 2766 6f72 2070 6169         f'for pai
-00017f50: 7220 7b70 6169 727d 2e20 4d65 7373 6167  r {pair}. Messag
-00017f60: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
-00017f70: 0a20 2020 2061 7379 6e63 2064 6566 205f  .    async def _
-00017f80: 6665 7463 685f 6675 6e64 696e 675f 7261  fetch_funding_ra
-00017f90: 7465 5f68 6973 746f 7279 280a 2020 2020  te_history(.    
-00017fa0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00017fb0: 2020 7061 6972 3a20 7374 722c 0a20 2020    pair: str,.   
-00017fc0: 2020 2020 2074 696d 6566 7261 6d65 3a20       timeframe: 
-00017fd0: 7374 722c 0a20 2020 2020 2020 206c 696d  str,.        lim
-00017fe0: 6974 3a20 696e 742c 0a20 2020 2020 2020  it: int,.       
-00017ff0: 2073 696e 6365 5f6d 733a 204f 7074 696f   since_ms: Optio
-00018000: 6e61 6c5b 696e 745d 203d 204e 6f6e 652c  nal[int] = None,
-00018010: 0a20 2020 2029 202d 3e20 4c69 7374 5b4c  .    ) -> List[L
-00018020: 6973 745d 3a0a 2020 2020 2020 2020 2222  ist]:.        ""
-00018030: 220a 2020 2020 2020 2020 4665 7463 6820  ".        Fetch 
-00018040: 6675 6e64 696e 6720 7261 7465 2068 6973  funding rate his
-00018050: 746f 7279 202d 2075 7365 6420 746f 2073  tory - used to s
-00018060: 656c 6563 7469 7665 6c79 206f 7665 7272  electively overr
-00018070: 6964 6520 7468 6973 2062 7920 7375 6263  ide this by subc
-00018080: 6c61 7373 6573 2e0a 2020 2020 2020 2020  lasses..        
-00018090: 2222 220a 2020 2020 2020 2020 2320 4675  """.        # Fu
-000180a0: 6e64 696e 6720 7261 7465 0a20 2020 2020  nding rate.     
-000180b0: 2020 2064 6174 6120 3d20 6177 6169 7420     data = await 
-000180c0: 7365 6c66 2e5f 6170 695f 6173 796e 632e  self._api_async.
-000180d0: 6665 7463 685f 6675 6e64 696e 675f 7261  fetch_funding_ra
-000180e0: 7465 5f68 6973 746f 7279 280a 2020 2020  te_history(.    
-000180f0: 2020 2020 2020 2020 7061 6972 2c20 7369          pair, si
-00018100: 6e63 653d 7369 6e63 655f 6d73 2c0a 2020  nce=since_ms,.  
-00018110: 2020 2020 2020 2020 2020 6c69 6d69 743d            limit=
-00018120: 6c69 6d69 7429 0a20 2020 2020 2020 2023  limit).        #
-00018130: 2043 6f6e 7665 7274 2066 756e 6469 6e67   Convert funding
-00018140: 2072 6174 6520 746f 2063 616e 646c 6520   rate to candle 
-00018150: 7061 7474 6572 6e0a 2020 2020 2020 2020  pattern.        
-00018160: 6461 7461 203d 205b 5b78 5b27 7469 6d65  data = [[x['time
-00018170: 7374 616d 7027 5d2c 2078 5b27 6675 6e64  stamp'], x['fund
-00018180: 696e 6752 6174 6527 5d2c 2030 2c20 302c  ingRate'], 0, 0,
-00018190: 2030 2c20 305d 2066 6f72 2078 2069 6e20   0, 0] for x in 
-000181a0: 6461 7461 5d0a 2020 2020 2020 2020 7265  data].        re
-000181b0: 7475 726e 2064 6174 610a 0a20 2020 2023  turn data..    #
-000181c0: 2046 6574 6368 2068 6973 746f 7269 6320   Fetch historic 
-000181d0: 7472 6164 6573 0a0a 2020 2020 4072 6574  trades..    @ret
-000181e0: 7269 6572 5f61 7379 6e63 0a20 2020 2061  rier_async.    a
-000181f0: 7379 6e63 2064 6566 205f 6173 796e 635f  sync def _async_
-00018200: 6665 7463 685f 7472 6164 6573 2873 656c  fetch_trades(sel
-00018210: 662c 2070 6169 723a 2073 7472 2c0a 2020  f, pair: str,.  
-00018220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017f40: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+00017f50: 666f 7220 7061 6972 207b 7061 6972 7d2e  for pair {pair}.
+00017f60: 204d 6573 7361 6765 3a20 7b65 7d27 2920   Message: {e}') 
+00017f70: 6672 6f6d 2065 0a0a 2020 2020 6173 796e  from e..    asyn
+00017f80: 6320 6465 6620 5f66 6574 6368 5f66 756e  c def _fetch_fun
+00017f90: 6469 6e67 5f72 6174 655f 6869 7374 6f72  ding_rate_histor
+00017fa0: 7928 0a20 2020 2020 2020 2073 656c 662c  y(.        self,
+00017fb0: 0a20 2020 2020 2020 2070 6169 723a 2073  .        pair: s
+00017fc0: 7472 2c0a 2020 2020 2020 2020 7469 6d65  tr,.        time
+00017fd0: 6672 616d 653a 2073 7472 2c0a 2020 2020  frame: str,.    
+00017fe0: 2020 2020 6c69 6d69 743a 2069 6e74 2c0a      limit: int,.
+00017ff0: 2020 2020 2020 2020 7369 6e63 655f 6d73          since_ms
+00018000: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
+00018010: 3d20 4e6f 6e65 2c0a 2020 2020 2920 2d3e  = None,.    ) ->
+00018020: 204c 6973 745b 4c69 7374 5d3a 0a20 2020   List[List]:.   
+00018030: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00018040: 2046 6574 6368 2066 756e 6469 6e67 2072   Fetch funding r
+00018050: 6174 6520 6869 7374 6f72 7920 2d20 7573  ate history - us
+00018060: 6564 2074 6f20 7365 6c65 6374 6976 656c  ed to selectivel
+00018070: 7920 6f76 6572 7269 6465 2074 6869 7320  y override this 
+00018080: 6279 2073 7562 636c 6173 7365 732e 0a20  by subclasses.. 
+00018090: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000180a0: 2020 2023 2046 756e 6469 6e67 2072 6174     # Funding rat
+000180b0: 650a 2020 2020 2020 2020 6461 7461 203d  e.        data =
+000180c0: 2061 7761 6974 2073 656c 662e 5f61 7069   await self._api
+000180d0: 5f61 7379 6e63 2e66 6574 6368 5f66 756e  _async.fetch_fun
+000180e0: 6469 6e67 5f72 6174 655f 6869 7374 6f72  ding_rate_histor
+000180f0: 7928 0a20 2020 2020 2020 2020 2020 2070  y(.            p
+00018100: 6169 722c 2073 696e 6365 3d73 696e 6365  air, since=since
+00018110: 5f6d 732c 0a20 2020 2020 2020 2020 2020  _ms,.           
+00018120: 206c 696d 6974 3d6c 696d 6974 290a 2020   limit=limit).  
+00018130: 2020 2020 2020 2320 436f 6e76 6572 7420        # Convert 
+00018140: 6675 6e64 696e 6720 7261 7465 2074 6f20  funding rate to 
+00018150: 6361 6e64 6c65 2070 6174 7465 726e 0a20  candle pattern. 
+00018160: 2020 2020 2020 2064 6174 6120 3d20 5b5b         data = [[
+00018170: 785b 2774 696d 6573 7461 6d70 275d 2c20  x['timestamp'], 
+00018180: 785b 2766 756e 6469 6e67 5261 7465 275d  x['fundingRate']
+00018190: 2c20 302c 2030 2c20 302c 2030 5d20 666f  , 0, 0, 0, 0] fo
+000181a0: 7220 7820 696e 2064 6174 615d 0a20 2020  r x in data].   
+000181b0: 2020 2020 2072 6574 7572 6e20 6461 7461       return data
+000181c0: 0a0a 2020 2020 2320 4665 7463 6820 6869  ..    # Fetch hi
+000181d0: 7374 6f72 6963 2074 7261 6465 730a 0a20  storic trades.. 
+000181e0: 2020 2040 7265 7472 6965 725f 6173 796e     @retrier_asyn
+000181f0: 630a 2020 2020 6173 796e 6320 6465 6620  c.    async def 
+00018200: 5f61 7379 6e63 5f66 6574 6368 5f74 7261  _async_fetch_tra
+00018210: 6465 7328 7365 6c66 2c20 7061 6972 3a20  des(self, pair: 
+00018220: 7374 722c 0a20 2020 2020 2020 2020 2020  str,.           
 00018230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018240: 7369 6e63 653a 204f 7074 696f 6e61 6c5b  since: Optional[
-00018250: 696e 745d 203d 204e 6f6e 652c 0a20 2020  int] = None,.   
-00018260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018270: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00018280: 6172 616d 733a 204f 7074 696f 6e61 6c5b  arams: Optional[
-00018290: 6469 6374 5d20 3d20 4e6f 6e65 2920 2d3e  dict] = None) ->
-000182a0: 204c 6973 745b 4c69 7374 5d3a 0a20 2020   List[List]:.   
-000182b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000182c0: 2041 7379 6e63 726f 6e6f 7573 6c79 2067   Asyncronously g
-000182d0: 6574 7320 7472 6164 6520 6869 7374 6f72  ets trade histor
-000182e0: 7920 7573 696e 6720 6665 7463 685f 7472  y using fetch_tr
-000182f0: 6164 6573 2e0a 2020 2020 2020 2020 4861  ades..        Ha
-00018300: 6e64 6c65 7320 6578 6368 616e 6765 2065  ndles exchange e
-00018310: 7272 6f72 732c 2064 6f65 7320 6f6e 6520  rrors, does one 
-00018320: 6361 6c6c 2074 6f20 7468 6520 6578 6368  call to the exch
-00018330: 616e 6765 2e0a 2020 2020 2020 2020 3a70  ange..        :p
-00018340: 6172 616d 2070 6169 723a 2050 6169 7220  aram pair: Pair 
-00018350: 746f 2066 6574 6368 2074 7261 6465 2064  to fetch trade d
-00018360: 6174 6120 666f 720a 2020 2020 2020 2020  ata for.        
-00018370: 3a70 6172 616d 2073 696e 6365 3a20 5369  :param since: Si
-00018380: 6e63 6520 6173 2069 6e74 6567 6572 2074  nce as integer t
-00018390: 696d 6573 7461 6d70 2069 6e20 6d69 6c6c  imestamp in mill
-000183a0: 6973 6563 6f6e 6473 0a20 2020 2020 2020  iseconds.       
-000183b0: 2072 6574 7572 6e73 3a20 4c69 7374 206f   returns: List o
-000183c0: 6620 6469 6374 7320 636f 6e74 6169 6e69  f dicts containi
-000183d0: 6e67 2074 7261 6465 730a 2020 2020 2020  ng trades.      
-000183e0: 2020 2222 220a 2020 2020 2020 2020 7472    """.        tr
-000183f0: 793a 0a20 2020 2020 2020 2020 2020 2023  y:.            #
-00018400: 2066 6574 6368 2074 7261 6465 7320 6173   fetch trades as
-00018410: 796e 6368 726f 6e6f 7573 6c79 0a20 2020  ynchronously.   
-00018420: 2020 2020 2020 2020 2069 6620 7061 7261           if para
-00018430: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-00018440: 2020 2020 6c6f 6767 6572 2e64 6562 7567      logger.debug
-00018450: 2822 4665 7463 6869 6e67 2074 7261 6465  ("Fetching trade
-00018460: 7320 666f 7220 7061 6972 2025 732c 2070  s for pair %s, p
-00018470: 6172 616d 733a 2025 7320 222c 2070 6169  arams: %s ", pai
-00018480: 722c 2070 6172 616d 7329 0a20 2020 2020  r, params).     
-00018490: 2020 2020 2020 2020 2020 2074 7261 6465             trade
-000184a0: 7320 3d20 6177 6169 7420 7365 6c66 2e5f  s = await self._
-000184b0: 6170 695f 6173 796e 632e 6665 7463 685f  api_async.fetch_
-000184c0: 7472 6164 6573 2870 6169 722c 2070 6172  trades(pair, par
-000184d0: 616d 733d 7061 7261 6d73 2c20 6c69 6d69  ams=params, limi
-000184e0: 743d 3130 3030 290a 2020 2020 2020 2020  t=1000).        
-000184f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00018500: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-00018510: 2e64 6562 7567 280a 2020 2020 2020 2020  .debug(.        
-00018520: 2020 2020 2020 2020 2020 2020 2246 6574              "Fet
-00018530: 6368 696e 6720 7472 6164 6573 2066 6f72  ching trades for
-00018540: 2070 6169 7220 2573 2c20 7369 6e63 6520   pair %s, since 
-00018550: 2573 2025 732e 2e2e 222c 0a20 2020 2020  %s %s...",.     
-00018560: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00018570: 6169 722c 2073 696e 6365 2c0a 2020 2020  air, since,.    
-00018580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018590: 2728 2720 2b20 6474 5f66 726f 6d5f 7473  '(' + dt_from_ts
-000185a0: 2873 696e 6365 292e 6973 6f66 6f72 6d61  (since).isoforma
-000185b0: 7428 2920 2b20 2729 2027 2069 6620 7369  t() + ') ' if si
-000185c0: 6e63 6520 6973 206e 6f74 204e 6f6e 6520  nce is not None 
-000185d0: 656c 7365 2027 270a 2020 2020 2020 2020  else ''.        
-000185e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000185f0: 2020 2020 2020 2020 2020 7472 6164 6573            trades
-00018600: 203d 2061 7761 6974 2073 656c 662e 5f61   = await self._a
-00018610: 7069 5f61 7379 6e63 2e66 6574 6368 5f74  pi_async.fetch_t
-00018620: 7261 6465 7328 7061 6972 2c20 7369 6e63  rades(pair, sinc
-00018630: 653d 7369 6e63 652c 206c 696d 6974 3d31  e=since, limit=1
-00018640: 3030 3029 0a20 2020 2020 2020 2020 2020  000).           
-00018650: 2074 7261 6465 7320 3d20 7365 6c66 2e5f   trades = self._
-00018660: 7472 6164 6573 5f63 6f6e 7472 6163 7473  trades_contracts
-00018670: 5f74 6f5f 616d 6f75 6e74 2874 7261 6465  _to_amount(trade
-00018680: 7329 0a20 2020 2020 2020 2020 2020 2072  s).            r
-00018690: 6574 7572 6e20 7472 6164 6573 5f64 6963  eturn trades_dic
-000186a0: 745f 746f 5f6c 6973 7428 7472 6164 6573  t_to_list(trades
-000186b0: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-000186c0: 2063 6378 742e 4e6f 7453 7570 706f 7274   ccxt.NotSupport
-000186d0: 6564 2061 7320 653a 0a20 2020 2020 2020  ed as e:.       
-000186e0: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
-000186f0: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
-00018700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018710: 2066 2745 7863 6861 6e67 6520 7b73 656c   f'Exchange {sel
-00018720: 662e 5f61 7069 2e6e 616d 657d 2064 6f65  f._api.name} doe
-00018730: 7320 6e6f 7420 7375 7070 6f72 7420 6665  s not support fe
-00018740: 7463 6869 6e67 2068 6973 746f 7269 6361  tching historica
-00018750: 6c20 7472 6164 6520 6461 7461 2e27 0a20  l trade data.'. 
-00018760: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00018770: 274d 6573 7361 6765 3a20 7b65 7d27 2920  'Message: {e}') 
-00018780: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
-00018790: 7863 6570 7420 6363 7874 2e44 446f 5350  xcept ccxt.DDoSP
-000187a0: 726f 7465 6374 696f 6e20 6173 2065 3a0a  rotection as e:.
-000187b0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000187c0: 6520 4444 6f73 5072 6f74 6563 7469 6f6e  e DDosProtection
-000187d0: 2865 2920 6672 6f6d 2065 0a20 2020 2020  (e) from e.     
-000187e0: 2020 2065 7863 6570 7420 2863 6378 742e     except (ccxt.
-000187f0: 4e65 7477 6f72 6b45 7272 6f72 2c20 6363  NetworkError, cc
-00018800: 7874 2e45 7863 6861 6e67 6545 7272 6f72  xt.ExchangeError
-00018810: 2920 6173 2065 3a0a 2020 2020 2020 2020  ) as e:.        
-00018820: 2020 2020 7261 6973 6520 5465 6d70 6f72      raise Tempor
-00018830: 6172 7945 7272 6f72 2866 2743 6f75 6c64  aryError(f'Could
-00018840: 206e 6f74 206c 6f61 6420 7472 6164 6520   not load trade 
-00018850: 6869 7374 6f72 7920 6475 6520 746f 207b  history due to {
-00018860: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
-00018870: 6d65 5f5f 7d2e 2027 0a20 2020 2020 2020  me__}. '.       
+00018240: 2020 2020 2020 2073 696e 6365 3a20 4f70         since: Op
+00018250: 7469 6f6e 616c 5b69 6e74 5d20 3d20 4e6f  tional[int] = No
+00018260: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+00018270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018280: 2020 2020 2020 7061 7261 6d73 3a20 4f70        params: Op
+00018290: 7469 6f6e 616c 5b64 6963 745d 203d 204e  tional[dict] = N
+000182a0: 6f6e 6529 202d 3e20 4c69 7374 5b4c 6973  one) -> List[Lis
+000182b0: 745d 3a0a 2020 2020 2020 2020 2222 220a  t]:.        """.
+000182c0: 2020 2020 2020 2020 4173 796e 6372 6f6e          Asyncron
+000182d0: 6f75 736c 7920 6765 7473 2074 7261 6465  ously gets trade
+000182e0: 2068 6973 746f 7279 2075 7369 6e67 2066   history using f
+000182f0: 6574 6368 5f74 7261 6465 732e 0a20 2020  etch_trades..   
+00018300: 2020 2020 2048 616e 646c 6573 2065 7863       Handles exc
+00018310: 6861 6e67 6520 6572 726f 7273 2c20 646f  hange errors, do
+00018320: 6573 206f 6e65 2063 616c 6c20 746f 2074  es one call to t
+00018330: 6865 2065 7863 6861 6e67 652e 0a20 2020  he exchange..   
+00018340: 2020 2020 203a 7061 7261 6d20 7061 6972       :param pair
+00018350: 3a20 5061 6972 2074 6f20 6665 7463 6820  : Pair to fetch 
+00018360: 7472 6164 6520 6461 7461 2066 6f72 0a20  trade data for. 
+00018370: 2020 2020 2020 203a 7061 7261 6d20 7369         :param si
+00018380: 6e63 653a 2053 696e 6365 2061 7320 696e  nce: Since as in
+00018390: 7465 6765 7220 7469 6d65 7374 616d 7020  teger timestamp 
+000183a0: 696e 206d 696c 6c69 7365 636f 6e64 730a  in milliseconds.
+000183b0: 2020 2020 2020 2020 7265 7475 726e 733a          returns:
+000183c0: 204c 6973 7420 6f66 2064 6963 7473 2063   List of dicts c
+000183d0: 6f6e 7461 696e 696e 6720 7472 6164 6573  ontaining trades
+000183e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000183f0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00018400: 2020 2020 2020 2320 6665 7463 6820 7472        # fetch tr
+00018410: 6164 6573 2061 7379 6e63 6872 6f6e 6f75  ades asynchronou
+00018420: 736c 790a 2020 2020 2020 2020 2020 2020  sly.            
+00018430: 6966 2070 6172 616d 733a 0a20 2020 2020  if params:.     
+00018440: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+00018450: 722e 6465 6275 6728 2246 6574 6368 696e  r.debug("Fetchin
+00018460: 6720 7472 6164 6573 2066 6f72 2070 6169  g trades for pai
+00018470: 7220 2573 2c20 7061 7261 6d73 3a20 2573  r %s, params: %s
+00018480: 2022 2c20 7061 6972 2c20 7061 7261 6d73   ", pair, params
+00018490: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000184a0: 2020 7472 6164 6573 203d 2061 7761 6974    trades = await
+000184b0: 2073 656c 662e 5f61 7069 5f61 7379 6e63   self._api_async
+000184c0: 2e66 6574 6368 5f74 7261 6465 7328 7061  .fetch_trades(pa
+000184d0: 6972 2c20 7061 7261 6d73 3d70 6172 616d  ir, params=param
+000184e0: 732c 206c 696d 6974 3d31 3030 3029 0a20  s, limit=1000). 
+000184f0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00018500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018510: 206c 6f67 6765 722e 6465 6275 6728 0a20   logger.debug(. 
+00018520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018530: 2020 2022 4665 7463 6869 6e67 2074 7261     "Fetching tra
+00018540: 6465 7320 666f 7220 7061 6972 2025 732c  des for pair %s,
+00018550: 2073 696e 6365 2025 7320 2573 2e2e 2e22   since %s %s..."
+00018560: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00018570: 2020 2020 2020 7061 6972 2c20 7369 6e63        pair, sinc
+00018580: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00018590: 2020 2020 2020 2027 2827 202b 2064 745f         '(' + dt_
+000185a0: 6672 6f6d 5f74 7328 7369 6e63 6529 2e69  from_ts(since).i
+000185b0: 736f 666f 726d 6174 2829 202b 2027 2920  soformat() + ') 
+000185c0: 2720 6966 2073 696e 6365 2069 7320 6e6f  ' if since is no
+000185d0: 7420 4e6f 6e65 2065 6c73 6520 2727 0a20  t None else ''. 
+000185e0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000185f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018600: 2074 7261 6465 7320 3d20 6177 6169 7420   trades = await 
+00018610: 7365 6c66 2e5f 6170 695f 6173 796e 632e  self._api_async.
+00018620: 6665 7463 685f 7472 6164 6573 2870 6169  fetch_trades(pai
+00018630: 722c 2073 696e 6365 3d73 696e 6365 2c20  r, since=since, 
+00018640: 6c69 6d69 743d 3130 3030 290a 2020 2020  limit=1000).    
+00018650: 2020 2020 2020 2020 7472 6164 6573 203d          trades =
+00018660: 2073 656c 662e 5f74 7261 6465 735f 636f   self._trades_co
+00018670: 6e74 7261 6374 735f 746f 5f61 6d6f 756e  ntracts_to_amoun
+00018680: 7428 7472 6164 6573 290a 2020 2020 2020  t(trades).      
+00018690: 2020 2020 2020 7265 7475 726e 2074 7261        return tra
+000186a0: 6465 735f 6469 6374 5f74 6f5f 6c69 7374  des_dict_to_list
+000186b0: 2874 7261 6465 7329 0a20 2020 2020 2020  (trades).       
+000186c0: 2065 7863 6570 7420 6363 7874 2e4e 6f74   except ccxt.Not
+000186d0: 5375 7070 6f72 7465 6420 6173 2065 3a0a  Supported as e:.
+000186e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000186f0: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
+00018700: 6570 7469 6f6e 280a 2020 2020 2020 2020  eption(.        
+00018710: 2020 2020 2020 2020 6627 4578 6368 616e          f'Exchan
+00018720: 6765 207b 7365 6c66 2e5f 6170 692e 6e61  ge {self._api.na
+00018730: 6d65 7d20 646f 6573 206e 6f74 2073 7570  me} does not sup
+00018740: 706f 7274 2066 6574 6368 696e 6720 6869  port fetching hi
+00018750: 7374 6f72 6963 616c 2074 7261 6465 2064  storical trade d
+00018760: 6174 612e 270a 2020 2020 2020 2020 2020  ata.'.          
+00018770: 2020 2020 2020 6627 4d65 7373 6167 653a        f'Message:
+00018780: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
+00018790: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
+000187a0: 742e 4444 6f53 5072 6f74 6563 7469 6f6e  t.DDoSProtection
+000187b0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+000187c0: 2020 2072 6169 7365 2044 446f 7350 726f     raise DDosPro
+000187d0: 7465 6374 696f 6e28 6529 2066 726f 6d20  tection(e) from 
+000187e0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+000187f0: 2028 6363 7874 2e4e 6574 776f 726b 4572   (ccxt.NetworkEr
+00018800: 726f 722c 2063 6378 742e 4578 6368 616e  ror, ccxt.Exchan
+00018810: 6765 4572 726f 7229 2061 7320 653a 0a20  geError) as e:. 
+00018820: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00018830: 2054 656d 706f 7261 7279 4572 726f 7228   TemporaryError(
+00018840: 6627 436f 756c 6420 6e6f 7420 6c6f 6164  f'Could not load
+00018850: 2074 7261 6465 2068 6973 746f 7279 2064   trade history d
+00018860: 7565 2074 6f20 7b65 2e5f 5f63 6c61 7373  ue to {e.__class
+00018870: 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20 270a  __.__name__}. '.
 00018880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018890: 2020 2020 2020 2020 2020 6627 4d65 7373            f'Mess
-000188a0: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
-000188b0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-000188c0: 2063 6378 742e 4261 7365 4572 726f 7220   ccxt.BaseError 
-000188d0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-000188e0: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
-000188f0: 6e61 6c45 7863 6570 7469 6f6e 2866 2743  nalException(f'C
-00018900: 6f75 6c64 206e 6f74 2066 6574 6368 2074  ould not fetch t
-00018910: 7261 6465 2064 6174 612e 204d 7367 3a20  rade data. Msg: 
-00018920: 7b65 7d27 2920 6672 6f6d 2065 0a0a 2020  {e}') from e..  
-00018930: 2020 6173 796e 6320 6465 6620 5f61 7379    async def _asy
-00018940: 6e63 5f67 6574 5f74 7261 6465 5f68 6973  nc_get_trade_his
-00018950: 746f 7279 5f69 6428 7365 6c66 2c20 7061  tory_id(self, pa
-00018960: 6972 3a20 7374 722c 0a20 2020 2020 2020  ir: str,.       
+00018890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188a0: 2066 274d 6573 7361 6765 3a20 7b65 7d27   f'Message: {e}'
+000188b0: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
+000188c0: 2065 7863 6570 7420 6363 7874 2e42 6173   except ccxt.Bas
+000188d0: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
+000188e0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+000188f0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
+00018900: 696f 6e28 6627 436f 756c 6420 6e6f 7420  ion(f'Could not 
+00018910: 6665 7463 6820 7472 6164 6520 6461 7461  fetch trade data
+00018920: 2e20 4d73 673a 207b 657d 2729 2066 726f  . Msg: {e}') fro
+00018930: 6d20 650a 0a20 2020 2061 7379 6e63 2064  m e..    async d
+00018940: 6566 205f 6173 796e 635f 6765 745f 7472  ef _async_get_tr
+00018950: 6164 655f 6869 7374 6f72 795f 6964 2873  ade_history_id(s
+00018960: 656c 662c 2070 6169 723a 2073 7472 2c0a  elf, pair: str,.
 00018970: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00018980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018990: 2020 2075 6e74 696c 3a20 696e 742c 0a20     until: int,. 
-000189a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018990: 2020 2020 2020 2020 2020 756e 7469 6c3a            until:
+000189a0: 2069 6e74 2c0a 2020 2020 2020 2020 2020   int,.          
 000189b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000189c0: 2020 2020 2020 2020 2073 696e 6365 3a20           since: 
-000189d0: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
-000189e0: 4e6f 6e65 2c0a 2020 2020 2020 2020 2020  None,.          
+000189c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000189d0: 7369 6e63 653a 204f 7074 696f 6e61 6c5b  since: Optional[
+000189e0: 696e 745d 203d 204e 6f6e 652c 0a20 2020  int] = None,.   
 000189f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00018a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018a10: 6672 6f6d 5f69 643a 204f 7074 696f 6e61  from_id: Optiona
-00018a20: 6c5b 7374 725d 203d 204e 6f6e 6529 202d  l[str] = None) -
-00018a30: 3e20 5475 706c 655b 7374 722c 204c 6973  > Tuple[str, Lis
-00018a40: 745b 4c69 7374 5d5d 3a0a 2020 2020 2020  t[List]]:.      
-00018a50: 2020 2222 220a 2020 2020 2020 2020 4173    """.        As
-00018a60: 796e 6372 6f6e 6f75 736c 7920 6765 7473  yncronously gets
-00018a70: 2074 7261 6465 2068 6973 746f 7279 2075   trade history u
-00018a80: 7369 6e67 2066 6574 6368 5f74 7261 6465  sing fetch_trade
-00018a90: 730a 2020 2020 2020 2020 7573 6520 7468  s.        use th
-00018aa0: 6973 2077 6865 6e20 6578 6368 616e 6765  is when exchange
-00018ab0: 2075 7365 7320 6964 2d62 6173 6564 2069   uses id-based i
-00018ac0: 7465 7261 7469 6f6e 2028 6368 6563 6b20  teration (check 
-00018ad0: 6073 656c 662e 5f74 7261 6465 735f 7061  `self._trades_pa
-00018ae0: 6769 6e61 7469 6f6e 6029 0a20 2020 2020  gination`).     
-00018af0: 2020 203a 7061 7261 6d20 7061 6972 3a20     :param pair: 
-00018b00: 5061 6972 2074 6f20 6665 7463 6820 7472  Pair to fetch tr
-00018b10: 6164 6520 6461 7461 2066 6f72 0a20 2020  ade data for.   
-00018b20: 2020 2020 203a 7061 7261 6d20 7369 6e63       :param sinc
-00018b30: 653a 2053 696e 6365 2061 7320 696e 7465  e: Since as inte
-00018b40: 6765 7220 7469 6d65 7374 616d 7020 696e  ger timestamp in
-00018b50: 206d 696c 6c69 7365 636f 6e64 730a 2020   milliseconds.  
-00018b60: 2020 2020 2020 3a70 6172 616d 2075 6e74        :param unt
-00018b70: 696c 3a20 556e 7469 6c20 6173 2069 6e74  il: Until as int
-00018b80: 6567 6572 2074 696d 6573 7461 6d70 2069  eger timestamp i
-00018b90: 6e20 6d69 6c6c 6973 6563 6f6e 6473 0a20  n milliseconds. 
-00018ba0: 2020 2020 2020 203a 7061 7261 6d20 6672         :param fr
-00018bb0: 6f6d 5f69 643a 2044 6f77 6e6c 6f61 6420  om_id: Download 
-00018bc0: 6461 7461 2073 7461 7274 696e 6720 7769  data starting wi
-00018bd0: 7468 2049 4420 2869 6620 6964 2069 7320  th ID (if id is 
-00018be0: 6b6e 6f77 6e29 2e20 4967 6e6f 7265 7320  known). Ignores 
-00018bf0: 2273 696e 6365 2220 6966 2073 6574 2e0a  "since" if set..
-00018c00: 2020 2020 2020 2020 7265 7475 726e 7320          returns 
-00018c10: 7475 706c 653a 2028 7061 6972 2c20 7472  tuple: (pair, tr
-00018c20: 6164 6573 2d6c 6973 7429 0a20 2020 2020  ades-list).     
-00018c30: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00018c40: 7472 6164 6573 3a20 4c69 7374 5b4c 6973  trades: List[Lis
-00018c50: 745d 203d 205b 5d0a 0a20 2020 2020 2020  t] = []..       
-00018c60: 2069 6620 6e6f 7420 6672 6f6d 5f69 643a   if not from_id:
-00018c70: 0a20 2020 2020 2020 2020 2020 2023 2046  .            # F
-00018c80: 6574 6368 2066 6972 7374 2065 6c65 6d65  etch first eleme
-00018c90: 6e74 7320 7573 696e 6720 7469 6d65 6261  nts using timeba
-00018ca0: 7365 6420 6d65 7468 6f64 2074 6f20 6765  sed method to ge
-00018cb0: 7420 616e 2049 4420 746f 2070 6167 696e  t an ID to pagin
-00018cc0: 6174 6520 6f6e 0a20 2020 2020 2020 2020  ate on.         
-00018cd0: 2020 2023 2044 6570 656e 6469 6e67 206f     # Depending o
-00018ce0: 6e20 7468 6520 4578 6368 616e 6765 2c20  n the Exchange, 
-00018cf0: 7468 6973 2063 616e 2069 6e74 726f 6475  this can introdu
-00018d00: 6365 2061 2064 7269 6674 2061 7420 7468  ce a drift at th
-00018d10: 6520 7374 6172 7420 6f66 2074 6865 2069  e start of the i
-00018d20: 6e74 6572 7661 6c0a 2020 2020 2020 2020  nterval.        
-00018d30: 2020 2020 2320 6f66 2075 7020 746f 2061      # of up to a
-00018d40: 6e20 686f 7572 2e0a 2020 2020 2020 2020  n hour..        
-00018d50: 2020 2020 2320 652e 672e 2042 696e 616e      # e.g. Binan
-00018d60: 6365 2072 6574 7572 6e73 2074 6865 2022  ce returns the "
-00018d70: 6c61 7374 2031 3030 3022 2063 616e 646c  last 1000" candl
-00018d80: 6573 2077 6974 6869 6e20 6120 3168 2074  es within a 1h t
-00018d90: 696d 6520 696e 7465 7276 616c 0a20 2020  ime interval.   
-00018da0: 2020 2020 2020 2020 2023 202d 2073 6f20           # - so 
-00018db0: 7765 2077 696c 6c20 6d69 7373 2074 6865  we will miss the
-00018dc0: 2066 6972 7374 2074 7261 6465 732e 0a20   first trades.. 
-00018dd0: 2020 2020 2020 2020 2020 2074 203d 2061             t = a
-00018de0: 7761 6974 2073 656c 662e 5f61 7379 6e63  wait self._async
-00018df0: 5f66 6574 6368 5f74 7261 6465 7328 7061  _fetch_trades(pa
-00018e00: 6972 2c20 7369 6e63 653d 7369 6e63 6529  ir, since=since)
-00018e10: 0a20 2020 2020 2020 2020 2020 2023 2044  .            # D
-00018e20: 4546 4155 4c54 5f54 5241 4445 535f 434f  EFAULT_TRADES_CO
-00018e30: 4c55 4d4e 533a 2030 202d 3e20 7469 6d65  LUMNS: 0 -> time
-00018e40: 7374 616d 700a 2020 2020 2020 2020 2020  stamp.          
-00018e50: 2020 2320 4445 4641 554c 545f 5452 4144    # DEFAULT_TRAD
-00018e60: 4553 5f43 4f4c 554d 4e53 3a20 3120 2d3e  ES_COLUMNS: 1 ->
-00018e70: 2069 640a 2020 2020 2020 2020 2020 2020   id.            
-00018e80: 6672 6f6d 5f69 6420 3d20 745b 2d31 5d5b  from_id = t[-1][
-00018e90: 315d 0a20 2020 2020 2020 2020 2020 2074  1].            t
-00018ea0: 7261 6465 732e 6578 7465 6e64 2874 5b3a  rades.extend(t[:
-00018eb0: 2d31 5d29 0a20 2020 2020 2020 2077 6869  -1]).        whi
-00018ec0: 6c65 2054 7275 653a 0a20 2020 2020 2020  le True:.       
-00018ed0: 2020 2020 2074 203d 2061 7761 6974 2073       t = await s
-00018ee0: 656c 662e 5f61 7379 6e63 5f66 6574 6368  elf._async_fetch
-00018ef0: 5f74 7261 6465 7328 7061 6972 2c0a 2020  _trades(pair,.  
-00018f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a10: 2020 2020 2020 2066 726f 6d5f 6964 3a20         from_id: 
+00018a20: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+00018a30: 4e6f 6e65 2920 2d3e 2054 7570 6c65 5b73  None) -> Tuple[s
+00018a40: 7472 2c20 4c69 7374 5b4c 6973 745d 5d3a  tr, List[List]]:
+00018a50: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00018a60: 2020 2020 2041 7379 6e63 726f 6e6f 7573       Asyncronous
+00018a70: 6c79 2067 6574 7320 7472 6164 6520 6869  ly gets trade hi
+00018a80: 7374 6f72 7920 7573 696e 6720 6665 7463  story using fetc
+00018a90: 685f 7472 6164 6573 0a20 2020 2020 2020  h_trades.       
+00018aa0: 2075 7365 2074 6869 7320 7768 656e 2065   use this when e
+00018ab0: 7863 6861 6e67 6520 7573 6573 2069 642d  xchange uses id-
+00018ac0: 6261 7365 6420 6974 6572 6174 696f 6e20  based iteration 
+00018ad0: 2863 6865 636b 2060 7365 6c66 2e5f 7472  (check `self._tr
+00018ae0: 6164 6573 5f70 6167 696e 6174 696f 6e60  ades_pagination`
+00018af0: 290a 2020 2020 2020 2020 3a70 6172 616d  ).        :param
+00018b00: 2070 6169 723a 2050 6169 7220 746f 2066   pair: Pair to f
+00018b10: 6574 6368 2074 7261 6465 2064 6174 6120  etch trade data 
+00018b20: 666f 720a 2020 2020 2020 2020 3a70 6172  for.        :par
+00018b30: 616d 2073 696e 6365 3a20 5369 6e63 6520  am since: Since 
+00018b40: 6173 2069 6e74 6567 6572 2074 696d 6573  as integer times
+00018b50: 7461 6d70 2069 6e20 6d69 6c6c 6973 6563  tamp in millisec
+00018b60: 6f6e 6473 0a20 2020 2020 2020 203a 7061  onds.        :pa
+00018b70: 7261 6d20 756e 7469 6c3a 2055 6e74 696c  ram until: Until
+00018b80: 2061 7320 696e 7465 6765 7220 7469 6d65   as integer time
+00018b90: 7374 616d 7020 696e 206d 696c 6c69 7365  stamp in millise
+00018ba0: 636f 6e64 730a 2020 2020 2020 2020 3a70  conds.        :p
+00018bb0: 6172 616d 2066 726f 6d5f 6964 3a20 446f  aram from_id: Do
+00018bc0: 776e 6c6f 6164 2064 6174 6120 7374 6172  wnload data star
+00018bd0: 7469 6e67 2077 6974 6820 4944 2028 6966  ting with ID (if
+00018be0: 2069 6420 6973 206b 6e6f 776e 292e 2049   id is known). I
+00018bf0: 676e 6f72 6573 2022 7369 6e63 6522 2069  gnores "since" i
+00018c00: 6620 7365 742e 0a20 2020 2020 2020 2072  f set..        r
+00018c10: 6574 7572 6e73 2074 7570 6c65 3a20 2870  eturns tuple: (p
+00018c20: 6169 722c 2074 7261 6465 732d 6c69 7374  air, trades-list
+00018c30: 290a 2020 2020 2020 2020 2222 220a 0a20  ).        """.. 
+00018c40: 2020 2020 2020 2074 7261 6465 733a 204c         trades: L
+00018c50: 6973 745b 4c69 7374 5d20 3d20 5b5d 0a0a  ist[List] = []..
+00018c60: 2020 2020 2020 2020 6966 206e 6f74 2066          if not f
+00018c70: 726f 6d5f 6964 3a0a 2020 2020 2020 2020  rom_id:.        
+00018c80: 2020 2020 2320 4665 7463 6820 6669 7273      # Fetch firs
+00018c90: 7420 656c 656d 656e 7473 2075 7369 6e67  t elements using
+00018ca0: 2074 696d 6562 6173 6564 206d 6574 686f   timebased metho
+00018cb0: 6420 746f 2067 6574 2061 6e20 4944 2074  d to get an ID t
+00018cc0: 6f20 7061 6769 6e61 7465 206f 6e0a 2020  o paginate on.  
+00018cd0: 2020 2020 2020 2020 2020 2320 4465 7065            # Depe
+00018ce0: 6e64 696e 6720 6f6e 2074 6865 2045 7863  nding on the Exc
+00018cf0: 6861 6e67 652c 2074 6869 7320 6361 6e20  hange, this can 
+00018d00: 696e 7472 6f64 7563 6520 6120 6472 6966  introduce a drif
+00018d10: 7420 6174 2074 6865 2073 7461 7274 206f  t at the start o
+00018d20: 6620 7468 6520 696e 7465 7276 616c 0a20  f the interval. 
+00018d30: 2020 2020 2020 2020 2020 2023 206f 6620             # of 
+00018d40: 7570 2074 6f20 616e 2068 6f75 722e 0a20  up to an hour.. 
+00018d50: 2020 2020 2020 2020 2020 2023 2065 2e67             # e.g
+00018d60: 2e20 4269 6e61 6e63 6520 7265 7475 726e  . Binance return
+00018d70: 7320 7468 6520 226c 6173 7420 3130 3030  s the "last 1000
+00018d80: 2220 6361 6e64 6c65 7320 7769 7468 696e  " candles within
+00018d90: 2061 2031 6820 7469 6d65 2069 6e74 6572   a 1h time inter
+00018da0: 7661 6c0a 2020 2020 2020 2020 2020 2020  val.            
+00018db0: 2320 2d20 736f 2077 6520 7769 6c6c 206d  # - so we will m
+00018dc0: 6973 7320 7468 6520 6669 7273 7420 7472  iss the first tr
+00018dd0: 6164 6573 2e0a 2020 2020 2020 2020 2020  ades..          
+00018de0: 2020 7420 3d20 6177 6169 7420 7365 6c66    t = await self
+00018df0: 2e5f 6173 796e 635f 6665 7463 685f 7472  ._async_fetch_tr
+00018e00: 6164 6573 2870 6169 722c 2073 696e 6365  ades(pair, since
+00018e10: 3d73 696e 6365 290a 2020 2020 2020 2020  =since).        
+00018e20: 2020 2020 2320 4445 4641 554c 545f 5452      # DEFAULT_TR
+00018e30: 4144 4553 5f43 4f4c 554d 4e53 3a20 3020  ADES_COLUMNS: 0 
+00018e40: 2d3e 2074 696d 6573 7461 6d70 0a20 2020  -> timestamp.   
+00018e50: 2020 2020 2020 2020 2023 2044 4546 4155           # DEFAU
+00018e60: 4c54 5f54 5241 4445 535f 434f 4c55 4d4e  LT_TRADES_COLUMN
+00018e70: 533a 2031 202d 3e20 6964 0a20 2020 2020  S: 1 -> id.     
+00018e80: 2020 2020 2020 2066 726f 6d5f 6964 203d         from_id =
+00018e90: 2074 5b2d 315d 5b31 5d0a 2020 2020 2020   t[-1][1].      
+00018ea0: 2020 2020 2020 7472 6164 6573 2e65 7874        trades.ext
+00018eb0: 656e 6428 745b 3a2d 315d 290a 2020 2020  end(t[:-1]).    
+00018ec0: 2020 2020 7768 696c 6520 5472 7565 3a0a      while True:.
+00018ed0: 2020 2020 2020 2020 2020 2020 7420 3d20              t = 
+00018ee0: 6177 6169 7420 7365 6c66 2e5f 6173 796e  await self._asyn
+00018ef0: 635f 6665 7463 685f 7472 6164 6573 2870  c_fetch_trades(p
+00018f00: 6169 722c 0a20 2020 2020 2020 2020 2020  air,.           
 00018f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f20: 2020 2020 2020 2020 2020 2020 2070 6172               par
-00018f30: 616d 733d 7b73 656c 662e 5f74 7261 6465  ams={self._trade
-00018f40: 735f 7061 6769 6e61 7469 6f6e 5f61 7267  s_pagination_arg
-00018f50: 3a20 6672 6f6d 5f69 647d 290a 2020 2020  : from_id}).    
-00018f60: 2020 2020 2020 2020 6966 2074 3a0a 2020          if t:.  
-00018f70: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00018f80: 536b 6970 206c 6173 7420 6964 2073 696e  Skip last id sin
-00018f90: 6365 2069 7473 2074 6865 206b 6579 2066  ce its the key f
-00018fa0: 6f72 2074 6865 206e 6578 7420 6361 6c6c  or the next call
-00018fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018fc0: 2074 7261 6465 732e 6578 7465 6e64 2874   trades.extend(t
-00018fd0: 5b3a 2d31 5d29 0a20 2020 2020 2020 2020  [:-1]).         
-00018fe0: 2020 2020 2020 2069 6620 6672 6f6d 5f69         if from_i
-00018ff0: 6420 3d3d 2074 5b2d 315d 5b31 5d20 6f72  d == t[-1][1] or
-00019000: 2074 5b2d 315d 5b30 5d20 3e20 756e 7469   t[-1][0] > unti
-00019010: 6c3a 0a20 2020 2020 2020 2020 2020 2020  l:.             
-00019020: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
-00019030: 6275 6728 6622 5374 6f70 7069 6e67 2062  bug(f"Stopping b
-00019040: 6563 6175 7365 2066 726f 6d5f 6964 2064  ecause from_id d
-00019050: 6964 206e 6f74 2063 6861 6e67 652e 2022  id not change. "
-00019060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018f30: 2020 2020 7061 7261 6d73 3d7b 7365 6c66      params={self
+00018f40: 2e5f 7472 6164 6573 5f70 6167 696e 6174  ._trades_paginat
+00018f50: 696f 6e5f 6172 673a 2066 726f 6d5f 6964  ion_arg: from_id
+00018f60: 7d29 0a20 2020 2020 2020 2020 2020 2069  }).            i
+00018f70: 6620 743a 0a20 2020 2020 2020 2020 2020  f t:.           
+00018f80: 2020 2020 2023 2053 6b69 7020 6c61 7374       # Skip last
+00018f90: 2069 6420 7369 6e63 6520 6974 7320 7468   id since its th
+00018fa0: 6520 6b65 7920 666f 7220 7468 6520 6e65  e key for the ne
+00018fb0: 7874 2063 616c 6c0a 2020 2020 2020 2020  xt call.        
+00018fc0: 2020 2020 2020 2020 7472 6164 6573 2e65          trades.e
+00018fd0: 7874 656e 6428 745b 3a2d 315d 290a 2020  xtend(t[:-1]).  
+00018fe0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00018ff0: 2066 726f 6d5f 6964 203d 3d20 745b 2d31   from_id == t[-1
+00019000: 5d5b 315d 206f 7220 745b 2d31 5d5b 305d  ][1] or t[-1][0]
+00019010: 203e 2075 6e74 696c 3a0a 2020 2020 2020   > until:.      
+00019020: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00019030: 6767 6572 2e64 6562 7567 2866 2253 746f  gger.debug(f"Sto
+00019040: 7070 696e 6720 6265 6361 7573 6520 6672  pping because fr
+00019050: 6f6d 5f69 6420 6469 6420 6e6f 7420 6368  om_id did not ch
+00019060: 616e 6765 2e20 220a 2020 2020 2020 2020  ange. ".        
 00019070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019080: 2020 6622 5265 6163 6865 6420 7b74 5b2d    f"Reached {t[-
-00019090: 315d 5b30 5d7d 203e 207b 756e 7469 6c7d  1][0]} > {until}
-000190a0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-000190b0: 2020 2020 2020 2023 2052 6561 6368 6564         # Reached
-000190c0: 2074 6865 2065 6e64 206f 6620 7468 6520   the end of the 
-000190d0: 6465 6669 6e65 642d 646f 776e 6c6f 6164  defined-download
-000190e0: 2070 6572 696f 6420 2d20 6164 6420 6c61   period - add la
-000190f0: 7374 2074 7261 6465 2061 7320 7765 6c6c  st trade as well
-00019100: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00019110: 2020 2020 2020 7472 6164 6573 2e65 7874        trades.ext
-00019120: 656e 6428 745b 2d31 3a5d 290a 2020 2020  end(t[-1:]).    
-00019130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019140: 6272 6561 6b0a 0a20 2020 2020 2020 2020  break..         
-00019150: 2020 2020 2020 2066 726f 6d5f 6964 203d         from_id =
-00019160: 2074 5b2d 315d 5b31 5d0a 2020 2020 2020   t[-1][1].      
-00019170: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00019180: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-00019190: 6b0a 0a20 2020 2020 2020 2072 6574 7572  k..        retur
-000191a0: 6e20 2870 6169 722c 2074 7261 6465 7329  n (pair, trades)
-000191b0: 0a0a 2020 2020 6173 796e 6320 6465 6620  ..    async def 
-000191c0: 5f61 7379 6e63 5f67 6574 5f74 7261 6465  _async_get_trade
-000191d0: 5f68 6973 746f 7279 5f74 696d 6528 7365  _history_time(se
-000191e0: 6c66 2c20 7061 6972 3a20 7374 722c 2075  lf, pair: str, u
-000191f0: 6e74 696c 3a20 696e 742c 0a20 2020 2020  ntil: int,.     
-00019200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019080: 2020 2020 2020 2020 2066 2252 6561 6368           f"Reach
+00019090: 6564 207b 745b 2d31 5d5b 305d 7d20 3e20  ed {t[-1][0]} > 
+000190a0: 7b75 6e74 696c 7d22 290a 2020 2020 2020  {until}").      
+000190b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+000190c0: 5265 6163 6865 6420 7468 6520 656e 6420  Reached the end 
+000190d0: 6f66 2074 6865 2064 6566 696e 6564 2d64  of the defined-d
+000190e0: 6f77 6e6c 6f61 6420 7065 7269 6f64 202d  ownload period -
+000190f0: 2061 6464 206c 6173 7420 7472 6164 6520   add last trade 
+00019100: 6173 2077 656c 6c2e 0a20 2020 2020 2020  as well..       
+00019110: 2020 2020 2020 2020 2020 2020 2074 7261               tra
+00019120: 6465 732e 6578 7465 6e64 2874 5b2d 313a  des.extend(t[-1:
+00019130: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00019140: 2020 2020 2020 2062 7265 616b 0a0a 2020         break..  
+00019150: 2020 2020 2020 2020 2020 2020 2020 6672                fr
+00019160: 6f6d 5f69 6420 3d20 745b 2d31 5d5b 315d  om_id = t[-1][1]
+00019170: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00019180: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00019190: 2020 2062 7265 616b 0a0a 2020 2020 2020     break..      
+000191a0: 2020 7265 7475 726e 2028 7061 6972 2c20    return (pair, 
+000191b0: 7472 6164 6573 290a 0a20 2020 2061 7379  trades)..    asy
+000191c0: 6e63 2064 6566 205f 6173 796e 635f 6765  nc def _async_ge
+000191d0: 745f 7472 6164 655f 6869 7374 6f72 795f  t_trade_history_
+000191e0: 7469 6d65 2873 656c 662c 2070 6169 723a  time(self, pair:
+000191f0: 2073 7472 2c20 756e 7469 6c3a 2069 6e74   str, until: int
+00019200: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 00019210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019220: 2020 2020 2020 2073 696e 6365 3a20 4f70         since: Op
-00019230: 7469 6f6e 616c 5b69 6e74 5d20 3d20 4e6f  tional[int] = No
-00019240: 6e65 2920 2d3e 2054 7570 6c65 5b73 7472  ne) -> Tuple[str
-00019250: 2c20 4c69 7374 5b4c 6973 745d 5d3a 0a20  , List[List]]:. 
-00019260: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00019270: 2020 2041 7379 6e63 726f 6e6f 7573 6c79     Asyncronously
-00019280: 2067 6574 7320 7472 6164 6520 6869 7374   gets trade hist
-00019290: 6f72 7920 7573 696e 6720 6665 7463 685f  ory using fetch_
-000192a0: 7472 6164 6573 2c0a 2020 2020 2020 2020  trades,.        
-000192b0: 7768 656e 2074 6865 2065 7863 6861 6e67  when the exchang
-000192c0: 6520 7573 6573 2074 696d 652d 6261 7365  e uses time-base
-000192d0: 6420 6974 6572 6174 696f 6e20 2863 6865  d iteration (che
-000192e0: 636b 2060 7365 6c66 2e5f 7472 6164 6573  ck `self._trades
-000192f0: 5f70 6167 696e 6174 696f 6e60 290a 2020  _pagination`).  
-00019300: 2020 2020 2020 3a70 6172 616d 2070 6169        :param pai
-00019310: 723a 2050 6169 7220 746f 2066 6574 6368  r: Pair to fetch
-00019320: 2074 7261 6465 2064 6174 6120 666f 720a   trade data for.
-00019330: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-00019340: 696e 6365 3a20 5369 6e63 6520 6173 2069  ince: Since as i
-00019350: 6e74 6567 6572 2074 696d 6573 7461 6d70  nteger timestamp
-00019360: 2069 6e20 6d69 6c6c 6973 6563 6f6e 6473   in milliseconds
-00019370: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00019380: 756e 7469 6c3a 2055 6e74 696c 2061 7320  until: Until as 
-00019390: 696e 7465 6765 7220 7469 6d65 7374 616d  integer timestam
-000193a0: 7020 696e 206d 696c 6c69 7365 636f 6e64  p in millisecond
-000193b0: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
-000193c0: 7320 7475 706c 653a 2028 7061 6972 2c20  s tuple: (pair, 
-000193d0: 7472 6164 6573 2d6c 6973 7429 0a20 2020  trades-list).   
-000193e0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-000193f0: 2020 7472 6164 6573 3a20 4c69 7374 5b4c    trades: List[L
-00019400: 6973 745d 203d 205b 5d0a 2020 2020 2020  ist] = [].      
-00019410: 2020 2320 4445 4641 554c 545f 5452 4144    # DEFAULT_TRAD
-00019420: 4553 5f43 4f4c 554d 4e53 3a20 3020 2d3e  ES_COLUMNS: 0 ->
-00019430: 2074 696d 6573 7461 6d70 0a20 2020 2020   timestamp.     
-00019440: 2020 2023 2044 4546 4155 4c54 5f54 5241     # DEFAULT_TRA
-00019450: 4445 535f 434f 4c55 4d4e 533a 2031 202d  DES_COLUMNS: 1 -
-00019460: 3e20 6964 0a20 2020 2020 2020 2077 6869  > id.        whi
-00019470: 6c65 2054 7275 653a 0a20 2020 2020 2020  le True:.       
-00019480: 2020 2020 2074 203d 2061 7761 6974 2073       t = await s
-00019490: 656c 662e 5f61 7379 6e63 5f66 6574 6368  elf._async_fetch
-000194a0: 5f74 7261 6465 7328 7061 6972 2c20 7369  _trades(pair, si
-000194b0: 6e63 653d 7369 6e63 6529 0a20 2020 2020  nce=since).     
-000194c0: 2020 2020 2020 2069 6620 743a 0a20 2020         if t:.   
-000194d0: 2020 2020 2020 2020 2020 2020 2073 696e               sin
-000194e0: 6365 203d 2074 5b2d 315d 5b30 5d0a 2020  ce = t[-1][0].  
-000194f0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00019500: 6164 6573 2e65 7874 656e 6428 7429 0a20  ades.extend(t). 
-00019510: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00019520: 2052 6561 6368 6564 2074 6865 2065 6e64   Reached the end
-00019530: 206f 6620 7468 6520 6465 6669 6e65 642d   of the defined-
-00019540: 646f 776e 6c6f 6164 2070 6572 696f 640a  download period.
-00019550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019560: 6966 2075 6e74 696c 2061 6e64 2074 5b2d  if until and t[-
-00019570: 315d 5b30 5d20 3e20 756e 7469 6c3a 0a20  1][0] > until:. 
-00019580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019590: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
-000195a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000195b0: 2020 2020 2020 2020 2066 2253 746f 7070           f"Stopp
-000195c0: 696e 6720 6265 6361 7573 6520 756e 7469  ing because unti
-000195d0: 6c20 7761 7320 7265 6163 6865 642e 207b  l was reached. {
-000195e0: 745b 2d31 5d5b 305d 7d20 3e20 7b75 6e74  t[-1][0]} > {unt
-000195f0: 696c 7d22 290a 2020 2020 2020 2020 2020  il}").          
-00019600: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-00019610: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00019620: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00019630: 2020 6272 6561 6b0a 0a20 2020 2020 2020    break..       
-00019640: 2072 6574 7572 6e20 2870 6169 722c 2074   return (pair, t
-00019650: 7261 6465 7329 0a0a 2020 2020 6173 796e  rades)..    asyn
-00019660: 6320 6465 6620 5f61 7379 6e63 5f67 6574  c def _async_get
-00019670: 5f74 7261 6465 5f68 6973 746f 7279 2873  _trade_history(s
-00019680: 656c 662c 2070 6169 723a 2073 7472 2c0a  elf, pair: str,.
-00019690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019220: 2020 2020 2020 2020 2020 2020 2020 7369                si
+00019230: 6e63 653a 204f 7074 696f 6e61 6c5b 696e  nce: Optional[in
+00019240: 745d 203d 204e 6f6e 6529 202d 3e20 5475  t] = None) -> Tu
+00019250: 706c 655b 7374 722c 204c 6973 745b 4c69  ple[str, List[Li
+00019260: 7374 5d5d 3a0a 2020 2020 2020 2020 2222  st]]:.        ""
+00019270: 220a 2020 2020 2020 2020 4173 796e 6372  ".        Asyncr
+00019280: 6f6e 6f75 736c 7920 6765 7473 2074 7261  onously gets tra
+00019290: 6465 2068 6973 746f 7279 2075 7369 6e67  de history using
+000192a0: 2066 6574 6368 5f74 7261 6465 732c 0a20   fetch_trades,. 
+000192b0: 2020 2020 2020 2077 6865 6e20 7468 6520         when the 
+000192c0: 6578 6368 616e 6765 2075 7365 7320 7469  exchange uses ti
+000192d0: 6d65 2d62 6173 6564 2069 7465 7261 7469  me-based iterati
+000192e0: 6f6e 2028 6368 6563 6b20 6073 656c 662e  on (check `self.
+000192f0: 5f74 7261 6465 735f 7061 6769 6e61 7469  _trades_paginati
+00019300: 6f6e 6029 0a20 2020 2020 2020 203a 7061  on`).        :pa
+00019310: 7261 6d20 7061 6972 3a20 5061 6972 2074  ram pair: Pair t
+00019320: 6f20 6665 7463 6820 7472 6164 6520 6461  o fetch trade da
+00019330: 7461 2066 6f72 0a20 2020 2020 2020 203a  ta for.        :
+00019340: 7061 7261 6d20 7369 6e63 653a 2053 696e  param since: Sin
+00019350: 6365 2061 7320 696e 7465 6765 7220 7469  ce as integer ti
+00019360: 6d65 7374 616d 7020 696e 206d 696c 6c69  mestamp in milli
+00019370: 7365 636f 6e64 730a 2020 2020 2020 2020  seconds.        
+00019380: 3a70 6172 616d 2075 6e74 696c 3a20 556e  :param until: Un
+00019390: 7469 6c20 6173 2069 6e74 6567 6572 2074  til as integer t
+000193a0: 696d 6573 7461 6d70 2069 6e20 6d69 6c6c  imestamp in mill
+000193b0: 6973 6563 6f6e 6473 0a20 2020 2020 2020  iseconds.       
+000193c0: 2072 6574 7572 6e73 2074 7570 6c65 3a20   returns tuple: 
+000193d0: 2870 6169 722c 2074 7261 6465 732d 6c69  (pair, trades-li
+000193e0: 7374 290a 2020 2020 2020 2020 2222 220a  st).        """.
+000193f0: 0a20 2020 2020 2020 2074 7261 6465 733a  .        trades:
+00019400: 204c 6973 745b 4c69 7374 5d20 3d20 5b5d   List[List] = []
+00019410: 0a20 2020 2020 2020 2023 2044 4546 4155  .        # DEFAU
+00019420: 4c54 5f54 5241 4445 535f 434f 4c55 4d4e  LT_TRADES_COLUMN
+00019430: 533a 2030 202d 3e20 7469 6d65 7374 616d  S: 0 -> timestam
+00019440: 700a 2020 2020 2020 2020 2320 4445 4641  p.        # DEFA
+00019450: 554c 545f 5452 4144 4553 5f43 4f4c 554d  ULT_TRADES_COLUM
+00019460: 4e53 3a20 3120 2d3e 2069 640a 2020 2020  NS: 1 -> id.    
+00019470: 2020 2020 7768 696c 6520 5472 7565 3a0a      while True:.
+00019480: 2020 2020 2020 2020 2020 2020 7420 3d20              t = 
+00019490: 6177 6169 7420 7365 6c66 2e5f 6173 796e  await self._asyn
+000194a0: 635f 6665 7463 685f 7472 6164 6573 2870  c_fetch_trades(p
+000194b0: 6169 722c 2073 696e 6365 3d73 696e 6365  air, since=since
+000194c0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+000194d0: 2074 3a0a 2020 2020 2020 2020 2020 2020   t:.            
+000194e0: 2020 2020 7369 6e63 6520 3d20 745b 2d31      since = t[-1
+000194f0: 5d5b 305d 0a20 2020 2020 2020 2020 2020  ][0].           
+00019500: 2020 2020 2074 7261 6465 732e 6578 7465       trades.exte
+00019510: 6e64 2874 290a 2020 2020 2020 2020 2020  nd(t).          
+00019520: 2020 2020 2020 2320 5265 6163 6865 6420        # Reached 
+00019530: 7468 6520 656e 6420 6f66 2074 6865 2064  the end of the d
+00019540: 6566 696e 6564 2d64 6f77 6e6c 6f61 6420  efined-download 
+00019550: 7065 7269 6f64 0a20 2020 2020 2020 2020  period.         
+00019560: 2020 2020 2020 2069 6620 756e 7469 6c20         if until 
+00019570: 616e 6420 745b 2d31 5d5b 305d 203e 2075  and t[-1][0] > u
+00019580: 6e74 696c 3a0a 2020 2020 2020 2020 2020  ntil:.          
+00019590: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+000195a0: 2e64 6562 7567 280a 2020 2020 2020 2020  .debug(.        
+000195b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000195c0: 6622 5374 6f70 7069 6e67 2062 6563 6175  f"Stopping becau
+000195d0: 7365 2075 6e74 696c 2077 6173 2072 6561  se until was rea
+000195e0: 6368 6564 2e20 7b74 5b2d 315d 5b30 5d7d  ched. {t[-1][0]}
+000195f0: 203e 207b 756e 7469 6c7d 2229 0a20 2020   > {until}").   
+00019600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019610: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
+00019620: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00019630: 2020 2020 2020 2020 2062 7265 616b 0a0a           break..
+00019640: 2020 2020 2020 2020 7265 7475 726e 2028          return (
+00019650: 7061 6972 2c20 7472 6164 6573 290a 0a20  pair, trades).. 
+00019660: 2020 2061 7379 6e63 2064 6566 205f 6173     async def _as
+00019670: 796e 635f 6765 745f 7472 6164 655f 6869  ync_get_trade_hi
+00019680: 7374 6f72 7928 7365 6c66 2c20 7061 6972  story(self, pair
+00019690: 3a20 7374 722c 0a20 2020 2020 2020 2020  : str,.         
 000196a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196b0: 2020 2020 2020 2073 696e 6365 3a20 4f70         since: Op
-000196c0: 7469 6f6e 616c 5b69 6e74 5d20 3d20 4e6f  tional[int] = No
-000196d0: 6e65 2c0a 2020 2020 2020 2020 2020 2020  ne,.            
+000196b0: 2020 2020 2020 2020 2020 2020 2020 7369                si
+000196c0: 6e63 653a 204f 7074 696f 6e61 6c5b 696e  nce: Optional[in
+000196d0: 745d 203d 204e 6f6e 652c 0a20 2020 2020  t] = None,.     
 000196e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196f0: 2020 2020 2020 2020 2020 2075 6e74 696c             until
-00019700: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
-00019710: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+000196f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019700: 2020 756e 7469 6c3a 204f 7074 696f 6e61    until: Optiona
+00019710: 6c5b 696e 745d 203d 204e 6f6e 652c 0a20  l[int] = None,. 
 00019720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019730: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00019740: 726f 6d5f 6964 3a20 4f70 7469 6f6e 616c  rom_id: Optional
-00019750: 5b73 7472 5d20 3d20 4e6f 6e65 2920 2d3e  [str] = None) ->
-00019760: 2054 7570 6c65 5b73 7472 2c20 4c69 7374   Tuple[str, List
-00019770: 5b4c 6973 745d 5d3a 0a20 2020 2020 2020  [List]]:.       
-00019780: 2022 2222 0a20 2020 2020 2020 2041 7379   """.        Asy
-00019790: 6e63 2077 7261 7070 6572 2068 616e 646c  nc wrapper handl
-000197a0: 696e 6720 646f 776e 6c6f 6164 696e 6720  ing downloading 
-000197b0: 7472 6164 6573 2075 7369 6e67 2065 6974  trades using eit
-000197c0: 6865 7220 7469 6d65 206f 7220 6964 2062  her time or id b
-000197d0: 6173 6564 206d 6574 686f 6473 2e0a 2020  ased methods..  
-000197e0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-000197f0: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
-00019800: 6622 5f61 7379 6e63 5f67 6574 5f74 7261  f"_async_get_tra
-00019810: 6465 5f68 6973 746f 7279 2829 2c20 7061  de_history(), pa
-00019820: 6972 3a20 7b70 6169 727d 2c20 220a 2020  ir: {pair}, ".  
-00019830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019840: 2020 2066 2273 696e 6365 3a20 7b73 696e     f"since: {sin
-00019850: 6365 7d2c 2075 6e74 696c 3a20 7b75 6e74  ce}, until: {unt
-00019860: 696c 7d2c 2066 726f 6d5f 6964 3a20 7b66  il}, from_id: {f
-00019870: 726f 6d5f 6964 7d22 290a 0a20 2020 2020  rom_id}")..     
-00019880: 2020 2069 6620 756e 7469 6c20 6973 204e     if until is N
-00019890: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-000198a0: 2075 6e74 696c 203d 2063 6378 742e 4578   until = ccxt.Ex
-000198b0: 6368 616e 6765 2e6d 696c 6c69 7365 636f  change.milliseco
-000198c0: 6e64 7328 290a 2020 2020 2020 2020 2020  nds().          
-000198d0: 2020 6c6f 6767 6572 2e64 6562 7567 2866    logger.debug(f
-000198e0: 2245 7863 6861 6e67 6520 6d69 6c6c 6973  "Exchange millis
-000198f0: 6563 6f6e 6473 3a20 7b75 6e74 696c 7d22  econds: {until}"
-00019900: 290a 0a20 2020 2020 2020 2069 6620 7365  )..        if se
-00019910: 6c66 2e5f 7472 6164 6573 5f70 6167 696e  lf._trades_pagin
-00019920: 6174 696f 6e20 3d3d 2027 7469 6d65 273a  ation == 'time':
-00019930: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00019940: 7572 6e20 6177 6169 7420 7365 6c66 2e5f  urn await self._
-00019950: 6173 796e 635f 6765 745f 7472 6164 655f  async_get_trade_
-00019960: 6869 7374 6f72 795f 7469 6d65 280a 2020  history_time(.  
-00019970: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00019980: 6972 3d70 6169 722c 2073 696e 6365 3d73  ir=pair, since=s
-00019990: 696e 6365 2c20 756e 7469 6c3d 756e 7469  ince, until=unti
-000199a0: 6c29 0a20 2020 2020 2020 2065 6c69 6620  l).        elif 
-000199b0: 7365 6c66 2e5f 7472 6164 6573 5f70 6167  self._trades_pag
-000199c0: 696e 6174 696f 6e20 3d3d 2027 6964 273a  ination == 'id':
-000199d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000199e0: 7572 6e20 6177 6169 7420 7365 6c66 2e5f  urn await self._
-000199f0: 6173 796e 635f 6765 745f 7472 6164 655f  async_get_trade_
-00019a00: 6869 7374 6f72 795f 6964 280a 2020 2020  history_id(.    
-00019a10: 2020 2020 2020 2020 2020 2020 7061 6972              pair
-00019a20: 3d70 6169 722c 2073 696e 6365 3d73 696e  =pair, since=sin
-00019a30: 6365 2c20 756e 7469 6c3d 756e 7469 6c2c  ce, until=until,
-00019a40: 2066 726f 6d5f 6964 3d66 726f 6d5f 6964   from_id=from_id
-00019a50: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00019a60: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00019a70: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
-00019a80: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
-00019a90: 696f 6e28 6622 4578 6368 616e 6765 207b  ion(f"Exchange {
-00019aa0: 7365 6c66 2e6e 616d 657d 2064 6f65 7320  self.name} does 
-00019ab0: 7573 6520 6e65 6974 6865 7220 7469 6d65  use neither time
-00019ac0: 2c20 220a 2020 2020 2020 2020 2020 2020  , ".            
+00019730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019740: 2020 2020 2020 6672 6f6d 5f69 643a 204f        from_id: O
+00019750: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
+00019760: 6f6e 6529 202d 3e20 5475 706c 655b 7374  one) -> Tuple[st
+00019770: 722c 204c 6973 745b 4c69 7374 5d5d 3a0a  r, List[List]]:.
+00019780: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00019790: 2020 2020 4173 796e 6320 7772 6170 7065      Async wrappe
+000197a0: 7220 6861 6e64 6c69 6e67 2064 6f77 6e6c  r handling downl
+000197b0: 6f61 6469 6e67 2074 7261 6465 7320 7573  oading trades us
+000197c0: 696e 6720 6569 7468 6572 2074 696d 6520  ing either time 
+000197d0: 6f72 2069 6420 6261 7365 6420 6d65 7468  or id based meth
+000197e0: 6f64 732e 0a20 2020 2020 2020 2022 2222  ods..        """
+000197f0: 0a0a 2020 2020 2020 2020 6c6f 6767 6572  ..        logger
+00019800: 2e64 6562 7567 2866 225f 6173 796e 635f  .debug(f"_async_
+00019810: 6765 745f 7472 6164 655f 6869 7374 6f72  get_trade_histor
+00019820: 7928 292c 2070 6169 723a 207b 7061 6972  y(), pair: {pair
+00019830: 7d2c 2022 0a20 2020 2020 2020 2020 2020  }, ".           
+00019840: 2020 2020 2020 2020 2020 6622 7369 6e63            f"sinc
+00019850: 653a 207b 7369 6e63 657d 2c20 756e 7469  e: {since}, unti
+00019860: 6c3a 207b 756e 7469 6c7d 2c20 6672 6f6d  l: {until}, from
+00019870: 5f69 643a 207b 6672 6f6d 5f69 647d 2229  _id: {from_id}")
+00019880: 0a0a 2020 2020 2020 2020 6966 2075 6e74  ..        if unt
+00019890: 696c 2069 7320 4e6f 6e65 3a0a 2020 2020  il is None:.    
+000198a0: 2020 2020 2020 2020 756e 7469 6c20 3d20          until = 
+000198b0: 6363 7874 2e45 7863 6861 6e67 652e 6d69  ccxt.Exchange.mi
+000198c0: 6c6c 6973 6563 6f6e 6473 2829 0a20 2020  lliseconds().   
+000198d0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+000198e0: 6465 6275 6728 6622 4578 6368 616e 6765  debug(f"Exchange
+000198f0: 206d 696c 6c69 7365 636f 6e64 733a 207b   milliseconds: {
+00019900: 756e 7469 6c7d 2229 0a0a 2020 2020 2020  until}")..      
+00019910: 2020 6966 2073 656c 662e 5f74 7261 6465    if self._trade
+00019920: 735f 7061 6769 6e61 7469 6f6e 203d 3d20  s_pagination == 
+00019930: 2774 696d 6527 3a0a 2020 2020 2020 2020  'time':.        
+00019940: 2020 2020 7265 7475 726e 2061 7761 6974      return await
+00019950: 2073 656c 662e 5f61 7379 6e63 5f67 6574   self._async_get
+00019960: 5f74 7261 6465 5f68 6973 746f 7279 5f74  _trade_history_t
+00019970: 696d 6528 0a20 2020 2020 2020 2020 2020  ime(.           
+00019980: 2020 2020 2070 6169 723d 7061 6972 2c20       pair=pair, 
+00019990: 7369 6e63 653d 7369 6e63 652c 2075 6e74  since=since, unt
+000199a0: 696c 3d75 6e74 696c 290a 2020 2020 2020  il=until).      
+000199b0: 2020 656c 6966 2073 656c 662e 5f74 7261    elif self._tra
+000199c0: 6465 735f 7061 6769 6e61 7469 6f6e 203d  des_pagination =
+000199d0: 3d20 2769 6427 3a0a 2020 2020 2020 2020  = 'id':.        
+000199e0: 2020 2020 7265 7475 726e 2061 7761 6974      return await
+000199f0: 2073 656c 662e 5f61 7379 6e63 5f67 6574   self._async_get
+00019a00: 5f74 7261 6465 5f68 6973 746f 7279 5f69  _trade_history_i
+00019a10: 6428 0a20 2020 2020 2020 2020 2020 2020  d(.             
+00019a20: 2020 2070 6169 723d 7061 6972 2c20 7369     pair=pair, si
+00019a30: 6e63 653d 7369 6e63 652c 2075 6e74 696c  nce=since, until
+00019a40: 3d75 6e74 696c 2c20 6672 6f6d 5f69 643d  =until, from_id=
+00019a50: 6672 6f6d 5f69 640a 2020 2020 2020 2020  from_id.        
+00019a60: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
+00019a70: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00019a80: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
+00019a90: 6c45 7863 6570 7469 6f6e 2866 2245 7863  lException(f"Exc
+00019aa0: 6861 6e67 6520 7b73 656c 662e 6e61 6d65  hange {self.name
+00019ab0: 7d20 646f 6573 2075 7365 206e 6569 7468  } does use neith
+00019ac0: 6572 2074 696d 652c 2022 0a20 2020 2020  er time, ".     
 00019ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ae0: 2020 2020 2020 2020 2020 2066 226e 6f72             f"nor
-00019af0: 2069 6420 6261 7365 6420 7061 6769 6e61   id based pagina
-00019b00: 7469 6f6e 2229 0a0a 2020 2020 6465 6620  tion")..    def 
-00019b10: 6765 745f 6869 7374 6f72 6963 5f74 7261  get_historic_tra
-00019b20: 6465 7328 7365 6c66 2c20 7061 6972 3a20  des(self, pair: 
-00019b30: 7374 722c 0a20 2020 2020 2020 2020 2020  str,.           
+00019ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019af0: 2020 6622 6e6f 7220 6964 2062 6173 6564    f"nor id based
+00019b00: 2070 6167 696e 6174 696f 6e22 290a 0a20   pagination").. 
+00019b10: 2020 2064 6566 2067 6574 5f68 6973 746f     def get_histo
+00019b20: 7269 635f 7472 6164 6573 2873 656c 662c  ric_trades(self,
+00019b30: 2070 6169 723a 2073 7472 2c0a 2020 2020   pair: str,.    
 00019b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019b50: 2073 696e 6365 3a20 4f70 7469 6f6e 616c   since: Optional
-00019b60: 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a 2020  [int] = None,.  
-00019b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019b80: 2020 2020 2020 2020 2020 756e 7469 6c3a            until:
-00019b90: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
-00019ba0: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+00019b50: 2020 2020 2020 2020 7369 6e63 653a 204f          since: O
+00019b60: 7074 696f 6e61 6c5b 696e 745d 203d 204e  ptional[int] = N
+00019b70: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00019b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019b90: 2075 6e74 696c 3a20 4f70 7469 6f6e 616c   until: Optional
+00019ba0: 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a 2020  [int] = None,.  
 00019bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019bc0: 2020 2066 726f 6d5f 6964 3a20 4f70 7469     from_id: Opti
-00019bd0: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-00019be0: 2920 2d3e 2054 7570 6c65 5b73 7472 2c20  ) -> Tuple[str, 
-00019bf0: 4c69 7374 5d3a 0a20 2020 2020 2020 2022  List]:.        "
-00019c00: 2222 0a20 2020 2020 2020 2047 6574 2074  "".        Get t
-00019c10: 7261 6465 2068 6973 746f 7279 2064 6174  rade history dat
-00019c20: 6120 7573 696e 6720 6173 796e 6369 6f2e  a using asyncio.
-00019c30: 0a20 2020 2020 2020 2048 616e 646c 6573  .        Handles
-00019c40: 2061 6c6c 2061 7379 6e63 2077 6f72 6b20   all async work 
-00019c50: 616e 6420 7265 7475 726e 7320 7468 6520  and returns the 
-00019c60: 6c69 7374 206f 6620 6361 6e64 6c65 732e  list of candles.
-00019c70: 0a20 2020 2020 2020 2041 7379 6e63 206f  .        Async o
-00019c80: 7665 7220 6f6e 6520 7061 6972 2c20 6173  ver one pair, as
-00019c90: 7375 6d69 6e67 2077 6520 6765 7420 6073  suming we get `s
-00019ca0: 656c 662e 6f68 6c63 765f 6361 6e64 6c65  elf.ohlcv_candle
-00019cb0: 5f6c 696d 6974 2829 6020 6361 6e64 6c65  _limit()` candle
-00019cc0: 7320 7065 7220 6361 6c6c 2e0a 2020 2020  s per call..    
-00019cd0: 2020 2020 3a70 6172 616d 2070 6169 723a      :param pair:
-00019ce0: 2050 6169 7220 746f 2064 6f77 6e6c 6f61   Pair to downloa
-00019cf0: 640a 2020 2020 2020 2020 3a70 6172 616d  d.        :param
-00019d00: 2073 696e 6365 3a20 5469 6d65 7374 616d   since: Timestam
-00019d10: 7020 696e 206d 696c 6c69 7365 636f 6e64  p in millisecond
-00019d20: 7320 746f 2067 6574 2068 6973 746f 7279  s to get history
-00019d30: 2066 726f 6d0a 2020 2020 2020 2020 3a70   from.        :p
-00019d40: 6172 616d 2075 6e74 696c 3a20 5469 6d65  aram until: Time
-00019d50: 7374 616d 7020 696e 206d 696c 6c69 7365  stamp in millise
-00019d60: 636f 6e64 732e 2044 6566 6175 6c74 7320  conds. Defaults 
-00019d70: 746f 2063 7572 7265 6e74 2074 696d 6573  to current times
-00019d80: 7461 6d70 2069 6620 6e6f 7420 6465 6669  tamp if not defi
-00019d90: 6e65 642e 0a20 2020 2020 2020 203a 7061  ned..        :pa
-00019da0: 7261 6d20 6672 6f6d 5f69 643a 2044 6f77  ram from_id: Dow
-00019db0: 6e6c 6f61 6420 6461 7461 2073 7461 7274  nload data start
-00019dc0: 696e 6720 7769 7468 2049 4420 2869 6620  ing with ID (if 
-00019dd0: 6964 2069 7320 6b6e 6f77 6e29 0a20 2020  id is known).   
-00019de0: 2020 2020 203a 7265 7475 726e 7320 4c69       :returns Li
-00019df0: 7374 206f 6620 7472 6164 6520 6461 7461  st of trade data
-00019e00: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00019e10: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-00019e20: 2e65 7863 6861 6e67 655f 6861 7328 2266  .exchange_has("f
-00019e30: 6574 6368 5472 6164 6573 2229 3a0a 2020  etchTrades"):.  
-00019e40: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00019e50: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
-00019e60: 7469 6f6e 2822 5468 6973 2065 7863 6861  tion("This excha
-00019e70: 6e67 6520 646f 6573 206e 6f74 2073 7570  nge does not sup
-00019e80: 706f 7274 2064 6f77 6e6c 6f61 6469 6e67  port downloading
-00019e90: 2054 7261 6465 732e 2229 0a0a 2020 2020   Trades.")..    
-00019ea0: 2020 2020 7769 7468 2073 656c 662e 5f6c      with self._l
-00019eb0: 6f6f 705f 6c6f 636b 3a0a 2020 2020 2020  oop_lock:.      
-00019ec0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00019ed0: 662e 6c6f 6f70 2e72 756e 5f75 6e74 696c  f.loop.run_until
-00019ee0: 5f63 6f6d 706c 6574 6528 0a20 2020 2020  _complete(.     
-00019ef0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00019f00: 5f61 7379 6e63 5f67 6574 5f74 7261 6465  _async_get_trade
-00019f10: 5f68 6973 746f 7279 2870 6169 723d 7061  _history(pair=pa
-00019f20: 6972 2c20 7369 6e63 653d 7369 6e63 652c  ir, since=since,
-00019f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019bc0: 2020 2020 2020 2020 2020 6672 6f6d 5f69            from_i
+00019bd0: 643a 204f 7074 696f 6e61 6c5b 7374 725d  d: Optional[str]
+00019be0: 203d 204e 6f6e 6529 202d 3e20 5475 706c   = None) -> Tupl
+00019bf0: 655b 7374 722c 204c 6973 745d 3a0a 2020  e[str, List]:.  
+00019c00: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00019c10: 2020 4765 7420 7472 6164 6520 6869 7374    Get trade hist
+00019c20: 6f72 7920 6461 7461 2075 7369 6e67 2061  ory data using a
+00019c30: 7379 6e63 696f 2e0a 2020 2020 2020 2020  syncio..        
+00019c40: 4861 6e64 6c65 7320 616c 6c20 6173 796e  Handles all asyn
+00019c50: 6320 776f 726b 2061 6e64 2072 6574 7572  c work and retur
+00019c60: 6e73 2074 6865 206c 6973 7420 6f66 2063  ns the list of c
+00019c70: 616e 646c 6573 2e0a 2020 2020 2020 2020  andles..        
+00019c80: 4173 796e 6320 6f76 6572 206f 6e65 2070  Async over one p
+00019c90: 6169 722c 2061 7373 756d 696e 6720 7765  air, assuming we
+00019ca0: 2067 6574 2060 7365 6c66 2e6f 686c 6376   get `self.ohlcv
+00019cb0: 5f63 616e 646c 655f 6c69 6d69 7428 2960  _candle_limit()`
+00019cc0: 2063 616e 646c 6573 2070 6572 2063 616c   candles per cal
+00019cd0: 6c2e 0a20 2020 2020 2020 203a 7061 7261  l..        :para
+00019ce0: 6d20 7061 6972 3a20 5061 6972 2074 6f20  m pair: Pair to 
+00019cf0: 646f 776e 6c6f 6164 0a20 2020 2020 2020  download.       
+00019d00: 203a 7061 7261 6d20 7369 6e63 653a 2054   :param since: T
+00019d10: 696d 6573 7461 6d70 2069 6e20 6d69 6c6c  imestamp in mill
+00019d20: 6973 6563 6f6e 6473 2074 6f20 6765 7420  iseconds to get 
+00019d30: 6869 7374 6f72 7920 6672 6f6d 0a20 2020  history from.   
+00019d40: 2020 2020 203a 7061 7261 6d20 756e 7469       :param unti
+00019d50: 6c3a 2054 696d 6573 7461 6d70 2069 6e20  l: Timestamp in 
+00019d60: 6d69 6c6c 6973 6563 6f6e 6473 2e20 4465  milliseconds. De
+00019d70: 6661 756c 7473 2074 6f20 6375 7272 656e  faults to curren
+00019d80: 7420 7469 6d65 7374 616d 7020 6966 206e  t timestamp if n
+00019d90: 6f74 2064 6566 696e 6564 2e0a 2020 2020  ot defined..    
+00019da0: 2020 2020 3a70 6172 616d 2066 726f 6d5f      :param from_
+00019db0: 6964 3a20 446f 776e 6c6f 6164 2064 6174  id: Download dat
+00019dc0: 6120 7374 6172 7469 6e67 2077 6974 6820  a starting with 
+00019dd0: 4944 2028 6966 2069 6420 6973 206b 6e6f  ID (if id is kno
+00019de0: 776e 290a 2020 2020 2020 2020 3a72 6574  wn).        :ret
+00019df0: 7572 6e73 204c 6973 7420 6f66 2074 7261  urns List of tra
+00019e00: 6465 2064 6174 610a 2020 2020 2020 2020  de data.        
+00019e10: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
+00019e20: 6f74 2073 656c 662e 6578 6368 616e 6765  ot self.exchange
+00019e30: 5f68 6173 2822 6665 7463 6854 7261 6465  _has("fetchTrade
+00019e40: 7322 293a 0a20 2020 2020 2020 2020 2020  s"):.           
+00019e50: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
+00019e60: 616c 4578 6365 7074 696f 6e28 2254 6869  alException("Thi
+00019e70: 7320 6578 6368 616e 6765 2064 6f65 7320  s exchange does 
+00019e80: 6e6f 7420 7375 7070 6f72 7420 646f 776e  not support down
+00019e90: 6c6f 6164 696e 6720 5472 6164 6573 2e22  loading Trades."
+00019ea0: 290a 0a20 2020 2020 2020 2077 6974 6820  )..        with 
+00019eb0: 7365 6c66 2e5f 6c6f 6f70 5f6c 6f63 6b3a  self._loop_lock:
+00019ec0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00019ed0: 7572 6e20 7365 6c66 2e6c 6f6f 702e 7275  urn self.loop.ru
+00019ee0: 6e5f 756e 7469 6c5f 636f 6d70 6c65 7465  n_until_complete
+00019ef0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00019f00: 2020 7365 6c66 2e5f 6173 796e 635f 6765    self._async_ge
+00019f10: 745f 7472 6164 655f 6869 7374 6f72 7928  t_trade_history(
+00019f20: 7061 6972 3d70 6169 722c 2073 696e 6365  pair=pair, since
+00019f30: 3d73 696e 6365 2c0a 2020 2020 2020 2020  =since,.        
 00019f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019f50: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00019f60: 6e74 696c 3d75 6e74 696c 2c20 6672 6f6d  ntil=until, from
-00019f70: 5f69 643d 6672 6f6d 5f69 6429 290a 0a20  _id=from_id)).. 
-00019f80: 2020 2040 7265 7472 6965 720a 2020 2020     @retrier.    
-00019f90: 6465 6620 5f67 6574 5f66 756e 6469 6e67  def _get_funding
-00019fa0: 5f66 6565 735f 6672 6f6d 5f65 7863 6861  _fees_from_excha
-00019fb0: 6e67 6528 7365 6c66 2c20 7061 6972 3a20  nge(self, pair: 
-00019fc0: 7374 722c 2073 696e 6365 3a20 556e 696f  str, since: Unio
-00019fd0: 6e5b 6461 7465 7469 6d65 2c20 696e 745d  n[datetime, int]
-00019fe0: 2920 2d3e 2066 6c6f 6174 3a0a 2020 2020  ) -> float:.    
-00019ff0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001a000: 5265 7475 726e 7320 7468 6520 7375 6d20  Returns the sum 
-0001a010: 6f66 2061 6c6c 2066 756e 6469 6e67 2066  of all funding f
-0001a020: 6565 7320 7468 6174 2077 6572 6520 6578  ees that were ex
-0001a030: 6368 616e 6765 6420 666f 7220 6120 7061  changed for a pa
-0001a040: 6972 2077 6974 6869 6e20 6120 7469 6d65  ir within a time
-0001a050: 6672 616d 650a 2020 2020 2020 2020 4472  frame.        Dr
-0001a060: 792d 7275 6e20 6861 6e64 6c69 6e67 2068  y-run handling h
-0001a070: 6170 7065 6e73 2061 7320 7061 7274 206f  appens as part o
-0001a080: 6620 5f63 616c 6375 6c61 7465 5f66 756e  f _calculate_fun
-0001a090: 6469 6e67 5f66 6565 732e 0a20 2020 2020  ding_fees..     
-0001a0a0: 2020 203a 7061 7261 6d20 7061 6972 3a20     :param pair: 
-0001a0b0: 2865 2e67 2e20 4144 412f 5553 4454 290a  (e.g. ADA/USDT).
-0001a0c0: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-0001a0d0: 696e 6365 3a20 5468 6520 6561 726c 6965  ince: The earlie
-0001a0e0: 7374 2074 696d 6520 6f66 2063 6f6e 7369  st time of consi
-0001a0f0: 6465 7261 7469 6f6e 2066 6f72 2063 616c  deration for cal
-0001a100: 6375 6c61 7469 6e67 2066 756e 6469 6e67  culating funding
-0001a110: 2066 6565 732c 0a20 2020 2020 2020 2020   fees,.         
-0001a120: 2020 2069 6e20 756e 6978 2074 696d 6520     in unix time 
-0001a130: 6f72 2061 7320 6120 6461 7465 7469 6d65  or as a datetime
-0001a140: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001a150: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
-0001a160: 2e65 7863 6861 6e67 655f 6861 7328 2266  .exchange_has("f
-0001a170: 6574 6368 4675 6e64 696e 6748 6973 746f  etchFundingHisto
-0001a180: 7279 2229 3a0a 2020 2020 2020 2020 2020  ry"):.          
-0001a190: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
-0001a1a0: 6e61 6c45 7863 6570 7469 6f6e 280a 2020  nalException(.  
-0001a1b0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0001a1c0: 6665 7463 685f 6675 6e64 696e 675f 6869  fetch_funding_hi
-0001a1d0: 7374 6f72 7928 2920 6973 206e 6f74 2061  story() is not a
-0001a1e0: 7661 696c 6162 6c65 2075 7369 6e67 207b  vailable using {
-0001a1f0: 7365 6c66 2e6e 616d 657d 220a 2020 2020  self.name}".    
-0001a200: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-0001a210: 2020 2069 6620 7479 7065 2873 696e 6365     if type(since
-0001a220: 2920 6973 2064 6174 6574 696d 653a 0a20  ) is datetime:. 
-0001a230: 2020 2020 2020 2020 2020 2073 696e 6365             since
-0001a240: 203d 2069 6e74 2873 696e 6365 2e74 696d   = int(since.tim
-0001a250: 6573 7461 6d70 2829 2920 2a20 3130 3030  estamp()) * 1000
-0001a260: 2020 2023 202a 2031 3030 3020 666f 7220     # * 1000 for 
-0001a270: 6d73 0a0a 2020 2020 2020 2020 7472 793a  ms..        try:
-0001a280: 0a20 2020 2020 2020 2020 2020 2066 756e  .            fun
-0001a290: 6469 6e67 5f68 6973 746f 7279 203d 2073  ding_history = s
-0001a2a0: 656c 662e 5f61 7069 2e66 6574 6368 5f66  elf._api.fetch_f
-0001a2b0: 756e 6469 6e67 5f68 6973 746f 7279 280a  unding_history(.
-0001a2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a2d0: 7379 6d62 6f6c 3d70 6169 722c 0a20 2020  symbol=pair,.   
-0001a2e0: 2020 2020 2020 2020 2020 2020 2073 696e               sin
-0001a2f0: 6365 3d73 696e 6365 0a20 2020 2020 2020  ce=since.       
-0001a300: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0001a310: 2020 2072 6574 7572 6e20 7375 6d28 6665     return sum(fe
-0001a320: 655b 2761 6d6f 756e 7427 5d20 666f 7220  e['amount'] for 
-0001a330: 6665 6520 696e 2066 756e 6469 6e67 5f68  fee in funding_h
-0001a340: 6973 746f 7279 290a 2020 2020 2020 2020  istory).        
-0001a350: 6578 6365 7074 2063 6378 742e 4444 6f53  except ccxt.DDoS
-0001a360: 5072 6f74 6563 7469 6f6e 2061 7320 653a  Protection as e:
-0001a370: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0001a380: 7365 2044 446f 7350 726f 7465 6374 696f  se DDosProtectio
-0001a390: 6e28 6529 2066 726f 6d20 650a 2020 2020  n(e) from e.    
-0001a3a0: 2020 2020 6578 6365 7074 2028 6363 7874      except (ccxt
-0001a3b0: 2e4e 6574 776f 726b 4572 726f 722c 2063  .NetworkError, c
-0001a3c0: 6378 742e 4578 6368 616e 6765 4572 726f  cxt.ExchangeErro
-0001a3d0: 7229 2061 7320 653a 0a20 2020 2020 2020  r) as e:.       
-0001a3e0: 2020 2020 2072 6169 7365 2054 656d 706f       raise Tempo
-0001a3f0: 7261 7279 4572 726f 7228 0a20 2020 2020  raryError(.     
-0001a400: 2020 2020 2020 2020 2020 2066 2743 6f75             f'Cou
-0001a410: 6c64 206e 6f74 2067 6574 2066 756e 6469  ld not get fundi
-0001a420: 6e67 2066 6565 7320 6475 6520 746f 207b  ng fees due to {
-0001a430: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
-0001a440: 6d65 5f5f 7d2e 204d 6573 7361 6765 3a20  me__}. Message: 
-0001a450: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
-0001a460: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
-0001a470: 2e42 6173 6545 7272 6f72 2061 7320 653a  .BaseError as e:
-0001a480: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0001a490: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
-0001a4a0: 6365 7074 696f 6e28 6529 2066 726f 6d20  ception(e) from 
-0001a4b0: 650a 0a20 2020 2040 7265 7472 6965 720a  e..    @retrier.
-0001a4c0: 2020 2020 6465 6620 6765 745f 6c65 7665      def get_leve
-0001a4d0: 7261 6765 5f74 6965 7273 2873 656c 6629  rage_tiers(self)
-0001a4e0: 202d 3e20 4469 6374 5b73 7472 2c20 4c69   -> Dict[str, Li
-0001a4f0: 7374 5b44 6963 745d 5d3a 0a20 2020 2020  st[Dict]]:.     
-0001a500: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0001a510: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0001a520: 5f61 7069 2e66 6574 6368 5f6c 6576 6572  _api.fetch_lever
-0001a530: 6167 655f 7469 6572 7328 290a 2020 2020  age_tiers().    
-0001a540: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
-0001a550: 4444 6f53 5072 6f74 6563 7469 6f6e 2061  DDoSProtection a
-0001a560: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-0001a570: 2072 6169 7365 2044 446f 7350 726f 7465   raise DDosProte
-0001a580: 6374 696f 6e28 6529 2066 726f 6d20 650a  ction(e) from e.
-0001a590: 2020 2020 2020 2020 6578 6365 7074 2028          except (
-0001a5a0: 6363 7874 2e4e 6574 776f 726b 4572 726f  ccxt.NetworkErro
-0001a5b0: 722c 2063 6378 742e 4578 6368 616e 6765  r, ccxt.Exchange
-0001a5c0: 4572 726f 7229 2061 7320 653a 0a20 2020  Error) as e:.   
-0001a5d0: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
-0001a5e0: 656d 706f 7261 7279 4572 726f 7228 0a20  emporaryError(. 
-0001a5f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001a600: 2743 6f75 6c64 206e 6f74 206c 6f61 6420  'Could not load 
-0001a610: 6c65 7665 7261 6765 2074 6965 7273 2064  leverage tiers d
-0001a620: 7565 2074 6f20 7b65 2e5f 5f63 6c61 7373  ue to {e.__class
-0001a630: 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20 4d65  __.__name__}. Me
-0001a640: 7373 6167 653a 207b 657d 270a 2020 2020  ssage: {e}'.    
-0001a650: 2020 2020 2020 2020 2920 6672 6f6d 2065          ) from e
-0001a660: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0001a670: 6363 7874 2e42 6173 6545 7272 6f72 2061  ccxt.BaseError a
-0001a680: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-0001a690: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
-0001a6a0: 616c 4578 6365 7074 696f 6e28 6529 2066  alException(e) f
-0001a6b0: 726f 6d20 650a 0a20 2020 2040 7265 7472  rom e..    @retr
-0001a6c0: 6965 725f 6173 796e 630a 2020 2020 6173  ier_async.    as
-0001a6d0: 796e 6320 6465 6620 6765 745f 6d61 726b  ync def get_mark
-0001a6e0: 6574 5f6c 6576 6572 6167 655f 7469 6572  et_leverage_tier
-0001a6f0: 7328 7365 6c66 2c20 7379 6d62 6f6c 3a20  s(self, symbol: 
-0001a700: 7374 7229 202d 3e20 5475 706c 655b 7374  str) -> Tuple[st
-0001a710: 722c 204c 6973 745b 4469 6374 5d5d 3a0a  r, List[Dict]]:.
-0001a720: 2020 2020 2020 2020 2222 2220 4c65 7665          """ Leve
-0001a730: 7261 6765 2074 6965 7273 2070 6572 2073  rage tiers per s
-0001a740: 796d 626f 6c20 2222 220a 2020 2020 2020  ymbol """.      
-0001a750: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0001a760: 2020 2074 6965 7220 3d20 6177 6169 7420     tier = await 
-0001a770: 7365 6c66 2e5f 6170 695f 6173 796e 632e  self._api_async.
-0001a780: 6665 7463 685f 6d61 726b 6574 5f6c 6576  fetch_market_lev
-0001a790: 6572 6167 655f 7469 6572 7328 7379 6d62  erage_tiers(symb
-0001a7a0: 6f6c 290a 2020 2020 2020 2020 2020 2020  ol).            
-0001a7b0: 7265 7475 726e 2073 796d 626f 6c2c 2074  return symbol, t
-0001a7c0: 6965 720a 2020 2020 2020 2020 6578 6365  ier.        exce
-0001a7d0: 7074 2063 6378 742e 4444 6f53 5072 6f74  pt ccxt.DDoSProt
-0001a7e0: 6563 7469 6f6e 2061 7320 653a 0a20 2020  ection as e:.   
-0001a7f0: 2020 2020 2020 2020 2072 6169 7365 2044           raise D
-0001a800: 446f 7350 726f 7465 6374 696f 6e28 6529  DosProtection(e)
-0001a810: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-0001a820: 6578 6365 7074 2028 6363 7874 2e4e 6574  except (ccxt.Net
-0001a830: 776f 726b 4572 726f 722c 2063 6378 742e  workError, ccxt.
-0001a840: 4578 6368 616e 6765 4572 726f 7229 2061  ExchangeError) a
-0001a850: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-0001a860: 2072 6169 7365 2054 656d 706f 7261 7279   raise Temporary
-0001a870: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-0001a880: 2020 2020 2020 2066 2743 6f75 6c64 206e         f'Could n
-0001a890: 6f74 206c 6f61 6420 6c65 7665 7261 6765  ot load leverage
-0001a8a0: 2074 6965 7273 2066 6f72 207b 7379 6d62   tiers for {symb
-0001a8b0: 6f6c 7d27 0a20 2020 2020 2020 2020 2020  ol}'.           
-0001a8c0: 2020 2020 2066 2720 6475 6520 746f 207b       f' due to {
-0001a8d0: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
-0001a8e0: 6d65 5f5f 7d2e 204d 6573 7361 6765 3a20  me__}. Message: 
-0001a8f0: 7b65 7d27 0a20 2020 2020 2020 2020 2020  {e}'.           
-0001a900: 2029 2066 726f 6d20 650a 2020 2020 2020   ) from e.      
-0001a910: 2020 6578 6365 7074 2063 6378 742e 4261    except ccxt.Ba
-0001a920: 7365 4572 726f 7220 6173 2065 3a0a 2020  seError as e:.  
-0001a930: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001a940: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
-0001a950: 7469 6f6e 2865 2920 6672 6f6d 2065 0a0a  tion(e) from e..
-0001a960: 2020 2020 6465 6620 6c6f 6164 5f6c 6576      def load_lev
-0001a970: 6572 6167 655f 7469 6572 7328 7365 6c66  erage_tiers(self
-0001a980: 2920 2d3e 2044 6963 745b 7374 722c 204c  ) -> Dict[str, L
-0001a990: 6973 745b 4469 6374 5d5d 3a0a 2020 2020  ist[Dict]]:.    
-0001a9a0: 2020 2020 6966 2073 656c 662e 7472 6164      if self.trad
-0001a9b0: 696e 675f 6d6f 6465 203d 3d20 5472 6164  ing_mode == Trad
-0001a9c0: 696e 674d 6f64 652e 4655 5455 5245 533a  ingMode.FUTURES:
-0001a9d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001a9e0: 7365 6c66 2e65 7863 6861 6e67 655f 6861  self.exchange_ha
-0001a9f0: 7328 2766 6574 6368 4c65 7665 7261 6765  s('fetchLeverage
-0001aa00: 5469 6572 7327 293a 0a20 2020 2020 2020  Tiers'):.       
-0001aa10: 2020 2020 2020 2020 2023 2046 6574 6368           # Fetch
-0001aa20: 2061 6c6c 206c 6576 6572 6167 6520 7469   all leverage ti
-0001aa30: 6572 7320 6174 206f 6e63 650a 2020 2020  ers at once.    
-0001aa40: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001aa50: 726e 2073 656c 662e 6765 745f 6c65 7665  rn self.get_leve
-0001aa60: 7261 6765 5f74 6965 7273 2829 0a20 2020  rage_tiers().   
-0001aa70: 2020 2020 2020 2020 2065 6c69 6620 7365           elif se
-0001aa80: 6c66 2e65 7863 6861 6e67 655f 6861 7328  lf.exchange_has(
-0001aa90: 2766 6574 6368 4d61 726b 6574 4c65 7665  'fetchMarketLeve
-0001aaa0: 7261 6765 5469 6572 7327 293a 0a20 2020  rageTiers'):.   
-0001aab0: 2020 2020 2020 2020 2020 2020 2023 204d               # M
-0001aac0: 7573 7420 6665 7463 6820 7468 6520 6c65  ust fetch the le
-0001aad0: 7665 7261 6765 2074 6965 7273 2066 6f72  verage tiers for
-0001aae0: 2065 6163 6820 6d61 726b 6574 2073 6570   each market sep
-0001aaf0: 6172 6174 656c 790a 2020 2020 2020 2020  arately.        
-0001ab00: 2020 2020 2020 2020 2320 2a20 5468 6973          # * This
-0001ab10: 2069 7320 736c 6f77 287e 3435 7329 206f   is slow(~45s) o
-0001ab20: 6e20 4f6b 782c 206d 616b 6573 207e 3930  n Okx, makes ~90
-0001ab30: 2061 7069 2063 616c 6c73 2074 6f20 6c6f   api calls to lo
-0001ab40: 6164 2061 6c6c 206c 696e 6561 7220 7377  ad all linear sw
-0001ab50: 6170 206d 6172 6b65 7473 0a20 2020 2020  ap markets.     
-0001ab60: 2020 2020 2020 2020 2020 206d 6172 6b65             marke
-0001ab70: 7473 203d 2073 656c 662e 6d61 726b 6574  ts = self.market
-0001ab80: 730a 0a20 2020 2020 2020 2020 2020 2020  s..             
-0001ab90: 2020 2073 796d 626f 6c73 203d 205b 0a20     symbols = [. 
-0001aba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001abb0: 2020 2073 796d 626f 6c20 666f 7220 7379     symbol for sy
-0001abc0: 6d62 6f6c 2c20 6d61 726b 6574 2069 6e20  mbol, market in 
-0001abd0: 6d61 726b 6574 732e 6974 656d 7328 290a  markets.items().
-0001abe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001abf0: 2020 2020 6966 2028 7365 6c66 2e6d 6172      if (self.mar
-0001ac00: 6b65 745f 6973 5f66 7574 7572 6528 6d61  ket_is_future(ma
-0001ac10: 726b 6574 290a 2020 2020 2020 2020 2020  rket).          
-0001ac20: 2020 2020 2020 2020 2020 2020 2020 616e                an
-0001ac30: 6420 6d61 726b 6574 5b27 7175 6f74 6527  d market['quote'
-0001ac40: 5d20 3d3d 2073 656c 662e 5f63 6f6e 6669  ] == self._confi
-0001ac50: 675b 2773 7461 6b65 5f63 7572 7265 6e63  g['stake_currenc
-0001ac60: 7927 5d29 0a20 2020 2020 2020 2020 2020  y']).           
-0001ac70: 2020 2020 205d 0a0a 2020 2020 2020 2020       ]..        
-0001ac80: 2020 2020 2020 2020 7469 6572 733a 2044          tiers: D
-0001ac90: 6963 745b 7374 722c 204c 6973 745b 4469  ict[str, List[Di
-0001aca0: 6374 5d5d 203d 207b 7d0a 0a20 2020 2020  ct]] = {}..     
-0001acb0: 2020 2020 2020 2020 2020 2074 6965 7273             tiers
-0001acc0: 5f63 6163 6865 6420 3d20 7365 6c66 2e6c  _cached = self.l
-0001acd0: 6f61 645f 6361 6368 6564 5f6c 6576 6572  oad_cached_lever
-0001ace0: 6167 655f 7469 6572 7328 7365 6c66 2e5f  age_tiers(self._
-0001acf0: 636f 6e66 6967 5b27 7374 616b 655f 6375  config['stake_cu
-0001ad00: 7272 656e 6379 275d 290a 2020 2020 2020  rrency']).      
-0001ad10: 2020 2020 2020 2020 2020 6966 2074 6965            if tie
-0001ad20: 7273 5f63 6163 6865 643a 0a20 2020 2020  rs_cached:.     
-0001ad30: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0001ad40: 6965 7273 203d 2074 6965 7273 5f63 6163  iers = tiers_cac
-0001ad50: 6865 640a 0a20 2020 2020 2020 2020 2020  hed..           
-0001ad60: 2020 2020 2063 6f72 6f73 203d 205b 0a20       coros = [. 
-0001ad70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ad80: 2020 2073 656c 662e 6765 745f 6d61 726b     self.get_mark
-0001ad90: 6574 5f6c 6576 6572 6167 655f 7469 6572  et_leverage_tier
-0001ada0: 7328 7379 6d62 6f6c 290a 2020 2020 2020  s(symbol).      
-0001adb0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0001adc0: 7220 7379 6d62 6f6c 2069 6e20 736f 7274  r symbol in sort
-0001add0: 6564 2873 796d 626f 6c73 2920 6966 2073  ed(symbols) if s
-0001ade0: 796d 626f 6c20 6e6f 7420 696e 2074 6965  ymbol not in tie
-0001adf0: 7273 5d0a 0a20 2020 2020 2020 2020 2020  rs]..           
-0001ae00: 2020 2020 2023 2042 6520 7665 7262 6f73       # Be verbos
-0001ae10: 6520 6865 7265 2c20 6173 2074 6869 7320  e here, as this 
-0001ae20: 6465 6c61 7973 2073 7461 7274 7570 2062  delays startup b
-0001ae30: 7920 7e31 206d 696e 7574 652e 0a20 2020  y ~1 minute..   
-0001ae40: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0001ae50: 636f 726f 733a 0a20 2020 2020 2020 2020  coros:.         
-0001ae60: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-0001ae70: 722e 696e 666f 280a 2020 2020 2020 2020  r.info(.        
+00019f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019f60: 2020 2020 2020 756e 7469 6c3d 756e 7469        until=unti
+00019f70: 6c2c 2066 726f 6d5f 6964 3d66 726f 6d5f  l, from_id=from_
+00019f80: 6964 2929 0a0a 2020 2020 4072 6574 7269  id))..    @retri
+00019f90: 6572 0a20 2020 2064 6566 205f 6765 745f  er.    def _get_
+00019fa0: 6675 6e64 696e 675f 6665 6573 5f66 726f  funding_fees_fro
+00019fb0: 6d5f 6578 6368 616e 6765 2873 656c 662c  m_exchange(self,
+00019fc0: 2070 6169 723a 2073 7472 2c20 7369 6e63   pair: str, sinc
+00019fd0: 653a 2055 6e69 6f6e 5b64 6174 6574 696d  e: Union[datetim
+00019fe0: 652c 2069 6e74 5d29 202d 3e20 666c 6f61  e, int]) -> floa
+00019ff0: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
+0001a000: 2020 2020 2020 2052 6574 7572 6e73 2074         Returns t
+0001a010: 6865 2073 756d 206f 6620 616c 6c20 6675  he sum of all fu
+0001a020: 6e64 696e 6720 6665 6573 2074 6861 7420  nding fees that 
+0001a030: 7765 7265 2065 7863 6861 6e67 6564 2066  were exchanged f
+0001a040: 6f72 2061 2070 6169 7220 7769 7468 696e  or a pair within
+0001a050: 2061 2074 696d 6566 7261 6d65 0a20 2020   a timeframe.   
+0001a060: 2020 2020 2044 7279 2d72 756e 2068 616e       Dry-run han
+0001a070: 646c 696e 6720 6861 7070 656e 7320 6173  dling happens as
+0001a080: 2070 6172 7420 6f66 205f 6361 6c63 756c   part of _calcul
+0001a090: 6174 655f 6675 6e64 696e 675f 6665 6573  ate_funding_fees
+0001a0a0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0001a0b0: 2070 6169 723a 2028 652e 672e 2041 4441   pair: (e.g. ADA
+0001a0c0: 2f55 5344 5429 0a20 2020 2020 2020 203a  /USDT).        :
+0001a0d0: 7061 7261 6d20 7369 6e63 653a 2054 6865  param since: The
+0001a0e0: 2065 6172 6c69 6573 7420 7469 6d65 206f   earliest time o
+0001a0f0: 6620 636f 6e73 6964 6572 6174 696f 6e20  f consideration 
+0001a100: 666f 7220 6361 6c63 756c 6174 696e 6720  for calculating 
+0001a110: 6675 6e64 696e 6720 6665 6573 2c0a 2020  funding fees,.  
+0001a120: 2020 2020 2020 2020 2020 696e 2075 6e69            in uni
+0001a130: 7820 7469 6d65 206f 7220 6173 2061 2064  x time or as a d
+0001a140: 6174 6574 696d 650a 2020 2020 2020 2020  atetime.        
+0001a150: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
+0001a160: 6f74 2073 656c 662e 6578 6368 616e 6765  ot self.exchange
+0001a170: 5f68 6173 2822 6665 7463 6846 756e 6469  _has("fetchFundi
+0001a180: 6e67 4869 7374 6f72 7922 293a 0a20 2020  ngHistory"):.   
+0001a190: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+0001a1a0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
+0001a1b0: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+0001a1c0: 2020 2020 2066 2266 6574 6368 5f66 756e       f"fetch_fun
+0001a1d0: 6469 6e67 5f68 6973 746f 7279 2829 2069  ding_history() i
+0001a1e0: 7320 6e6f 7420 6176 6169 6c61 626c 6520  s not available 
+0001a1f0: 7573 696e 6720 7b73 656c 662e 6e61 6d65  using {self.name
+0001a200: 7d22 0a20 2020 2020 2020 2020 2020 2029  }".            )
+0001a210: 0a0a 2020 2020 2020 2020 6966 2074 7970  ..        if typ
+0001a220: 6528 7369 6e63 6529 2069 7320 6461 7465  e(since) is date
+0001a230: 7469 6d65 3a0a 2020 2020 2020 2020 2020  time:.          
+0001a240: 2020 7369 6e63 6520 3d20 696e 7428 7369    since = int(si
+0001a250: 6e63 652e 7469 6d65 7374 616d 7028 2929  nce.timestamp())
+0001a260: 202a 2031 3030 3020 2020 2320 2a20 3130   * 1000   # * 10
+0001a270: 3030 2066 6f72 206d 730a 0a20 2020 2020  00 for ms..     
+0001a280: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0001a290: 2020 2020 6675 6e64 696e 675f 6869 7374      funding_hist
+0001a2a0: 6f72 7920 3d20 7365 6c66 2e5f 6170 692e  ory = self._api.
+0001a2b0: 6665 7463 685f 6675 6e64 696e 675f 6869  fetch_funding_hi
+0001a2c0: 7374 6f72 7928 0a20 2020 2020 2020 2020  story(.         
+0001a2d0: 2020 2020 2020 2073 796d 626f 6c3d 7061         symbol=pa
+0001a2e0: 6972 2c0a 2020 2020 2020 2020 2020 2020  ir,.            
+0001a2f0: 2020 2020 7369 6e63 653d 7369 6e63 650a      since=since.
+0001a300: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001a310: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001a320: 2073 756d 2866 6565 5b27 616d 6f75 6e74   sum(fee['amount
+0001a330: 275d 2066 6f72 2066 6565 2069 6e20 6675  '] for fee in fu
+0001a340: 6e64 696e 675f 6869 7374 6f72 7929 0a20  nding_history). 
+0001a350: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
+0001a360: 7874 2e44 446f 5350 726f 7465 6374 696f  xt.DDoSProtectio
+0001a370: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
+0001a380: 2020 2020 7261 6973 6520 4444 6f73 5072      raise DDosPr
+0001a390: 6f74 6563 7469 6f6e 2865 2920 6672 6f6d  otection(e) from
+0001a3a0: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
+0001a3b0: 7420 2863 6378 742e 4e65 7477 6f72 6b45  t (ccxt.NetworkE
+0001a3c0: 7272 6f72 2c20 6363 7874 2e45 7863 6861  rror, ccxt.Excha
+0001a3d0: 6e67 6545 7272 6f72 2920 6173 2065 3a0a  ngeError) as e:.
+0001a3e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0001a3f0: 6520 5465 6d70 6f72 6172 7945 7272 6f72  e TemporaryError
+0001a400: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001a410: 2020 6627 436f 756c 6420 6e6f 7420 6765    f'Could not ge
+0001a420: 7420 6675 6e64 696e 6720 6665 6573 2064  t funding fees d
+0001a430: 7565 2074 6f20 7b65 2e5f 5f63 6c61 7373  ue to {e.__class
+0001a440: 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20 4d65  __.__name__}. Me
+0001a450: 7373 6167 653a 207b 657d 2729 2066 726f  ssage: {e}') fro
+0001a460: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
+0001a470: 7074 2063 6378 742e 4261 7365 4572 726f  pt ccxt.BaseErro
+0001a480: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
+0001a490: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
+0001a4a0: 696f 6e61 6c45 7863 6570 7469 6f6e 2865  ionalException(e
+0001a4b0: 2920 6672 6f6d 2065 0a0a 2020 2020 4072  ) from e..    @r
+0001a4c0: 6574 7269 6572 0a20 2020 2064 6566 2067  etrier.    def g
+0001a4d0: 6574 5f6c 6576 6572 6167 655f 7469 6572  et_leverage_tier
+0001a4e0: 7328 7365 6c66 2920 2d3e 2044 6963 745b  s(self) -> Dict[
+0001a4f0: 7374 722c 204c 6973 745b 4469 6374 5d5d  str, List[Dict]]
+0001a500: 3a0a 2020 2020 2020 2020 7472 793a 0a20  :.        try:. 
+0001a510: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001a520: 6e20 7365 6c66 2e5f 6170 692e 6665 7463  n self._api.fetc
+0001a530: 685f 6c65 7665 7261 6765 5f74 6965 7273  h_leverage_tiers
+0001a540: 2829 0a20 2020 2020 2020 2065 7863 6570  ().        excep
+0001a550: 7420 6363 7874 2e44 446f 5350 726f 7465  t ccxt.DDoSProte
+0001a560: 6374 696f 6e20 6173 2065 3a0a 2020 2020  ction as e:.    
+0001a570: 2020 2020 2020 2020 7261 6973 6520 4444          raise DD
+0001a580: 6f73 5072 6f74 6563 7469 6f6e 2865 2920  osProtection(e) 
+0001a590: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
+0001a5a0: 7863 6570 7420 2863 6378 742e 4e65 7477  xcept (ccxt.Netw
+0001a5b0: 6f72 6b45 7272 6f72 2c20 6363 7874 2e45  orkError, ccxt.E
+0001a5c0: 7863 6861 6e67 6545 7272 6f72 2920 6173  xchangeError) as
+0001a5d0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0001a5e0: 7261 6973 6520 5465 6d70 6f72 6172 7945  raise TemporaryE
+0001a5f0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+0001a600: 2020 2020 2020 6627 436f 756c 6420 6e6f        f'Could no
+0001a610: 7420 6c6f 6164 206c 6576 6572 6167 6520  t load leverage 
+0001a620: 7469 6572 7320 6475 6520 746f 207b 652e  tiers due to {e.
+0001a630: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+0001a640: 5f5f 7d2e 204d 6573 7361 6765 3a20 7b65  __}. Message: {e
+0001a650: 7d27 0a20 2020 2020 2020 2020 2020 2029  }'.            )
+0001a660: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
+0001a670: 6578 6365 7074 2063 6378 742e 4261 7365  except ccxt.Base
+0001a680: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
+0001a690: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
+0001a6a0: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
+0001a6b0: 6f6e 2865 2920 6672 6f6d 2065 0a0a 2020  on(e) from e..  
+0001a6c0: 2020 4072 6574 7269 6572 5f61 7379 6e63    @retrier_async
+0001a6d0: 0a20 2020 2061 7379 6e63 2064 6566 2067  .    async def g
+0001a6e0: 6574 5f6d 6172 6b65 745f 6c65 7665 7261  et_market_levera
+0001a6f0: 6765 5f74 6965 7273 2873 656c 662c 2073  ge_tiers(self, s
+0001a700: 796d 626f 6c3a 2073 7472 2920 2d3e 2054  ymbol: str) -> T
+0001a710: 7570 6c65 5b73 7472 2c20 4c69 7374 5b44  uple[str, List[D
+0001a720: 6963 745d 5d3a 0a20 2020 2020 2020 2022  ict]]:.        "
+0001a730: 2222 204c 6576 6572 6167 6520 7469 6572  "" Leverage tier
+0001a740: 7320 7065 7220 7379 6d62 6f6c 2022 2222  s per symbol """
+0001a750: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+0001a760: 2020 2020 2020 2020 2020 7469 6572 203d            tier =
+0001a770: 2061 7761 6974 2073 656c 662e 5f61 7069   await self._api
+0001a780: 5f61 7379 6e63 2e66 6574 6368 5f6d 6172  _async.fetch_mar
+0001a790: 6b65 745f 6c65 7665 7261 6765 5f74 6965  ket_leverage_tie
+0001a7a0: 7273 2873 796d 626f 6c29 0a20 2020 2020  rs(symbol).     
+0001a7b0: 2020 2020 2020 2072 6574 7572 6e20 7379         return sy
+0001a7c0: 6d62 6f6c 2c20 7469 6572 0a20 2020 2020  mbol, tier.     
+0001a7d0: 2020 2065 7863 6570 7420 6363 7874 2e44     except ccxt.D
+0001a7e0: 446f 5350 726f 7465 6374 696f 6e20 6173  DoSProtection as
+0001a7f0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0001a800: 7261 6973 6520 4444 6f73 5072 6f74 6563  raise DDosProtec
+0001a810: 7469 6f6e 2865 2920 6672 6f6d 2065 0a20  tion(e) from e. 
+0001a820: 2020 2020 2020 2065 7863 6570 7420 2863         except (c
+0001a830: 6378 742e 4e65 7477 6f72 6b45 7272 6f72  cxt.NetworkError
+0001a840: 2c20 6363 7874 2e45 7863 6861 6e67 6545  , ccxt.ExchangeE
+0001a850: 7272 6f72 2920 6173 2065 3a0a 2020 2020  rror) as e:.    
+0001a860: 2020 2020 2020 2020 7261 6973 6520 5465          raise Te
+0001a870: 6d70 6f72 6172 7945 7272 6f72 280a 2020  mporaryError(.  
+0001a880: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+0001a890: 436f 756c 6420 6e6f 7420 6c6f 6164 206c  Could not load l
+0001a8a0: 6576 6572 6167 6520 7469 6572 7320 666f  everage tiers fo
+0001a8b0: 7220 7b73 796d 626f 6c7d 270a 2020 2020  r {symbol}'.    
+0001a8c0: 2020 2020 2020 2020 2020 2020 6627 2064              f' d
+0001a8d0: 7565 2074 6f20 7b65 2e5f 5f63 6c61 7373  ue to {e.__class
+0001a8e0: 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20 4d65  __.__name__}. Me
+0001a8f0: 7373 6167 653a 207b 657d 270a 2020 2020  ssage: {e}'.    
+0001a900: 2020 2020 2020 2020 2920 6672 6f6d 2065          ) from e
+0001a910: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0001a920: 6363 7874 2e42 6173 6545 7272 6f72 2061  ccxt.BaseError a
+0001a930: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+0001a940: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
+0001a950: 616c 4578 6365 7074 696f 6e28 6529 2066  alException(e) f
+0001a960: 726f 6d20 650a 0a20 2020 2064 6566 206c  rom e..    def l
+0001a970: 6f61 645f 6c65 7665 7261 6765 5f74 6965  oad_leverage_tie
+0001a980: 7273 2873 656c 6629 202d 3e20 4469 6374  rs(self) -> Dict
+0001a990: 5b73 7472 2c20 4c69 7374 5b44 6963 745d  [str, List[Dict]
+0001a9a0: 5d3a 0a20 2020 2020 2020 2069 6620 7365  ]:.        if se
+0001a9b0: 6c66 2e74 7261 6469 6e67 5f6d 6f64 6520  lf.trading_mode 
+0001a9c0: 3d3d 2054 7261 6469 6e67 4d6f 6465 2e46  == TradingMode.F
+0001a9d0: 5554 5552 4553 3a0a 2020 2020 2020 2020  UTURES:.        
+0001a9e0: 2020 2020 6966 2073 656c 662e 6578 6368      if self.exch
+0001a9f0: 616e 6765 5f68 6173 2827 6665 7463 684c  ange_has('fetchL
+0001aa00: 6576 6572 6167 6554 6965 7273 2729 3a0a  everageTiers'):.
+0001aa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aa20: 2320 4665 7463 6820 616c 6c20 6c65 7665  # Fetch all leve
+0001aa30: 7261 6765 2074 6965 7273 2061 7420 6f6e  rage tiers at on
+0001aa40: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
+0001aa50: 2020 2072 6574 7572 6e20 7365 6c66 2e67     return self.g
+0001aa60: 6574 5f6c 6576 6572 6167 655f 7469 6572  et_leverage_tier
+0001aa70: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+0001aa80: 656c 6966 2073 656c 662e 6578 6368 616e  elif self.exchan
+0001aa90: 6765 5f68 6173 2827 6665 7463 684d 6172  ge_has('fetchMar
+0001aaa0: 6b65 744c 6576 6572 6167 6554 6965 7273  ketLeverageTiers
+0001aab0: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
+0001aac0: 2020 2020 2320 4d75 7374 2066 6574 6368      # Must fetch
+0001aad0: 2074 6865 206c 6576 6572 6167 6520 7469   the leverage ti
+0001aae0: 6572 7320 666f 7220 6561 6368 206d 6172  ers for each mar
+0001aaf0: 6b65 7420 7365 7061 7261 7465 6c79 0a20  ket separately. 
+0001ab00: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001ab10: 202a 2054 6869 7320 6973 2073 6c6f 7728   * This is slow(
+0001ab20: 7e34 3573 2920 6f6e 204f 6b78 2c20 6d61  ~45s) on Okx, ma
+0001ab30: 6b65 7320 7e39 3020 6170 6920 6361 6c6c  kes ~90 api call
+0001ab40: 7320 746f 206c 6f61 6420 616c 6c20 6c69  s to load all li
+0001ab50: 6e65 6172 2073 7761 7020 6d61 726b 6574  near swap market
+0001ab60: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+0001ab70: 2020 6d61 726b 6574 7320 3d20 7365 6c66    markets = self
+0001ab80: 2e6d 6172 6b65 7473 0a0a 2020 2020 2020  .markets..      
+0001ab90: 2020 2020 2020 2020 2020 7379 6d62 6f6c            symbol
+0001aba0: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
+0001abb0: 2020 2020 2020 2020 2020 7379 6d62 6f6c            symbol
+0001abc0: 2066 6f72 2073 796d 626f 6c2c 206d 6172   for symbol, mar
+0001abd0: 6b65 7420 696e 206d 6172 6b65 7473 2e69  ket in markets.i
+0001abe0: 7465 6d73 2829 0a20 2020 2020 2020 2020  tems().         
+0001abf0: 2020 2020 2020 2020 2020 2069 6620 2873             if (s
+0001ac00: 656c 662e 6d61 726b 6574 5f69 735f 6675  elf.market_is_fu
+0001ac10: 7475 7265 286d 6172 6b65 7429 0a20 2020  ture(market).   
+0001ac20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac30: 2020 2020 2061 6e64 206d 6172 6b65 745b       and market[
+0001ac40: 2771 756f 7465 275d 203d 3d20 7365 6c66  'quote'] == self
+0001ac50: 2e5f 636f 6e66 6967 5b27 7374 616b 655f  ._config['stake_
+0001ac60: 6375 7272 656e 6379 275d 290a 2020 2020  currency']).    
+0001ac70: 2020 2020 2020 2020 2020 2020 5d0a 0a20              ].. 
+0001ac80: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001ac90: 6965 7273 3a20 4469 6374 5b73 7472 2c20  iers: Dict[str, 
+0001aca0: 4c69 7374 5b44 6963 745d 5d20 3d20 7b7d  List[Dict]] = {}
+0001acb0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001acc0: 2020 7469 6572 735f 6361 6368 6564 203d    tiers_cached =
+0001acd0: 2073 656c 662e 6c6f 6164 5f63 6163 6865   self.load_cache
+0001ace0: 645f 6c65 7665 7261 6765 5f74 6965 7273  d_leverage_tiers
+0001acf0: 2873 656c 662e 5f63 6f6e 6669 675b 2773  (self._config['s
+0001ad00: 7461 6b65 5f63 7572 7265 6e63 7927 5d29  take_currency'])
+0001ad10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ad20: 2069 6620 7469 6572 735f 6361 6368 6564   if tiers_cached
+0001ad30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001ad40: 2020 2020 2020 7469 6572 7320 3d20 7469        tiers = ti
+0001ad50: 6572 735f 6361 6368 6564 0a0a 2020 2020  ers_cached..    
+0001ad60: 2020 2020 2020 2020 2020 2020 636f 726f              coro
+0001ad70: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
+0001ad80: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
+0001ad90: 6574 5f6d 6172 6b65 745f 6c65 7665 7261  et_market_levera
+0001ada0: 6765 5f74 6965 7273 2873 796d 626f 6c29  ge_tiers(symbol)
+0001adb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001adc0: 2020 2020 2066 6f72 2073 796d 626f 6c20       for symbol 
+0001add0: 696e 2073 6f72 7465 6428 7379 6d62 6f6c  in sorted(symbol
+0001ade0: 7329 2069 6620 7379 6d62 6f6c 206e 6f74  s) if symbol not
+0001adf0: 2069 6e20 7469 6572 735d 0a0a 2020 2020   in tiers]..    
+0001ae00: 2020 2020 2020 2020 2020 2020 2320 4265              # Be
+0001ae10: 2076 6572 626f 7365 2068 6572 652c 2061   verbose here, a
+0001ae20: 7320 7468 6973 2064 656c 6179 7320 7374  s this delays st
+0001ae30: 6172 7475 7020 6279 207e 3120 6d69 6e75  artup by ~1 minu
+0001ae40: 7465 2e0a 2020 2020 2020 2020 2020 2020  te..            
+0001ae50: 2020 2020 6966 2063 6f72 6f73 3a0a 2020      if coros:.  
+0001ae60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ae70: 2020 6c6f 6767 6572 2e69 6e66 6f28 0a20    logger.info(. 
 0001ae80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae90: 6622 496e 6974 6961 6c69 7a69 6e67 206c  f"Initializing l
-0001aea0: 6576 6572 6167 655f 7469 6572 7320 666f  everage_tiers fo
-0001aeb0: 7220 7b6c 656e 2873 796d 626f 6c73 297d  r {len(symbols)}
-0001aec0: 206d 6172 6b65 7473 2e20 220a 2020 2020   markets. ".    
-0001aed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aee0: 2020 2020 2254 6869 7320 7769 6c6c 2074      "This will t
-0001aef0: 616b 6520 6162 6f75 7420 6120 6d69 6e75  ake about a minu
-0001af00: 7465 2e22 290a 2020 2020 2020 2020 2020  te.").          
-0001af10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001af20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af30: 6c6f 6767 6572 2e69 6e66 6f28 2255 7369  logger.info("Usi
-0001af40: 6e67 2063 6163 6865 6420 6c65 7665 7261  ng cached levera
-0001af50: 6765 5f74 6965 7273 2e22 290a 0a20 2020  ge_tiers.")..   
-0001af60: 2020 2020 2020 2020 2020 2020 2061 7379               asy
-0001af70: 6e63 2064 6566 2067 6174 6865 725f 7265  nc def gather_re
-0001af80: 7375 6c74 7328 696e 7075 745f 636f 726f  sults(input_coro
-0001af90: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001afa0: 2020 2020 2020 2072 6574 7572 6e20 6177         return aw
-0001afb0: 6169 7420 6173 796e 6369 6f2e 6761 7468  ait asyncio.gath
-0001afc0: 6572 282a 696e 7075 745f 636f 726f 2c20  er(*input_coro, 
-0001afd0: 7265 7475 726e 5f65 7863 6570 7469 6f6e  return_exception
-0001afe0: 733d 5472 7565 290a 0a20 2020 2020 2020  s=True)..       
-0001aff0: 2020 2020 2020 2020 2066 6f72 2069 6e70           for inp
-0001b000: 7574 5f63 6f72 6f20 696e 2063 6875 6e6b  ut_coro in chunk
-0001b010: 7328 636f 726f 732c 2031 3030 293a 0a0a  s(coros, 100):..
-0001b020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b030: 2020 2020 7769 7468 2073 656c 662e 5f6c      with self._l
-0001b040: 6f6f 705f 6c6f 636b 3a0a 2020 2020 2020  oop_lock:.      
-0001b050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b060: 2020 7265 7375 6c74 7320 3d20 7365 6c66    results = self
-0001b070: 2e6c 6f6f 702e 7275 6e5f 756e 7469 6c5f  .loop.run_until_
-0001b080: 636f 6d70 6c65 7465 2867 6174 6865 725f  complete(gather_
-0001b090: 7265 7375 6c74 7328 696e 7075 745f 636f  results(input_co
-0001b0a0: 726f 2929 0a0a 2020 2020 2020 2020 2020  ro))..          
-0001b0b0: 2020 2020 2020 2020 2020 666f 7220 7265            for re
-0001b0c0: 7320 696e 2072 6573 756c 7473 3a0a 2020  s in results:.  
-0001b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b0e0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0001b0f0: 6e63 6528 7265 732c 2045 7863 6570 7469  nce(res, Excepti
-0001b100: 6f6e 293a 0a20 2020 2020 2020 2020 2020  on):.           
+0001ae90: 2020 2020 2020 2066 2249 6e69 7469 616c         f"Initial
+0001aea0: 697a 696e 6720 6c65 7665 7261 6765 5f74  izing leverage_t
+0001aeb0: 6965 7273 2066 6f72 207b 6c65 6e28 7379  iers for {len(sy
+0001aec0: 6d62 6f6c 7329 7d20 6d61 726b 6574 732e  mbols)} markets.
+0001aed0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0001aee0: 2020 2020 2020 2020 2020 2022 5468 6973             "This
+0001aef0: 2077 696c 6c20 7461 6b65 2061 626f 7574   will take about
+0001af00: 2061 206d 696e 7574 652e 2229 0a20 2020   a minute.").   
+0001af10: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0001af20: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001af30: 2020 2020 2020 206c 6f67 6765 722e 696e         logger.in
+0001af40: 666f 2822 5573 696e 6720 6361 6368 6564  fo("Using cached
+0001af50: 206c 6576 6572 6167 655f 7469 6572 732e   leverage_tiers.
+0001af60: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
+0001af70: 2020 2020 6173 796e 6320 6465 6620 6761      async def ga
+0001af80: 7468 6572 5f72 6573 756c 7473 2869 6e70  ther_results(inp
+0001af90: 7574 5f63 6f72 6f29 3a0a 2020 2020 2020  ut_coro):.      
+0001afa0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0001afb0: 7475 726e 2061 7761 6974 2061 7379 6e63  turn await async
+0001afc0: 696f 2e67 6174 6865 7228 2a69 6e70 7574  io.gather(*input
+0001afd0: 5f63 6f72 6f2c 2072 6574 7572 6e5f 6578  _coro, return_ex
+0001afe0: 6365 7074 696f 6e73 3d54 7275 6529 0a0a  ceptions=True)..
+0001aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b000: 666f 7220 696e 7075 745f 636f 726f 2069  for input_coro i
+0001b010: 6e20 6368 756e 6b73 2863 6f72 6f73 2c20  n chunks(coros, 
+0001b020: 3130 3029 3a0a 0a20 2020 2020 2020 2020  100):..         
+0001b030: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0001b040: 7365 6c66 2e5f 6c6f 6f70 5f6c 6f63 6b3a  self._loop_lock:
+0001b050: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b060: 2020 2020 2020 2020 2072 6573 756c 7473           results
+0001b070: 203d 2073 656c 662e 6c6f 6f70 2e72 756e   = self.loop.run
+0001b080: 5f75 6e74 696c 5f63 6f6d 706c 6574 6528  _until_complete(
+0001b090: 6761 7468 6572 5f72 6573 756c 7473 2869  gather_results(i
+0001b0a0: 6e70 7574 5f63 6f72 6f29 290a 0a20 2020  nput_coro))..   
+0001b0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b0c0: 2066 6f72 2072 6573 2069 6e20 7265 7375   for res in resu
+0001b0d0: 6c74 733a 0a20 2020 2020 2020 2020 2020  lts:.           
+0001b0e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001b0f0: 6973 696e 7374 616e 6365 2872 6573 2c20  isinstance(res, 
+0001b100: 4578 6365 7074 696f 6e29 3a0a 2020 2020  Exception):.    
 0001b110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b120: 206c 6f67 6765 722e 7761 726e 696e 6728   logger.warning(
-0001b130: 6622 4c65 7665 7261 6765 2074 6965 7220  f"Leverage tier 
-0001b140: 6578 6365 7074 696f 6e3a 207b 7265 7072  exception: {repr
-0001b150: 2872 6573 297d 2229 0a20 2020 2020 2020  (res)}").       
+0001b120: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
+0001b130: 6172 6e69 6e67 2866 224c 6576 6572 6167  arning(f"Leverag
+0001b140: 6520 7469 6572 2065 7863 6570 7469 6f6e  e tier exception
+0001b150: 3a20 7b72 6570 7228 7265 7329 7d22 290a  : {repr(res)}").
 0001b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b170: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
-0001b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b190: 2020 2020 2020 7379 6d62 6f6c 2c20 7469        symbol, ti
-0001b1a0: 6572 203d 2072 6573 0a20 2020 2020 2020  er = res.       
+0001b170: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0001b180: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+0001b190: 2020 2020 2020 2020 2020 2020 2073 796d               sym
+0001b1a0: 626f 6c2c 2074 6965 7220 3d20 7265 730a  bol, tier = res.
 0001b1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1c0: 2074 6965 7273 5b73 796d 626f 6c5d 203d   tiers[symbol] =
-0001b1d0: 2074 6965 720a 2020 2020 2020 2020 2020   tier.          
-0001b1e0: 2020 2020 2020 6966 206c 656e 2863 6f72        if len(cor
-0001b1f0: 6f73 2920 3e20 303a 0a20 2020 2020 2020  os) > 0:.       
-0001b200: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001b210: 662e 6361 6368 655f 6c65 7665 7261 6765  f.cache_leverage
-0001b220: 5f74 6965 7273 2874 6965 7273 2c20 7365  _tiers(tiers, se
-0001b230: 6c66 2e5f 636f 6e66 6967 5b27 7374 616b  lf._config['stak
-0001b240: 655f 6375 7272 656e 6379 275d 290a 2020  e_currency']).  
-0001b250: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-0001b260: 6767 6572 2e69 6e66 6f28 6622 446f 6e65  gger.info(f"Done
-0001b270: 2069 6e69 7469 616c 697a 696e 6720 7b6c   initializing {l
-0001b280: 656e 2873 796d 626f 6c73 297d 206d 6172  en(symbols)} mar
-0001b290: 6b65 7473 2e22 290a 0a20 2020 2020 2020  kets.")..       
-0001b2a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001b2b0: 7469 6572 730a 2020 2020 2020 2020 7265  tiers.        re
-0001b2c0: 7475 726e 207b 7d0a 0a20 2020 2064 6566  turn {}..    def
-0001b2d0: 2063 6163 6865 5f6c 6576 6572 6167 655f   cache_leverage_
-0001b2e0: 7469 6572 7328 7365 6c66 2c20 7469 6572  tiers(self, tier
-0001b2f0: 733a 2044 6963 745b 7374 722c 204c 6973  s: Dict[str, Lis
-0001b300: 745b 4469 6374 5d5d 2c20 7374 616b 655f  t[Dict]], stake_
-0001b310: 6375 7272 656e 6379 3a20 7374 7229 202d  currency: str) -
-0001b320: 3e20 4e6f 6e65 3a0a 0a20 2020 2020 2020  > None:..       
-0001b330: 2066 696c 656e 616d 6520 3d20 7365 6c66   filename = self
-0001b340: 2e5f 636f 6e66 6967 5b27 6461 7461 6469  ._config['datadi
-0001b350: 7227 5d20 2f20 2266 7574 7572 6573 2220  r'] / "futures" 
-0001b360: 2f20 6622 6c65 7665 7261 6765 5f74 6965  / f"leverage_tie
-0001b370: 7273 5f7b 7374 616b 655f 6375 7272 656e  rs_{stake_curren
-0001b380: 6379 7d2e 6a73 6f6e 220a 2020 2020 2020  cy}.json".      
-0001b390: 2020 6966 206e 6f74 2066 696c 656e 616d    if not filenam
-0001b3a0: 652e 7061 7265 6e74 2e69 735f 6469 7228  e.parent.is_dir(
-0001b3b0: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
-0001b3c0: 696c 656e 616d 652e 7061 7265 6e74 2e6d  ilename.parent.m
-0001b3d0: 6b64 6972 2870 6172 656e 7473 3d54 7275  kdir(parents=Tru
-0001b3e0: 6529 0a20 2020 2020 2020 2064 6174 6120  e).        data 
-0001b3f0: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
-0001b400: 2275 7064 6174 6564 223a 2064 6174 6574  "updated": datet
-0001b410: 696d 652e 6e6f 7728 7469 6d65 7a6f 6e65  ime.now(timezone
-0001b420: 2e75 7463 292c 0a20 2020 2020 2020 2020  .utc),.         
-0001b430: 2020 2022 6461 7461 223a 2074 6965 7273     "data": tiers
-0001b440: 2c0a 2020 2020 2020 2020 7d0a 2020 2020  ,.        }.    
-0001b450: 2020 2020 6669 6c65 5f64 756d 705f 6a73      file_dump_js
-0001b460: 6f6e 2866 696c 656e 616d 652c 2064 6174  on(filename, dat
-0001b470: 6129 0a0a 2020 2020 6465 6620 6c6f 6164  a)..    def load
-0001b480: 5f63 6163 6865 645f 6c65 7665 7261 6765  _cached_leverage
-0001b490: 5f74 6965 7273 2873 656c 662c 2073 7461  _tiers(self, sta
-0001b4a0: 6b65 5f63 7572 7265 6e63 793a 2073 7472  ke_currency: str
-0001b4b0: 2920 2d3e 204f 7074 696f 6e61 6c5b 4469  ) -> Optional[Di
-0001b4c0: 6374 5b73 7472 2c20 4c69 7374 5b44 6963  ct[str, List[Dic
-0001b4d0: 745d 5d5d 3a0a 2020 2020 2020 2020 6669  t]]]:.        fi
-0001b4e0: 6c65 6e61 6d65 203d 2073 656c 662e 5f63  lename = self._c
-0001b4f0: 6f6e 6669 675b 2764 6174 6164 6972 275d  onfig['datadir']
-0001b500: 202f 2022 6675 7475 7265 7322 202f 2066   / "futures" / f
-0001b510: 226c 6576 6572 6167 655f 7469 6572 735f  "leverage_tiers_
-0001b520: 7b73 7461 6b65 5f63 7572 7265 6e63 797d  {stake_currency}
-0001b530: 2e6a 736f 6e22 0a20 2020 2020 2020 2069  .json".        i
-0001b540: 6620 6669 6c65 6e61 6d65 2e69 735f 6669  f filename.is_fi
-0001b550: 6c65 2829 3a0a 2020 2020 2020 2020 2020  le():.          
-0001b560: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0001b570: 2020 2020 2020 2074 6965 7273 203d 2066         tiers = f
-0001b580: 696c 655f 6c6f 6164 5f6a 736f 6e28 6669  ile_load_json(fi
-0001b590: 6c65 6e61 6d65 290a 2020 2020 2020 2020  lename).        
-0001b5a0: 2020 2020 2020 2020 7570 6461 7465 6420          updated 
-0001b5b0: 3d20 7469 6572 732e 6765 7428 2775 7064  = tiers.get('upd
-0001b5c0: 6174 6564 2729 0a20 2020 2020 2020 2020  ated').         
-0001b5d0: 2020 2020 2020 2069 6620 7570 6461 7465         if update
-0001b5e0: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
-0001b5f0: 2020 2020 2020 2075 7064 6174 6564 5f64         updated_d
-0001b600: 7420 3d20 7061 7273 6572 2e70 6172 7365  t = parser.parse
-0001b610: 2875 7064 6174 6564 290a 2020 2020 2020  (updated).      
-0001b620: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001b630: 2075 7064 6174 6564 5f64 7420 3c20 6461   updated_dt < da
-0001b640: 7465 7469 6d65 2e6e 6f77 2874 696d 657a  tetime.now(timez
-0001b650: 6f6e 652e 7574 6329 202d 2074 696d 6564  one.utc) - timed
-0001b660: 656c 7461 2877 6565 6b73 3d34 293a 0a20  elta(weeks=4):. 
-0001b670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b680: 2020 2020 2020 206c 6f67 6765 722e 696e         logger.in
-0001b690: 666f 2822 4361 6368 6564 206c 6576 6572  fo("Cached lever
-0001b6a0: 6167 6520 7469 6572 7320 6172 6520 6f75  age tiers are ou
-0001b6b0: 7464 6174 6564 2e20 5769 6c6c 2075 7064  tdated. Will upd
-0001b6c0: 6174 652e 2229 0a20 2020 2020 2020 2020  ate.").         
-0001b6d0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001b6e0: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
-0001b6f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001b700: 6e20 7469 6572 735b 2764 6174 6127 5d0a  n tiers['data'].
-0001b710: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-0001b720: 7074 2045 7863 6570 7469 6f6e 3a0a 2020  pt Exception:.  
-0001b730: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-0001b740: 6767 6572 2e65 7863 6570 7469 6f6e 2822  gger.exception("
-0001b750: 4572 726f 7220 6c6f 6164 696e 6720 6361  Error loading ca
-0001b760: 6368 6564 206c 6576 6572 6167 6520 7469  ched leverage ti
-0001b770: 6572 732e 2052 6566 7265 7368 696e 672e  ers. Refreshing.
-0001b780: 2229 0a20 2020 2020 2020 2072 6574 7572  ").        retur
-0001b790: 6e20 4e6f 6e65 0a0a 2020 2020 6465 6620  n None..    def 
-0001b7a0: 6669 6c6c 5f6c 6576 6572 6167 655f 7469  fill_leverage_ti
-0001b7b0: 6572 7328 7365 6c66 2920 2d3e 204e 6f6e  ers(self) -> Non
-0001b7c0: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
-0001b7d0: 2020 2020 2020 2041 7373 6967 6e73 2070         Assigns p
-0001b7e0: 726f 7065 7274 7920 5f6c 6576 6572 6167  roperty _leverag
-0001b7f0: 655f 7469 6572 7320 746f 2061 2064 6963  e_tiers to a dic
-0001b800: 7469 6f6e 6172 7920 6f66 2069 6e66 6f72  tionary of infor
-0001b810: 6d61 7469 6f6e 2061 626f 7574 2074 6865  mation about the
-0001b820: 206c 6576 6572 6167 650a 2020 2020 2020   leverage.      
-0001b830: 2020 616c 6c6f 7765 6420 6f6e 2065 6163    allowed on eac
-0001b840: 6820 7061 6972 0a20 2020 2020 2020 2022  h pair.        "
-0001b850: 2222 0a20 2020 2020 2020 206c 6576 6572  "".        lever
-0001b860: 6167 655f 7469 6572 7320 3d20 7365 6c66  age_tiers = self
-0001b870: 2e6c 6f61 645f 6c65 7665 7261 6765 5f74  .load_leverage_t
-0001b880: 6965 7273 2829 0a20 2020 2020 2020 2066  iers().        f
-0001b890: 6f72 2070 6169 722c 2074 6965 7273 2069  or pair, tiers i
-0001b8a0: 6e20 6c65 7665 7261 6765 5f74 6965 7273  n leverage_tiers
-0001b8b0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-0001b8c0: 2020 2020 2020 7061 6972 5f74 6965 7273        pair_tiers
-0001b8d0: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-0001b8e0: 2020 666f 7220 7469 6572 2069 6e20 7469    for tier in ti
-0001b8f0: 6572 733a 0a20 2020 2020 2020 2020 2020  ers:.           
-0001b900: 2020 2020 2070 6169 725f 7469 6572 732e       pair_tiers.
-0001b910: 6170 7065 6e64 2873 656c 662e 7061 7273  append(self.pars
-0001b920: 655f 6c65 7665 7261 6765 5f74 6965 7228  e_leverage_tier(
-0001b930: 7469 6572 2929 0a20 2020 2020 2020 2020  tier)).         
-0001b940: 2020 2073 656c 662e 5f6c 6576 6572 6167     self._leverag
-0001b950: 655f 7469 6572 735b 7061 6972 5d20 3d20  e_tiers[pair] = 
-0001b960: 7061 6972 5f74 6965 7273 0a0a 2020 2020  pair_tiers..    
-0001b970: 6465 6620 7061 7273 655f 6c65 7665 7261  def parse_levera
-0001b980: 6765 5f74 6965 7228 7365 6c66 2c20 7469  ge_tier(self, ti
-0001b990: 6572 2920 2d3e 2044 6963 743a 0a20 2020  er) -> Dict:.   
-0001b9a0: 2020 2020 2069 6e66 6f20 3d20 7469 6572       info = tier
-0001b9b0: 2e67 6574 2827 696e 666f 272c 207b 7d29  .get('info', {})
-0001b9c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001b9d0: 7b0a 2020 2020 2020 2020 2020 2020 276d  {.            'm
-0001b9e0: 696e 4e6f 7469 6f6e 616c 273a 2074 6965  inNotional': tie
-0001b9f0: 725b 276d 696e 4e6f 7469 6f6e 616c 275d  r['minNotional']
-0001ba00: 2c0a 2020 2020 2020 2020 2020 2020 276d  ,.            'm
-0001ba10: 6178 4e6f 7469 6f6e 616c 273a 2074 6965  axNotional': tie
-0001ba20: 725b 276d 6178 4e6f 7469 6f6e 616c 275d  r['maxNotional']
-0001ba30: 2c0a 2020 2020 2020 2020 2020 2020 276d  ,.            'm
-0001ba40: 6169 6e74 656e 616e 6365 4d61 7267 696e  aintenanceMargin
-0001ba50: 5261 7465 273a 2074 6965 725b 276d 6169  Rate': tier['mai
-0001ba60: 6e74 656e 616e 6365 4d61 7267 696e 5261  ntenanceMarginRa
-0001ba70: 7465 275d 2c0a 2020 2020 2020 2020 2020  te'],.          
-0001ba80: 2020 276d 6178 4c65 7665 7261 6765 273a    'maxLeverage':
-0001ba90: 2074 6965 725b 276d 6178 4c65 7665 7261   tier['maxLevera
-0001baa0: 6765 275d 2c0a 2020 2020 2020 2020 2020  ge'],.          
-0001bab0: 2020 276d 6169 6e74 416d 7427 3a20 666c    'maintAmt': fl
-0001bac0: 6f61 7428 696e 666f 5b27 6375 6d27 5d29  oat(info['cum'])
-0001bad0: 2069 6620 2763 756d 2720 696e 2069 6e66   if 'cum' in inf
-0001bae0: 6f20 656c 7365 204e 6f6e 652c 0a20 2020  o else None,.   
-0001baf0: 2020 2020 207d 0a0a 2020 2020 6465 6620       }..    def 
-0001bb00: 6765 745f 6d61 785f 6c65 7665 7261 6765  get_max_leverage
-0001bb10: 2873 656c 662c 2070 6169 723a 2073 7472  (self, pair: str
-0001bb20: 2c20 7374 616b 655f 616d 6f75 6e74 3a20  , stake_amount: 
-0001bb30: 4f70 7469 6f6e 616c 5b66 6c6f 6174 5d29  Optional[float])
-0001bb40: 202d 3e20 666c 6f61 743a 0a20 2020 2020   -> float:.     
-0001bb50: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
-0001bb60: 6574 7572 6e73 2074 6865 206d 6178 696d  eturns the maxim
-0001bb70: 756d 206c 6576 6572 6167 6520 7468 6174  um leverage that
-0001bb80: 2061 2070 6169 7220 6361 6e20 6265 2074   a pair can be t
-0001bb90: 7261 6465 6420 6174 0a20 2020 2020 2020  raded at.       
-0001bba0: 203a 7061 7261 6d20 7061 6972 3a20 5468   :param pair: Th
-0001bbb0: 6520 6261 7365 2f71 756f 7465 2063 7572  e base/quote cur
-0001bbc0: 7265 6e63 7920 7061 6972 2062 6569 6e67  rency pair being
-0001bbd0: 2074 7261 6465 640a 2020 2020 2020 2020   traded.        
-0001bbe0: 3a73 7461 6b65 5f61 6d6f 756e 743a 2054  :stake_amount: T
-0001bbf0: 6865 2074 6f74 616c 2076 616c 7565 206f  he total value o
-0001bc00: 6620 7468 6520 7472 6164 6572 7320 6d61  f the traders ma
-0001bc10: 7267 696e 5f6d 6f64 6520 696e 2071 756f  rgin_mode in quo
-0001bc20: 7465 2063 7572 7265 6e63 790a 2020 2020  te currency.    
-0001bc30: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-0001bc40: 2069 6620 7365 6c66 2e74 7261 6469 6e67   if self.trading
-0001bc50: 5f6d 6f64 6520 3d3d 2054 7261 6469 6e67  _mode == Trading
-0001bc60: 4d6f 6465 2e53 504f 543a 0a20 2020 2020  Mode.SPOT:.     
-0001bc70: 2020 2020 2020 2072 6574 7572 6e20 312e         return 1.
-0001bc80: 300a 0a20 2020 2020 2020 2069 6620 7365  0..        if se
-0001bc90: 6c66 2e74 7261 6469 6e67 5f6d 6f64 6520  lf.trading_mode 
-0001bca0: 3d3d 2054 7261 6469 6e67 4d6f 6465 2e46  == TradingMode.F
-0001bcb0: 5554 5552 4553 3a0a 0a20 2020 2020 2020  UTURES:..       
-0001bcc0: 2020 2020 2023 2043 6865 636b 7320 616e       # Checks an
-0001bcd0: 6420 6564 6765 2063 6173 6573 0a20 2020  d edge cases.   
-0001bce0: 2020 2020 2020 2020 2069 6620 7374 616b           if stak
-0001bcf0: 655f 616d 6f75 6e74 2069 7320 4e6f 6e65  e_amount is None
-0001bd00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001bd10: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
-0001bd20: 6e61 6c45 7863 6570 7469 6f6e 280a 2020  nalException(.  
-0001bd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bd40: 2020 6627 7b73 656c 662e 6e61 6d65 7d2e    f'{self.name}.
-0001bd50: 6765 745f 6d61 785f 6c65 7665 7261 6765  get_max_leverage
-0001bd60: 2072 6571 7569 7265 7320 6172 6775 6d65   requires argume
-0001bd70: 6e74 2073 7461 6b65 5f61 6d6f 756e 7427  nt stake_amount'
-0001bd80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bd90: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
-0001bda0: 6966 2070 6169 7220 6e6f 7420 696e 2073  if pair not in s
-0001bdb0: 656c 662e 5f6c 6576 6572 6167 655f 7469  elf._leverage_ti
-0001bdc0: 6572 733a 0a20 2020 2020 2020 2020 2020  ers:.           
-0001bdd0: 2020 2020 2023 204d 6179 6265 2072 6169       # Maybe rai
-0001bde0: 7365 2065 7863 6570 7469 6f6e 2062 6563  se exception bec
-0001bdf0: 6175 7365 2069 7420 6361 6e27 7420 6265  ause it can't be
-0001be00: 2074 7261 6465 6420 6f6e 2066 7574 7572   traded on futur
-0001be10: 6573 3f0a 2020 2020 2020 2020 2020 2020  es?.            
-0001be20: 2020 2020 7265 7475 726e 2031 2e30 0a0a      return 1.0..
-0001be30: 2020 2020 2020 2020 2020 2020 7061 6972              pair
-0001be40: 5f74 6965 7273 203d 2073 656c 662e 5f6c  _tiers = self._l
-0001be50: 6576 6572 6167 655f 7469 6572 735b 7061  everage_tiers[pa
-0001be60: 6972 5d0a 0a20 2020 2020 2020 2020 2020  ir]..           
-0001be70: 2069 6620 7374 616b 655f 616d 6f75 6e74   if stake_amount
-0001be80: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0001be90: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0001bea0: 6c66 2e5f 6c65 7665 7261 6765 5f74 6965  lf._leverage_tie
-0001beb0: 7273 5b70 6169 725d 5b30 5d5b 276d 6178  rs[pair][0]['max
-0001bec0: 4c65 7665 7261 6765 275d 2020 2320 4d61  Leverage']  # Ma
-0001bed0: 7820 6c65 7620 666f 7220 6c6f 7765 7374  x lev for lowest
-0001bee0: 2061 6d6f 756e 740a 0a20 2020 2020 2020   amount..       
-0001bef0: 2020 2020 2066 6f72 2074 6965 725f 696e       for tier_in
-0001bf00: 6465 7820 696e 2072 616e 6765 286c 656e  dex in range(len
-0001bf10: 2870 6169 725f 7469 6572 7329 293a 0a0a  (pair_tiers)):..
-0001bf20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf30: 7469 6572 203d 2070 6169 725f 7469 6572  tier = pair_tier
-0001bf40: 735b 7469 6572 5f69 6e64 6578 5d0a 2020  s[tier_index].  
-0001bf50: 2020 2020 2020 2020 2020 2020 2020 6c65                le
-0001bf60: 7620 3d20 7469 6572 5b27 6d61 784c 6576  v = tier['maxLev
-0001bf70: 6572 6167 6527 5d0a 0a20 2020 2020 2020  erage']..       
-0001bf80: 2020 2020 2020 2020 2069 6620 7469 6572           if tier
-0001bf90: 5f69 6e64 6578 203c 206c 656e 2870 6169  _index < len(pai
-0001bfa0: 725f 7469 6572 7329 202d 2031 3a0a 2020  r_tiers) - 1:.  
-0001bfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bfc0: 2020 6e65 7874 5f74 6965 7220 3d20 7061    next_tier = pa
-0001bfd0: 6972 5f74 6965 7273 5b74 6965 725f 696e  ir_tiers[tier_in
-0001bfe0: 6465 7820 2b20 315d 0a20 2020 2020 2020  dex + 1].       
-0001bff0: 2020 2020 2020 2020 2020 2020 206e 6578               nex
-0001c000: 745f 666c 6f6f 7220 3d20 6e65 7874 5f74  t_floor = next_t
-0001c010: 6965 725b 276d 696e 4e6f 7469 6f6e 616c  ier['minNotional
-0001c020: 275d 202f 206e 6578 745f 7469 6572 5b27  '] / next_tier['
-0001c030: 6d61 784c 6576 6572 6167 6527 5d0a 2020  maxLeverage'].  
-0001c040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c050: 2020 6966 206e 6578 745f 666c 6f6f 7220    if next_floor 
-0001c060: 3e20 7374 616b 655f 616d 6f75 6e74 3a20  > stake_amount: 
-0001c070: 2023 204e 6578 7420 7469 6572 206d 696e   # Next tier min
-0001c080: 2074 6f6f 2068 6967 6820 666f 7220 7374   too high for st
-0001c090: 616b 6520 616d 6f75 6e74 0a20 2020 2020  ake amount.     
-0001c0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0b0: 2020 2072 6574 7572 6e20 6d69 6e28 2874     return min((t
-0001c0c0: 6965 725b 276d 6178 4e6f 7469 6f6e 616c  ier['maxNotional
-0001c0d0: 275d 202f 2073 7461 6b65 5f61 6d6f 756e  '] / stake_amoun
-0001c0e0: 7429 2c20 6c65 7629 0a20 2020 2020 2020  t), lev).       
+0001b1c0: 2020 2020 2020 2020 7469 6572 735b 7379          tiers[sy
+0001b1d0: 6d62 6f6c 5d20 3d20 7469 6572 0a20 2020  mbol] = tier.   
+0001b1e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001b1f0: 6c65 6e28 636f 726f 7329 203e 2030 3a0a  len(coros) > 0:.
+0001b200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b210: 2020 2020 7365 6c66 2e63 6163 6865 5f6c      self.cache_l
+0001b220: 6576 6572 6167 655f 7469 6572 7328 7469  everage_tiers(ti
+0001b230: 6572 732c 2073 656c 662e 5f63 6f6e 6669  ers, self._confi
+0001b240: 675b 2773 7461 6b65 5f63 7572 7265 6e63  g['stake_currenc
+0001b250: 7927 5d29 0a20 2020 2020 2020 2020 2020  y']).           
+0001b260: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
+0001b270: 2866 2244 6f6e 6520 696e 6974 6961 6c69  (f"Done initiali
+0001b280: 7a69 6e67 207b 6c65 6e28 7379 6d62 6f6c  zing {len(symbol
+0001b290: 7329 7d20 6d61 726b 6574 732e 2229 0a0a  s)} markets.")..
+0001b2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b2b0: 7265 7475 726e 2074 6965 7273 0a20 2020  return tiers.   
+0001b2c0: 2020 2020 2072 6574 7572 6e20 7b7d 0a0a       return {}..
+0001b2d0: 2020 2020 6465 6620 6361 6368 655f 6c65      def cache_le
+0001b2e0: 7665 7261 6765 5f74 6965 7273 2873 656c  verage_tiers(sel
+0001b2f0: 662c 2074 6965 7273 3a20 4469 6374 5b73  f, tiers: Dict[s
+0001b300: 7472 2c20 4c69 7374 5b44 6963 745d 5d2c  tr, List[Dict]],
+0001b310: 2073 7461 6b65 5f63 7572 7265 6e63 793a   stake_currency:
+0001b320: 2073 7472 2920 2d3e 204e 6f6e 653a 0a0a   str) -> None:..
+0001b330: 2020 2020 2020 2020 6669 6c65 6e61 6d65          filename
+0001b340: 203d 2073 656c 662e 5f63 6f6e 6669 675b   = self._config[
+0001b350: 2764 6174 6164 6972 275d 202f 2022 6675  'datadir'] / "fu
+0001b360: 7475 7265 7322 202f 2066 226c 6576 6572  tures" / f"lever
+0001b370: 6167 655f 7469 6572 735f 7b73 7461 6b65  age_tiers_{stake
+0001b380: 5f63 7572 7265 6e63 797d 2e6a 736f 6e22  _currency}.json"
+0001b390: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0001b3a0: 6669 6c65 6e61 6d65 2e70 6172 656e 742e  filename.parent.
+0001b3b0: 6973 5f64 6972 2829 3a0a 2020 2020 2020  is_dir():.      
+0001b3c0: 2020 2020 2020 6669 6c65 6e61 6d65 2e70        filename.p
+0001b3d0: 6172 656e 742e 6d6b 6469 7228 7061 7265  arent.mkdir(pare
+0001b3e0: 6e74 733d 5472 7565 290a 2020 2020 2020  nts=True).      
+0001b3f0: 2020 6461 7461 203d 207b 0a20 2020 2020    data = {.     
+0001b400: 2020 2020 2020 2022 7570 6461 7465 6422         "updated"
+0001b410: 3a20 6461 7465 7469 6d65 2e6e 6f77 2874  : datetime.now(t
+0001b420: 696d 657a 6f6e 652e 7574 6329 2c0a 2020  imezone.utc),.  
+0001b430: 2020 2020 2020 2020 2020 2264 6174 6122            "data"
+0001b440: 3a20 7469 6572 732c 0a20 2020 2020 2020  : tiers,.       
+0001b450: 207d 0a20 2020 2020 2020 2066 696c 655f   }.        file_
+0001b460: 6475 6d70 5f6a 736f 6e28 6669 6c65 6e61  dump_json(filena
+0001b470: 6d65 2c20 6461 7461 290a 0a20 2020 2064  me, data)..    d
+0001b480: 6566 206c 6f61 645f 6361 6368 6564 5f6c  ef load_cached_l
+0001b490: 6576 6572 6167 655f 7469 6572 7328 7365  everage_tiers(se
+0001b4a0: 6c66 2c20 7374 616b 655f 6375 7272 656e  lf, stake_curren
+0001b4b0: 6379 3a20 7374 7229 202d 3e20 4f70 7469  cy: str) -> Opti
+0001b4c0: 6f6e 616c 5b44 6963 745b 7374 722c 204c  onal[Dict[str, L
+0001b4d0: 6973 745b 4469 6374 5d5d 5d3a 0a20 2020  ist[Dict]]]:.   
+0001b4e0: 2020 2020 2066 696c 656e 616d 6520 3d20       filename = 
+0001b4f0: 7365 6c66 2e5f 636f 6e66 6967 5b27 6461  self._config['da
+0001b500: 7461 6469 7227 5d20 2f20 2266 7574 7572  tadir'] / "futur
+0001b510: 6573 2220 2f20 6622 6c65 7665 7261 6765  es" / f"leverage
+0001b520: 5f74 6965 7273 5f7b 7374 616b 655f 6375  _tiers_{stake_cu
+0001b530: 7272 656e 6379 7d2e 6a73 6f6e 220a 2020  rrency}.json".  
+0001b540: 2020 2020 2020 6966 2066 696c 656e 616d        if filenam
+0001b550: 652e 6973 5f66 696c 6528 293a 0a20 2020  e.is_file():.   
+0001b560: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+0001b570: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+0001b580: 6572 7320 3d20 6669 6c65 5f6c 6f61 645f  ers = file_load_
+0001b590: 6a73 6f6e 2866 696c 656e 616d 6529 0a20  json(filename). 
+0001b5a0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+0001b5b0: 7064 6174 6564 203d 2074 6965 7273 2e67  pdated = tiers.g
+0001b5c0: 6574 2827 7570 6461 7465 6427 290a 2020  et('updated').  
+0001b5d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001b5e0: 2075 7064 6174 6564 3a0a 2020 2020 2020   updated:.      
+0001b5f0: 2020 2020 2020 2020 2020 2020 2020 7570                up
+0001b600: 6461 7465 645f 6474 203d 2070 6172 7365  dated_dt = parse
+0001b610: 722e 7061 7273 6528 7570 6461 7465 6429  r.parse(updated)
+0001b620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b630: 2020 2020 2069 6620 7570 6461 7465 645f       if updated_
+0001b640: 6474 203c 2064 6174 6574 696d 652e 6e6f  dt < datetime.no
+0001b650: 7728 7469 6d65 7a6f 6e65 2e75 7463 2920  w(timezone.utc) 
+0001b660: 2d20 7469 6d65 6465 6c74 6128 7765 656b  - timedelta(week
+0001b670: 733d 3429 3a0a 2020 2020 2020 2020 2020  s=4):.          
+0001b680: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+0001b690: 6767 6572 2e69 6e66 6f28 2243 6163 6865  gger.info("Cache
+0001b6a0: 6420 6c65 7665 7261 6765 2074 6965 7273  d leverage tiers
+0001b6b0: 2061 7265 206f 7574 6461 7465 642e 2057   are outdated. W
+0001b6c0: 696c 6c20 7570 6461 7465 2e22 290a 2020  ill update.").  
+0001b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b6e0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+0001b6f0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0001b700: 2020 7265 7475 726e 2074 6965 7273 5b27    return tiers['
+0001b710: 6461 7461 275d 0a20 2020 2020 2020 2020  data'].         
+0001b720: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+0001b730: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+0001b740: 2020 2020 206c 6f67 6765 722e 6578 6365       logger.exce
+0001b750: 7074 696f 6e28 2245 7272 6f72 206c 6f61  ption("Error loa
+0001b760: 6469 6e67 2063 6163 6865 6420 6c65 7665  ding cached leve
+0001b770: 7261 6765 2074 6965 7273 2e20 5265 6672  rage tiers. Refr
+0001b780: 6573 6869 6e67 2e22 290a 2020 2020 2020  eshing.").      
+0001b790: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
+0001b7a0: 2020 2064 6566 2066 696c 6c5f 6c65 7665     def fill_leve
+0001b7b0: 7261 6765 5f74 6965 7273 2873 656c 6629  rage_tiers(self)
+0001b7c0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0001b7d0: 2020 2222 220a 2020 2020 2020 2020 4173    """.        As
+0001b7e0: 7369 676e 7320 7072 6f70 6572 7479 205f  signs property _
+0001b7f0: 6c65 7665 7261 6765 5f74 6965 7273 2074  leverage_tiers t
+0001b800: 6f20 6120 6469 6374 696f 6e61 7279 206f  o a dictionary o
+0001b810: 6620 696e 666f 726d 6174 696f 6e20 6162  f information ab
+0001b820: 6f75 7420 7468 6520 6c65 7665 7261 6765  out the leverage
+0001b830: 0a20 2020 2020 2020 2061 6c6c 6f77 6564  .        allowed
+0001b840: 206f 6e20 6561 6368 2070 6169 720a 2020   on each pair.  
+0001b850: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001b860: 2020 6c65 7665 7261 6765 5f74 6965 7273    leverage_tiers
+0001b870: 203d 2073 656c 662e 6c6f 6164 5f6c 6576   = self.load_lev
+0001b880: 6572 6167 655f 7469 6572 7328 290a 2020  erage_tiers().  
+0001b890: 2020 2020 2020 666f 7220 7061 6972 2c20        for pair, 
+0001b8a0: 7469 6572 7320 696e 206c 6576 6572 6167  tiers in leverag
+0001b8b0: 655f 7469 6572 732e 6974 656d 7328 293a  e_tiers.items():
+0001b8c0: 0a20 2020 2020 2020 2020 2020 2070 6169  .            pai
+0001b8d0: 725f 7469 6572 7320 3d20 5b5d 0a20 2020  r_tiers = [].   
+0001b8e0: 2020 2020 2020 2020 2066 6f72 2074 6965           for tie
+0001b8f0: 7220 696e 2074 6965 7273 3a0a 2020 2020  r in tiers:.    
+0001b900: 2020 2020 2020 2020 2020 2020 7061 6972              pair
+0001b910: 5f74 6965 7273 2e61 7070 656e 6428 7365  _tiers.append(se
+0001b920: 6c66 2e70 6172 7365 5f6c 6576 6572 6167  lf.parse_leverag
+0001b930: 655f 7469 6572 2874 6965 7229 290a 2020  e_tier(tier)).  
+0001b940: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0001b950: 6c65 7665 7261 6765 5f74 6965 7273 5b70  leverage_tiers[p
+0001b960: 6169 725d 203d 2070 6169 725f 7469 6572  air] = pair_tier
+0001b970: 730a 0a20 2020 2064 6566 2070 6172 7365  s..    def parse
+0001b980: 5f6c 6576 6572 6167 655f 7469 6572 2873  _leverage_tier(s
+0001b990: 656c 662c 2074 6965 7229 202d 3e20 4469  elf, tier) -> Di
+0001b9a0: 6374 3a0a 2020 2020 2020 2020 696e 666f  ct:.        info
+0001b9b0: 203d 2074 6965 722e 6765 7428 2769 6e66   = tier.get('inf
+0001b9c0: 6f27 2c20 7b7d 290a 2020 2020 2020 2020  o', {}).        
+0001b9d0: 7265 7475 726e 207b 0a20 2020 2020 2020  return {.       
+0001b9e0: 2020 2020 2027 6d69 6e4e 6f74 696f 6e61       'minNotiona
+0001b9f0: 6c27 3a20 7469 6572 5b27 6d69 6e4e 6f74  l': tier['minNot
+0001ba00: 696f 6e61 6c27 5d2c 0a20 2020 2020 2020  ional'],.       
+0001ba10: 2020 2020 2027 6d61 784e 6f74 696f 6e61       'maxNotiona
+0001ba20: 6c27 3a20 7469 6572 5b27 6d61 784e 6f74  l': tier['maxNot
+0001ba30: 696f 6e61 6c27 5d2c 0a20 2020 2020 2020  ional'],.       
+0001ba40: 2020 2020 2027 6d61 696e 7465 6e61 6e63       'maintenanc
+0001ba50: 654d 6172 6769 6e52 6174 6527 3a20 7469  eMarginRate': ti
+0001ba60: 6572 5b27 6d61 696e 7465 6e61 6e63 654d  er['maintenanceM
+0001ba70: 6172 6769 6e52 6174 6527 5d2c 0a20 2020  arginRate'],.   
+0001ba80: 2020 2020 2020 2020 2027 6d61 784c 6576           'maxLev
+0001ba90: 6572 6167 6527 3a20 7469 6572 5b27 6d61  erage': tier['ma
+0001baa0: 784c 6576 6572 6167 6527 5d2c 0a20 2020  xLeverage'],.   
+0001bab0: 2020 2020 2020 2020 2027 6d61 696e 7441           'maintA
+0001bac0: 6d74 273a 2066 6c6f 6174 2869 6e66 6f5b  mt': float(info[
+0001bad0: 2763 756d 275d 2920 6966 2027 6375 6d27  'cum']) if 'cum'
+0001bae0: 2069 6e20 696e 666f 2065 6c73 6520 4e6f   in info else No
+0001baf0: 6e65 2c0a 2020 2020 2020 2020 7d0a 0a20  ne,.        }.. 
+0001bb00: 2020 2064 6566 2067 6574 5f6d 6178 5f6c     def get_max_l
+0001bb10: 6576 6572 6167 6528 7365 6c66 2c20 7061  everage(self, pa
+0001bb20: 6972 3a20 7374 722c 2073 7461 6b65 5f61  ir: str, stake_a
+0001bb30: 6d6f 756e 743a 204f 7074 696f 6e61 6c5b  mount: Optional[
+0001bb40: 666c 6f61 745d 2920 2d3e 2066 6c6f 6174  float]) -> float
+0001bb50: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0001bb60: 2020 2020 2020 5265 7475 726e 7320 7468        Returns th
+0001bb70: 6520 6d61 7869 6d75 6d20 6c65 7665 7261  e maximum levera
+0001bb80: 6765 2074 6861 7420 6120 7061 6972 2063  ge that a pair c
+0001bb90: 616e 2062 6520 7472 6164 6564 2061 740a  an be traded at.
+0001bba0: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+0001bbb0: 6169 723a 2054 6865 2062 6173 652f 7175  air: The base/qu
+0001bbc0: 6f74 6520 6375 7272 656e 6379 2070 6169  ote currency pai
+0001bbd0: 7220 6265 696e 6720 7472 6164 6564 0a20  r being traded. 
+0001bbe0: 2020 2020 2020 203a 7374 616b 655f 616d         :stake_am
+0001bbf0: 6f75 6e74 3a20 5468 6520 746f 7461 6c20  ount: The total 
+0001bc00: 7661 6c75 6520 6f66 2074 6865 2074 7261  value of the tra
+0001bc10: 6465 7273 206d 6172 6769 6e5f 6d6f 6465  ders margin_mode
+0001bc20: 2069 6e20 7175 6f74 6520 6375 7272 656e   in quote curren
+0001bc30: 6379 0a20 2020 2020 2020 2022 2222 0a0a  cy.        """..
+0001bc40: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0001bc50: 7472 6164 696e 675f 6d6f 6465 203d 3d20  trading_mode == 
+0001bc60: 5472 6164 696e 674d 6f64 652e 5350 4f54  TradingMode.SPOT
+0001bc70: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001bc80: 7475 726e 2031 2e30 0a0a 2020 2020 2020  turn 1.0..      
+0001bc90: 2020 6966 2073 656c 662e 7472 6164 696e    if self.tradin
+0001bca0: 675f 6d6f 6465 203d 3d20 5472 6164 696e  g_mode == Tradin
+0001bcb0: 674d 6f64 652e 4655 5455 5245 533a 0a0a  gMode.FUTURES:..
+0001bcc0: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
+0001bcd0: 6563 6b73 2061 6e64 2065 6467 6520 6361  ecks and edge ca
+0001bce0: 7365 730a 2020 2020 2020 2020 2020 2020  ses.            
+0001bcf0: 6966 2073 7461 6b65 5f61 6d6f 756e 7420  if stake_amount 
+0001bd00: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0001bd10: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+0001bd20: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
+0001bd30: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+0001bd40: 2020 2020 2020 2020 2066 277b 7365 6c66           f'{self
+0001bd50: 2e6e 616d 657d 2e67 6574 5f6d 6178 5f6c  .name}.get_max_l
+0001bd60: 6576 6572 6167 6520 7265 7175 6972 6573  everage requires
+0001bd70: 2061 7267 756d 656e 7420 7374 616b 655f   argument stake_
+0001bd80: 616d 6f75 6e74 270a 2020 2020 2020 2020  amount'.        
+0001bd90: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0001bda0: 2020 2020 2020 2069 6620 7061 6972 206e         if pair n
+0001bdb0: 6f74 2069 6e20 7365 6c66 2e5f 6c65 7665  ot in self._leve
+0001bdc0: 7261 6765 5f74 6965 7273 3a0a 2020 2020  rage_tiers:.    
+0001bdd0: 2020 2020 2020 2020 2020 2020 2320 4d61              # Ma
+0001bde0: 7962 6520 7261 6973 6520 6578 6365 7074  ybe raise except
+0001bdf0: 696f 6e20 6265 6361 7573 6520 6974 2063  ion because it c
+0001be00: 616e 2774 2062 6520 7472 6164 6564 206f  an't be traded o
+0001be10: 6e20 6675 7475 7265 733f 0a20 2020 2020  n futures?.     
+0001be20: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001be30: 6e20 312e 300a 0a20 2020 2020 2020 2020  n 1.0..         
+0001be40: 2020 2070 6169 725f 7469 6572 7320 3d20     pair_tiers = 
+0001be50: 7365 6c66 2e5f 6c65 7665 7261 6765 5f74  self._leverage_t
+0001be60: 6965 7273 5b70 6169 725d 0a0a 2020 2020  iers[pair]..    
+0001be70: 2020 2020 2020 2020 6966 2073 7461 6b65          if stake
+0001be80: 5f61 6d6f 756e 7420 3d3d 2030 3a0a 2020  _amount == 0:.  
+0001be90: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0001bea0: 7475 726e 2073 656c 662e 5f6c 6576 6572  turn self._lever
+0001beb0: 6167 655f 7469 6572 735b 7061 6972 5d5b  age_tiers[pair][
+0001bec0: 305d 5b27 6d61 784c 6576 6572 6167 6527  0]['maxLeverage'
+0001bed0: 5d20 2023 204d 6178 206c 6576 2066 6f72  ]  # Max lev for
+0001bee0: 206c 6f77 6573 7420 616d 6f75 6e74 0a0a   lowest amount..
+0001bef0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0001bf00: 7469 6572 5f69 6e64 6578 2069 6e20 7261  tier_index in ra
+0001bf10: 6e67 6528 6c65 6e28 7061 6972 5f74 6965  nge(len(pair_tie
+0001bf20: 7273 2929 3a0a 0a20 2020 2020 2020 2020  rs)):..         
+0001bf30: 2020 2020 2020 2074 6965 7220 3d20 7061         tier = pa
+0001bf40: 6972 5f74 6965 7273 5b74 6965 725f 696e  ir_tiers[tier_in
+0001bf50: 6465 785d 0a20 2020 2020 2020 2020 2020  dex].           
+0001bf60: 2020 2020 206c 6576 203d 2074 6965 725b       lev = tier[
+0001bf70: 276d 6178 4c65 7665 7261 6765 275d 0a0a  'maxLeverage']..
+0001bf80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf90: 6966 2074 6965 725f 696e 6465 7820 3c20  if tier_index < 
+0001bfa0: 6c65 6e28 7061 6972 5f74 6965 7273 2920  len(pair_tiers) 
+0001bfb0: 2d20 313a 0a20 2020 2020 2020 2020 2020  - 1:.           
+0001bfc0: 2020 2020 2020 2020 206e 6578 745f 7469           next_ti
+0001bfd0: 6572 203d 2070 6169 725f 7469 6572 735b  er = pair_tiers[
+0001bfe0: 7469 6572 5f69 6e64 6578 202b 2031 5d0a  tier_index + 1].
+0001bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c000: 2020 2020 6e65 7874 5f66 6c6f 6f72 203d      next_floor =
+0001c010: 206e 6578 745f 7469 6572 5b27 6d69 6e4e   next_tier['minN
+0001c020: 6f74 696f 6e61 6c27 5d20 2f20 6e65 7874  otional'] / next
+0001c030: 5f74 6965 725b 276d 6178 4c65 7665 7261  _tier['maxLevera
+0001c040: 6765 275d 0a20 2020 2020 2020 2020 2020  ge'].           
+0001c050: 2020 2020 2020 2020 2069 6620 6e65 7874           if next
+0001c060: 5f66 6c6f 6f72 203e 2073 7461 6b65 5f61  _floor > stake_a
+0001c070: 6d6f 756e 743a 2020 2320 4e65 7874 2074  mount:  # Next t
+0001c080: 6965 7220 6d69 6e20 746f 6f20 6869 6768  ier min too high
+0001c090: 2066 6f72 2073 7461 6b65 2061 6d6f 756e   for stake amoun
+0001c0a0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0001c0b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001c0c0: 206d 696e 2828 7469 6572 5b27 6d61 784e   min((tier['maxN
+0001c0d0: 6f74 696f 6e61 6c27 5d20 2f20 7374 616b  otional'] / stak
+0001c0e0: 655f 616d 6f75 6e74 292c 206c 6576 290a  e_amount), lev).
 0001c0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c100: 2023 0a20 2020 2020 2020 2020 2020 2020   #.             
-0001c110: 2020 2020 2020 2020 2020 2023 2057 6974             # Wit
-0001c120: 6820 7468 6520 7477 6f20 6c65 7665 7261  h the two levera
-0001c130: 6765 2074 6965 7273 2062 656c 6f77 2c0a  ge tiers below,.
-0001c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c150: 2020 2020 2020 2020 2320 2d20 6120 7374          # - a st
-0001c160: 616b 6520 616d 6f75 6e74 206f 6620 3135  ake amount of 15
-0001c170: 3020 776f 756c 6420 6d65 616e 2061 206d  0 would mean a m
-0001c180: 6178 206c 6576 6572 6167 6520 6f66 2028  ax leverage of (
-0001c190: 3130 3030 3020 2f20 3135 3029 203d 2036  10000 / 150) = 6
-0001c1a0: 362e 3636 0a20 2020 2020 2020 2020 2020  6.66.           
-0001c1b0: 2020 2020 2020 2020 2020 2020 2023 202d               # -
-0001c1c0: 2073 7461 6b65 7320 6265 6c6f 7720 3133   stakes below 13
-0001c1d0: 332e 3333 203d 206d 6178 5f6c 6576 206f  3.33 = max_lev o
-0001c1e0: 6620 3735 0a20 2020 2020 2020 2020 2020  f 75.           
-0001c1f0: 2020 2020 2020 2020 2020 2020 2023 202d               # -
-0001c200: 2073 7461 6b65 7320 6265 7477 6565 6e20   stakes between 
-0001c210: 3133 332e 3333 2d32 3030 203d 206d 6178  133.33-200 = max
-0001c220: 5f6c 6576 206f 6620 3130 3030 302f 7374  _lev of 10000/st
-0001c230: 616b 6520 3d20 3530 2e30 312d 3734 2e39  ake = 50.01-74.9
-0001c240: 390a 2020 2020 2020 2020 2020 2020 2020  9.              
-0001c250: 2020 2020 2020 2020 2020 2320 2d20 7374            # - st
-0001c260: 616b 6573 2066 726f 6d20 3230 3020 2b20  akes from 200 + 
-0001c270: 3130 3030 203d 206d 6178 5f6c 6576 206f  1000 = max_lev o
-0001c280: 6620 3530 0a20 2020 2020 2020 2020 2020  f 50.           
-0001c290: 2020 2020 2020 2020 2020 2020 2023 0a20               #. 
-0001c2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c2b0: 2020 2020 2020 2023 207b 0a20 2020 2020         # {.     
-0001c2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c2d0: 2020 2023 2020 2020 2022 6d69 6e22 3a20     #     "min": 
-0001c2e0: 302c 2020 2020 2020 2320 7374 616b 6520  0,      # stake 
-0001c2f0: 3d20 302e 300a 2020 2020 2020 2020 2020  = 0.0.          
-0001c300: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001c310: 2020 2020 226d 6178 223a 2031 3030 3030      "max": 10000
-0001c320: 2c20 2023 206d 6178 5f73 7461 6b65 4037  ,  # max_stake@7
-0001c330: 3520 3d20 3130 3030 302f 3735 203d 2031  5 = 10000/75 = 1
-0001c340: 3333 2e33 3333 3333 3333 3333 3333 3333  33.3333333333333
-0001c350: 340a 2020 2020 2020 2020 2020 2020 2020  4.              
-0001c360: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-0001c370: 226c 6576 223a 2037 352c 0a20 2020 2020  "lev": 75,.     
-0001c380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c390: 2020 2023 207d 2c0a 2020 2020 2020 2020     # },.        
+0001c100: 2020 2020 2020 2020 230a 2020 2020 2020          #.      
+0001c110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c120: 2020 2320 5769 7468 2074 6865 2074 776f    # With the two
+0001c130: 206c 6576 6572 6167 6520 7469 6572 7320   leverage tiers 
+0001c140: 6265 6c6f 772c 0a20 2020 2020 2020 2020  below,.         
+0001c150: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001c160: 202d 2061 2073 7461 6b65 2061 6d6f 756e   - a stake amoun
+0001c170: 7420 6f66 2031 3530 2077 6f75 6c64 206d  t of 150 would m
+0001c180: 6561 6e20 6120 6d61 7820 6c65 7665 7261  ean a max levera
+0001c190: 6765 206f 6620 2831 3030 3030 202f 2031  ge of (10000 / 1
+0001c1a0: 3530 2920 3d20 3636 2e36 360a 2020 2020  50) = 66.66.    
+0001c1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c1c0: 2020 2020 2320 2d20 7374 616b 6573 2062      # - stakes b
+0001c1d0: 656c 6f77 2031 3333 2e33 3320 3d20 6d61  elow 133.33 = ma
+0001c1e0: 785f 6c65 7620 6f66 2037 350a 2020 2020  x_lev of 75.    
+0001c1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c200: 2020 2020 2320 2d20 7374 616b 6573 2062      # - stakes b
+0001c210: 6574 7765 656e 2031 3333 2e33 332d 3230  etween 133.33-20
+0001c220: 3020 3d20 6d61 785f 6c65 7620 6f66 2031  0 = max_lev of 1
+0001c230: 3030 3030 2f73 7461 6b65 203d 2035 302e  0000/stake = 50.
+0001c240: 3031 2d37 342e 3939 0a20 2020 2020 2020  01-74.99.       
+0001c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c260: 2023 202d 2073 7461 6b65 7320 6672 6f6d   # - stakes from
+0001c270: 2032 3030 202b 2031 3030 3020 3d20 6d61   200 + 1000 = ma
+0001c280: 785f 6c65 7620 6f66 2035 300a 2020 2020  x_lev of 50.    
+0001c290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c2a0: 2020 2020 230a 2020 2020 2020 2020 2020      #.          
+0001c2b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001c2c0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0001c2d0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+0001c2e0: 226d 696e 223a 2030 2c20 2020 2020 2023  "min": 0,      #
+0001c2f0: 2073 7461 6b65 203d 2030 2e30 0a20 2020   stake = 0.0.   
+0001c300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c310: 2020 2020 2023 2020 2020 2022 6d61 7822       #     "max"
+0001c320: 3a20 3130 3030 302c 2020 2320 6d61 785f  : 10000,  # max_
+0001c330: 7374 616b 6540 3735 203d 2031 3030 3030  stake@75 = 10000
+0001c340: 2f37 3520 3d20 3133 332e 3333 3333 3333  /75 = 133.333333
+0001c350: 3333 3333 3333 3334 0a20 2020 2020 2020  33333334.       
+0001c360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c370: 2023 2020 2020 2022 6c65 7622 3a20 3735   #     "lev": 75
+0001c380: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001c390: 2020 2020 2020 2020 2020 2320 7d2c 0a20            # },. 
 0001c3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c3b0: 2320 7b0a 2020 2020 2020 2020 2020 2020  # {.            
-0001c3c0: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-0001c3d0: 2020 226d 696e 223a 2031 3030 3030 2c20    "min": 10000, 
-0001c3e0: 2023 2073 7461 6b65 203d 2032 3030 2e30   # stake = 200.0
-0001c3f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c400: 2020 2020 2020 2020 2023 2020 2020 2022           #     "
-0001c410: 6d61 7822 3a20 3530 3030 302c 2020 2320  max": 50000,  # 
-0001c420: 6d61 785f 7374 616b 6540 3530 203d 2035  max_stake@50 = 5
-0001c430: 3030 3030 2f35 3020 3d20 3130 3030 2e30  0000/50 = 1000.0
-0001c440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c450: 2020 2020 2020 2020 2023 2020 2020 2022           #     "
-0001c460: 6c65 7622 3a20 3530 2c0a 2020 2020 2020  lev": 50,.      
-0001c470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c480: 2020 2320 7d0a 2020 2020 2020 2020 2020    # }.          
-0001c490: 2020 2020 2020 2020 2020 2020 2020 230a                #.
-0001c4a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c4b0: 2065 6c73 653a 2020 2320 6966 206f 6e20   else:  # if on 
-0001c4c0: 7468 6520 6c61 7374 2074 6965 720a 2020  the last tier.  
-0001c4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c4e0: 2020 6966 2073 7461 6b65 5f61 6d6f 756e    if stake_amoun
-0001c4f0: 7420 3e20 7469 6572 5b27 6d61 784e 6f74  t > tier['maxNot
-0001c500: 696f 6e61 6c27 5d3a 0a20 2020 2020 2020  ional']:.       
+0001c3b0: 2020 2020 2020 2023 207b 0a20 2020 2020         # {.     
+0001c3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c3d0: 2020 2023 2020 2020 2022 6d69 6e22 3a20     #     "min": 
+0001c3e0: 3130 3030 302c 2020 2320 7374 616b 6520  10000,  # stake 
+0001c3f0: 3d20 3230 302e 300a 2020 2020 2020 2020  = 200.0.        
+0001c400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c410: 2320 2020 2020 226d 6178 223a 2035 3030  #     "max": 500
+0001c420: 3030 2c20 2023 206d 6178 5f73 7461 6b65  00,  # max_stake
+0001c430: 4035 3020 3d20 3530 3030 302f 3530 203d  @50 = 50000/50 =
+0001c440: 2031 3030 302e 300a 2020 2020 2020 2020   1000.0.        
+0001c450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c460: 2320 2020 2020 226c 6576 223a 2035 302c  #     "lev": 50,
+0001c470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c480: 2020 2020 2020 2020 2023 207d 0a20 2020           # }.   
+0001c490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c4a0: 2020 2020 2023 0a0a 2020 2020 2020 2020       #..        
+0001c4b0: 2020 2020 2020 2020 656c 7365 3a20 2023          else:  #
+0001c4c0: 2069 6620 6f6e 2074 6865 206c 6173 7420   if on the last 
+0001c4d0: 7469 6572 0a20 2020 2020 2020 2020 2020  tier.           
+0001c4e0: 2020 2020 2020 2020 2069 6620 7374 616b           if stak
+0001c4f0: 655f 616d 6f75 6e74 203e 2074 6965 725b  e_amount > tier[
+0001c500: 276d 6178 4e6f 7469 6f6e 616c 275d 3a0a  'maxNotional']:.
 0001c510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c520: 2023 2049 6620 7374 616b 6520 6973 203e   # If stake is >
-0001c530: 2074 6861 6e20 6d61 7820 7472 6164 6561   than max tradea
-0001c540: 626c 6520 616d 6f75 6e74 0a20 2020 2020  ble amount.     
-0001c550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c560: 2020 2072 6169 7365 2049 6e76 616c 6964     raise Invalid
-0001c570: 4f72 6465 7245 7863 6570 7469 6f6e 2866  OrderException(f
-0001c580: 2741 6d6f 756e 7420 7b73 7461 6b65 5f61  'Amount {stake_a
-0001c590: 6d6f 756e 747d 2074 6f6f 2068 6967 6820  mount} too high 
-0001c5a0: 666f 7220 7b70 6169 727d 2729 0a20 2020  for {pair}').   
-0001c5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c5c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001c5d0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001c5e0: 6574 7572 6e20 7469 6572 5b27 6d61 784c  eturn tier['maxL
-0001c5f0: 6576 6572 6167 6527 5d0a 0a20 2020 2020  everage']..     
-0001c600: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
-0001c610: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
-0001c620: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-0001c630: 2020 2027 4c6f 6f70 6564 2074 6872 6f75     'Looped throu
-0001c640: 6768 2061 6c6c 2074 6965 7273 2077 6974  gh all tiers wit
-0001c650: 686f 7574 2066 696e 6469 6e67 2061 206d  hout finding a m
-0001c660: 6178 206c 6576 6572 6167 652e 2053 686f  ax leverage. Sho
-0001c670: 756c 6420 6e65 7665 7220 6265 2072 6561  uld never be rea
-0001c680: 6368 6564 270a 2020 2020 2020 2020 2020  ched'.          
-0001c690: 2020 290a 0a20 2020 2020 2020 2065 6c69    )..        eli
-0001c6a0: 6620 7365 6c66 2e74 7261 6469 6e67 5f6d  f self.trading_m
-0001c6b0: 6f64 6520 3d3d 2054 7261 6469 6e67 4d6f  ode == TradingMo
-0001c6c0: 6465 2e4d 4152 4749 4e3a 2020 2320 5365  de.MARGIN:  # Se
-0001c6d0: 6172 6368 206d 6172 6b65 7473 2e6c 696d  arch markets.lim
-0001c6e0: 6974 7320 666f 7220 6d61 7820 6c65 760a  its for max lev.
-0001c6f0: 2020 2020 2020 2020 2020 2020 6d61 726b              mark
-0001c700: 6574 203d 2073 656c 662e 6d61 726b 6574  et = self.market
-0001c710: 735b 7061 6972 5d0a 2020 2020 2020 2020  s[pair].        
-0001c720: 2020 2020 6966 206d 6172 6b65 745b 276c      if market['l
-0001c730: 696d 6974 7327 5d5b 276c 6576 6572 6167  imits']['leverag
-0001c740: 6527 5d5b 276d 6178 275d 2069 7320 6e6f  e']['max'] is no
-0001c750: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0001c760: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-0001c770: 6172 6b65 745b 276c 696d 6974 7327 5d5b  arket['limits'][
-0001c780: 276c 6576 6572 6167 6527 5d5b 276d 6178  'leverage']['max
-0001c790: 275d 0a20 2020 2020 2020 2020 2020 2065  '].            e
-0001c7a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001c7b0: 2020 2020 2072 6574 7572 6e20 312e 3020       return 1.0 
-0001c7c0: 2023 2044 6566 6175 6c74 2069 6620 6d61   # Default if ma
-0001c7d0: 7820 6c65 7665 7261 6765 2063 616e 6e6f  x leverage canno
-0001c7e0: 7420 6265 2066 6f75 6e64 0a20 2020 2020  t be found.     
-0001c7f0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001c800: 2020 2020 2072 6574 7572 6e20 312e 300a       return 1.0.
-0001c810: 0a20 2020 2040 7265 7472 6965 720a 2020  .    @retrier.  
-0001c820: 2020 6465 6620 5f73 6574 5f6c 6576 6572    def _set_lever
-0001c830: 6167 6528 0a20 2020 2020 2020 2073 656c  age(.        sel
-0001c840: 662c 0a20 2020 2020 2020 206c 6576 6572  f,.        lever
-0001c850: 6167 653a 2066 6c6f 6174 2c0a 2020 2020  age: float,.    
-0001c860: 2020 2020 7061 6972 3a20 4f70 7469 6f6e      pair: Option
-0001c870: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-0001c880: 2020 2020 2020 2020 6163 6365 7074 5f66          accept_f
-0001c890: 6169 6c3a 2062 6f6f 6c20 3d20 4661 6c73  ail: bool = Fals
-0001c8a0: 652c 0a20 2020 2029 3a0a 2020 2020 2020  e,.    ):.      
-0001c8b0: 2020 2222 220a 2020 2020 2020 2020 5365    """.        Se
-0001c8c0: 7427 7320 7468 6520 6c65 7665 7261 6765  t's the leverage
-0001c8d0: 2062 6566 6f72 6520 6d61 6b69 6e67 2061   before making a
-0001c8e0: 2074 7261 6465 2c20 696e 206f 7264 6572   trade, in order
-0001c8f0: 2074 6f20 6e6f 740a 2020 2020 2020 2020   to not.        
-0001c900: 6861 7665 2074 6865 2073 616d 6520 6c65  have the same le
-0001c910: 7665 7261 6765 206f 6e20 6576 6572 7920  verage on every 
-0001c920: 7472 6164 650a 2020 2020 2020 2020 2222  trade.        ""
-0001c930: 220a 2020 2020 2020 2020 6966 2073 656c  ".        if sel
-0001c940: 662e 5f63 6f6e 6669 675b 2764 7279 5f72  f._config['dry_r
-0001c950: 756e 275d 206f 7220 6e6f 7420 7365 6c66  un'] or not self
-0001c960: 2e65 7863 6861 6e67 655f 6861 7328 2273  .exchange_has("s
-0001c970: 6574 4c65 7665 7261 6765 2229 3a0a 2020  etLeverage"):.  
-0001c980: 2020 2020 2020 2020 2020 2320 536f 6d65            # Some
-0001c990: 2065 7863 6861 6e67 6573 206f 6e6c 7920   exchanges only 
-0001c9a0: 7375 7070 6f72 7420 6f6e 6520 6d61 7267  support one marg
-0001c9b0: 696e 5f6d 6f64 6520 7479 7065 0a20 2020  in_mode type.   
-0001c9c0: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-0001c9d0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0001c9e0: 5f66 745f 6861 732e 6765 7428 2766 6c6f  _ft_has.get('flo
-0001c9f0: 6f72 5f6c 6576 6572 6167 6527 2c20 4661  or_leverage', Fa
-0001ca00: 6c73 6529 2069 7320 5472 7565 3a0a 2020  lse) is True:.  
-0001ca10: 2020 2020 2020 2020 2020 2320 526f 756e            # Roun
-0001ca20: 6469 6e67 2066 6f72 2062 696e 616e 6365  ding for binance
-0001ca30: 202e 2e2e 0a20 2020 2020 2020 2020 2020   ....           
-0001ca40: 206c 6576 6572 6167 6520 3d20 666c 6f6f   leverage = floo
-0001ca50: 7228 6c65 7665 7261 6765 290a 2020 2020  r(leverage).    
-0001ca60: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0001ca70: 2020 2020 2072 6573 203d 2073 656c 662e       res = self.
-0001ca80: 5f61 7069 2e73 6574 5f6c 6576 6572 6167  _api.set_leverag
-0001ca90: 6528 7379 6d62 6f6c 3d70 6169 722c 206c  e(symbol=pair, l
-0001caa0: 6576 6572 6167 653d 6c65 7665 7261 6765  everage=leverage
-0001cab0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-0001cac0: 6c66 2e5f 6c6f 675f 6578 6368 616e 6765  lf._log_exchange
-0001cad0: 5f72 6573 706f 6e73 6528 2773 6574 5f6c  _response('set_l
-0001cae0: 6576 6572 6167 6527 2c20 7265 7329 0a20  everage', res). 
-0001caf0: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
-0001cb00: 7874 2e44 446f 5350 726f 7465 6374 696f  xt.DDoSProtectio
-0001cb10: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
-0001cb20: 2020 2020 7261 6973 6520 4444 6f73 5072      raise DDosPr
-0001cb30: 6f74 6563 7469 6f6e 2865 2920 6672 6f6d  otection(e) from
-0001cb40: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
-0001cb50: 7420 2863 6378 742e 4261 6452 6571 7565  t (ccxt.BadReque
-0001cb60: 7374 2c20 6363 7874 2e49 6e73 7566 6669  st, ccxt.Insuffi
-0001cb70: 6369 656e 7446 756e 6473 2920 6173 2065  cientFunds) as e
-0001cb80: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0001cb90: 206e 6f74 2061 6363 6570 745f 6661 696c   not accept_fail
-0001cba0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001cbb0: 2020 7261 6973 6520 5465 6d70 6f72 6172    raise Temporar
-0001cbc0: 7945 7272 6f72 280a 2020 2020 2020 2020  yError(.        
-0001cbd0: 2020 2020 2020 2020 2020 2020 6627 436f              f'Co
-0001cbe0: 756c 6420 6e6f 7420 7365 7420 6c65 7665  uld not set leve
-0001cbf0: 7261 6765 2064 7565 2074 6f20 7b65 2e5f  rage due to {e._
-0001cc00: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-0001cc10: 5f7d 2e20 4d65 7373 6167 653a 207b 657d  _}. Message: {e}
-0001cc20: 2729 2066 726f 6d20 650a 2020 2020 2020  ') from e.      
-0001cc30: 2020 6578 6365 7074 2028 6363 7874 2e4e    except (ccxt.N
-0001cc40: 6574 776f 726b 4572 726f 722c 2063 6378  etworkError, ccx
-0001cc50: 742e 4578 6368 616e 6765 4572 726f 7229  t.ExchangeError)
-0001cc60: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0001cc70: 2020 2072 6169 7365 2054 656d 706f 7261     raise Tempora
-0001cc80: 7279 4572 726f 7228 0a20 2020 2020 2020  ryError(.       
-0001cc90: 2020 2020 2020 2020 2066 2743 6f75 6c64           f'Could
-0001cca0: 206e 6f74 2073 6574 206c 6576 6572 6167   not set leverag
-0001ccb0: 6520 6475 6520 746f 207b 652e 5f5f 636c  e due to {e.__cl
-0001ccc0: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d2e  ass__.__name__}.
-0001ccd0: 204d 6573 7361 6765 3a20 7b65 7d27 2920   Message: {e}') 
-0001cce0: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
-0001ccf0: 7863 6570 7420 6363 7874 2e42 6173 6545  xcept ccxt.BaseE
-0001cd00: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
-0001cd10: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
-0001cd20: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
-0001cd30: 6e28 6529 2066 726f 6d20 650a 0a20 2020  n(e) from e..   
-0001cd40: 2064 6566 2067 6574 5f69 6e74 6572 6573   def get_interes
-0001cd50: 745f 7261 7465 2873 656c 6629 202d 3e20  t_rate(self) -> 
-0001cd60: 666c 6f61 743a 0a20 2020 2020 2020 2022  float:.        "
-0001cd70: 2222 0a20 2020 2020 2020 2052 6574 7269  "".        Retri
-0001cd80: 6576 6520 696e 7465 7265 7374 2072 6174  eve interest rat
-0001cd90: 6520 2d20 6e65 6365 7373 6172 7920 666f  e - necessary fo
-0001cda0: 7220 4d61 7267 696e 2074 7261 6469 6e67  r Margin trading
-0001cdb0: 2e0a 2020 2020 2020 2020 5368 6f75 6c64  ..        Should
-0001cdc0: 206e 6f74 2063 616c 6c20 7468 6520 6578   not call the ex
-0001cdd0: 6368 616e 6765 2064 6972 6563 746c 7920  change directly 
-0001cde0: 7768 656e 2075 7365 6420 6672 6f6d 2062  when used from b
-0001cdf0: 6163 6b74 6573 7469 6e67 2e0a 2020 2020  acktesting..    
-0001ce00: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001ce10: 7265 7475 726e 2030 2e30 0a0a 2020 2020  return 0.0..    
-0001ce20: 6465 6620 6675 6e64 696e 675f 6665 655f  def funding_fee_
-0001ce30: 6375 746f 6666 2873 656c 662c 206f 7065  cutoff(self, ope
-0001ce40: 6e5f 6461 7465 3a20 6461 7465 7469 6d65  n_date: datetime
-0001ce50: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-0001ce60: 2020 2020 2020 203a 7061 7261 6d20 6f70         :param op
-0001ce70: 656e 5f64 6174 653a 2054 6865 206f 7065  en_date: The ope
-0001ce80: 6e20 6461 7465 2066 6f72 2061 2074 7261  n date for a tra
-0001ce90: 6465 0a20 2020 2020 2020 203a 7265 7475  de.        :retu
-0001cea0: 726e 3a20 5468 6520 6375 746f 6666 206f  rn: The cutoff o
-0001ceb0: 7065 6e20 7469 6d65 2066 6f72 2077 6865  pen time for whe
-0001cec0: 6e20 6120 6675 6e64 696e 6720 6665 6520  n a funding fee 
-0001ced0: 6973 2063 6861 7267 6564 0a20 2020 2020  is charged.     
-0001cee0: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
-0001cef0: 6574 7572 6e20 6f70 656e 5f64 6174 652e  eturn open_date.
-0001cf00: 6d69 6e75 7465 203e 2030 206f 7220 6f70  minute > 0 or op
-0001cf10: 656e 5f64 6174 652e 7365 636f 6e64 203e  en_date.second >
-0001cf20: 2030 0a0a 2020 2020 4072 6574 7269 6572   0..    @retrier
-0001cf30: 0a20 2020 2064 6566 2073 6574 5f6d 6172  .    def set_mar
-0001cf40: 6769 6e5f 6d6f 6465 2873 656c 662c 2070  gin_mode(self, p
-0001cf50: 6169 723a 2073 7472 2c20 6d61 7267 696e  air: str, margin
-0001cf60: 5f6d 6f64 653a 204d 6172 6769 6e4d 6f64  _mode: MarginMod
-0001cf70: 652c 2061 6363 6570 745f 6661 696c 3a20  e, accept_fail: 
-0001cf80: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-0001cf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cfa0: 2020 2020 2020 7061 7261 6d73 3a20 6469        params: di
-0001cfb0: 6374 203d 207b 7d29 3a0a 2020 2020 2020  ct = {}):.      
-0001cfc0: 2020 2222 220a 2020 2020 2020 2020 5365    """.        Se
-0001cfd0: 7427 7320 7468 6520 6d61 7267 696e 206d  t's the margin m
-0001cfe0: 6f64 6520 6f6e 2074 6865 2065 7863 6861  ode on the excha
-0001cff0: 6e67 6520 746f 2063 726f 7373 206f 7220  nge to cross or 
-0001d000: 6973 6f6c 6174 6564 2066 6f72 2061 2073  isolated for a s
-0001d010: 7065 6369 6669 6320 7061 6972 0a20 2020  pecific pair.   
-0001d020: 2020 2020 203a 7061 7261 6d20 7061 6972       :param pair
-0001d030: 3a20 6261 7365 2f71 756f 7465 2063 7572  : base/quote cur
-0001d040: 7265 6e63 7920 7061 6972 2028 652e 672e  rency pair (e.g.
-0001d050: 2022 4144 412f 5553 4454 2229 0a20 2020   "ADA/USDT").   
-0001d060: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001d070: 2069 6620 7365 6c66 2e5f 636f 6e66 6967   if self._config
-0001d080: 5b27 6472 795f 7275 6e27 5d20 6f72 206e  ['dry_run'] or n
-0001d090: 6f74 2073 656c 662e 6578 6368 616e 6765  ot self.exchange
-0001d0a0: 5f68 6173 2822 7365 744d 6172 6769 6e4d  _has("setMarginM
-0001d0b0: 6f64 6522 293a 0a20 2020 2020 2020 2020  ode"):.         
-0001d0c0: 2020 2023 2053 6f6d 6520 6578 6368 616e     # Some exchan
-0001d0d0: 6765 7320 6f6e 6c79 2073 7570 706f 7274  ges only support
-0001d0e0: 206f 6e65 206d 6172 6769 6e5f 6d6f 6465   one margin_mode
-0001d0f0: 2074 7970 650a 2020 2020 2020 2020 2020   type.          
-0001d100: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
-0001d110: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0001d120: 2020 2072 6573 203d 2073 656c 662e 5f61     res = self._a
-0001d130: 7069 2e73 6574 5f6d 6172 6769 6e5f 6d6f  pi.set_margin_mo
-0001d140: 6465 286d 6172 6769 6e5f 6d6f 6465 2e76  de(margin_mode.v
-0001d150: 616c 7565 2c20 7061 6972 2c20 7061 7261  alue, pair, para
-0001d160: 6d73 290a 2020 2020 2020 2020 2020 2020  ms).            
-0001d170: 7365 6c66 2e5f 6c6f 675f 6578 6368 616e  self._log_exchan
-0001d180: 6765 5f72 6573 706f 6e73 6528 2773 6574  ge_response('set
-0001d190: 5f6d 6172 6769 6e5f 6d6f 6465 272c 2072  _margin_mode', r
-0001d1a0: 6573 290a 2020 2020 2020 2020 6578 6365  es).        exce
-0001d1b0: 7074 2063 6378 742e 4444 6f53 5072 6f74  pt ccxt.DDoSProt
-0001d1c0: 6563 7469 6f6e 2061 7320 653a 0a20 2020  ection as e:.   
-0001d1d0: 2020 2020 2020 2020 2072 6169 7365 2044           raise D
-0001d1e0: 446f 7350 726f 7465 6374 696f 6e28 6529  DosProtection(e)
-0001d1f0: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-0001d200: 6578 6365 7074 2063 6378 742e 4261 6452  except ccxt.BadR
-0001d210: 6571 7565 7374 2061 7320 653a 0a20 2020  equest as e:.   
-0001d220: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0001d230: 6163 6365 7074 5f66 6169 6c3a 0a20 2020  accept_fail:.   
-0001d240: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0001d250: 7365 2054 656d 706f 7261 7279 4572 726f  se TemporaryErro
-0001d260: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-0001d270: 2020 2020 2020 2066 2743 6f75 6c64 206e         f'Could n
-0001d280: 6f74 2073 6574 206d 6172 6769 6e20 6d6f  ot set margin mo
-0001d290: 6465 2064 7565 2074 6f20 7b65 2e5f 5f63  de due to {e.__c
-0001d2a0: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
-0001d2b0: 2e20 4d65 7373 6167 653a 207b 657d 2729  . Message: {e}')
-0001d2c0: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-0001d2d0: 6578 6365 7074 2028 6363 7874 2e4e 6574  except (ccxt.Net
-0001d2e0: 776f 726b 4572 726f 722c 2063 6378 742e  workError, ccxt.
-0001d2f0: 4578 6368 616e 6765 4572 726f 7229 2061  ExchangeError) a
-0001d300: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-0001d310: 2072 6169 7365 2054 656d 706f 7261 7279   raise Temporary
-0001d320: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-0001d330: 2020 2020 2020 2066 2743 6f75 6c64 206e         f'Could n
-0001d340: 6f74 2073 6574 206d 6172 6769 6e20 6d6f  ot set margin mo
-0001d350: 6465 2064 7565 2074 6f20 7b65 2e5f 5f63  de due to {e.__c
-0001d360: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
-0001d370: 2e20 4d65 7373 6167 653a 207b 657d 2729  . Message: {e}')
-0001d380: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-0001d390: 6578 6365 7074 2063 6378 742e 4261 7365  except ccxt.Base
-0001d3a0: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
-0001d3b0: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
-0001d3c0: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
-0001d3d0: 6f6e 2865 2920 6672 6f6d 2065 0a0a 2020  on(e) from e..  
-0001d3e0: 2020 6465 6620 5f66 6574 6368 5f61 6e64    def _fetch_and
-0001d3f0: 5f63 616c 6375 6c61 7465 5f66 756e 6469  _calculate_fundi
-0001d400: 6e67 5f66 6565 7328 0a20 2020 2020 2020  ng_fees(.       
-0001d410: 2073 656c 662c 0a20 2020 2020 2020 2070   self,.        p
-0001d420: 6169 723a 2073 7472 2c0a 2020 2020 2020  air: str,.      
-0001d430: 2020 616d 6f75 6e74 3a20 666c 6f61 742c    amount: float,
-0001d440: 0a20 2020 2020 2020 2069 735f 7368 6f72  .        is_shor
-0001d450: 743a 2062 6f6f 6c2c 0a20 2020 2020 2020  t: bool,.       
-0001d460: 206f 7065 6e5f 6461 7465 3a20 6461 7465   open_date: date
-0001d470: 7469 6d65 2c0a 2020 2020 2020 2020 636c  time,.        cl
-0001d480: 6f73 655f 6461 7465 3a20 4f70 7469 6f6e  ose_date: Option
-0001d490: 616c 5b64 6174 6574 696d 655d 203d 204e  al[datetime] = N
-0001d4a0: 6f6e 650a 2020 2020 2920 2d3e 2066 6c6f  one.    ) -> flo
-0001d4b0: 6174 3a0a 2020 2020 2020 2020 2222 220a  at:.        """.
-0001d4c0: 2020 2020 2020 2020 4665 7463 6865 7320          Fetches 
-0001d4d0: 616e 6420 6361 6c63 756c 6174 6573 2074  and calculates t
-0001d4e0: 6865 2073 756d 206f 6620 616c 6c20 6675  he sum of all fu
-0001d4f0: 6e64 696e 6720 6665 6573 2074 6861 7420  nding fees that 
-0001d500: 6f63 6375 7272 6564 2066 6f72 2061 2070  occurred for a p
-0001d510: 6169 720a 2020 2020 2020 2020 6475 7269  air.        duri
-0001d520: 6e67 2061 2066 7574 7572 6573 2074 7261  ng a futures tra
-0001d530: 6465 2e0a 2020 2020 2020 2020 4f6e 6c79  de..        Only
-0001d540: 2075 7365 6420 6475 7269 6e67 2064 7279   used during dry
-0001d550: 2d72 756e 206f 7220 6966 2074 6865 2065  -run or if the e
-0001d560: 7863 6861 6e67 6520 646f 6573 206e 6f74  xchange does not
-0001d570: 2070 726f 7669 6465 2061 2066 756e 6469   provide a fundi
-0001d580: 6e67 5f72 6174 6573 2065 6e64 706f 696e  ng_rates endpoin
-0001d590: 742e 0a20 2020 2020 2020 203a 7061 7261  t..        :para
-0001d5a0: 6d20 7061 6972 3a20 5468 6520 7175 6f74  m pair: The quot
-0001d5b0: 652f 6261 7365 2070 6169 7220 6f66 2074  e/base pair of t
-0001d5c0: 6865 2074 7261 6465 0a20 2020 2020 2020  he trade.       
-0001d5d0: 203a 7061 7261 6d20 616d 6f75 6e74 3a20   :param amount: 
-0001d5e0: 5468 6520 7175 616e 7469 7479 206f 6620  The quantity of 
-0001d5f0: 7468 6520 7472 6164 650a 2020 2020 2020  the trade.      
-0001d600: 2020 3a70 6172 616d 2069 735f 7368 6f72    :param is_shor
-0001d610: 743a 2074 7261 6465 2064 6972 6563 7469  t: trade directi
-0001d620: 6f6e 0a20 2020 2020 2020 203a 7061 7261  on.        :para
-0001d630: 6d20 6f70 656e 5f64 6174 653a 2054 6865  m open_date: The
-0001d640: 2064 6174 6520 616e 6420 7469 6d65 2074   date and time t
-0001d650: 6861 7420 7468 6520 7472 6164 6520 7374  hat the trade st
-0001d660: 6172 7465 640a 2020 2020 2020 2020 3a70  arted.        :p
-0001d670: 6172 616d 2063 6c6f 7365 5f64 6174 653a  aram close_date:
-0001d680: 2054 6865 2064 6174 6520 616e 6420 7469   The date and ti
-0001d690: 6d65 2074 6861 7420 7468 6520 7472 6164  me that the trad
-0001d6a0: 6520 656e 6465 640a 2020 2020 2020 2020  e ended.        
-0001d6b0: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
-0001d6c0: 7365 6c66 2e66 756e 6469 6e67 5f66 6565  self.funding_fee
-0001d6d0: 5f63 7574 6f66 6628 6f70 656e 5f64 6174  _cutoff(open_dat
-0001d6e0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
-0001d6f0: 6f70 656e 5f64 6174 6520 2b3d 2074 696d  open_date += tim
-0001d700: 6564 656c 7461 2868 6f75 7273 3d31 290a  edelta(hours=1).
-0001d710: 2020 2020 2020 2020 7469 6d65 6672 616d          timefram
-0001d720: 6520 3d20 7365 6c66 2e5f 6674 5f68 6173  e = self._ft_has
-0001d730: 5b27 6d61 726b 5f6f 686c 6376 5f74 696d  ['mark_ohlcv_tim
-0001d740: 6566 7261 6d65 275d 0a20 2020 2020 2020  eframe'].       
-0001d750: 2074 696d 6566 7261 6d65 5f66 6620 3d20   timeframe_ff = 
-0001d760: 7365 6c66 2e5f 6674 5f68 6173 2e67 6574  self._ft_has.get
-0001d770: 2827 6675 6e64 696e 675f 6665 655f 7469  ('funding_fee_ti
-0001d780: 6d65 6672 616d 6527 2c0a 2020 2020 2020  meframe',.      
-0001d790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c520: 2020 2020 2020 2020 2320 4966 2073 7461          # If sta
+0001c530: 6b65 2069 7320 3e20 7468 616e 206d 6178  ke is > than max
+0001c540: 2074 7261 6465 6162 6c65 2061 6d6f 756e   tradeable amoun
+0001c550: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0001c560: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001c570: 496e 7661 6c69 644f 7264 6572 4578 6365  InvalidOrderExce
+0001c580: 7074 696f 6e28 6627 416d 6f75 6e74 207b  ption(f'Amount {
+0001c590: 7374 616b 655f 616d 6f75 6e74 7d20 746f  stake_amount} to
+0001c5a0: 6f20 6869 6768 2066 6f72 207b 7061 6972  o high for {pair
+0001c5b0: 7d27 290a 2020 2020 2020 2020 2020 2020  }').            
+0001c5c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0001c5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c5e0: 2020 2020 2020 7265 7475 726e 2074 6965        return tie
+0001c5f0: 725b 276d 6178 4c65 7665 7261 6765 275d  r['maxLeverage']
+0001c600: 0a0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+0001c610: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+0001c620: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
+0001c630: 2020 2020 2020 2020 2020 274c 6f6f 7065            'Loope
+0001c640: 6420 7468 726f 7567 6820 616c 6c20 7469  d through all ti
+0001c650: 6572 7320 7769 7468 6f75 7420 6669 6e64  ers without find
+0001c660: 696e 6720 6120 6d61 7820 6c65 7665 7261  ing a max levera
+0001c670: 6765 2e20 5368 6f75 6c64 206e 6576 6572  ge. Should never
+0001c680: 2062 6520 7265 6163 6865 6427 0a20 2020   be reached'.   
+0001c690: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0001c6a0: 2020 2020 656c 6966 2073 656c 662e 7472      elif self.tr
+0001c6b0: 6164 696e 675f 6d6f 6465 203d 3d20 5472  ading_mode == Tr
+0001c6c0: 6164 696e 674d 6f64 652e 4d41 5247 494e  adingMode.MARGIN
+0001c6d0: 3a20 2023 2053 6561 7263 6820 6d61 726b  :  # Search mark
+0001c6e0: 6574 732e 6c69 6d69 7473 2066 6f72 206d  ets.limits for m
+0001c6f0: 6178 206c 6576 0a20 2020 2020 2020 2020  ax lev.         
+0001c700: 2020 206d 6172 6b65 7420 3d20 7365 6c66     market = self
+0001c710: 2e6d 6172 6b65 7473 5b70 6169 725d 0a20  .markets[pair]. 
+0001c720: 2020 2020 2020 2020 2020 2069 6620 6d61             if ma
+0001c730: 726b 6574 5b27 6c69 6d69 7473 275d 5b27  rket['limits']['
+0001c740: 6c65 7665 7261 6765 275d 5b27 6d61 7827  leverage']['max'
+0001c750: 5d20 6973 206e 6f74 204e 6f6e 653a 0a20  ] is not None:. 
+0001c760: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001c770: 6574 7572 6e20 6d61 726b 6574 5b27 6c69  eturn market['li
+0001c780: 6d69 7473 275d 5b27 6c65 7665 7261 6765  mits']['leverage
+0001c790: 275d 5b27 6d61 7827 5d0a 2020 2020 2020  ']['max'].      
+0001c7a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001c7b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001c7c0: 726e 2031 2e30 2020 2320 4465 6661 756c  rn 1.0  # Defaul
+0001c7d0: 7420 6966 206d 6178 206c 6576 6572 6167  t if max leverag
+0001c7e0: 6520 6361 6e6e 6f74 2062 6520 666f 756e  e cannot be foun
+0001c7f0: 640a 2020 2020 2020 2020 656c 7365 3a0a  d.        else:.
+0001c800: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001c810: 726e 2031 2e30 0a0a 2020 2020 4072 6574  rn 1.0..    @ret
+0001c820: 7269 6572 0a20 2020 2064 6566 205f 7365  rier.    def _se
+0001c830: 745f 6c65 7665 7261 6765 280a 2020 2020  t_leverage(.    
+0001c840: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+0001c850: 2020 6c65 7665 7261 6765 3a20 666c 6f61    leverage: floa
+0001c860: 742c 0a20 2020 2020 2020 2070 6169 723a  t,.        pair:
+0001c870: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
+0001c880: 204e 6f6e 652c 0a20 2020 2020 2020 2061   None,.        a
+0001c890: 6363 6570 745f 6661 696c 3a20 626f 6f6c  ccept_fail: bool
+0001c8a0: 203d 2046 616c 7365 2c0a 2020 2020 293a   = False,.    ):
+0001c8b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001c8c0: 2020 2020 2053 6574 2773 2074 6865 206c       Set's the l
+0001c8d0: 6576 6572 6167 6520 6265 666f 7265 206d  everage before m
+0001c8e0: 616b 696e 6720 6120 7472 6164 652c 2069  aking a trade, i
+0001c8f0: 6e20 6f72 6465 7220 746f 206e 6f74 0a20  n order to not. 
+0001c900: 2020 2020 2020 2068 6176 6520 7468 6520         have the 
+0001c910: 7361 6d65 206c 6576 6572 6167 6520 6f6e  same leverage on
+0001c920: 2065 7665 7279 2074 7261 6465 0a20 2020   every trade.   
+0001c930: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001c940: 2069 6620 7365 6c66 2e5f 636f 6e66 6967   if self._config
+0001c950: 5b27 6472 795f 7275 6e27 5d20 6f72 206e  ['dry_run'] or n
+0001c960: 6f74 2073 656c 662e 6578 6368 616e 6765  ot self.exchange
+0001c970: 5f68 6173 2822 7365 744c 6576 6572 6167  _has("setLeverag
+0001c980: 6522 293a 0a20 2020 2020 2020 2020 2020  e"):.           
+0001c990: 2023 2053 6f6d 6520 6578 6368 616e 6765   # Some exchange
+0001c9a0: 7320 6f6e 6c79 2073 7570 706f 7274 206f  s only support o
+0001c9b0: 6e65 206d 6172 6769 6e5f 6d6f 6465 2074  ne margin_mode t
+0001c9c0: 7970 650a 2020 2020 2020 2020 2020 2020  ype.            
+0001c9d0: 7265 7475 726e 0a20 2020 2020 2020 2069  return.        i
+0001c9e0: 6620 7365 6c66 2e5f 6674 5f68 6173 2e67  f self._ft_has.g
+0001c9f0: 6574 2827 666c 6f6f 725f 6c65 7665 7261  et('floor_levera
+0001ca00: 6765 272c 2046 616c 7365 2920 6973 2054  ge', False) is T
+0001ca10: 7275 653a 0a20 2020 2020 2020 2020 2020  rue:.           
+0001ca20: 2023 2052 6f75 6e64 696e 6720 666f 7220   # Rounding for 
+0001ca30: 6269 6e61 6e63 6520 2e2e 2e0a 2020 2020  binance ....    
+0001ca40: 2020 2020 2020 2020 6c65 7665 7261 6765          leverage
+0001ca50: 203d 2066 6c6f 6f72 286c 6576 6572 6167   = floor(leverag
+0001ca60: 6529 0a20 2020 2020 2020 2074 7279 3a0a  e).        try:.
+0001ca70: 2020 2020 2020 2020 2020 2020 7265 7320              res 
+0001ca80: 3d20 7365 6c66 2e5f 6170 692e 7365 745f  = self._api.set_
+0001ca90: 6c65 7665 7261 6765 2873 796d 626f 6c3d  leverage(symbol=
+0001caa0: 7061 6972 2c20 6c65 7665 7261 6765 3d6c  pair, leverage=l
+0001cab0: 6576 6572 6167 6529 0a20 2020 2020 2020  everage).       
+0001cac0: 2020 2020 2073 656c 662e 5f6c 6f67 5f65       self._log_e
+0001cad0: 7863 6861 6e67 655f 7265 7370 6f6e 7365  xchange_response
+0001cae0: 2827 7365 745f 6c65 7665 7261 6765 272c  ('set_leverage',
+0001caf0: 2072 6573 290a 2020 2020 2020 2020 6578   res).        ex
+0001cb00: 6365 7074 2063 6378 742e 4444 6f53 5072  cept ccxt.DDoSPr
+0001cb10: 6f74 6563 7469 6f6e 2061 7320 653a 0a20  otection as e:. 
+0001cb20: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001cb30: 2044 446f 7350 726f 7465 6374 696f 6e28   DDosProtection(
+0001cb40: 6529 2066 726f 6d20 650a 2020 2020 2020  e) from e.      
+0001cb50: 2020 6578 6365 7074 2028 6363 7874 2e42    except (ccxt.B
+0001cb60: 6164 5265 7175 6573 742c 2063 6378 742e  adRequest, ccxt.
+0001cb70: 496e 7375 6666 6963 6965 6e74 4675 6e64  InsufficientFund
+0001cb80: 7329 2061 7320 653a 0a20 2020 2020 2020  s) as e:.       
+0001cb90: 2020 2020 2069 6620 6e6f 7420 6163 6365       if not acce
+0001cba0: 7074 5f66 6169 6c3a 0a20 2020 2020 2020  pt_fail:.       
+0001cbb0: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+0001cbc0: 656d 706f 7261 7279 4572 726f 7228 0a20  emporaryError(. 
+0001cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbe0: 2020 2066 2743 6f75 6c64 206e 6f74 2073     f'Could not s
+0001cbf0: 6574 206c 6576 6572 6167 6520 6475 6520  et leverage due 
+0001cc00: 746f 207b 652e 5f5f 636c 6173 735f 5f2e  to {e.__class__.
+0001cc10: 5f5f 6e61 6d65 5f5f 7d2e 204d 6573 7361  __name__}. Messa
+0001cc20: 6765 3a20 7b65 7d27 2920 6672 6f6d 2065  ge: {e}') from e
+0001cc30: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0001cc40: 2863 6378 742e 4e65 7477 6f72 6b45 7272  (ccxt.NetworkErr
+0001cc50: 6f72 2c20 6363 7874 2e45 7863 6861 6e67  or, ccxt.Exchang
+0001cc60: 6545 7272 6f72 2920 6173 2065 3a0a 2020  eError) as e:.  
+0001cc70: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001cc80: 5465 6d70 6f72 6172 7945 7272 6f72 280a  TemporaryError(.
+0001cc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cca0: 6627 436f 756c 6420 6e6f 7420 7365 7420  f'Could not set 
+0001ccb0: 6c65 7665 7261 6765 2064 7565 2074 6f20  leverage due to 
+0001ccc0: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
+0001ccd0: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
+0001cce0: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
+0001ccf0: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
+0001cd00: 742e 4261 7365 4572 726f 7220 6173 2065  t.BaseError as e
+0001cd10: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0001cd20: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+0001cd30: 7863 6570 7469 6f6e 2865 2920 6672 6f6d  xception(e) from
+0001cd40: 2065 0a0a 2020 2020 6465 6620 6765 745f   e..    def get_
+0001cd50: 696e 7465 7265 7374 5f72 6174 6528 7365  interest_rate(se
+0001cd60: 6c66 2920 2d3e 2066 6c6f 6174 3a0a 2020  lf) -> float:.  
+0001cd70: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001cd80: 2020 5265 7472 6965 7665 2069 6e74 6572    Retrieve inter
+0001cd90: 6573 7420 7261 7465 202d 206e 6563 6573  est rate - neces
+0001cda0: 7361 7279 2066 6f72 204d 6172 6769 6e20  sary for Margin 
+0001cdb0: 7472 6164 696e 672e 0a20 2020 2020 2020  trading..       
+0001cdc0: 2053 686f 756c 6420 6e6f 7420 6361 6c6c   Should not call
+0001cdd0: 2074 6865 2065 7863 6861 6e67 6520 6469   the exchange di
+0001cde0: 7265 6374 6c79 2077 6865 6e20 7573 6564  rectly when used
+0001cdf0: 2066 726f 6d20 6261 636b 7465 7374 696e   from backtestin
+0001ce00: 672e 0a20 2020 2020 2020 2022 2222 0a20  g..        """. 
+0001ce10: 2020 2020 2020 2072 6574 7572 6e20 302e         return 0.
+0001ce20: 300a 0a20 2020 2064 6566 2066 756e 6469  0..    def fundi
+0001ce30: 6e67 5f66 6565 5f63 7574 6f66 6628 7365  ng_fee_cutoff(se
+0001ce40: 6c66 2c20 6f70 656e 5f64 6174 653a 2064  lf, open_date: d
+0001ce50: 6174 6574 696d 6529 3a0a 2020 2020 2020  atetime):.      
+0001ce60: 2020 2222 220a 2020 2020 2020 2020 3a70    """.        :p
+0001ce70: 6172 616d 206f 7065 6e5f 6461 7465 3a20  aram open_date: 
+0001ce80: 5468 6520 6f70 656e 2064 6174 6520 666f  The open date fo
+0001ce90: 7220 6120 7472 6164 650a 2020 2020 2020  r a trade.      
+0001cea0: 2020 3a72 6574 7572 6e3a 2054 6865 2063    :return: The c
+0001ceb0: 7574 6f66 6620 6f70 656e 2074 696d 6520  utoff open time 
+0001cec0: 666f 7220 7768 656e 2061 2066 756e 6469  for when a fundi
+0001ced0: 6e67 2066 6565 2069 7320 6368 6172 6765  ng fee is charge
+0001cee0: 640a 2020 2020 2020 2020 2222 220a 2020  d.        """.  
+0001cef0: 2020 2020 2020 7265 7475 726e 206f 7065        return ope
+0001cf00: 6e5f 6461 7465 2e6d 696e 7574 6520 3e20  n_date.minute > 
+0001cf10: 3020 6f72 206f 7065 6e5f 6461 7465 2e73  0 or open_date.s
+0001cf20: 6563 6f6e 6420 3e20 300a 0a20 2020 2040  econd > 0..    @
+0001cf30: 7265 7472 6965 720a 2020 2020 6465 6620  retrier.    def 
+0001cf40: 7365 745f 6d61 7267 696e 5f6d 6f64 6528  set_margin_mode(
+0001cf50: 7365 6c66 2c20 7061 6972 3a20 7374 722c  self, pair: str,
+0001cf60: 206d 6172 6769 6e5f 6d6f 6465 3a20 4d61   margin_mode: Ma
+0001cf70: 7267 696e 4d6f 6465 2c20 6163 6365 7074  rginMode, accept
+0001cf80: 5f66 6169 6c3a 2062 6f6f 6c20 3d20 4661  _fail: bool = Fa
+0001cf90: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
+0001cfa0: 2020 2020 2020 2020 2020 2020 2070 6172               par
+0001cfb0: 616d 733a 2064 6963 7420 3d20 7b7d 293a  ams: dict = {}):
+0001cfc0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001cfd0: 2020 2020 2053 6574 2773 2074 6865 206d       Set's the m
+0001cfe0: 6172 6769 6e20 6d6f 6465 206f 6e20 7468  argin mode on th
+0001cff0: 6520 6578 6368 616e 6765 2074 6f20 6372  e exchange to cr
+0001d000: 6f73 7320 6f72 2069 736f 6c61 7465 6420  oss or isolated 
+0001d010: 666f 7220 6120 7370 6563 6966 6963 2070  for a specific p
+0001d020: 6169 720a 2020 2020 2020 2020 3a70 6172  air.        :par
+0001d030: 616d 2070 6169 723a 2062 6173 652f 7175  am pair: base/qu
+0001d040: 6f74 6520 6375 7272 656e 6379 2070 6169  ote currency pai
+0001d050: 7220 2865 2e67 2e20 2241 4441 2f55 5344  r (e.g. "ADA/USD
+0001d060: 5422 290a 2020 2020 2020 2020 2222 220a  T").        """.
+0001d070: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0001d080: 5f63 6f6e 6669 675b 2764 7279 5f72 756e  _config['dry_run
+0001d090: 275d 206f 7220 6e6f 7420 7365 6c66 2e65  '] or not self.e
+0001d0a0: 7863 6861 6e67 655f 6861 7328 2273 6574  xchange_has("set
+0001d0b0: 4d61 7267 696e 4d6f 6465 2229 3a0a 2020  MarginMode"):.  
+0001d0c0: 2020 2020 2020 2020 2020 2320 536f 6d65            # Some
+0001d0d0: 2065 7863 6861 6e67 6573 206f 6e6c 7920   exchanges only 
+0001d0e0: 7375 7070 6f72 7420 6f6e 6520 6d61 7267  support one marg
+0001d0f0: 696e 5f6d 6f64 6520 7479 7065 0a20 2020  in_mode type.   
+0001d100: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+0001d110: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+0001d120: 2020 2020 2020 2020 2020 7265 7320 3d20            res = 
+0001d130: 7365 6c66 2e5f 6170 692e 7365 745f 6d61  self._api.set_ma
+0001d140: 7267 696e 5f6d 6f64 6528 6d61 7267 696e  rgin_mode(margin
+0001d150: 5f6d 6f64 652e 7661 6c75 652c 2070 6169  _mode.value, pai
+0001d160: 722c 2070 6172 616d 7329 0a20 2020 2020  r, params).     
+0001d170: 2020 2020 2020 2073 656c 662e 5f6c 6f67         self._log
+0001d180: 5f65 7863 6861 6e67 655f 7265 7370 6f6e  _exchange_respon
+0001d190: 7365 2827 7365 745f 6d61 7267 696e 5f6d  se('set_margin_m
+0001d1a0: 6f64 6527 2c20 7265 7329 0a20 2020 2020  ode', res).     
+0001d1b0: 2020 2065 7863 6570 7420 6363 7874 2e44     except ccxt.D
+0001d1c0: 446f 5350 726f 7465 6374 696f 6e20 6173  DoSProtection as
+0001d1d0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0001d1e0: 7261 6973 6520 4444 6f73 5072 6f74 6563  raise DDosProtec
+0001d1f0: 7469 6f6e 2865 2920 6672 6f6d 2065 0a20  tion(e) from e. 
+0001d200: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
+0001d210: 7874 2e42 6164 5265 7175 6573 7420 6173  xt.BadRequest as
+0001d220: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0001d230: 6966 206e 6f74 2061 6363 6570 745f 6661  if not accept_fa
+0001d240: 696c 3a0a 2020 2020 2020 2020 2020 2020  il:.            
+0001d250: 2020 2020 7261 6973 6520 5465 6d70 6f72      raise Tempor
+0001d260: 6172 7945 7272 6f72 280a 2020 2020 2020  aryError(.      
+0001d270: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+0001d280: 436f 756c 6420 6e6f 7420 7365 7420 6d61  Could not set ma
+0001d290: 7267 696e 206d 6f64 6520 6475 6520 746f  rgin mode due to
+0001d2a0: 207b 652e 5f5f 636c 6173 735f 5f2e 5f5f   {e.__class__.__
+0001d2b0: 6e61 6d65 5f5f 7d2e 204d 6573 7361 6765  name__}. Message
+0001d2c0: 3a20 7b65 7d27 2920 6672 6f6d 2065 0a20  : {e}') from e. 
+0001d2d0: 2020 2020 2020 2065 7863 6570 7420 2863         except (c
+0001d2e0: 6378 742e 4e65 7477 6f72 6b45 7272 6f72  cxt.NetworkError
+0001d2f0: 2c20 6363 7874 2e45 7863 6861 6e67 6545  , ccxt.ExchangeE
+0001d300: 7272 6f72 2920 6173 2065 3a0a 2020 2020  rror) as e:.    
+0001d310: 2020 2020 2020 2020 7261 6973 6520 5465          raise Te
+0001d320: 6d70 6f72 6172 7945 7272 6f72 280a 2020  mporaryError(.  
+0001d330: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+0001d340: 436f 756c 6420 6e6f 7420 7365 7420 6d61  Could not set ma
+0001d350: 7267 696e 206d 6f64 6520 6475 6520 746f  rgin mode due to
+0001d360: 207b 652e 5f5f 636c 6173 735f 5f2e 5f5f   {e.__class__.__
+0001d370: 6e61 6d65 5f5f 7d2e 204d 6573 7361 6765  name__}. Message
+0001d380: 3a20 7b65 7d27 2920 6672 6f6d 2065 0a20  : {e}') from e. 
+0001d390: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
+0001d3a0: 7874 2e42 6173 6545 7272 6f72 2061 7320  xt.BaseError as 
+0001d3b0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0001d3c0: 6169 7365 204f 7065 7261 7469 6f6e 616c  aise Operational
+0001d3d0: 4578 6365 7074 696f 6e28 6529 2066 726f  Exception(e) fro
+0001d3e0: 6d20 650a 0a20 2020 2064 6566 205f 6665  m e..    def _fe
+0001d3f0: 7463 685f 616e 645f 6361 6c63 756c 6174  tch_and_calculat
+0001d400: 655f 6675 6e64 696e 675f 6665 6573 280a  e_funding_fees(.
+0001d410: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+0001d420: 2020 2020 2020 7061 6972 3a20 7374 722c        pair: str,
+0001d430: 0a20 2020 2020 2020 2061 6d6f 756e 743a  .        amount:
+0001d440: 2066 6c6f 6174 2c0a 2020 2020 2020 2020   float,.        
+0001d450: 6973 5f73 686f 7274 3a20 626f 6f6c 2c0a  is_short: bool,.
+0001d460: 2020 2020 2020 2020 6f70 656e 5f64 6174          open_dat
+0001d470: 653a 2064 6174 6574 696d 652c 0a20 2020  e: datetime,.   
+0001d480: 2020 2020 2063 6c6f 7365 5f64 6174 653a       close_date:
+0001d490: 204f 7074 696f 6e61 6c5b 6461 7465 7469   Optional[dateti
+0001d4a0: 6d65 5d20 3d20 4e6f 6e65 0a20 2020 2029  me] = None.    )
+0001d4b0: 202d 3e20 666c 6f61 743a 0a20 2020 2020   -> float:.     
+0001d4c0: 2020 2022 2222 0a20 2020 2020 2020 2046     """.        F
+0001d4d0: 6574 6368 6573 2061 6e64 2063 616c 6375  etches and calcu
+0001d4e0: 6c61 7465 7320 7468 6520 7375 6d20 6f66  lates the sum of
+0001d4f0: 2061 6c6c 2066 756e 6469 6e67 2066 6565   all funding fee
+0001d500: 7320 7468 6174 206f 6363 7572 7265 6420  s that occurred 
+0001d510: 666f 7220 6120 7061 6972 0a20 2020 2020  for a pair.     
+0001d520: 2020 2064 7572 696e 6720 6120 6675 7475     during a futu
+0001d530: 7265 7320 7472 6164 652e 0a20 2020 2020  res trade..     
+0001d540: 2020 204f 6e6c 7920 7573 6564 2064 7572     Only used dur
+0001d550: 696e 6720 6472 792d 7275 6e20 6f72 2069  ing dry-run or i
+0001d560: 6620 7468 6520 6578 6368 616e 6765 2064  f the exchange d
+0001d570: 6f65 7320 6e6f 7420 7072 6f76 6964 6520  oes not provide 
+0001d580: 6120 6675 6e64 696e 675f 7261 7465 7320  a funding_rates 
+0001d590: 656e 6470 6f69 6e74 2e0a 2020 2020 2020  endpoint..      
+0001d5a0: 2020 3a70 6172 616d 2070 6169 723a 2054    :param pair: T
+0001d5b0: 6865 2071 756f 7465 2f62 6173 6520 7061  he quote/base pa
+0001d5c0: 6972 206f 6620 7468 6520 7472 6164 650a  ir of the trade.
+0001d5d0: 2020 2020 2020 2020 3a70 6172 616d 2061          :param a
+0001d5e0: 6d6f 756e 743a 2054 6865 2071 7561 6e74  mount: The quant
+0001d5f0: 6974 7920 6f66 2074 6865 2074 7261 6465  ity of the trade
+0001d600: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001d610: 6973 5f73 686f 7274 3a20 7472 6164 6520  is_short: trade 
+0001d620: 6469 7265 6374 696f 6e0a 2020 2020 2020  direction.      
+0001d630: 2020 3a70 6172 616d 206f 7065 6e5f 6461    :param open_da
+0001d640: 7465 3a20 5468 6520 6461 7465 2061 6e64  te: The date and
+0001d650: 2074 696d 6520 7468 6174 2074 6865 2074   time that the t
+0001d660: 7261 6465 2073 7461 7274 6564 0a20 2020  rade started.   
+0001d670: 2020 2020 203a 7061 7261 6d20 636c 6f73       :param clos
+0001d680: 655f 6461 7465 3a20 5468 6520 6461 7465  e_date: The date
+0001d690: 2061 6e64 2074 696d 6520 7468 6174 2074   and time that t
+0001d6a0: 6865 2074 7261 6465 2065 6e64 6564 0a20  he trade ended. 
+0001d6b0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0001d6c0: 2020 2020 6966 2073 656c 662e 6675 6e64      if self.fund
+0001d6d0: 696e 675f 6665 655f 6375 746f 6666 286f  ing_fee_cutoff(o
+0001d6e0: 7065 6e5f 6461 7465 293a 0a20 2020 2020  pen_date):.     
+0001d6f0: 2020 2020 2020 206f 7065 6e5f 6461 7465         open_date
+0001d700: 202b 3d20 7469 6d65 6465 6c74 6128 686f   += timedelta(ho
+0001d710: 7572 733d 3129 0a20 2020 2020 2020 2074  urs=1).        t
+0001d720: 696d 6566 7261 6d65 203d 2073 656c 662e  imeframe = self.
+0001d730: 5f66 745f 6861 735b 276d 6172 6b5f 6f68  _ft_has['mark_oh
+0001d740: 6c63 765f 7469 6d65 6672 616d 6527 5d0a  lcv_timeframe'].
+0001d750: 2020 2020 2020 2020 7469 6d65 6672 616d          timefram
+0001d760: 655f 6666 203d 2073 656c 662e 5f66 745f  e_ff = self._ft_
+0001d770: 6861 732e 6765 7428 2766 756e 6469 6e67  has.get('funding
+0001d780: 5f66 6565 5f74 696d 6566 7261 6d65 272c  _fee_timeframe',
+0001d790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0001d7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d7b0: 2020 7365 6c66 2e5f 6674 5f68 6173 5b27    self._ft_has['
-0001d7c0: 6d61 726b 5f6f 686c 6376 5f74 696d 6566  mark_ohlcv_timef
-0001d7d0: 7261 6d65 275d 290a 0a20 2020 2020 2020  rame'])..       
-0001d7e0: 2069 6620 6e6f 7420 636c 6f73 655f 6461   if not close_da
-0001d7f0: 7465 3a0a 2020 2020 2020 2020 2020 2020  te:.            
-0001d800: 636c 6f73 655f 6461 7465 203d 2064 6174  close_date = dat
-0001d810: 6574 696d 652e 6e6f 7728 7469 6d65 7a6f  etime.now(timezo
-0001d820: 6e65 2e75 7463 290a 2020 2020 2020 2020  ne.utc).        
-0001d830: 6f70 656e 5f74 696d 6573 7461 6d70 203d  open_timestamp =
-0001d840: 2069 6e74 2874 696d 6566 7261 6d65 5f74   int(timeframe_t
-0001d850: 6f5f 7072 6576 5f64 6174 6528 7469 6d65  o_prev_date(time
-0001d860: 6672 616d 652c 206f 7065 6e5f 6461 7465  frame, open_date
-0001d870: 292e 7469 6d65 7374 616d 7028 2929 202a  ).timestamp()) *
-0001d880: 2031 3030 300a 2020 2020 2020 2020 2320   1000.        # 
-0001d890: 636c 6f73 655f 7469 6d65 7374 616d 7020  close_timestamp 
-0001d8a0: 3d20 696e 7428 636c 6f73 655f 6461 7465  = int(close_date
-0001d8b0: 2e74 696d 6573 7461 6d70 2829 2920 2a20  .timestamp()) * 
-0001d8c0: 3130 3030 0a0a 2020 2020 2020 2020 6d61  1000..        ma
-0001d8d0: 726b 5f63 6f6d 623a 2050 6169 7257 6974  rk_comb: PairWit
-0001d8e0: 6854 696d 6566 7261 6d65 203d 2028 0a20  hTimeframe = (. 
-0001d8f0: 2020 2020 2020 2020 2020 2070 6169 722c             pair,
-0001d900: 2074 696d 6566 7261 6d65 2c20 4361 6e64   timeframe, Cand
-0001d910: 6c65 5479 7065 2e66 726f 6d5f 7374 7269  leType.from_stri
-0001d920: 6e67 2873 656c 662e 5f66 745f 6861 735b  ng(self._ft_has[
-0001d930: 226d 6172 6b5f 6f68 6c63 765f 7072 6963  "mark_ohlcv_pric
-0001d940: 6522 5d29 290a 0a20 2020 2020 2020 2066  e"]))..        f
-0001d950: 756e 6469 6e67 5f63 6f6d 623a 2050 6169  unding_comb: Pai
-0001d960: 7257 6974 6854 696d 6566 7261 6d65 203d  rWithTimeframe =
-0001d970: 2028 7061 6972 2c20 7469 6d65 6672 616d   (pair, timefram
-0001d980: 655f 6666 2c20 4361 6e64 6c65 5479 7065  e_ff, CandleType
-0001d990: 2e46 554e 4449 4e47 5f52 4154 4529 0a20  .FUNDING_RATE). 
-0001d9a0: 2020 2020 2020 2063 616e 646c 655f 6869         candle_hi
-0001d9b0: 7374 6f72 6965 7320 3d20 7365 6c66 2e72  stories = self.r
-0001d9c0: 6566 7265 7368 5f6c 6174 6573 745f 6f68  efresh_latest_oh
-0001d9d0: 6c63 7628 0a20 2020 2020 2020 2020 2020  lcv(.           
-0001d9e0: 205b 6d61 726b 5f63 6f6d 622c 2066 756e   [mark_comb, fun
-0001d9f0: 6469 6e67 5f63 6f6d 625d 2c0a 2020 2020  ding_comb],.    
-0001da00: 2020 2020 2020 2020 7369 6e63 655f 6d73          since_ms
-0001da10: 3d6f 7065 6e5f 7469 6d65 7374 616d 702c  =open_timestamp,
-0001da20: 0a20 2020 2020 2020 2020 2020 2063 6163  .            cac
-0001da30: 6865 3d46 616c 7365 2c0a 2020 2020 2020  he=False,.      
-0001da40: 2020 2020 2020 6472 6f70 5f69 6e63 6f6d        drop_incom
-0001da50: 706c 6574 653d 4661 6c73 652c 0a20 2020  plete=False,.   
-0001da60: 2020 2020 2029 0a20 2020 2020 2020 2074       ).        t
-0001da70: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0001da80: 2320 7765 2063 616e 2774 2061 7373 756d  # we can't assum
-0001da90: 6520 7765 2061 6c77 6179 7320 6765 7420  e we always get 
-0001daa0: 6869 7374 6f72 6965 7320 2d20 666f 7220  histories - for 
-0001dab0: 6578 616d 706c 6520 6475 7269 6e67 2065  example during e
-0001dac0: 7863 6861 6e67 6520 646f 776e 7469 6d65  xchange downtime
-0001dad0: 730a 2020 2020 2020 2020 2020 2020 6675  s.            fu
-0001dae0: 6e64 696e 675f 7261 7465 7320 3d20 6361  nding_rates = ca
-0001daf0: 6e64 6c65 5f68 6973 746f 7269 6573 5b66  ndle_histories[f
-0001db00: 756e 6469 6e67 5f63 6f6d 625d 0a20 2020  unding_comb].   
-0001db10: 2020 2020 2020 2020 206d 6172 6b5f 7261           mark_ra
-0001db20: 7465 7320 3d20 6361 6e64 6c65 5f68 6973  tes = candle_his
-0001db30: 746f 7269 6573 5b6d 6172 6b5f 636f 6d62  tories[mark_comb
-0001db40: 5d0a 2020 2020 2020 2020 6578 6365 7074  ].        except
-0001db50: 204b 6579 4572 726f 723a 0a20 2020 2020   KeyError:.     
-0001db60: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-0001db70: 6861 6e67 6545 7272 6f72 2822 436f 756c  hangeError("Coul
-0001db80: 6420 6e6f 7420 6669 6e64 2066 756e 6469  d not find fundi
-0001db90: 6e67 2072 6174 6573 2e22 2920 6672 6f6d  ng rates.") from
-0001dba0: 204e 6f6e 650a 0a20 2020 2020 2020 2066   None..        f
-0001dbb0: 756e 6469 6e67 5f6d 6172 6b5f 7261 7465  unding_mark_rate
-0001dbc0: 7320 3d20 7365 6c66 2e63 6f6d 6269 6e65  s = self.combine
-0001dbd0: 5f66 756e 6469 6e67 5f61 6e64 5f6d 6172  _funding_and_mar
-0001dbe0: 6b28 0a20 2020 2020 2020 2020 2020 2066  k(.            f
-0001dbf0: 756e 6469 6e67 5f72 6174 6573 3d66 756e  unding_rates=fun
-0001dc00: 6469 6e67 5f72 6174 6573 2c20 6d61 726b  ding_rates, mark
-0001dc10: 5f72 6174 6573 3d6d 6172 6b5f 7261 7465  _rates=mark_rate
-0001dc20: 7329 0a0a 2020 2020 2020 2020 7265 7475  s)..        retu
-0001dc30: 726e 2073 656c 662e 6361 6c63 756c 6174  rn self.calculat
-0001dc40: 655f 6675 6e64 696e 675f 6665 6573 280a  e_funding_fees(.
-0001dc50: 2020 2020 2020 2020 2020 2020 6675 6e64              fund
-0001dc60: 696e 675f 6d61 726b 5f72 6174 6573 2c0a  ing_mark_rates,.
-0001dc70: 2020 2020 2020 2020 2020 2020 616d 6f75              amou
-0001dc80: 6e74 3d61 6d6f 756e 742c 0a20 2020 2020  nt=amount,.     
-0001dc90: 2020 2020 2020 2069 735f 7368 6f72 743d         is_short=
-0001dca0: 6973 5f73 686f 7274 2c0a 2020 2020 2020  is_short,.      
-0001dcb0: 2020 2020 2020 6f70 656e 5f64 6174 653d        open_date=
-0001dcc0: 6f70 656e 5f64 6174 652c 0a20 2020 2020  open_date,.     
-0001dcd0: 2020 2020 2020 2063 6c6f 7365 5f64 6174         close_dat
-0001dce0: 653d 636c 6f73 655f 6461 7465 0a20 2020  e=close_date.   
-0001dcf0: 2020 2020 2029 0a0a 2020 2020 4073 7461       )..    @sta
-0001dd00: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
-0001dd10: 6620 636f 6d62 696e 655f 6675 6e64 696e  f combine_fundin
-0001dd20: 675f 616e 645f 6d61 726b 2866 756e 6469  g_and_mark(fundi
-0001dd30: 6e67 5f72 6174 6573 3a20 4461 7461 4672  ng_rates: DataFr
-0001dd40: 616d 652c 206d 6172 6b5f 7261 7465 733a  ame, mark_rates:
-0001dd50: 2044 6174 6146 7261 6d65 2c0a 2020 2020   DataFrame,.    
-0001dd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dd70: 2020 2020 2020 2020 2020 2020 2066 7574               fut
-0001dd80: 7572 6573 5f66 756e 6469 6e67 5f72 6174  ures_funding_rat
-0001dd90: 653a 204f 7074 696f 6e61 6c5b 696e 745d  e: Optional[int]
-0001dda0: 203d 204e 6f6e 6529 202d 3e20 4461 7461   = None) -> Data
-0001ddb0: 4672 616d 653a 0a20 2020 2020 2020 2022  Frame:.        "
-0001ddc0: 2222 0a20 2020 2020 2020 2043 6f6d 6269  "".        Combi
-0001ddd0: 6e65 2066 756e 6469 6e67 2d72 6174 6573  ne funding-rates
-0001dde0: 2061 6e64 206d 6172 6b2d 7261 7465 7320   and mark-rates 
-0001ddf0: 6461 7461 6672 616d 6573 0a20 2020 2020  dataframes.     
-0001de00: 2020 203a 7061 7261 6d20 6675 6e64 696e     :param fundin
-0001de10: 675f 7261 7465 733a 2044 6174 6166 7261  g_rates: Datafra
-0001de20: 6d65 2063 6f6e 7461 696e 696e 6720 4675  me containing Fu
-0001de30: 6e64 696e 6720 7261 7465 7320 2854 7970  nding rates (Typ
-0001de40: 6520 4655 4e44 494e 475f 5241 5445 290a  e FUNDING_RATE).
-0001de50: 2020 2020 2020 2020 3a70 6172 616d 206d          :param m
-0001de60: 6172 6b5f 7261 7465 733a 2044 6174 6166  ark_rates: Dataf
-0001de70: 7261 6d65 2063 6f6e 7461 696e 696e 6720  rame containing 
-0001de80: 4d61 726b 2072 6174 6573 2028 5479 7065  Mark rates (Type
-0001de90: 206d 6172 6b5f 6f68 6c63 765f 7072 6963   mark_ohlcv_pric
-0001dea0: 6529 0a20 2020 2020 2020 203a 7061 7261  e).        :para
-0001deb0: 6d20 6675 7475 7265 735f 6675 6e64 696e  m futures_fundin
-0001dec0: 675f 7261 7465 3a20 4661 6b65 2066 756e  g_rate: Fake fun
-0001ded0: 6469 6e67 2072 6174 6520 746f 2075 7365  ding rate to use
-0001dee0: 2069 6620 6675 6e64 696e 675f 7261 7465   if funding_rate
-0001def0: 7320 6172 6520 6e6f 7420 6176 6169 6c61  s are not availa
-0001df00: 626c 650a 2020 2020 2020 2020 2222 220a  ble.        """.
-0001df10: 2020 2020 2020 2020 6966 2066 7574 7572          if futur
-0001df20: 6573 5f66 756e 6469 6e67 5f72 6174 6520  es_funding_rate 
-0001df30: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0001df40: 2020 2020 2072 6574 7572 6e20 6d61 726b       return mark
-0001df50: 5f72 6174 6573 2e6d 6572 6765 280a 2020  _rates.merge(.  
-0001df60: 2020 2020 2020 2020 2020 2020 2020 6675                fu
-0001df70: 6e64 696e 675f 7261 7465 732c 206f 6e3d  nding_rates, on=
-0001df80: 2764 6174 6527 2c20 686f 773d 2269 6e6e  'date', how="inn
-0001df90: 6572 222c 2073 7566 6669 7865 733d 5b22  er", suffixes=["
-0001dfa0: 5f6d 6172 6b22 2c20 225f 6675 6e64 225d  _mark", "_fund"]
-0001dfb0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0001dfc0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0001dfd0: 656e 2866 756e 6469 6e67 5f72 6174 6573  en(funding_rates
-0001dfe0: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-0001dff0: 2020 2020 2020 2020 2320 4e6f 2066 756e          # No fun
-0001e000: 6469 6e67 2072 6174 6520 6361 6e64 6c65  ding rate candle
-0001e010: 7320 2d20 6675 6c6c 2066 696c 6c75 7020  s - full fillup 
-0001e020: 7769 7468 2066 616c 6c62 6163 6b20 7661  with fallback va
-0001e030: 7269 6162 6c65 0a20 2020 2020 2020 2020  riable.         
-0001e040: 2020 2020 2020 206d 6172 6b5f 7261 7465         mark_rate
-0001e050: 735b 276f 7065 6e5f 6675 6e64 275d 203d  s['open_fund'] =
-0001e060: 2066 7574 7572 6573 5f66 756e 6469 6e67   futures_funding
-0001e070: 5f72 6174 650a 2020 2020 2020 2020 2020  _rate.          
-0001e080: 2020 2020 2020 7265 7475 726e 206d 6172        return mar
-0001e090: 6b5f 7261 7465 732e 7265 6e61 6d65 280a  k_rates.rename(.
-0001e0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e0b0: 2020 2020 2020 2020 636f 6c75 6d6e 733d          columns=
-0001e0c0: 7b27 6f70 656e 273a 2027 6f70 656e 5f6d  {'open': 'open_m
-0001e0d0: 6172 6b27 2c0a 2020 2020 2020 2020 2020  ark',.          
+0001d7b0: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
+0001d7c0: 745f 6861 735b 276d 6172 6b5f 6f68 6c63  t_has['mark_ohlc
+0001d7d0: 765f 7469 6d65 6672 616d 6527 5d29 0a0a  v_timeframe'])..
+0001d7e0: 2020 2020 2020 2020 6966 206e 6f74 2063          if not c
+0001d7f0: 6c6f 7365 5f64 6174 653a 0a20 2020 2020  lose_date:.     
+0001d800: 2020 2020 2020 2063 6c6f 7365 5f64 6174         close_dat
+0001d810: 6520 3d20 6461 7465 7469 6d65 2e6e 6f77  e = datetime.now
+0001d820: 2874 696d 657a 6f6e 652e 7574 6329 0a20  (timezone.utc). 
+0001d830: 2020 2020 2020 206f 7065 6e5f 7469 6d65         open_time
+0001d840: 7374 616d 7020 3d20 696e 7428 7469 6d65  stamp = int(time
+0001d850: 6672 616d 655f 746f 5f70 7265 765f 6461  frame_to_prev_da
+0001d860: 7465 2874 696d 6566 7261 6d65 2c20 6f70  te(timeframe, op
+0001d870: 656e 5f64 6174 6529 2e74 696d 6573 7461  en_date).timesta
+0001d880: 6d70 2829 2920 2a20 3130 3030 0a20 2020  mp()) * 1000.   
+0001d890: 2020 2020 2023 2063 6c6f 7365 5f74 696d       # close_tim
+0001d8a0: 6573 7461 6d70 203d 2069 6e74 2863 6c6f  estamp = int(clo
+0001d8b0: 7365 5f64 6174 652e 7469 6d65 7374 616d  se_date.timestam
+0001d8c0: 7028 2929 202a 2031 3030 300a 0a20 2020  p()) * 1000..   
+0001d8d0: 2020 2020 206d 6172 6b5f 636f 6d62 3a20       mark_comb: 
+0001d8e0: 5061 6972 5769 7468 5469 6d65 6672 616d  PairWithTimefram
+0001d8f0: 6520 3d20 280a 2020 2020 2020 2020 2020  e = (.          
+0001d900: 2020 7061 6972 2c20 7469 6d65 6672 616d    pair, timefram
+0001d910: 652c 2043 616e 646c 6554 7970 652e 6672  e, CandleType.fr
+0001d920: 6f6d 5f73 7472 696e 6728 7365 6c66 2e5f  om_string(self._
+0001d930: 6674 5f68 6173 5b22 6d61 726b 5f6f 686c  ft_has["mark_ohl
+0001d940: 6376 5f70 7269 6365 225d 2929 0a0a 2020  cv_price"]))..  
+0001d950: 2020 2020 2020 6675 6e64 696e 675f 636f        funding_co
+0001d960: 6d62 3a20 5061 6972 5769 7468 5469 6d65  mb: PairWithTime
+0001d970: 6672 616d 6520 3d20 2870 6169 722c 2074  frame = (pair, t
+0001d980: 696d 6566 7261 6d65 5f66 662c 2043 616e  imeframe_ff, Can
+0001d990: 646c 6554 7970 652e 4655 4e44 494e 475f  dleType.FUNDING_
+0001d9a0: 5241 5445 290a 2020 2020 2020 2020 6361  RATE).        ca
+0001d9b0: 6e64 6c65 5f68 6973 746f 7269 6573 203d  ndle_histories =
+0001d9c0: 2073 656c 662e 7265 6672 6573 685f 6c61   self.refresh_la
+0001d9d0: 7465 7374 5f6f 686c 6376 280a 2020 2020  test_ohlcv(.    
+0001d9e0: 2020 2020 2020 2020 5b6d 6172 6b5f 636f          [mark_co
+0001d9f0: 6d62 2c20 6675 6e64 696e 675f 636f 6d62  mb, funding_comb
+0001da00: 5d2c 0a20 2020 2020 2020 2020 2020 2073  ],.            s
+0001da10: 696e 6365 5f6d 733d 6f70 656e 5f74 696d  ince_ms=open_tim
+0001da20: 6573 7461 6d70 2c0a 2020 2020 2020 2020  estamp,.        
+0001da30: 2020 2020 6361 6368 653d 4661 6c73 652c      cache=False,
+0001da40: 0a20 2020 2020 2020 2020 2020 2064 726f  .            dro
+0001da50: 705f 696e 636f 6d70 6c65 7465 3d46 616c  p_incomplete=Fal
+0001da60: 7365 2c0a 2020 2020 2020 2020 290a 2020  se,.        ).  
+0001da70: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0001da80: 2020 2020 2020 2023 2077 6520 6361 6e27         # we can'
+0001da90: 7420 6173 7375 6d65 2077 6520 616c 7761  t assume we alwa
+0001daa0: 7973 2067 6574 2068 6973 746f 7269 6573  ys get histories
+0001dab0: 202d 2066 6f72 2065 7861 6d70 6c65 2064   - for example d
+0001dac0: 7572 696e 6720 6578 6368 616e 6765 2064  uring exchange d
+0001dad0: 6f77 6e74 696d 6573 0a20 2020 2020 2020  owntimes.       
+0001dae0: 2020 2020 2066 756e 6469 6e67 5f72 6174       funding_rat
+0001daf0: 6573 203d 2063 616e 646c 655f 6869 7374  es = candle_hist
+0001db00: 6f72 6965 735b 6675 6e64 696e 675f 636f  ories[funding_co
+0001db10: 6d62 5d0a 2020 2020 2020 2020 2020 2020  mb].            
+0001db20: 6d61 726b 5f72 6174 6573 203d 2063 616e  mark_rates = can
+0001db30: 646c 655f 6869 7374 6f72 6965 735b 6d61  dle_histories[ma
+0001db40: 726b 5f63 6f6d 625d 0a20 2020 2020 2020  rk_comb].       
+0001db50: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
+0001db60: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0001db70: 6973 6520 4578 6368 616e 6765 4572 726f  ise ExchangeErro
+0001db80: 7228 2243 6f75 6c64 206e 6f74 2066 696e  r("Could not fin
+0001db90: 6420 6675 6e64 696e 6720 7261 7465 732e  d funding rates.
+0001dba0: 2229 2066 726f 6d20 4e6f 6e65 0a0a 2020  ") from None..  
+0001dbb0: 2020 2020 2020 6675 6e64 696e 675f 6d61        funding_ma
+0001dbc0: 726b 5f72 6174 6573 203d 2073 656c 662e  rk_rates = self.
+0001dbd0: 636f 6d62 696e 655f 6675 6e64 696e 675f  combine_funding_
+0001dbe0: 616e 645f 6d61 726b 280a 2020 2020 2020  and_mark(.      
+0001dbf0: 2020 2020 2020 6675 6e64 696e 675f 7261        funding_ra
+0001dc00: 7465 733d 6675 6e64 696e 675f 7261 7465  tes=funding_rate
+0001dc10: 732c 206d 6172 6b5f 7261 7465 733d 6d61  s, mark_rates=ma
+0001dc20: 726b 5f72 6174 6573 290a 0a20 2020 2020  rk_rates)..     
+0001dc30: 2020 2072 6574 7572 6e20 7365 6c66 2e63     return self.c
+0001dc40: 616c 6375 6c61 7465 5f66 756e 6469 6e67  alculate_funding
+0001dc50: 5f66 6565 7328 0a20 2020 2020 2020 2020  _fees(.         
+0001dc60: 2020 2066 756e 6469 6e67 5f6d 6172 6b5f     funding_mark_
+0001dc70: 7261 7465 732c 0a20 2020 2020 2020 2020  rates,.         
+0001dc80: 2020 2061 6d6f 756e 743d 616d 6f75 6e74     amount=amount
+0001dc90: 2c0a 2020 2020 2020 2020 2020 2020 6973  ,.            is
+0001dca0: 5f73 686f 7274 3d69 735f 7368 6f72 742c  _short=is_short,
+0001dcb0: 0a20 2020 2020 2020 2020 2020 206f 7065  .            ope
+0001dcc0: 6e5f 6461 7465 3d6f 7065 6e5f 6461 7465  n_date=open_date
+0001dcd0: 2c0a 2020 2020 2020 2020 2020 2020 636c  ,.            cl
+0001dce0: 6f73 655f 6461 7465 3d63 6c6f 7365 5f64  ose_date=close_d
+0001dcf0: 6174 650a 2020 2020 2020 2020 290a 0a20  ate.        ).. 
+0001dd00: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
+0001dd10: 0a20 2020 2064 6566 2063 6f6d 6269 6e65  .    def combine
+0001dd20: 5f66 756e 6469 6e67 5f61 6e64 5f6d 6172  _funding_and_mar
+0001dd30: 6b28 6675 6e64 696e 675f 7261 7465 733a  k(funding_rates:
+0001dd40: 2044 6174 6146 7261 6d65 2c20 6d61 726b   DataFrame, mark
+0001dd50: 5f72 6174 6573 3a20 4461 7461 4672 616d  _rates: DataFram
+0001dd60: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0001dd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd80: 2020 2020 6675 7475 7265 735f 6675 6e64      futures_fund
+0001dd90: 696e 675f 7261 7465 3a20 4f70 7469 6f6e  ing_rate: Option
+0001dda0: 616c 5b69 6e74 5d20 3d20 4e6f 6e65 2920  al[int] = None) 
+0001ddb0: 2d3e 2044 6174 6146 7261 6d65 3a0a 2020  -> DataFrame:.  
+0001ddc0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001ddd0: 2020 436f 6d62 696e 6520 6675 6e64 696e    Combine fundin
+0001dde0: 672d 7261 7465 7320 616e 6420 6d61 726b  g-rates and mark
+0001ddf0: 2d72 6174 6573 2064 6174 6166 7261 6d65  -rates dataframe
+0001de00: 730a 2020 2020 2020 2020 3a70 6172 616d  s.        :param
+0001de10: 2066 756e 6469 6e67 5f72 6174 6573 3a20   funding_rates: 
+0001de20: 4461 7461 6672 616d 6520 636f 6e74 6169  Dataframe contai
+0001de30: 6e69 6e67 2046 756e 6469 6e67 2072 6174  ning Funding rat
+0001de40: 6573 2028 5479 7065 2046 554e 4449 4e47  es (Type FUNDING
+0001de50: 5f52 4154 4529 0a20 2020 2020 2020 203a  _RATE).        :
+0001de60: 7061 7261 6d20 6d61 726b 5f72 6174 6573  param mark_rates
+0001de70: 3a20 4461 7461 6672 616d 6520 636f 6e74  : Dataframe cont
+0001de80: 6169 6e69 6e67 204d 6172 6b20 7261 7465  aining Mark rate
+0001de90: 7320 2854 7970 6520 6d61 726b 5f6f 686c  s (Type mark_ohl
+0001dea0: 6376 5f70 7269 6365 290a 2020 2020 2020  cv_price).      
+0001deb0: 2020 3a70 6172 616d 2066 7574 7572 6573    :param futures
+0001dec0: 5f66 756e 6469 6e67 5f72 6174 653a 2046  _funding_rate: F
+0001ded0: 616b 6520 6675 6e64 696e 6720 7261 7465  ake funding rate
+0001dee0: 2074 6f20 7573 6520 6966 2066 756e 6469   to use if fundi
+0001def0: 6e67 5f72 6174 6573 2061 7265 206e 6f74  ng_rates are not
+0001df00: 2061 7661 696c 6162 6c65 0a20 2020 2020   available.     
+0001df10: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+0001df20: 6620 6675 7475 7265 735f 6675 6e64 696e  f futures_fundin
+0001df30: 675f 7261 7465 2069 7320 4e6f 6e65 3a0a  g_rate is None:.
+0001df40: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001df50: 726e 206d 6172 6b5f 7261 7465 732e 6d65  rn mark_rates.me
+0001df60: 7267 6528 0a20 2020 2020 2020 2020 2020  rge(.           
+0001df70: 2020 2020 2066 756e 6469 6e67 5f72 6174       funding_rat
+0001df80: 6573 2c20 6f6e 3d27 6461 7465 272c 2068  es, on='date', h
+0001df90: 6f77 3d22 696e 6e65 7222 2c20 7375 6666  ow="inner", suff
+0001dfa0: 6978 6573 3d5b 225f 6d61 726b 222c 2022  ixes=["_mark", "
+0001dfb0: 5f66 756e 6422 5d29 0a20 2020 2020 2020  _fund"]).       
+0001dfc0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001dfd0: 2020 2069 6620 6c65 6e28 6675 6e64 696e     if len(fundin
+0001dfe0: 675f 7261 7465 7329 203d 3d20 303a 0a20  g_rates) == 0:. 
+0001dff0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001e000: 204e 6f20 6675 6e64 696e 6720 7261 7465   No funding rate
+0001e010: 2063 616e 646c 6573 202d 2066 756c 6c20   candles - full 
+0001e020: 6669 6c6c 7570 2077 6974 6820 6661 6c6c  fillup with fall
+0001e030: 6261 636b 2076 6172 6961 626c 650a 2020  back variable.  
+0001e040: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+0001e050: 726b 5f72 6174 6573 5b27 6f70 656e 5f66  rk_rates['open_f
+0001e060: 756e 6427 5d20 3d20 6675 7475 7265 735f  und'] = futures_
+0001e070: 6675 6e64 696e 675f 7261 7465 0a20 2020  funding_rate.   
+0001e080: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0001e090: 7572 6e20 6d61 726b 5f72 6174 6573 2e72  urn mark_rates.r
+0001e0a0: 656e 616d 6528 0a20 2020 2020 2020 2020  ename(.         
+0001e0b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001e0c0: 6f6c 756d 6e73 3d7b 276f 7065 6e27 3a20  olumns={'open': 
+0001e0d0: 276f 7065 6e5f 6d61 726b 272c 0a20 2020  'open_mark',.   
 0001e0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e0f0: 2020 2020 2020 2027 636c 6f73 6527 3a20         'close': 
-0001e100: 2763 6c6f 7365 5f6d 6172 6b27 2c0a 2020  'close_mark',.  
-0001e110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e120: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001e130: 6869 6768 273a 2027 6869 6768 5f6d 6172  high': 'high_mar
-0001e140: 6b27 2c0a 2020 2020 2020 2020 2020 2020  k',.            
+0001e0f0: 2020 2020 2020 2020 2020 2020 2020 2763                'c
+0001e100: 6c6f 7365 273a 2027 636c 6f73 655f 6d61  lose': 'close_ma
+0001e110: 726b 272c 0a20 2020 2020 2020 2020 2020  rk',.           
+0001e120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e130: 2020 2020 2020 2768 6967 6827 3a20 2768        'high': 'h
+0001e140: 6967 685f 6d61 726b 272c 0a20 2020 2020  igh_mark',.     
 0001e150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e160: 2020 2020 2027 6c6f 7727 3a20 276c 6f77       'low': 'low
-0001e170: 5f6d 6172 6b27 2c0a 2020 2020 2020 2020  _mark',.        
+0001e160: 2020 2020 2020 2020 2020 2020 276c 6f77              'low
+0001e170: 273a 2027 6c6f 775f 6d61 726b 272c 0a20  ': 'low_mark',. 
 0001e180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e190: 2020 2020 2020 2020 2027 766f 6c75 6d65           'volume
-0001e1a0: 273a 2027 766f 6c75 6d65 5f6d 6172 6b27  ': 'volume_mark'
-0001e1b0: 7d29 0a0a 2020 2020 2020 2020 2020 2020  })..            
-0001e1c0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001e1d0: 2020 2020 2020 2320 4669 6c6c 2075 7020        # Fill up 
-0001e1e0: 6d69 7373 696e 6720 6675 6e64 696e 675f  missing funding_
-0001e1f0: 7261 7465 2063 616e 646c 6573 2077 6974  rate candles wit
-0001e200: 6820 6661 6c6c 6261 636b 2076 616c 7565  h fallback value
-0001e210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e220: 2063 6f6d 6269 6e65 6420 3d20 6d61 726b   combined = mark
-0001e230: 5f72 6174 6573 2e6d 6572 6765 280a 2020  _rates.merge(.  
-0001e240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e250: 2020 6675 6e64 696e 675f 7261 7465 732c    funding_rates,
-0001e260: 206f 6e3d 2764 6174 6527 2c20 686f 773d   on='date', how=
-0001e270: 226f 7574 6572 222c 2073 7566 6669 7865  "outer", suffixe
-0001e280: 733d 5b22 5f6d 6172 6b22 2c20 225f 6675  s=["_mark", "_fu
-0001e290: 6e64 225d 0a20 2020 2020 2020 2020 2020  nd"].           
-0001e2a0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0001e2b0: 2020 2020 2020 2020 2020 2063 6f6d 6269             combi
-0001e2c0: 6e65 645b 276f 7065 6e5f 6675 6e64 275d  ned['open_fund']
-0001e2d0: 203d 2063 6f6d 6269 6e65 645b 276f 7065   = combined['ope
-0001e2e0: 6e5f 6675 6e64 275d 2e66 696c 6c6e 6128  n_fund'].fillna(
-0001e2f0: 6675 7475 7265 735f 6675 6e64 696e 675f  futures_funding_
-0001e300: 7261 7465 290a 2020 2020 2020 2020 2020  rate).          
-0001e310: 2020 2020 2020 7265 7475 726e 2063 6f6d        return com
-0001e320: 6269 6e65 640a 0a20 2020 2064 6566 2063  bined..    def c
-0001e330: 616c 6375 6c61 7465 5f66 756e 6469 6e67  alculate_funding
-0001e340: 5f66 6565 7328 0a20 2020 2020 2020 2073  _fees(.        s
-0001e350: 656c 662c 0a20 2020 2020 2020 2064 663a  elf,.        df:
-0001e360: 2044 6174 6146 7261 6d65 2c0a 2020 2020   DataFrame,.    
-0001e370: 2020 2020 616d 6f75 6e74 3a20 666c 6f61      amount: floa
-0001e380: 742c 0a20 2020 2020 2020 2069 735f 7368  t,.        is_sh
-0001e390: 6f72 743a 2062 6f6f 6c2c 0a20 2020 2020  ort: bool,.     
-0001e3a0: 2020 206f 7065 6e5f 6461 7465 3a20 6461     open_date: da
-0001e3b0: 7465 7469 6d65 2c0a 2020 2020 2020 2020  tetime,.        
-0001e3c0: 636c 6f73 655f 6461 7465 3a20 4f70 7469  close_date: Opti
-0001e3d0: 6f6e 616c 5b64 6174 6574 696d 655d 203d  onal[datetime] =
-0001e3e0: 204e 6f6e 652c 0a20 2020 2020 2020 2074   None,.        t
-0001e3f0: 696d 655f 696e 5f72 6174 696f 3a20 4f70  ime_in_ratio: Op
-0001e400: 7469 6f6e 616c 5b66 6c6f 6174 5d20 3d20  tional[float] = 
-0001e410: 4e6f 6e65 0a20 2020 2029 202d 3e20 666c  None.    ) -> fl
-0001e420: 6f61 743a 0a20 2020 2020 2020 2022 2222  oat:.        """
-0001e430: 0a20 2020 2020 2020 2063 616c 6375 6c61  .        calcula
-0001e440: 7465 7320 7468 6520 7375 6d20 6f66 2061  tes the sum of a
-0001e450: 6c6c 2066 756e 6469 6e67 2066 6565 7320  ll funding fees 
-0001e460: 7468 6174 206f 6363 7572 7265 6420 666f  that occurred fo
-0001e470: 7220 6120 7061 6972 2064 7572 696e 6720  r a pair during 
-0001e480: 6120 6675 7475 7265 7320 7472 6164 650a  a futures trade.
-0001e490: 2020 2020 2020 2020 3a70 6172 616d 2064          :param d
-0001e4a0: 663a 2044 6174 6166 7261 6d65 2063 6f6e  f: Dataframe con
-0001e4b0: 7461 696e 696e 6720 636f 6d62 696e 6564  taining combined
-0001e4c0: 2066 756e 6469 6e67 2061 6e64 206d 6172   funding and mar
-0001e4d0: 6b20 7261 7465 730a 2020 2020 2020 2020  k rates.        
-0001e4e0: 2020 2020 2020 2020 2020 2061 7320 606f             as `o
-0001e4f0: 7065 6e5f 6675 6e64 6020 616e 6420 606f  pen_fund` and `o
-0001e500: 7065 6e5f 6d61 726b 602e 0a20 2020 2020  pen_mark`..     
-0001e510: 2020 203a 7061 7261 6d20 616d 6f75 6e74     :param amount
-0001e520: 3a20 5468 6520 7175 616e 7469 7479 206f  : The quantity o
-0001e530: 6620 7468 6520 7472 6164 650a 2020 2020  f the trade.    
-0001e540: 2020 2020 3a70 6172 616d 2069 735f 7368      :param is_sh
-0001e550: 6f72 743a 2074 7261 6465 2064 6972 6563  ort: trade direc
-0001e560: 7469 6f6e 0a20 2020 2020 2020 203a 7061  tion.        :pa
-0001e570: 7261 6d20 6f70 656e 5f64 6174 653a 2054  ram open_date: T
-0001e580: 6865 2064 6174 6520 616e 6420 7469 6d65  he date and time
-0001e590: 2074 6861 7420 7468 6520 7472 6164 6520   that the trade 
-0001e5a0: 7374 6172 7465 640a 2020 2020 2020 2020  started.        
-0001e5b0: 3a70 6172 616d 2063 6c6f 7365 5f64 6174  :param close_dat
-0001e5c0: 653a 2054 6865 2064 6174 6520 616e 6420  e: The date and 
-0001e5d0: 7469 6d65 2074 6861 7420 7468 6520 7472  time that the tr
-0001e5e0: 6164 6520 656e 6465 640a 2020 2020 2020  ade ended.      
-0001e5f0: 2020 3a70 6172 616d 2074 696d 655f 696e    :param time_in
-0001e600: 5f72 6174 696f 3a20 4e6f 7420 7573 6564  _ratio: Not used
-0001e610: 2062 7920 6d6f 7374 2065 7863 6861 6e67   by most exchang
-0001e620: 6520 636c 6173 7365 730a 2020 2020 2020  e classes.      
-0001e630: 2020 2222 220a 2020 2020 2020 2020 6665    """.        fe
-0001e640: 6573 3a20 666c 6f61 7420 3d20 300a 0a20  es: float = 0.. 
-0001e650: 2020 2020 2020 2069 6620 6e6f 7420 6466         if not df
-0001e660: 2e65 6d70 7479 3a0a 2020 2020 2020 2020  .empty:.        
-0001e670: 2020 2020 6466 203d 2064 665b 2864 665b      df = df[(df[
-0001e680: 2764 6174 6527 5d20 3e3d 206f 7065 6e5f  'date'] >= open_
-0001e690: 6461 7465 2920 2620 2864 665b 2764 6174  date) & (df['dat
-0001e6a0: 6527 5d20 3c3d 2063 6c6f 7365 5f64 6174  e'] <= close_dat
-0001e6b0: 6529 5d0a 2020 2020 2020 2020 2020 2020  e)].            
-0001e6c0: 6665 6573 203d 2073 756d 2864 665b 276f  fees = sum(df['o
-0001e6d0: 7065 6e5f 6675 6e64 275d 202a 2064 665b  pen_fund'] * df[
-0001e6e0: 276f 7065 6e5f 6d61 726b 275d 202a 2061  'open_mark'] * a
-0001e6f0: 6d6f 756e 7429 0a0a 2020 2020 2020 2020  mount)..        
-0001e700: 2320 4e65 6761 7465 2066 6565 7320 666f  # Negate fees fo
-0001e710: 7220 6c6f 6e67 7320 6173 2066 756e 6469  r longs as fundi
-0001e720: 6e67 5f66 6565 7320 6578 7065 6374 7320  ng_fees expects 
-0001e730: 6974 2074 6869 7320 7761 7920 6261 7365  it this way base
-0001e740: 6420 6f6e 206c 6976 6520 656e 6470 6f69  d on live endpoi
-0001e750: 6e74 732e 0a20 2020 2020 2020 2072 6574  nts..        ret
-0001e760: 7572 6e20 6665 6573 2069 6620 6973 5f73  urn fees if is_s
-0001e770: 686f 7274 2065 6c73 6520 2d66 6565 730a  hort else -fees.
-0001e780: 0a20 2020 2064 6566 2067 6574 5f66 756e  .    def get_fun
-0001e790: 6469 6e67 5f66 6565 7328 0a20 2020 2020  ding_fees(.     
-0001e7a0: 2020 2020 2020 2073 656c 662c 2070 6169         self, pai
-0001e7b0: 723a 2073 7472 2c20 616d 6f75 6e74 3a20  r: str, amount: 
-0001e7c0: 666c 6f61 742c 2069 735f 7368 6f72 743a  float, is_short:
-0001e7d0: 2062 6f6f 6c2c 206f 7065 6e5f 6461 7465   bool, open_date
-0001e7e0: 3a20 6461 7465 7469 6d65 2920 2d3e 2066  : datetime) -> f
-0001e7f0: 6c6f 6174 3a0a 2020 2020 2020 2020 2222  loat:.        ""
-0001e800: 220a 2020 2020 2020 2020 4665 7463 6820  ".        Fetch 
-0001e810: 6675 6e64 696e 6720 6665 6573 2c20 6569  funding fees, ei
-0001e820: 7468 6572 2066 726f 6d20 7468 6520 6578  ther from the ex
-0001e830: 6368 616e 6765 2028 6c69 7665 2920 6f72  change (live) or
-0001e840: 2063 616c 6375 6c61 7465 7320 7468 656d   calculates them
-0001e850: 0a20 2020 2020 2020 2062 6173 6564 206f  .        based o
-0001e860: 6e20 6675 6e64 696e 6720 7261 7465 2f6d  n funding rate/m
-0001e870: 6172 6b20 7072 6963 6520 6869 7374 6f72  ark price histor
-0001e880: 790a 2020 2020 2020 2020 3a70 6172 616d  y.        :param
-0001e890: 2070 6169 723a 2054 6865 2071 756f 7465   pair: The quote
-0001e8a0: 2f62 6173 6520 7061 6972 206f 6620 7468  /base pair of th
-0001e8b0: 6520 7472 6164 650a 2020 2020 2020 2020  e trade.        
-0001e8c0: 3a70 6172 616d 2069 735f 7368 6f72 743a  :param is_short:
-0001e8d0: 2074 7261 6465 2064 6972 6563 7469 6f6e   trade direction
-0001e8e0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0001e8f0: 616d 6f75 6e74 3a20 5472 6164 6520 616d  amount: Trade am
-0001e900: 6f75 6e74 0a20 2020 2020 2020 203a 7061  ount.        :pa
-0001e910: 7261 6d20 6f70 656e 5f64 6174 653a 204f  ram open_date: O
-0001e920: 7065 6e20 6461 7465 206f 6620 7468 6520  pen date of the 
-0001e930: 7472 6164 650a 2020 2020 2020 2020 3a72  trade.        :r
-0001e940: 6574 7572 6e3a 2066 756e 6469 6e67 2066  eturn: funding f
-0001e950: 6565 2073 696e 6365 206f 7065 6e5f 6461  ee since open_da
-0001e960: 7465 0a20 2020 2020 2020 203a 7261 6973  te.        :rais
-0001e970: 6573 3a20 4578 6368 616e 6765 4572 726f  es: ExchangeErro
-0001e980: 7220 6966 2073 6f6d 6574 6869 6e67 2067  r if something g
-0001e990: 6f65 7320 7772 6f6e 672e 0a20 2020 2020  oes wrong..     
-0001e9a0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-0001e9b0: 6620 7365 6c66 2e74 7261 6469 6e67 5f6d  f self.trading_m
-0001e9c0: 6f64 6520 3d3d 2054 7261 6469 6e67 4d6f  ode == TradingMo
-0001e9d0: 6465 2e46 5554 5552 4553 3a0a 2020 2020  de.FUTURES:.    
-0001e9e0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0001e9f0: 5f63 6f6e 6669 675b 2764 7279 5f72 756e  _config['dry_run
-0001ea00: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
-0001ea10: 2020 2020 6675 6e64 696e 675f 6665 6573      funding_fees
-0001ea20: 203d 2073 656c 662e 5f66 6574 6368 5f61   = self._fetch_a
-0001ea30: 6e64 5f63 616c 6375 6c61 7465 5f66 756e  nd_calculate_fun
-0001ea40: 6469 6e67 5f66 6565 7328 0a20 2020 2020  ding_fees(.     
-0001ea50: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001ea60: 6169 722c 2061 6d6f 756e 742c 2069 735f  air, amount, is_
-0001ea70: 7368 6f72 742c 206f 7065 6e5f 6461 7465  short, open_date
-0001ea80: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-0001ea90: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001eaa0: 2020 2020 6675 6e64 696e 675f 6665 6573      funding_fees
-0001eab0: 203d 2073 656c 662e 5f67 6574 5f66 756e   = self._get_fun
-0001eac0: 6469 6e67 5f66 6565 735f 6672 6f6d 5f65  ding_fees_from_e
-0001ead0: 7863 6861 6e67 6528 7061 6972 2c20 6f70  xchange(pair, op
-0001eae0: 656e 5f64 6174 6529 0a20 2020 2020 2020  en_date).       
-0001eaf0: 2020 2020 2072 6574 7572 6e20 6675 6e64       return fund
-0001eb00: 696e 675f 6665 6573 0a20 2020 2020 2020  ing_fees.       
-0001eb10: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001eb20: 2020 2072 6574 7572 6e20 302e 300a 0a20     return 0.0.. 
-0001eb30: 2020 2064 6566 2067 6574 5f6c 6971 7569     def get_liqui
-0001eb40: 6461 7469 6f6e 5f70 7269 6365 280a 2020  dation_price(.  
-0001eb50: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-0001eb60: 2020 2020 7061 6972 3a20 7374 722c 0a20      pair: str,. 
-0001eb70: 2020 2020 2020 2023 2044 7279 2d72 756e         # Dry-run
-0001eb80: 0a20 2020 2020 2020 206f 7065 6e5f 7261  .        open_ra
-0001eb90: 7465 3a20 666c 6f61 742c 2020 2023 2045  te: float,   # E
-0001eba0: 6e74 7279 2070 7269 6365 206f 6620 706f  ntry price of po
-0001ebb0: 7369 7469 6f6e 0a20 2020 2020 2020 2069  sition.        i
-0001ebc0: 735f 7368 6f72 743a 2062 6f6f 6c2c 0a20  s_short: bool,. 
-0001ebd0: 2020 2020 2020 2061 6d6f 756e 743a 2066         amount: f
-0001ebe0: 6c6f 6174 2c20 2023 2041 6273 6f6c 7574  loat,  # Absolut
-0001ebf0: 6520 7661 6c75 6520 6f66 2070 6f73 6974  e value of posit
-0001ec00: 696f 6e20 7369 7a65 0a20 2020 2020 2020  ion size.       
-0001ec10: 2073 7461 6b65 5f61 6d6f 756e 743a 2066   stake_amount: f
-0001ec20: 6c6f 6174 2c0a 2020 2020 2020 2020 6c65  loat,.        le
-0001ec30: 7665 7261 6765 3a20 666c 6f61 742c 0a20  verage: float,. 
-0001ec40: 2020 2020 2020 2077 616c 6c65 745f 6261         wallet_ba
-0001ec50: 6c61 6e63 653a 2066 6c6f 6174 2c0a 2020  lance: float,.  
-0001ec60: 2020 2020 2020 6d6d 5f65 785f 313a 2066        mm_ex_1: f
-0001ec70: 6c6f 6174 203d 2030 2e30 2c20 2023 2028  loat = 0.0,  # (
-0001ec80: 4269 6e61 6e63 6529 2043 726f 7373 206f  Binance) Cross o
-0001ec90: 6e6c 790a 2020 2020 2020 2020 7570 6e6c  nly.        upnl
-0001eca0: 5f65 785f 313a 2066 6c6f 6174 203d 2030  _ex_1: float = 0
-0001ecb0: 2e30 2c20 2023 2028 4269 6e61 6e63 6529  .0,  # (Binance)
-0001ecc0: 2043 726f 7373 206f 6e6c 790a 2020 2020   Cross only.    
-0001ecd0: 2920 2d3e 204f 7074 696f 6e61 6c5b 666c  ) -> Optional[fl
-0001ece0: 6f61 745d 3a0a 2020 2020 2020 2020 2222  oat]:.        ""
-0001ecf0: 220a 2020 2020 2020 2020 5365 7427 7320  ".        Set's 
-0001ed00: 7468 6520 6d61 7267 696e 206d 6f64 6520  the margin mode 
-0001ed10: 6f6e 2074 6865 2065 7863 6861 6e67 6520  on the exchange 
-0001ed20: 746f 2063 726f 7373 206f 7220 6973 6f6c  to cross or isol
-0001ed30: 6174 6564 2066 6f72 2061 2073 7065 6369  ated for a speci
-0001ed40: 6669 6320 7061 6972 0a20 2020 2020 2020  fic pair.       
-0001ed50: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-0001ed60: 7365 6c66 2e74 7261 6469 6e67 5f6d 6f64  self.trading_mod
-0001ed70: 6520 3d3d 2054 7261 6469 6e67 4d6f 6465  e == TradingMode
-0001ed80: 2e53 504f 543a 0a20 2020 2020 2020 2020  .SPOT:.         
-0001ed90: 2020 2072 6574 7572 6e20 4e6f 6e65 0a20     return None. 
-0001eda0: 2020 2020 2020 2065 6c69 6620 2873 656c         elif (sel
-0001edb0: 662e 7472 6164 696e 675f 6d6f 6465 2021  f.trading_mode !
-0001edc0: 3d20 5472 6164 696e 674d 6f64 652e 4655  = TradingMode.FU
-0001edd0: 5455 5245 5329 3a0a 2020 2020 2020 2020  TURES):.        
-0001ede0: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
-0001edf0: 696f 6e61 6c45 7863 6570 7469 6f6e 280a  ionalException(.
-0001ee00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ee10: 6622 7b73 656c 662e 6e61 6d65 7d20 646f  f"{self.name} do
-0001ee20: 6573 206e 6f74 2073 7570 706f 7274 207b  es not support {
-0001ee30: 7365 6c66 2e6d 6172 6769 6e5f 6d6f 6465  self.margin_mode
-0001ee40: 7d20 7b73 656c 662e 7472 6164 696e 675f  } {self.trading_
-0001ee50: 6d6f 6465 7d22 290a 0a20 2020 2020 2020  mode}")..       
-0001ee60: 206c 6971 7569 6461 7469 6f6e 5f70 7269   liquidation_pri
-0001ee70: 6365 203d 204e 6f6e 650a 2020 2020 2020  ce = None.      
-0001ee80: 2020 6966 2073 656c 662e 5f63 6f6e 6669    if self._confi
-0001ee90: 675b 2764 7279 5f72 756e 275d 206f 7220  g['dry_run'] or 
-0001eea0: 6e6f 7420 7365 6c66 2e65 7863 6861 6e67  not self.exchang
-0001eeb0: 655f 6861 7328 2266 6574 6368 506f 7369  e_has("fetchPosi
-0001eec0: 7469 6f6e 7322 293a 0a0a 2020 2020 2020  tions"):..      
-0001eed0: 2020 2020 2020 6c69 7175 6964 6174 696f        liquidatio
-0001eee0: 6e5f 7072 6963 6520 3d20 7365 6c66 2e64  n_price = self.d
-0001eef0: 7279 5f72 756e 5f6c 6971 7569 6461 7469  ry_run_liquidati
-0001ef00: 6f6e 5f70 7269 6365 280a 2020 2020 2020  on_price(.      
-0001ef10: 2020 2020 2020 2020 2020 7061 6972 3d70            pair=p
-0001ef20: 6169 722c 0a20 2020 2020 2020 2020 2020  air,.           
-0001ef30: 2020 2020 206f 7065 6e5f 7261 7465 3d6f       open_rate=o
-0001ef40: 7065 6e5f 7261 7465 2c0a 2020 2020 2020  pen_rate,.      
-0001ef50: 2020 2020 2020 2020 2020 6973 5f73 686f            is_sho
-0001ef60: 7274 3d69 735f 7368 6f72 742c 0a20 2020  rt=is_short,.   
-0001ef70: 2020 2020 2020 2020 2020 2020 2061 6d6f               amo
-0001ef80: 756e 743d 616d 6f75 6e74 2c0a 2020 2020  unt=amount,.    
-0001ef90: 2020 2020 2020 2020 2020 2020 6c65 7665              leve
-0001efa0: 7261 6765 3d6c 6576 6572 6167 652c 0a20  rage=leverage,. 
-0001efb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001efc0: 7461 6b65 5f61 6d6f 756e 743d 7374 616b  take_amount=stak
-0001efd0: 655f 616d 6f75 6e74 2c0a 2020 2020 2020  e_amount,.      
-0001efe0: 2020 2020 2020 2020 2020 7761 6c6c 6574            wallet
-0001eff0: 5f62 616c 616e 6365 3d77 616c 6c65 745f  _balance=wallet_
-0001f000: 6261 6c61 6e63 652c 0a20 2020 2020 2020  balance,.       
-0001f010: 2020 2020 2020 2020 206d 6d5f 6578 5f31           mm_ex_1
-0001f020: 3d6d 6d5f 6578 5f31 2c0a 2020 2020 2020  =mm_ex_1,.      
-0001f030: 2020 2020 2020 2020 2020 7570 6e6c 5f65            upnl_e
-0001f040: 785f 313d 7570 6e6c 5f65 785f 310a 2020  x_1=upnl_ex_1.  
-0001f050: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0001f060: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001f070: 2020 2020 2020 706f 7369 7469 6f6e 7320        positions 
-0001f080: 3d20 7365 6c66 2e66 6574 6368 5f70 6f73  = self.fetch_pos
-0001f090: 6974 696f 6e73 2870 6169 7229 0a20 2020  itions(pair).   
-0001f0a0: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-0001f0b0: 706f 7369 7469 6f6e 7329 203e 2030 3a0a  positions) > 0:.
-0001f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f0d0: 706f 7320 3d20 706f 7369 7469 6f6e 735b  pos = positions[
-0001f0e0: 305d 0a20 2020 2020 2020 2020 2020 2020  0].             
-0001f0f0: 2020 206c 6971 7569 6461 7469 6f6e 5f70     liquidation_p
-0001f100: 7269 6365 203d 2070 6f73 5b27 6c69 7175  rice = pos['liqu
-0001f110: 6964 6174 696f 6e50 7269 6365 275d 0a0a  idationPrice']..
-0001f120: 2020 2020 2020 2020 6966 206c 6971 7569          if liqui
-0001f130: 6461 7469 6f6e 5f70 7269 6365 2069 7320  dation_price is 
-0001f140: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0001f150: 2020 2020 2020 6275 6666 6572 5f61 6d6f        buffer_amo
-0001f160: 756e 7420 3d20 6162 7328 6f70 656e 5f72  unt = abs(open_r
-0001f170: 6174 6520 2d20 6c69 7175 6964 6174 696f  ate - liquidatio
-0001f180: 6e5f 7072 6963 6529 202a 2073 656c 662e  n_price) * self.
-0001f190: 6c69 7175 6964 6174 696f 6e5f 6275 6666  liquidation_buff
-0001f1a0: 6572 0a20 2020 2020 2020 2020 2020 206c  er.            l
-0001f1b0: 6971 7569 6461 7469 6f6e 5f70 7269 6365  iquidation_price
-0001f1c0: 5f62 7566 6665 7220 3d20 280a 2020 2020  _buffer = (.    
-0001f1d0: 2020 2020 2020 2020 2020 2020 6c69 7175              liqu
-0001f1e0: 6964 6174 696f 6e5f 7072 6963 6520 2d20  idation_price - 
-0001f1f0: 6275 6666 6572 5f61 6d6f 756e 740a 2020  buffer_amount.  
-0001f200: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001f210: 2069 735f 7368 6f72 7420 656c 7365 0a20   is_short else. 
-0001f220: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0001f230: 6971 7569 6461 7469 6f6e 5f70 7269 6365  iquidation_price
-0001f240: 202b 2062 7566 6665 725f 616d 6f75 6e74   + buffer_amount
-0001f250: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0001f260: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001f270: 6e20 6d61 7828 6c69 7175 6964 6174 696f  n max(liquidatio
-0001f280: 6e5f 7072 6963 655f 6275 6666 6572 2c20  n_price_buffer, 
-0001f290: 302e 3029 0a20 2020 2020 2020 2065 6c73  0.0).        els
-0001f2a0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0001f2b0: 6574 7572 6e20 4e6f 6e65 0a0a 2020 2020  eturn None..    
-0001f2c0: 6465 6620 6472 795f 7275 6e5f 6c69 7175  def dry_run_liqu
-0001f2d0: 6964 6174 696f 6e5f 7072 6963 6528 0a20  idation_price(. 
-0001f2e0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-0001f2f0: 2020 2020 2070 6169 723a 2073 7472 2c0a       pair: str,.
-0001f300: 2020 2020 2020 2020 6f70 656e 5f72 6174          open_rat
-0001f310: 653a 2066 6c6f 6174 2c20 2020 2320 456e  e: float,   # En
-0001f320: 7472 7920 7072 6963 6520 6f66 2070 6f73  try price of pos
-0001f330: 6974 696f 6e0a 2020 2020 2020 2020 6973  ition.        is
-0001f340: 5f73 686f 7274 3a20 626f 6f6c 2c0a 2020  _short: bool,.  
-0001f350: 2020 2020 2020 616d 6f75 6e74 3a20 666c        amount: fl
-0001f360: 6f61 742c 0a20 2020 2020 2020 2073 7461  oat,.        sta
-0001f370: 6b65 5f61 6d6f 756e 743a 2066 6c6f 6174  ke_amount: float
-0001f380: 2c0a 2020 2020 2020 2020 6c65 7665 7261  ,.        levera
-0001f390: 6765 3a20 666c 6f61 742c 0a20 2020 2020  ge: float,.     
-0001f3a0: 2020 2077 616c 6c65 745f 6261 6c61 6e63     wallet_balanc
-0001f3b0: 653a 2066 6c6f 6174 2c20 2023 204f 7220  e: float,  # Or 
-0001f3c0: 6d61 7267 696e 2062 616c 616e 6365 0a20  margin balance. 
-0001f3d0: 2020 2020 2020 206d 6d5f 6578 5f31 3a20         mm_ex_1: 
-0001f3e0: 666c 6f61 7420 3d20 302e 302c 2020 2320  float = 0.0,  # 
-0001f3f0: 2842 696e 616e 6365 2920 4372 6f73 7320  (Binance) Cross 
-0001f400: 6f6e 6c79 0a20 2020 2020 2020 2075 706e  only.        upn
-0001f410: 6c5f 6578 5f31 3a20 666c 6f61 7420 3d20  l_ex_1: float = 
-0001f420: 302e 302c 2020 2320 2842 696e 616e 6365  0.0,  # (Binance
-0001f430: 2920 4372 6f73 7320 6f6e 6c79 0a20 2020  ) Cross only.   
-0001f440: 2029 202d 3e20 4f70 7469 6f6e 616c 5b66   ) -> Optional[f
-0001f450: 6c6f 6174 5d3a 0a20 2020 2020 2020 2022  loat]:.        "
-0001f460: 2222 0a20 2020 2020 2020 2049 6d70 6f72  "".        Impor
-0001f470: 7461 6e74 3a20 4d75 7374 2062 6520 6665  tant: Must be fe
-0001f480: 7463 6869 6e67 2064 6174 6120 6672 6f6d  tching data from
-0001f490: 2063 6163 6865 6420 7661 6c75 6573 2061   cached values a
-0001f4a0: 7320 7468 6973 2069 7320 7573 6564 2062  s this is used b
-0001f4b0: 7920 6261 636b 7465 7374 696e 6721 0a20  y backtesting!. 
-0001f4c0: 2020 2020 2020 2050 4552 5045 5455 414c         PERPETUAL
-0001f4d0: 3a0a 2020 2020 2020 2020 2067 6174 653a  :.         gate:
-0001f4e0: 2068 7474 7073 3a2f 2f77 7777 2e67 6174   https://www.gat
-0001f4f0: 652e 696f 2f68 656c 702f 6675 7475 7265  e.io/help/future
-0001f500: 732f 6675 7475 7265 732f 3237 3732 342f  s/futures/27724/
-0001f510: 6c69 7175 6964 6174 696f 6e2d 7072 6963  liquidation-pric
-0001f520: 652d 6261 6e6b 7275 7074 6379 2d70 7269  e-bankruptcy-pri
-0001f530: 6365 0a20 2020 2020 2020 2020 3e20 4c69  ce.         > Li
-0001f540: 7175 6964 6174 696f 6e20 5072 6963 6520  quidation Price 
-0001f550: 3d20 2845 6e74 7279 2050 7269 6365 20c2  = (Entry Price .
-0001f560: b120 4d61 7267 696e 202f 2043 6f6e 7472  . Margin / Contr
-0001f570: 6163 7420 4d75 6c74 6970 6c69 6572 202f  act Multiplier /
-0001f580: 2053 697a 6529 202f 0a20 2020 2020 2020   Size) /.       
+0001e190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e1a0: 2776 6f6c 756d 6527 3a20 2776 6f6c 756d  'volume': 'volum
+0001e1b0: 655f 6d61 726b 277d 290a 0a20 2020 2020  e_mark'})..     
+0001e1c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001e1d0: 2020 2020 2020 2020 2020 2020 2023 2046               # F
+0001e1e0: 696c 6c20 7570 206d 6973 7369 6e67 2066  ill up missing f
+0001e1f0: 756e 6469 6e67 5f72 6174 6520 6361 6e64  unding_rate cand
+0001e200: 6c65 7320 7769 7468 2066 616c 6c62 6163  les with fallbac
+0001e210: 6b20 7661 6c75 650a 2020 2020 2020 2020  k value.        
+0001e220: 2020 2020 2020 2020 636f 6d62 696e 6564          combined
+0001e230: 203d 206d 6172 6b5f 7261 7465 732e 6d65   = mark_rates.me
+0001e240: 7267 6528 0a20 2020 2020 2020 2020 2020  rge(.           
+0001e250: 2020 2020 2020 2020 2066 756e 6469 6e67           funding
+0001e260: 5f72 6174 6573 2c20 6f6e 3d27 6461 7465  _rates, on='date
+0001e270: 272c 2068 6f77 3d22 6f75 7465 7222 2c20  ', how="outer", 
+0001e280: 7375 6666 6978 6573 3d5b 225f 6d61 726b  suffixes=["_mark
+0001e290: 222c 2022 5f66 756e 6422 5d0a 2020 2020  ", "_fund"].    
+0001e2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e2b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001e2c0: 2020 636f 6d62 696e 6564 5b27 6f70 656e    combined['open
+0001e2d0: 5f66 756e 6427 5d20 3d20 636f 6d62 696e  _fund'] = combin
+0001e2e0: 6564 5b27 6f70 656e 5f66 756e 6427 5d2e  ed['open_fund'].
+0001e2f0: 6669 6c6c 6e61 2866 7574 7572 6573 5f66  fillna(futures_f
+0001e300: 756e 6469 6e67 5f72 6174 6529 0a20 2020  unding_rate).   
+0001e310: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0001e320: 7572 6e20 636f 6d62 696e 6564 0a0a 2020  urn combined..  
+0001e330: 2020 6465 6620 6361 6c63 756c 6174 655f    def calculate_
+0001e340: 6675 6e64 696e 675f 6665 6573 280a 2020  funding_fees(.  
+0001e350: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+0001e360: 2020 2020 6466 3a20 4461 7461 4672 616d      df: DataFram
+0001e370: 652c 0a20 2020 2020 2020 2061 6d6f 756e  e,.        amoun
+0001e380: 743a 2066 6c6f 6174 2c0a 2020 2020 2020  t: float,.      
+0001e390: 2020 6973 5f73 686f 7274 3a20 626f 6f6c    is_short: bool
+0001e3a0: 2c0a 2020 2020 2020 2020 6f70 656e 5f64  ,.        open_d
+0001e3b0: 6174 653a 2064 6174 6574 696d 652c 0a20  ate: datetime,. 
+0001e3c0: 2020 2020 2020 2063 6c6f 7365 5f64 6174         close_dat
+0001e3d0: 653a 204f 7074 696f 6e61 6c5b 6461 7465  e: Optional[date
+0001e3e0: 7469 6d65 5d20 3d20 4e6f 6e65 2c0a 2020  time] = None,.  
+0001e3f0: 2020 2020 2020 7469 6d65 5f69 6e5f 7261        time_in_ra
+0001e400: 7469 6f3a 204f 7074 696f 6e61 6c5b 666c  tio: Optional[fl
+0001e410: 6f61 745d 203d 204e 6f6e 650a 2020 2020  oat] = None.    
+0001e420: 2920 2d3e 2066 6c6f 6174 3a0a 2020 2020  ) -> float:.    
+0001e430: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001e440: 6361 6c63 756c 6174 6573 2074 6865 2073  calculates the s
+0001e450: 756d 206f 6620 616c 6c20 6675 6e64 696e  um of all fundin
+0001e460: 6720 6665 6573 2074 6861 7420 6f63 6375  g fees that occu
+0001e470: 7272 6564 2066 6f72 2061 2070 6169 7220  rred for a pair 
+0001e480: 6475 7269 6e67 2061 2066 7574 7572 6573  during a futures
+0001e490: 2074 7261 6465 0a20 2020 2020 2020 203a   trade.        :
+0001e4a0: 7061 7261 6d20 6466 3a20 4461 7461 6672  param df: Datafr
+0001e4b0: 616d 6520 636f 6e74 6169 6e69 6e67 2063  ame containing c
+0001e4c0: 6f6d 6269 6e65 6420 6675 6e64 696e 6720  ombined funding 
+0001e4d0: 616e 6420 6d61 726b 2072 6174 6573 0a20  and mark rates. 
+0001e4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e4f0: 2020 6173 2060 6f70 656e 5f66 756e 6460    as `open_fund`
+0001e500: 2061 6e64 2060 6f70 656e 5f6d 6172 6b60   and `open_mark`
+0001e510: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0001e520: 2061 6d6f 756e 743a 2054 6865 2071 7561   amount: The qua
+0001e530: 6e74 6974 7920 6f66 2074 6865 2074 7261  ntity of the tra
+0001e540: 6465 0a20 2020 2020 2020 203a 7061 7261  de.        :para
+0001e550: 6d20 6973 5f73 686f 7274 3a20 7472 6164  m is_short: trad
+0001e560: 6520 6469 7265 6374 696f 6e0a 2020 2020  e direction.    
+0001e570: 2020 2020 3a70 6172 616d 206f 7065 6e5f      :param open_
+0001e580: 6461 7465 3a20 5468 6520 6461 7465 2061  date: The date a
+0001e590: 6e64 2074 696d 6520 7468 6174 2074 6865  nd time that the
+0001e5a0: 2074 7261 6465 2073 7461 7274 6564 0a20   trade started. 
+0001e5b0: 2020 2020 2020 203a 7061 7261 6d20 636c         :param cl
+0001e5c0: 6f73 655f 6461 7465 3a20 5468 6520 6461  ose_date: The da
+0001e5d0: 7465 2061 6e64 2074 696d 6520 7468 6174  te and time that
+0001e5e0: 2074 6865 2074 7261 6465 2065 6e64 6564   the trade ended
+0001e5f0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001e600: 7469 6d65 5f69 6e5f 7261 7469 6f3a 204e  time_in_ratio: N
+0001e610: 6f74 2075 7365 6420 6279 206d 6f73 7420  ot used by most 
+0001e620: 6578 6368 616e 6765 2063 6c61 7373 6573  exchange classes
+0001e630: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001e640: 2020 2020 2066 6565 733a 2066 6c6f 6174       fees: float
+0001e650: 203d 2030 0a0a 2020 2020 2020 2020 6966   = 0..        if
+0001e660: 206e 6f74 2064 662e 656d 7074 793a 0a20   not df.empty:. 
+0001e670: 2020 2020 2020 2020 2020 2064 6620 3d20             df = 
+0001e680: 6466 5b28 6466 5b27 6461 7465 275d 203e  df[(df['date'] >
+0001e690: 3d20 6f70 656e 5f64 6174 6529 2026 2028  = open_date) & (
+0001e6a0: 6466 5b27 6461 7465 275d 203c 3d20 636c  df['date'] <= cl
+0001e6b0: 6f73 655f 6461 7465 295d 0a20 2020 2020  ose_date)].     
+0001e6c0: 2020 2020 2020 2066 6565 7320 3d20 7375         fees = su
+0001e6d0: 6d28 6466 5b27 6f70 656e 5f66 756e 6427  m(df['open_fund'
+0001e6e0: 5d20 2a20 6466 5b27 6f70 656e 5f6d 6172  ] * df['open_mar
+0001e6f0: 6b27 5d20 2a20 616d 6f75 6e74 290a 0a20  k'] * amount).. 
+0001e700: 2020 2020 2020 2023 204e 6567 6174 6520         # Negate 
+0001e710: 6665 6573 2066 6f72 206c 6f6e 6773 2061  fees for longs a
+0001e720: 7320 6675 6e64 696e 675f 6665 6573 2065  s funding_fees e
+0001e730: 7870 6563 7473 2069 7420 7468 6973 2077  xpects it this w
+0001e740: 6179 2062 6173 6564 206f 6e20 6c69 7665  ay based on live
+0001e750: 2065 6e64 706f 696e 7473 2e0a 2020 2020   endpoints..    
+0001e760: 2020 2020 7265 7475 726e 2066 6565 7320      return fees 
+0001e770: 6966 2069 735f 7368 6f72 7420 656c 7365  if is_short else
+0001e780: 202d 6665 6573 0a0a 2020 2020 6465 6620   -fees..    def 
+0001e790: 6765 745f 6675 6e64 696e 675f 6665 6573  get_funding_fees
+0001e7a0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+0001e7b0: 6c66 2c20 7061 6972 3a20 7374 722c 2061  lf, pair: str, a
+0001e7c0: 6d6f 756e 743a 2066 6c6f 6174 2c20 6973  mount: float, is
+0001e7d0: 5f73 686f 7274 3a20 626f 6f6c 2c20 6f70  _short: bool, op
+0001e7e0: 656e 5f64 6174 653a 2064 6174 6574 696d  en_date: datetim
+0001e7f0: 6529 202d 3e20 666c 6f61 743a 0a20 2020  e) -> float:.   
+0001e800: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001e810: 2046 6574 6368 2066 756e 6469 6e67 2066   Fetch funding f
+0001e820: 6565 732c 2065 6974 6865 7220 6672 6f6d  ees, either from
+0001e830: 2074 6865 2065 7863 6861 6e67 6520 286c   the exchange (l
+0001e840: 6976 6529 206f 7220 6361 6c63 756c 6174  ive) or calculat
+0001e850: 6573 2074 6865 6d0a 2020 2020 2020 2020  es them.        
+0001e860: 6261 7365 6420 6f6e 2066 756e 6469 6e67  based on funding
+0001e870: 2072 6174 652f 6d61 726b 2070 7269 6365   rate/mark price
+0001e880: 2068 6973 746f 7279 0a20 2020 2020 2020   history.       
+0001e890: 203a 7061 7261 6d20 7061 6972 3a20 5468   :param pair: Th
+0001e8a0: 6520 7175 6f74 652f 6261 7365 2070 6169  e quote/base pai
+0001e8b0: 7220 6f66 2074 6865 2074 7261 6465 0a20  r of the trade. 
+0001e8c0: 2020 2020 2020 203a 7061 7261 6d20 6973         :param is
+0001e8d0: 5f73 686f 7274 3a20 7472 6164 6520 6469  _short: trade di
+0001e8e0: 7265 6374 696f 6e0a 2020 2020 2020 2020  rection.        
+0001e8f0: 3a70 6172 616d 2061 6d6f 756e 743a 2054  :param amount: T
+0001e900: 7261 6465 2061 6d6f 756e 740a 2020 2020  rade amount.    
+0001e910: 2020 2020 3a70 6172 616d 206f 7065 6e5f      :param open_
+0001e920: 6461 7465 3a20 4f70 656e 2064 6174 6520  date: Open date 
+0001e930: 6f66 2074 6865 2074 7261 6465 0a20 2020  of the trade.   
+0001e940: 2020 2020 203a 7265 7475 726e 3a20 6675       :return: fu
+0001e950: 6e64 696e 6720 6665 6520 7369 6e63 6520  nding fee since 
+0001e960: 6f70 656e 5f64 6174 650a 2020 2020 2020  open_date.      
+0001e970: 2020 3a72 6169 7365 733a 2045 7863 6861    :raises: Excha
+0001e980: 6e67 6545 7272 6f72 2069 6620 736f 6d65  ngeError if some
+0001e990: 7468 696e 6720 676f 6573 2077 726f 6e67  thing goes wrong
+0001e9a0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0001e9b0: 2020 2020 2020 6966 2073 656c 662e 7472        if self.tr
+0001e9c0: 6164 696e 675f 6d6f 6465 203d 3d20 5472  ading_mode == Tr
+0001e9d0: 6164 696e 674d 6f64 652e 4655 5455 5245  adingMode.FUTURE
+0001e9e0: 533a 0a20 2020 2020 2020 2020 2020 2069  S:.            i
+0001e9f0: 6620 7365 6c66 2e5f 636f 6e66 6967 5b27  f self._config['
+0001ea00: 6472 795f 7275 6e27 5d3a 0a20 2020 2020  dry_run']:.     
+0001ea10: 2020 2020 2020 2020 2020 2066 756e 6469             fundi
+0001ea20: 6e67 5f66 6565 7320 3d20 7365 6c66 2e5f  ng_fees = self._
+0001ea30: 6665 7463 685f 616e 645f 6361 6c63 756c  fetch_and_calcul
+0001ea40: 6174 655f 6675 6e64 696e 675f 6665 6573  ate_funding_fees
+0001ea50: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001ea60: 2020 2020 2020 7061 6972 2c20 616d 6f75        pair, amou
+0001ea70: 6e74 2c20 6973 5f73 686f 7274 2c20 6f70  nt, is_short, op
+0001ea80: 656e 5f64 6174 6529 0a20 2020 2020 2020  en_date).       
+0001ea90: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001eaa0: 2020 2020 2020 2020 2020 2066 756e 6469             fundi
+0001eab0: 6e67 5f66 6565 7320 3d20 7365 6c66 2e5f  ng_fees = self._
+0001eac0: 6765 745f 6675 6e64 696e 675f 6665 6573  get_funding_fees
+0001ead0: 5f66 726f 6d5f 6578 6368 616e 6765 2870  _from_exchange(p
+0001eae0: 6169 722c 206f 7065 6e5f 6461 7465 290a  air, open_date).
+0001eaf0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001eb00: 726e 2066 756e 6469 6e67 5f66 6565 730a  rn funding_fees.
+0001eb10: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0001eb20: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001eb30: 2030 2e30 0a0a 2020 2020 6465 6620 6765   0.0..    def ge
+0001eb40: 745f 6c69 7175 6964 6174 696f 6e5f 7072  t_liquidation_pr
+0001eb50: 6963 6528 0a20 2020 2020 2020 2073 656c  ice(.        sel
+0001eb60: 662c 0a20 2020 2020 2020 2070 6169 723a  f,.        pair:
+0001eb70: 2073 7472 2c0a 2020 2020 2020 2020 2320   str,.        # 
+0001eb80: 4472 792d 7275 6e0a 2020 2020 2020 2020  Dry-run.        
+0001eb90: 6f70 656e 5f72 6174 653a 2066 6c6f 6174  open_rate: float
+0001eba0: 2c20 2020 2320 456e 7472 7920 7072 6963  ,   # Entry pric
+0001ebb0: 6520 6f66 2070 6f73 6974 696f 6e0a 2020  e of position.  
+0001ebc0: 2020 2020 2020 6973 5f73 686f 7274 3a20        is_short: 
+0001ebd0: 626f 6f6c 2c0a 2020 2020 2020 2020 616d  bool,.        am
+0001ebe0: 6f75 6e74 3a20 666c 6f61 742c 2020 2320  ount: float,  # 
+0001ebf0: 4162 736f 6c75 7465 2076 616c 7565 206f  Absolute value o
+0001ec00: 6620 706f 7369 7469 6f6e 2073 697a 650a  f position size.
+0001ec10: 2020 2020 2020 2020 7374 616b 655f 616d          stake_am
+0001ec20: 6f75 6e74 3a20 666c 6f61 742c 0a20 2020  ount: float,.   
+0001ec30: 2020 2020 206c 6576 6572 6167 653a 2066       leverage: f
+0001ec40: 6c6f 6174 2c0a 2020 2020 2020 2020 7761  loat,.        wa
+0001ec50: 6c6c 6574 5f62 616c 616e 6365 3a20 666c  llet_balance: fl
+0001ec60: 6f61 742c 0a20 2020 2020 2020 206d 6d5f  oat,.        mm_
+0001ec70: 6578 5f31 3a20 666c 6f61 7420 3d20 302e  ex_1: float = 0.
+0001ec80: 302c 2020 2320 2842 696e 616e 6365 2920  0,  # (Binance) 
+0001ec90: 4372 6f73 7320 6f6e 6c79 0a20 2020 2020  Cross only.     
+0001eca0: 2020 2075 706e 6c5f 6578 5f31 3a20 666c     upnl_ex_1: fl
+0001ecb0: 6f61 7420 3d20 302e 302c 2020 2320 2842  oat = 0.0,  # (B
+0001ecc0: 696e 616e 6365 2920 4372 6f73 7320 6f6e  inance) Cross on
+0001ecd0: 6c79 0a20 2020 2029 202d 3e20 4f70 7469  ly.    ) -> Opti
+0001ece0: 6f6e 616c 5b66 6c6f 6174 5d3a 0a20 2020  onal[float]:.   
+0001ecf0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001ed00: 2053 6574 2773 2074 6865 206d 6172 6769   Set's the margi
+0001ed10: 6e20 6d6f 6465 206f 6e20 7468 6520 6578  n mode on the ex
+0001ed20: 6368 616e 6765 2074 6f20 6372 6f73 7320  change to cross 
+0001ed30: 6f72 2069 736f 6c61 7465 6420 666f 7220  or isolated for 
+0001ed40: 6120 7370 6563 6966 6963 2070 6169 720a  a specific pair.
+0001ed50: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001ed60: 2020 2020 6966 2073 656c 662e 7472 6164      if self.trad
+0001ed70: 696e 675f 6d6f 6465 203d 3d20 5472 6164  ing_mode == Trad
+0001ed80: 696e 674d 6f64 652e 5350 4f54 3a0a 2020  ingMode.SPOT:.  
+0001ed90: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001eda0: 204e 6f6e 650a 2020 2020 2020 2020 656c   None.        el
+0001edb0: 6966 2028 7365 6c66 2e74 7261 6469 6e67  if (self.trading
+0001edc0: 5f6d 6f64 6520 213d 2054 7261 6469 6e67  _mode != Trading
+0001edd0: 4d6f 6465 2e46 5554 5552 4553 293a 0a20  Mode.FUTURES):. 
+0001ede0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001edf0: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
+0001ee00: 7074 696f 6e28 0a20 2020 2020 2020 2020  ption(.         
+0001ee10: 2020 2020 2020 2066 227b 7365 6c66 2e6e         f"{self.n
+0001ee20: 616d 657d 2064 6f65 7320 6e6f 7420 7375  ame} does not su
+0001ee30: 7070 6f72 7420 7b73 656c 662e 6d61 7267  pport {self.marg
+0001ee40: 696e 5f6d 6f64 657d 207b 7365 6c66 2e74  in_mode} {self.t
+0001ee50: 7261 6469 6e67 5f6d 6f64 657d 2229 0a0a  rading_mode}")..
+0001ee60: 2020 2020 2020 2020 6c69 7175 6964 6174          liquidat
+0001ee70: 696f 6e5f 7072 6963 6520 3d20 4e6f 6e65  ion_price = None
+0001ee80: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0001ee90: 2e5f 636f 6e66 6967 5b27 6472 795f 7275  ._config['dry_ru
+0001eea0: 6e27 5d20 6f72 206e 6f74 2073 656c 662e  n'] or not self.
+0001eeb0: 6578 6368 616e 6765 5f68 6173 2822 6665  exchange_has("fe
+0001eec0: 7463 6850 6f73 6974 696f 6e73 2229 3a0a  tchPositions"):.
+0001eed0: 0a20 2020 2020 2020 2020 2020 206c 6971  .            liq
+0001eee0: 7569 6461 7469 6f6e 5f70 7269 6365 203d  uidation_price =
+0001eef0: 2073 656c 662e 6472 795f 7275 6e5f 6c69   self.dry_run_li
+0001ef00: 7175 6964 6174 696f 6e5f 7072 6963 6528  quidation_price(
+0001ef10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ef20: 2070 6169 723d 7061 6972 2c0a 2020 2020   pair=pair,.    
+0001ef30: 2020 2020 2020 2020 2020 2020 6f70 656e              open
+0001ef40: 5f72 6174 653d 6f70 656e 5f72 6174 652c  _rate=open_rate,
+0001ef50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ef60: 2069 735f 7368 6f72 743d 6973 5f73 686f   is_short=is_sho
+0001ef70: 7274 2c0a 2020 2020 2020 2020 2020 2020  rt,.            
+0001ef80: 2020 2020 616d 6f75 6e74 3d61 6d6f 756e      amount=amoun
+0001ef90: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+0001efa0: 2020 206c 6576 6572 6167 653d 6c65 7665     leverage=leve
+0001efb0: 7261 6765 2c0a 2020 2020 2020 2020 2020  rage,.          
+0001efc0: 2020 2020 2020 7374 616b 655f 616d 6f75        stake_amou
+0001efd0: 6e74 3d73 7461 6b65 5f61 6d6f 756e 742c  nt=stake_amount,
+0001efe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001eff0: 2077 616c 6c65 745f 6261 6c61 6e63 653d   wallet_balance=
+0001f000: 7761 6c6c 6574 5f62 616c 616e 6365 2c0a  wallet_balance,.
+0001f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f020: 6d6d 5f65 785f 313d 6d6d 5f65 785f 312c  mm_ex_1=mm_ex_1,
+0001f030: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f040: 2075 706e 6c5f 6578 5f31 3d75 706e 6c5f   upnl_ex_1=upnl_
+0001f050: 6578 5f31 0a20 2020 2020 2020 2020 2020  ex_1.           
+0001f060: 2029 0a20 2020 2020 2020 2065 6c73 653a   ).        else:
+0001f070: 0a20 2020 2020 2020 2020 2020 2070 6f73  .            pos
+0001f080: 6974 696f 6e73 203d 2073 656c 662e 6665  itions = self.fe
+0001f090: 7463 685f 706f 7369 7469 6f6e 7328 7061  tch_positions(pa
+0001f0a0: 6972 290a 2020 2020 2020 2020 2020 2020  ir).            
+0001f0b0: 6966 206c 656e 2870 6f73 6974 696f 6e73  if len(positions
+0001f0c0: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
+0001f0d0: 2020 2020 2020 2070 6f73 203d 2070 6f73         pos = pos
+0001f0e0: 6974 696f 6e73 5b30 5d0a 2020 2020 2020  itions[0].      
+0001f0f0: 2020 2020 2020 2020 2020 6c69 7175 6964            liquid
+0001f100: 6174 696f 6e5f 7072 6963 6520 3d20 706f  ation_price = po
+0001f110: 735b 276c 6971 7569 6461 7469 6f6e 5072  s['liquidationPr
+0001f120: 6963 6527 5d0a 0a20 2020 2020 2020 2069  ice']..        i
+0001f130: 6620 6c69 7175 6964 6174 696f 6e5f 7072  f liquidation_pr
+0001f140: 6963 6520 6973 206e 6f74 204e 6f6e 653a  ice is not None:
+0001f150: 0a20 2020 2020 2020 2020 2020 2062 7566  .            buf
+0001f160: 6665 725f 616d 6f75 6e74 203d 2061 6273  fer_amount = abs
+0001f170: 286f 7065 6e5f 7261 7465 202d 206c 6971  (open_rate - liq
+0001f180: 7569 6461 7469 6f6e 5f70 7269 6365 2920  uidation_price) 
+0001f190: 2a20 7365 6c66 2e6c 6971 7569 6461 7469  * self.liquidati
+0001f1a0: 6f6e 5f62 7566 6665 720a 2020 2020 2020  on_buffer.      
+0001f1b0: 2020 2020 2020 6c69 7175 6964 6174 696f        liquidatio
+0001f1c0: 6e5f 7072 6963 655f 6275 6666 6572 203d  n_price_buffer =
+0001f1d0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0001f1e0: 2020 206c 6971 7569 6461 7469 6f6e 5f70     liquidation_p
+0001f1f0: 7269 6365 202d 2062 7566 6665 725f 616d  rice - buffer_am
+0001f200: 6f75 6e74 0a20 2020 2020 2020 2020 2020  ount.           
+0001f210: 2020 2020 2069 6620 6973 5f73 686f 7274       if is_short
+0001f220: 2065 6c73 650a 2020 2020 2020 2020 2020   else.          
+0001f230: 2020 2020 2020 6c69 7175 6964 6174 696f        liquidatio
+0001f240: 6e5f 7072 6963 6520 2b20 6275 6666 6572  n_price + buffer
+0001f250: 5f61 6d6f 756e 740a 2020 2020 2020 2020  _amount.        
+0001f260: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0001f270: 2020 7265 7475 726e 206d 6178 286c 6971    return max(liq
+0001f280: 7569 6461 7469 6f6e 5f70 7269 6365 5f62  uidation_price_b
+0001f290: 7566 6665 722c 2030 2e30 290a 2020 2020  uffer, 0.0).    
+0001f2a0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001f2b0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+0001f2c0: 650a 0a20 2020 2064 6566 2064 7279 5f72  e..    def dry_r
+0001f2d0: 756e 5f6c 6971 7569 6461 7469 6f6e 5f70  un_liquidation_p
+0001f2e0: 7269 6365 280a 2020 2020 2020 2020 7365  rice(.        se
+0001f2f0: 6c66 2c0a 2020 2020 2020 2020 7061 6972  lf,.        pair
+0001f300: 3a20 7374 722c 0a20 2020 2020 2020 206f  : str,.        o
+0001f310: 7065 6e5f 7261 7465 3a20 666c 6f61 742c  pen_rate: float,
+0001f320: 2020 2023 2045 6e74 7279 2070 7269 6365     # Entry price
+0001f330: 206f 6620 706f 7369 7469 6f6e 0a20 2020   of position.   
+0001f340: 2020 2020 2069 735f 7368 6f72 743a 2062       is_short: b
+0001f350: 6f6f 6c2c 0a20 2020 2020 2020 2061 6d6f  ool,.        amo
+0001f360: 756e 743a 2066 6c6f 6174 2c0a 2020 2020  unt: float,.    
+0001f370: 2020 2020 7374 616b 655f 616d 6f75 6e74      stake_amount
+0001f380: 3a20 666c 6f61 742c 0a20 2020 2020 2020  : float,.       
+0001f390: 206c 6576 6572 6167 653a 2066 6c6f 6174   leverage: float
+0001f3a0: 2c0a 2020 2020 2020 2020 7761 6c6c 6574  ,.        wallet
+0001f3b0: 5f62 616c 616e 6365 3a20 666c 6f61 742c  _balance: float,
+0001f3c0: 2020 2320 4f72 206d 6172 6769 6e20 6261    # Or margin ba
+0001f3d0: 6c61 6e63 650a 2020 2020 2020 2020 6d6d  lance.        mm
+0001f3e0: 5f65 785f 313a 2066 6c6f 6174 203d 2030  _ex_1: float = 0
+0001f3f0: 2e30 2c20 2023 2028 4269 6e61 6e63 6529  .0,  # (Binance)
+0001f400: 2043 726f 7373 206f 6e6c 790a 2020 2020   Cross only.    
+0001f410: 2020 2020 7570 6e6c 5f65 785f 313a 2066      upnl_ex_1: f
+0001f420: 6c6f 6174 203d 2030 2e30 2c20 2023 2028  loat = 0.0,  # (
+0001f430: 4269 6e61 6e63 6529 2043 726f 7373 206f  Binance) Cross o
+0001f440: 6e6c 790a 2020 2020 2920 2d3e 204f 7074  nly.    ) -> Opt
+0001f450: 696f 6e61 6c5b 666c 6f61 745d 3a0a 2020  ional[float]:.  
+0001f460: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001f470: 2020 496d 706f 7274 616e 743a 204d 7573    Important: Mus
+0001f480: 7420 6265 2066 6574 6368 696e 6720 6461  t be fetching da
+0001f490: 7461 2066 726f 6d20 6361 6368 6564 2076  ta from cached v
+0001f4a0: 616c 7565 7320 6173 2074 6869 7320 6973  alues as this is
+0001f4b0: 2075 7365 6420 6279 2062 6163 6b74 6573   used by backtes
+0001f4c0: 7469 6e67 210a 2020 2020 2020 2020 5045  ting!.        PE
+0001f4d0: 5250 4554 5541 4c3a 0a20 2020 2020 2020  RPETUAL:.       
+0001f4e0: 2020 6761 7465 3a20 6874 7470 733a 2f2f    gate: https://
+0001f4f0: 7777 772e 6761 7465 2e69 6f2f 6865 6c70  www.gate.io/help
+0001f500: 2f66 7574 7572 6573 2f66 7574 7572 6573  /futures/futures
+0001f510: 2f32 3737 3234 2f6c 6971 7569 6461 7469  /27724/liquidati
+0001f520: 6f6e 2d70 7269 6365 2d62 616e 6b72 7570  on-price-bankrup
+0001f530: 7463 792d 7072 6963 650a 2020 2020 2020  tcy-price.      
+0001f540: 2020 203e 204c 6971 7569 6461 7469 6f6e     > Liquidation
+0001f550: 2050 7269 6365 203d 2028 456e 7472 7920   Price = (Entry 
+0001f560: 5072 6963 6520 c2b1 204d 6172 6769 6e20  Price .. Margin 
+0001f570: 2f20 436f 6e74 7261 6374 204d 756c 7469  / Contract Multi
+0001f580: 706c 6965 7220 2f20 5369 7a65 2920 2f0a  plier / Size) /.
 0001f590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f5a0: 2020 2020 2020 2020 205b 2031 20c2 b120           [ 1 .. 
-0001f5b0: 284d 6169 6e74 656e 616e 6365 204d 6172  (Maintenance Mar
-0001f5c0: 6769 6e20 5261 7469 6f20 2b20 5461 6b65  gin Ratio + Take
-0001f5d0: 7220 5261 7465 295d 0a20 2020 2020 2020  r Rate)].       
-0001f5e0: 2020 2020 2057 6865 7265 696e 2c20 222b       Wherein, "+
-0001f5f0: 2220 6f72 2022 2d22 2064 6570 656e 6473  " or "-" depends
-0001f600: 206f 6e20 7768 6574 6865 7220 7468 6520   on whether the 
-0001f610: 636f 6e74 7261 6374 2067 6f65 7320 6c6f  contract goes lo
-0001f620: 6e67 206f 7220 7368 6f72 743a 0a20 2020  ng or short:.   
-0001f630: 2020 2020 2020 2020 2022 2d22 2066 6f72           "-" for
-0001f640: 206c 6f6e 672c 2061 6e64 2022 2b22 2066   long, and "+" f
-0001f650: 6f72 2073 686f 7274 2e0a 0a20 2020 2020  or short...     
-0001f660: 2020 2020 6f6b 6578 3a20 6874 7470 733a      okex: https:
-0001f670: 2f2f 7777 772e 6f6b 6578 2e63 6f6d 2f73  //www.okex.com/s
-0001f680: 7570 706f 7274 2f68 632f 656e 2d75 732f  upport/hc/en-us/
-0001f690: 6172 7469 636c 6573 2f0a 2020 2020 2020  articles/.      
-0001f6a0: 2020 2020 2020 3336 3030 3533 3930 3935        3600539095
-0001f6b0: 3932 2d56 492d 496e 7472 6f64 7563 7469  92-VI-Introducti
-0001f6c0: 6f6e 2d74 6f2d 7468 652d 6973 6f6c 6174  on-to-the-isolat
-0001f6d0: 6564 2d6d 6f64 652d 6f66 2d53 696e 676c  ed-mode-of-Singl
-0001f6e0: 652d 4d75 6c74 692d 6375 7272 656e 6379  e-Multi-currency
-0001f6f0: 2d50 6f72 7466 6f6c 696f 2d6d 6172 6769  -Portfolio-margi
-0001f700: 6e0a 0a20 2020 2020 2020 203a 7061 7261  n..        :para
-0001f710: 6d20 7061 6972 3a20 5061 6972 2074 6f20  m pair: Pair to 
-0001f720: 6361 6c63 756c 6174 6520 6c69 7175 6964  calculate liquid
-0001f730: 6174 696f 6e20 7072 6963 6520 666f 720a  ation price for.
-0001f740: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
-0001f750: 7065 6e5f 7261 7465 3a20 456e 7472 7920  pen_rate: Entry 
-0001f760: 7072 6963 6520 6f66 2070 6f73 6974 696f  price of positio
-0001f770: 6e0a 2020 2020 2020 2020 3a70 6172 616d  n.        :param
-0001f780: 2069 735f 7368 6f72 743a 2054 7275 6520   is_short: True 
-0001f790: 6966 2074 6865 2074 7261 6465 2069 7320  if the trade is 
-0001f7a0: 6120 7368 6f72 742c 2066 616c 7365 206f  a short, false o
-0001f7b0: 7468 6572 7769 7365 0a20 2020 2020 2020  therwise.       
-0001f7c0: 203a 7061 7261 6d20 616d 6f75 6e74 3a20   :param amount: 
-0001f7d0: 4162 736f 6c75 7465 2076 616c 7565 206f  Absolute value o
-0001f7e0: 6620 706f 7369 7469 6f6e 2073 697a 6520  f position size 
-0001f7f0: 696e 636c 2e20 6c65 7665 7261 6765 2028  incl. leverage (
-0001f800: 696e 2062 6173 6520 6375 7272 656e 6379  in base currency
-0001f810: 290a 2020 2020 2020 2020 3a70 6172 616d  ).        :param
-0001f820: 2073 7461 6b65 5f61 6d6f 756e 743a 2053   stake_amount: S
-0001f830: 7461 6b65 2061 6d6f 756e 7420 2d20 436f  take amount - Co
-0001f840: 6c6c 6174 6572 616c 2069 6e20 7365 7474  llateral in sett
-0001f850: 6c65 2063 7572 7265 6e63 792e 0a20 2020  le currency..   
-0001f860: 2020 2020 203a 7061 7261 6d20 6c65 7665       :param leve
-0001f870: 7261 6765 3a20 4c65 7665 7261 6765 2075  rage: Leverage u
-0001f880: 7365 6420 666f 7220 7468 6973 2070 6f73  sed for this pos
-0001f890: 6974 696f 6e2e 0a20 2020 2020 2020 203a  ition..        :
-0001f8a0: 7061 7261 6d20 7472 6164 696e 675f 6d6f  param trading_mo
-0001f8b0: 6465 3a20 5350 4f54 2c20 4d41 5247 494e  de: SPOT, MARGIN
-0001f8c0: 2c20 4655 5455 5245 532c 2065 7463 2e0a  , FUTURES, etc..
-0001f8d0: 2020 2020 2020 2020 3a70 6172 616d 206d          :param m
-0001f8e0: 6172 6769 6e5f 6d6f 6465 3a20 4569 7468  argin_mode: Eith
-0001f8f0: 6572 2049 534f 4c41 5445 4420 6f72 2043  er ISOLATED or C
-0001f900: 524f 5353 0a20 2020 2020 2020 203a 7061  ROSS.        :pa
-0001f910: 7261 6d20 7761 6c6c 6574 5f62 616c 616e  ram wallet_balan
-0001f920: 6365 3a20 416d 6f75 6e74 206f 6620 6d61  ce: Amount of ma
-0001f930: 7267 696e 5f6d 6f64 6520 696e 2074 6865  rgin_mode in the
-0001f940: 2077 616c 6c65 7420 6265 696e 6720 7573   wallet being us
-0001f950: 6564 2074 6f20 7472 6164 650a 2020 2020  ed to trade.    
-0001f960: 2020 2020 2020 2020 4372 6f73 732d 4d61          Cross-Ma
-0001f970: 7267 696e 204d 6f64 653a 2063 726f 7373  rgin Mode: cross
-0001f980: 5761 6c6c 6574 4261 6c61 6e63 650a 2020  WalletBalance.  
-0001f990: 2020 2020 2020 2020 2020 4973 6f6c 6174            Isolat
-0001f9a0: 6564 2d4d 6172 6769 6e20 4d6f 6465 3a20  ed-Margin Mode: 
-0001f9b0: 6973 6f6c 6174 6564 5761 6c6c 6574 4261  isolatedWalletBa
-0001f9c0: 6c61 6e63 650a 0a20 2020 2020 2020 2023  lance..        #
-0001f9d0: 202a 204e 6f74 2072 6571 7569 7265 6420   * Not required 
-0001f9e0: 6279 2047 6174 6520 6f72 204f 4b58 0a20  by Gate or OKX. 
-0001f9f0: 2020 2020 2020 203a 7061 7261 6d20 6d6d         :param mm
-0001fa00: 5f65 785f 313a 0a20 2020 2020 2020 203a  _ex_1:.        :
-0001fa10: 7061 7261 6d20 7570 6e6c 5f65 785f 313a  param upnl_ex_1:
-0001fa20: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0001fa30: 2020 2020 2020 6d61 726b 6574 203d 2073        market = s
-0001fa40: 656c 662e 6d61 726b 6574 735b 7061 6972  elf.markets[pair
-0001fa50: 5d0a 2020 2020 2020 2020 7461 6b65 725f  ].        taker_
-0001fa60: 6665 655f 7261 7465 203d 206d 6172 6b65  fee_rate = marke
-0001fa70: 745b 2774 616b 6572 275d 0a20 2020 2020  t['taker'].     
-0001fa80: 2020 206d 6d5f 7261 7469 6f2c 205f 203d     mm_ratio, _ =
-0001fa90: 2073 656c 662e 6765 745f 6d61 696e 7465   self.get_mainte
-0001faa0: 6e61 6e63 655f 7261 7469 6f5f 616e 645f  nance_ratio_and_
-0001fab0: 616d 7428 7061 6972 2c20 7374 616b 655f  amt(pair, stake_
-0001fac0: 616d 6f75 6e74 290a 0a20 2020 2020 2020  amount)..       
-0001fad0: 2069 6620 7365 6c66 2e74 7261 6469 6e67   if self.trading
-0001fae0: 5f6d 6f64 6520 3d3d 2054 7261 6469 6e67  _mode == Trading
-0001faf0: 4d6f 6465 2e46 5554 5552 4553 2061 6e64  Mode.FUTURES and
-0001fb00: 2073 656c 662e 6d61 7267 696e 5f6d 6f64   self.margin_mod
-0001fb10: 6520 3d3d 204d 6172 6769 6e4d 6f64 652e  e == MarginMode.
-0001fb20: 4953 4f4c 4154 4544 3a0a 0a20 2020 2020  ISOLATED:..     
-0001fb30: 2020 2020 2020 2069 6620 6d61 726b 6574         if market
-0001fb40: 5b27 696e 7665 7273 6527 5d3a 0a20 2020  ['inverse']:.   
-0001fb50: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0001fb60: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
-0001fb70: 6365 7074 696f 6e28 0a20 2020 2020 2020  ception(.       
-0001fb80: 2020 2020 2020 2020 2020 2020 2022 4672               "Fr
-0001fb90: 6571 7472 6164 6520 646f 6573 206e 6f74  eqtrade does not
-0001fba0: 2079 6574 2073 7570 706f 7274 2069 6e76   yet support inv
-0001fbb0: 6572 7365 2063 6f6e 7472 6163 7473 2229  erse contracts")
-0001fbc0: 0a0a 2020 2020 2020 2020 2020 2020 7661  ..            va
-0001fbd0: 6c75 6520 3d20 7761 6c6c 6574 5f62 616c  lue = wallet_bal
-0001fbe0: 616e 6365 202f 2061 6d6f 756e 740a 0a20  ance / amount.. 
-0001fbf0: 2020 2020 2020 2020 2020 206d 6d5f 7261             mm_ra
-0001fc00: 7469 6f5f 7461 6b65 7220 3d20 286d 6d5f  tio_taker = (mm_
-0001fc10: 7261 7469 6f20 2b20 7461 6b65 725f 6665  ratio + taker_fe
-0001fc20: 655f 7261 7465 290a 2020 2020 2020 2020  e_rate).        
-0001fc30: 2020 2020 6966 2069 735f 7368 6f72 743a      if is_short:
-0001fc40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fc50: 2072 6574 7572 6e20 286f 7065 6e5f 7261   return (open_ra
-0001fc60: 7465 202b 2076 616c 7565 2920 2f20 2831  te + value) / (1
-0001fc70: 202b 206d 6d5f 7261 7469 6f5f 7461 6b65   + mm_ratio_take
-0001fc80: 7229 0a20 2020 2020 2020 2020 2020 2065  r).            e
-0001fc90: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001fca0: 2020 2020 2072 6574 7572 6e20 286f 7065       return (ope
-0001fcb0: 6e5f 7261 7465 202d 2076 616c 7565 2920  n_rate - value) 
-0001fcc0: 2f20 2831 202d 206d 6d5f 7261 7469 6f5f  / (1 - mm_ratio_
-0001fcd0: 7461 6b65 7229 0a20 2020 2020 2020 2065  taker).        e
-0001fce0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001fcf0: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
-0001fd00: 616c 4578 6365 7074 696f 6e28 0a20 2020  alException(.   
-0001fd10: 2020 2020 2020 2020 2020 2020 2022 4672               "Fr
-0001fd20: 6571 7472 6164 6520 6f6e 6c79 2073 7570  eqtrade only sup
-0001fd30: 706f 7274 7320 6973 6f6c 6174 6564 2066  ports isolated f
-0001fd40: 7574 7572 6573 2066 6f72 206c 6576 6572  utures for lever
-0001fd50: 6167 6520 7472 6164 696e 6722 290a 0a20  age trading").. 
-0001fd60: 2020 2064 6566 2067 6574 5f6d 6169 6e74     def get_maint
-0001fd70: 656e 616e 6365 5f72 6174 696f 5f61 6e64  enance_ratio_and
-0001fd80: 5f61 6d74 280a 2020 2020 2020 2020 7365  _amt(.        se
-0001fd90: 6c66 2c0a 2020 2020 2020 2020 7061 6972  lf,.        pair
-0001fda0: 3a20 7374 722c 0a20 2020 2020 2020 206e  : str,.        n
-0001fdb0: 6f6d 696e 616c 5f76 616c 7565 3a20 666c  ominal_value: fl
-0001fdc0: 6f61 742c 0a20 2020 2029 202d 3e20 5475  oat,.    ) -> Tu
-0001fdd0: 706c 655b 666c 6f61 742c 204f 7074 696f  ple[float, Optio
-0001fde0: 6e61 6c5b 666c 6f61 745d 5d3a 0a20 2020  nal[float]]:.   
-0001fdf0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001fe00: 2049 6d70 6f72 7461 6e74 3a20 4d75 7374   Important: Must
-0001fe10: 2062 6520 6665 7463 6869 6e67 2064 6174   be fetching dat
-0001fe20: 6120 6672 6f6d 2063 6163 6865 6420 7661  a from cached va
-0001fe30: 6c75 6573 2061 7320 7468 6973 2069 7320  lues as this is 
-0001fe40: 7573 6564 2062 7920 6261 636b 7465 7374  used by backtest
-0001fe50: 696e 6721 0a20 2020 2020 2020 203a 7061  ing!.        :pa
-0001fe60: 7261 6d20 7061 6972 3a20 4d61 726b 6574  ram pair: Market
-0001fe70: 2073 796d 626f 6c0a 2020 2020 2020 2020   symbol.        
-0001fe80: 3a70 6172 616d 206e 6f6d 696e 616c 5f76  :param nominal_v
-0001fe90: 616c 7565 3a20 5468 6520 746f 7461 6c20  alue: The total 
-0001fea0: 7472 6164 6520 616d 6f75 6e74 2069 6e20  trade amount in 
-0001feb0: 7175 6f74 6520 6375 7272 656e 6379 2069  quote currency i
-0001fec0: 6e63 6c75 6469 6e67 206c 6576 6572 6167  ncluding leverag
-0001fed0: 650a 2020 2020 2020 2020 6d61 696e 7465  e.        mainte
-0001fee0: 6e61 6e63 6520 616d 6f75 6e74 206f 6e6c  nance amount onl
-0001fef0: 7920 6f6e 2042 696e 616e 6365 0a20 2020  y on Binance.   
-0001ff00: 2020 2020 203a 7265 7475 726e 3a20 286d       :return: (m
-0001ff10: 6169 6e74 656e 616e 6365 206d 6172 6769  aintenance margi
-0001ff20: 6e20 7261 7469 6f2c 206d 6169 6e74 656e  n ratio, mainten
-0001ff30: 616e 6365 2061 6d6f 756e 7429 0a20 2020  ance amount).   
-0001ff40: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-0001ff50: 2020 6966 2028 7365 6c66 2e5f 636f 6e66    if (self._conf
-0001ff60: 6967 2e67 6574 2827 7275 6e6d 6f64 6527  ig.get('runmode'
-0001ff70: 2920 696e 204f 5054 494d 495a 455f 4d4f  ) in OPTIMIZE_MO
-0001ff80: 4445 530a 2020 2020 2020 2020 2020 2020  DES.            
-0001ff90: 2020 2020 6f72 2073 656c 662e 6578 6368      or self.exch
-0001ffa0: 616e 6765 5f68 6173 2827 6665 7463 684c  ange_has('fetchL
-0001ffb0: 6576 6572 6167 6554 6965 7273 2729 0a20  everageTiers'). 
-0001ffc0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0001ffd0: 7220 7365 6c66 2e65 7863 6861 6e67 655f  r self.exchange_
-0001ffe0: 6861 7328 2766 6574 6368 4d61 726b 6574  has('fetchMarket
-0001fff0: 4c65 7665 7261 6765 5469 6572 7327 2929  LeverageTiers'))
-00020000: 3a0a 0a20 2020 2020 2020 2020 2020 2069  :..            i
-00020010: 6620 7061 6972 206e 6f74 2069 6e20 7365  f pair not in se
-00020020: 6c66 2e5f 6c65 7665 7261 6765 5f74 6965  lf._leverage_tie
-00020030: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
-00020040: 2020 2020 7261 6973 6520 496e 7661 6c69      raise Invali
-00020050: 644f 7264 6572 4578 6365 7074 696f 6e28  dOrderException(
-00020060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020070: 2020 2020 2066 224d 6169 6e74 656e 616e       f"Maintenan
-00020080: 6365 206d 6172 6769 6e20 7261 7465 2066  ce margin rate f
-00020090: 6f72 207b 7061 6972 7d20 6973 2075 6e61  or {pair} is una
-000200a0: 7661 696c 6162 6c65 2066 6f72 207b 7365  vailable for {se
-000200b0: 6c66 2e6e 616d 657d 220a 2020 2020 2020  lf.name}".      
-000200c0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-000200d0: 2020 2020 2020 2020 2070 6169 725f 7469           pair_ti
-000200e0: 6572 7320 3d20 7365 6c66 2e5f 6c65 7665  ers = self._leve
-000200f0: 7261 6765 5f74 6965 7273 5b70 6169 725d  rage_tiers[pair]
-00020100: 0a0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
-00020110: 7220 7469 6572 2069 6e20 7265 7665 7273  r tier in revers
-00020120: 6564 2870 6169 725f 7469 6572 7329 3a0a  ed(pair_tiers):.
-00020130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020140: 6966 206e 6f6d 696e 616c 5f76 616c 7565  if nominal_value
-00020150: 203e 3d20 7469 6572 5b27 6d69 6e4e 6f74   >= tier['minNot
-00020160: 696f 6e61 6c27 5d3a 0a20 2020 2020 2020  ional']:.       
-00020170: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00020180: 7572 6e20 2874 6965 725b 276d 6169 6e74  urn (tier['maint
-00020190: 656e 616e 6365 4d61 7267 696e 5261 7465  enanceMarginRate
-000201a0: 275d 2c20 7469 6572 5b27 6d61 696e 7441  '], tier['maintA
-000201b0: 6d74 275d 290a 0a20 2020 2020 2020 2020  mt'])..         
-000201c0: 2020 2072 6169 7365 2045 7863 6861 6e67     raise Exchang
-000201d0: 6545 7272 6f72 2822 6e6f 6d69 6e61 6c20  eError("nominal 
-000201e0: 7661 6c75 6520 6361 6e20 6e6f 7420 6265  value can not be
-000201f0: 206c 6f77 6572 2074 6861 6e20 3022 290a   lower than 0").
-00020200: 2020 2020 2020 2020 2020 2020 2320 5468              # Th
-00020210: 6520 6c6f 7765 7374 206e 6f74 696f 6e61  e lowest notiona
-00020220: 6c5f 666c 6f6f 7220 666f 7220 616e 7920  l_floor for any 
-00020230: 7061 6972 2069 6e20 6665 7463 685f 6c65  pair in fetch_le
-00020240: 7665 7261 6765 5f74 6965 7273 2069 7320  verage_tiers is 
-00020250: 616c 7761 7973 2030 2062 6563 6175 7365  always 0 because
-00020260: 2069 740a 2020 2020 2020 2020 2020 2020   it.            
-00020270: 2320 6465 7363 7269 6265 7320 7468 6520  # describes the 
-00020280: 6d69 6e20 616d 7420 666f 7220 6120 7469  min amt for a ti
-00020290: 6572 2c20 616e 6420 7468 6520 6c6f 7765  er, and the lowe
-000202a0: 7374 2074 6965 7220 7769 6c6c 2061 6c77  st tier will alw
-000202b0: 6179 7320 676f 2064 6f77 6e20 746f 2030  ays go down to 0
-000202c0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-000202d0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000202e0: 2045 7863 6861 6e67 6545 7272 6f72 2866   ExchangeError(f
-000202f0: 2243 616e 6e6f 7420 6765 7420 6d61 696e  "Cannot get main
-00020300: 7465 6e61 6e63 6520 7261 7469 6f20 7573  tenance ratio us
-00020310: 696e 6720 7b73 656c 662e 6e61 6d65 7d22  ing {self.name}"
-00020320: 290a                                     ).
+0001f5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f5b0: 5b20 3120 c2b1 2028 4d61 696e 7465 6e61  [ 1 .. (Maintena
+0001f5c0: 6e63 6520 4d61 7267 696e 2052 6174 696f  nce Margin Ratio
+0001f5d0: 202b 2054 616b 6572 2052 6174 6529 5d0a   + Taker Rate)].
+0001f5e0: 2020 2020 2020 2020 2020 2020 5768 6572              Wher
+0001f5f0: 6569 6e2c 2022 2b22 206f 7220 222d 2220  ein, "+" or "-" 
+0001f600: 6465 7065 6e64 7320 6f6e 2077 6865 7468  depends on wheth
+0001f610: 6572 2074 6865 2063 6f6e 7472 6163 7420  er the contract 
+0001f620: 676f 6573 206c 6f6e 6720 6f72 2073 686f  goes long or sho
+0001f630: 7274 3a0a 2020 2020 2020 2020 2020 2020  rt:.            
+0001f640: 222d 2220 666f 7220 6c6f 6e67 2c20 616e  "-" for long, an
+0001f650: 6420 222b 2220 666f 7220 7368 6f72 742e  d "+" for short.
+0001f660: 0a0a 2020 2020 2020 2020 206f 6b65 783a  ..         okex:
+0001f670: 2068 7474 7073 3a2f 2f77 7777 2e6f 6b65   https://www.oke
+0001f680: 782e 636f 6d2f 7375 7070 6f72 742f 6863  x.com/support/hc
+0001f690: 2f65 6e2d 7573 2f61 7274 6963 6c65 732f  /en-us/articles/
+0001f6a0: 0a20 2020 2020 2020 2020 2020 2033 3630  .            360
+0001f6b0: 3035 3339 3039 3539 322d 5649 2d49 6e74  053909592-VI-Int
+0001f6c0: 726f 6475 6374 696f 6e2d 746f 2d74 6865  roduction-to-the
+0001f6d0: 2d69 736f 6c61 7465 642d 6d6f 6465 2d6f  -isolated-mode-o
+0001f6e0: 662d 5369 6e67 6c65 2d4d 756c 7469 2d63  f-Single-Multi-c
+0001f6f0: 7572 7265 6e63 792d 506f 7274 666f 6c69  urrency-Portfoli
+0001f700: 6f2d 6d61 7267 696e 0a0a 2020 2020 2020  o-margin..      
+0001f710: 2020 3a70 6172 616d 2070 6169 723a 2050    :param pair: P
+0001f720: 6169 7220 746f 2063 616c 6375 6c61 7465  air to calculate
+0001f730: 206c 6971 7569 6461 7469 6f6e 2070 7269   liquidation pri
+0001f740: 6365 2066 6f72 0a20 2020 2020 2020 203a  ce for.        :
+0001f750: 7061 7261 6d20 6f70 656e 5f72 6174 653a  param open_rate:
+0001f760: 2045 6e74 7279 2070 7269 6365 206f 6620   Entry price of 
+0001f770: 706f 7369 7469 6f6e 0a20 2020 2020 2020  position.       
+0001f780: 203a 7061 7261 6d20 6973 5f73 686f 7274   :param is_short
+0001f790: 3a20 5472 7565 2069 6620 7468 6520 7472  : True if the tr
+0001f7a0: 6164 6520 6973 2061 2073 686f 7274 2c20  ade is a short, 
+0001f7b0: 6661 6c73 6520 6f74 6865 7277 6973 650a  false otherwise.
+0001f7c0: 2020 2020 2020 2020 3a70 6172 616d 2061          :param a
+0001f7d0: 6d6f 756e 743a 2041 6273 6f6c 7574 6520  mount: Absolute 
+0001f7e0: 7661 6c75 6520 6f66 2070 6f73 6974 696f  value of positio
+0001f7f0: 6e20 7369 7a65 2069 6e63 6c2e 206c 6576  n size incl. lev
+0001f800: 6572 6167 6520 2869 6e20 6261 7365 2063  erage (in base c
+0001f810: 7572 7265 6e63 7929 0a20 2020 2020 2020  urrency).       
+0001f820: 203a 7061 7261 6d20 7374 616b 655f 616d   :param stake_am
+0001f830: 6f75 6e74 3a20 5374 616b 6520 616d 6f75  ount: Stake amou
+0001f840: 6e74 202d 2043 6f6c 6c61 7465 7261 6c20  nt - Collateral 
+0001f850: 696e 2073 6574 746c 6520 6375 7272 656e  in settle curren
+0001f860: 6379 2e0a 2020 2020 2020 2020 3a70 6172  cy..        :par
+0001f870: 616d 206c 6576 6572 6167 653a 204c 6576  am leverage: Lev
+0001f880: 6572 6167 6520 7573 6564 2066 6f72 2074  erage used for t
+0001f890: 6869 7320 706f 7369 7469 6f6e 2e0a 2020  his position..  
+0001f8a0: 2020 2020 2020 3a70 6172 616d 2074 7261        :param tra
+0001f8b0: 6469 6e67 5f6d 6f64 653a 2053 504f 542c  ding_mode: SPOT,
+0001f8c0: 204d 4152 4749 4e2c 2046 5554 5552 4553   MARGIN, FUTURES
+0001f8d0: 2c20 6574 632e 0a20 2020 2020 2020 203a  , etc..        :
+0001f8e0: 7061 7261 6d20 6d61 7267 696e 5f6d 6f64  param margin_mod
+0001f8f0: 653a 2045 6974 6865 7220 4953 4f4c 4154  e: Either ISOLAT
+0001f900: 4544 206f 7220 4352 4f53 530a 2020 2020  ED or CROSS.    
+0001f910: 2020 2020 3a70 6172 616d 2077 616c 6c65      :param walle
+0001f920: 745f 6261 6c61 6e63 653a 2041 6d6f 756e  t_balance: Amoun
+0001f930: 7420 6f66 206d 6172 6769 6e5f 6d6f 6465  t of margin_mode
+0001f940: 2069 6e20 7468 6520 7761 6c6c 6574 2062   in the wallet b
+0001f950: 6569 6e67 2075 7365 6420 746f 2074 7261  eing used to tra
+0001f960: 6465 0a20 2020 2020 2020 2020 2020 2043  de.            C
+0001f970: 726f 7373 2d4d 6172 6769 6e20 4d6f 6465  ross-Margin Mode
+0001f980: 3a20 6372 6f73 7357 616c 6c65 7442 616c  : crossWalletBal
+0001f990: 616e 6365 0a20 2020 2020 2020 2020 2020  ance.           
+0001f9a0: 2049 736f 6c61 7465 642d 4d61 7267 696e   Isolated-Margin
+0001f9b0: 204d 6f64 653a 2069 736f 6c61 7465 6457   Mode: isolatedW
+0001f9c0: 616c 6c65 7442 616c 616e 6365 0a0a 2020  alletBalance..  
+0001f9d0: 2020 2020 2020 2320 2a20 4e6f 7420 7265        # * Not re
+0001f9e0: 7175 6972 6564 2062 7920 4761 7465 206f  quired by Gate o
+0001f9f0: 7220 4f4b 580a 2020 2020 2020 2020 3a70  r OKX.        :p
+0001fa00: 6172 616d 206d 6d5f 6578 5f31 3a0a 2020  aram mm_ex_1:.  
+0001fa10: 2020 2020 2020 3a70 6172 616d 2075 706e        :param upn
+0001fa20: 6c5f 6578 5f31 3a0a 2020 2020 2020 2020  l_ex_1:.        
+0001fa30: 2222 220a 0a20 2020 2020 2020 206d 6172  """..        mar
+0001fa40: 6b65 7420 3d20 7365 6c66 2e6d 6172 6b65  ket = self.marke
+0001fa50: 7473 5b70 6169 725d 0a20 2020 2020 2020  ts[pair].       
+0001fa60: 2074 616b 6572 5f66 6565 5f72 6174 6520   taker_fee_rate 
+0001fa70: 3d20 6d61 726b 6574 5b27 7461 6b65 7227  = market['taker'
+0001fa80: 5d0a 2020 2020 2020 2020 6d6d 5f72 6174  ].        mm_rat
+0001fa90: 696f 2c20 5f20 3d20 7365 6c66 2e67 6574  io, _ = self.get
+0001faa0: 5f6d 6169 6e74 656e 616e 6365 5f72 6174  _maintenance_rat
+0001fab0: 696f 5f61 6e64 5f61 6d74 2870 6169 722c  io_and_amt(pair,
+0001fac0: 2073 7461 6b65 5f61 6d6f 756e 7429 0a0a   stake_amount)..
+0001fad0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0001fae0: 7472 6164 696e 675f 6d6f 6465 203d 3d20  trading_mode == 
+0001faf0: 5472 6164 696e 674d 6f64 652e 4655 5455  TradingMode.FUTU
+0001fb00: 5245 5320 616e 6420 7365 6c66 2e6d 6172  RES and self.mar
+0001fb10: 6769 6e5f 6d6f 6465 203d 3d20 4d61 7267  gin_mode == Marg
+0001fb20: 696e 4d6f 6465 2e49 534f 4c41 5445 443a  inMode.ISOLATED:
+0001fb30: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+0001fb40: 206d 6172 6b65 745b 2769 6e76 6572 7365   market['inverse
+0001fb50: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
+0001fb60: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
+0001fb70: 696f 6e61 6c45 7863 6570 7469 6f6e 280a  ionalException(.
+0001fb80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fb90: 2020 2020 2246 7265 7174 7261 6465 2064      "Freqtrade d
+0001fba0: 6f65 7320 6e6f 7420 7965 7420 7375 7070  oes not yet supp
+0001fbb0: 6f72 7420 696e 7665 7273 6520 636f 6e74  ort inverse cont
+0001fbc0: 7261 6374 7322 290a 0a20 2020 2020 2020  racts")..       
+0001fbd0: 2020 2020 2076 616c 7565 203d 2077 616c       value = wal
+0001fbe0: 6c65 745f 6261 6c61 6e63 6520 2f20 616d  let_balance / am
+0001fbf0: 6f75 6e74 0a0a 2020 2020 2020 2020 2020  ount..          
+0001fc00: 2020 6d6d 5f72 6174 696f 5f74 616b 6572    mm_ratio_taker
+0001fc10: 203d 2028 6d6d 5f72 6174 696f 202b 2074   = (mm_ratio + t
+0001fc20: 616b 6572 5f66 6565 5f72 6174 6529 0a20  aker_fee_rate). 
+0001fc30: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+0001fc40: 5f73 686f 7274 3a0a 2020 2020 2020 2020  _short:.        
+0001fc50: 2020 2020 2020 2020 7265 7475 726e 2028          return (
+0001fc60: 6f70 656e 5f72 6174 6520 2b20 7661 6c75  open_rate + valu
+0001fc70: 6529 202f 2028 3120 2b20 6d6d 5f72 6174  e) / (1 + mm_rat
+0001fc80: 696f 5f74 616b 6572 290a 2020 2020 2020  io_taker).      
+0001fc90: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001fca0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001fcb0: 726e 2028 6f70 656e 5f72 6174 6520 2d20  rn (open_rate - 
+0001fcc0: 7661 6c75 6529 202f 2028 3120 2d20 6d6d  value) / (1 - mm
+0001fcd0: 5f72 6174 696f 5f74 616b 6572 290a 2020  _ratio_taker).  
+0001fce0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001fcf0: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
+0001fd00: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
+0001fd10: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+0001fd20: 2020 2020 2246 7265 7174 7261 6465 206f      "Freqtrade o
+0001fd30: 6e6c 7920 7375 7070 6f72 7473 2069 736f  nly supports iso
+0001fd40: 6c61 7465 6420 6675 7475 7265 7320 666f  lated futures fo
+0001fd50: 7220 6c65 7665 7261 6765 2074 7261 6469  r leverage tradi
+0001fd60: 6e67 2229 0a0a 2020 2020 6465 6620 6765  ng")..    def ge
+0001fd70: 745f 6d61 696e 7465 6e61 6e63 655f 7261  t_maintenance_ra
+0001fd80: 7469 6f5f 616e 645f 616d 7428 0a20 2020  tio_and_amt(.   
+0001fd90: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0001fda0: 2020 2070 6169 723a 2073 7472 2c0a 2020     pair: str,.  
+0001fdb0: 2020 2020 2020 6e6f 6d69 6e61 6c5f 7661        nominal_va
+0001fdc0: 6c75 653a 2066 6c6f 6174 2c0a 2020 2020  lue: float,.    
+0001fdd0: 2920 2d3e 2054 7570 6c65 5b66 6c6f 6174  ) -> Tuple[float
+0001fde0: 2c20 4f70 7469 6f6e 616c 5b66 6c6f 6174  , Optional[float
+0001fdf0: 5d5d 3a0a 2020 2020 2020 2020 2222 220a  ]]:.        """.
+0001fe00: 2020 2020 2020 2020 496d 706f 7274 616e          Importan
+0001fe10: 743a 204d 7573 7420 6265 2066 6574 6368  t: Must be fetch
+0001fe20: 696e 6720 6461 7461 2066 726f 6d20 6361  ing data from ca
+0001fe30: 6368 6564 2076 616c 7565 7320 6173 2074  ched values as t
+0001fe40: 6869 7320 6973 2075 7365 6420 6279 2062  his is used by b
+0001fe50: 6163 6b74 6573 7469 6e67 210a 2020 2020  acktesting!.    
+0001fe60: 2020 2020 3a70 6172 616d 2070 6169 723a      :param pair:
+0001fe70: 204d 6172 6b65 7420 7379 6d62 6f6c 0a20   Market symbol. 
+0001fe80: 2020 2020 2020 203a 7061 7261 6d20 6e6f         :param no
+0001fe90: 6d69 6e61 6c5f 7661 6c75 653a 2054 6865  minal_value: The
+0001fea0: 2074 6f74 616c 2074 7261 6465 2061 6d6f   total trade amo
+0001feb0: 756e 7420 696e 2071 756f 7465 2063 7572  unt in quote cur
+0001fec0: 7265 6e63 7920 696e 636c 7564 696e 6720  rency including 
+0001fed0: 6c65 7665 7261 6765 0a20 2020 2020 2020  leverage.       
+0001fee0: 206d 6169 6e74 656e 616e 6365 2061 6d6f   maintenance amo
+0001fef0: 756e 7420 6f6e 6c79 206f 6e20 4269 6e61  unt only on Bina
+0001ff00: 6e63 650a 2020 2020 2020 2020 3a72 6574  nce.        :ret
+0001ff10: 7572 6e3a 2028 6d61 696e 7465 6e61 6e63  urn: (maintenanc
+0001ff20: 6520 6d61 7267 696e 2072 6174 696f 2c20  e margin ratio, 
+0001ff30: 6d61 696e 7465 6e61 6e63 6520 616d 6f75  maintenance amou
+0001ff40: 6e74 290a 2020 2020 2020 2020 2222 220a  nt).        """.
+0001ff50: 0a20 2020 2020 2020 2069 6620 2873 656c  .        if (sel
+0001ff60: 662e 5f63 6f6e 6669 672e 6765 7428 2772  f._config.get('r
+0001ff70: 756e 6d6f 6465 2729 2069 6e20 4f50 5449  unmode') in OPTI
+0001ff80: 4d49 5a45 5f4d 4f44 4553 0a20 2020 2020  MIZE_MODES.     
+0001ff90: 2020 2020 2020 2020 2020 206f 7220 7365             or se
+0001ffa0: 6c66 2e65 7863 6861 6e67 655f 6861 7328  lf.exchange_has(
+0001ffb0: 2766 6574 6368 4c65 7665 7261 6765 5469  'fetchLeverageTi
+0001ffc0: 6572 7327 290a 2020 2020 2020 2020 2020  ers').          
+0001ffd0: 2020 2020 2020 6f72 2073 656c 662e 6578        or self.ex
+0001ffe0: 6368 616e 6765 5f68 6173 2827 6665 7463  change_has('fetc
+0001fff0: 684d 6172 6b65 744c 6576 6572 6167 6554  hMarketLeverageT
+00020000: 6965 7273 2729 293a 0a0a 2020 2020 2020  iers')):..      
+00020010: 2020 2020 2020 6966 2070 6169 7220 6e6f        if pair no
+00020020: 7420 696e 2073 656c 662e 5f6c 6576 6572  t in self._lever
+00020030: 6167 655f 7469 6572 733a 0a20 2020 2020  age_tiers:.     
+00020040: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00020050: 2049 6e76 616c 6964 4f72 6465 7245 7863   InvalidOrderExc
+00020060: 6570 7469 6f6e 280a 2020 2020 2020 2020  eption(.        
+00020070: 2020 2020 2020 2020 2020 2020 6622 4d61              f"Ma
+00020080: 696e 7465 6e61 6e63 6520 6d61 7267 696e  intenance margin
+00020090: 2072 6174 6520 666f 7220 7b70 6169 727d   rate for {pair}
+000200a0: 2069 7320 756e 6176 6169 6c61 626c 6520   is unavailable 
+000200b0: 666f 7220 7b73 656c 662e 6e61 6d65 7d22  for {self.name}"
+000200c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000200d0: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+000200e0: 7061 6972 5f74 6965 7273 203d 2073 656c  pair_tiers = sel
+000200f0: 662e 5f6c 6576 6572 6167 655f 7469 6572  f._leverage_tier
+00020100: 735b 7061 6972 5d0a 0a20 2020 2020 2020  s[pair]..       
+00020110: 2020 2020 2066 6f72 2074 6965 7220 696e       for tier in
+00020120: 2072 6576 6572 7365 6428 7061 6972 5f74   reversed(pair_t
+00020130: 6965 7273 293a 0a20 2020 2020 2020 2020  iers):.         
+00020140: 2020 2020 2020 2069 6620 6e6f 6d69 6e61         if nomina
+00020150: 6c5f 7661 6c75 6520 3e3d 2074 6965 725b  l_value >= tier[
+00020160: 276d 696e 4e6f 7469 6f6e 616c 275d 3a0a  'minNotional']:.
+00020170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020180: 2020 2020 7265 7475 726e 2028 7469 6572      return (tier
+00020190: 5b27 6d61 696e 7465 6e61 6e63 654d 6172  ['maintenanceMar
+000201a0: 6769 6e52 6174 6527 5d2c 2074 6965 725b  ginRate'], tier[
+000201b0: 276d 6169 6e74 416d 7427 5d29 0a0a 2020  'maintAmt'])..  
+000201c0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000201d0: 4578 6368 616e 6765 4572 726f 7228 226e  ExchangeError("n
+000201e0: 6f6d 696e 616c 2076 616c 7565 2063 616e  ominal value can
+000201f0: 206e 6f74 2062 6520 6c6f 7765 7220 7468   not be lower th
+00020200: 616e 2030 2229 0a20 2020 2020 2020 2020  an 0").         
+00020210: 2020 2023 2054 6865 206c 6f77 6573 7420     # The lowest 
+00020220: 6e6f 7469 6f6e 616c 5f66 6c6f 6f72 2066  notional_floor f
+00020230: 6f72 2061 6e79 2070 6169 7220 696e 2066  or any pair in f
+00020240: 6574 6368 5f6c 6576 6572 6167 655f 7469  etch_leverage_ti
+00020250: 6572 7320 6973 2061 6c77 6179 7320 3020  ers is always 0 
+00020260: 6265 6361 7573 6520 6974 0a20 2020 2020  because it.     
+00020270: 2020 2020 2020 2023 2064 6573 6372 6962         # describ
+00020280: 6573 2074 6865 206d 696e 2061 6d74 2066  es the min amt f
+00020290: 6f72 2061 2074 6965 722c 2061 6e64 2074  or a tier, and t
+000202a0: 6865 206c 6f77 6573 7420 7469 6572 2077  he lowest tier w
+000202b0: 696c 6c20 616c 7761 7973 2067 6f20 646f  ill always go do
+000202c0: 776e 2074 6f20 300a 2020 2020 2020 2020  wn to 0.        
+000202d0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+000202e0: 2020 7261 6973 6520 4578 6368 616e 6765    raise Exchange
+000202f0: 4572 726f 7228 6622 4361 6e6e 6f74 2067  Error(f"Cannot g
+00020300: 6574 206d 6169 6e74 656e 616e 6365 2072  et maintenance r
+00020310: 6174 696f 2075 7369 6e67 207b 7365 6c66  atio using {self
+00020320: 2e6e 616d 657d 2229 0a                   .name}").
```

### Comparing `freqtrade-2023.5/freqtrade/exchange/exchange_utils.py` & `freqtrade-2023.5.1/freqtrade/exchange/exchange_utils.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/exchange/gate.py` & `freqtrade-2023.5.1/freqtrade/exchange/gate.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/exchange/hitbtc.py` & `freqtrade-2023.5.1/freqtrade/exchange/hitbtc.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/exchange/huobi.py` & `freqtrade-2023.5.1/freqtrade/exchange/huobi.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/exchange/kraken.py` & `freqtrade-2023.5.1/freqtrade/exchange/kraken.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/exchange/kucoin.py` & `freqtrade-2023.5.1/freqtrade/exchange/kucoin.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/exchange/okx.py` & `freqtrade-2023.5.1/freqtrade/exchange/okx.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/exchange/types.py` & `freqtrade-2023.5.1/freqtrade/exchange/types.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/RL/Base3ActionRLEnv.py` & `freqtrade-2023.5.1/freqtrade/freqai/RL/Base3ActionRLEnv.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/RL/Base4ActionRLEnv.py` & `freqtrade-2023.5.1/freqtrade/freqai/RL/Base4ActionRLEnv.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/RL/Base5ActionRLEnv.py` & `freqtrade-2023.5.1/freqtrade/freqai/RL/Base5ActionRLEnv.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/RL/BaseEnvironment.py` & `freqtrade-2023.5.1/freqtrade/freqai/RL/BaseEnvironment.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/RL/BaseReinforcementLearningModel.py` & `freqtrade-2023.5.1/freqtrade/freqai/RL/BaseReinforcementLearningModel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/base_models/BaseClassifierModel.py` & `freqtrade-2023.5.1/freqtrade/freqai/base_models/BaseClassifierModel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/base_models/BasePyTorchClassifier.py` & `freqtrade-2023.5.1/freqtrade/freqai/base_models/BasePyTorchClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/base_models/BasePyTorchModel.py` & `freqtrade-2023.5.1/freqtrade/freqai/base_models/BasePyTorchModel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/base_models/BasePyTorchRegressor.py` & `freqtrade-2023.5.1/freqtrade/freqai/base_models/BasePyTorchRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/base_models/BaseRegressionModel.py` & `freqtrade-2023.5.1/freqtrade/freqai/base_models/BaseRegressionModel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/base_models/BaseTensorFlowModel.py` & `freqtrade-2023.5.1/freqtrade/freqai/base_models/BaseTensorFlowModel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/base_models/FreqaiMultiOutputClassifier.py` & `freqtrade-2023.5.1/freqtrade/freqai/base_models/FreqaiMultiOutputClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/base_models/FreqaiMultiOutputRegressor.py` & `freqtrade-2023.5.1/freqtrade/freqai/base_models/FreqaiMultiOutputRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/data_drawer.py` & `freqtrade-2023.5.1/freqtrade/freqai/data_drawer.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/data_kitchen.py` & `freqtrade-2023.5.1/freqtrade/freqai/data_kitchen.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/freqai_interface.py` & `freqtrade-2023.5.1/freqtrade/freqai/freqai_interface.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/prediction_models/CatboostClassifier.py` & `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/CatboostClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/prediction_models/CatboostClassifierMultiTarget.py` & `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/CatboostClassifierMultiTarget.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/prediction_models/CatboostRegressor.py` & `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/CatboostRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/prediction_models/CatboostRegressorMultiTarget.py` & `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/CatboostRegressorMultiTarget.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/prediction_models/LightGBMClassifier.py` & `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/LightGBMClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/prediction_models/LightGBMClassifierMultiTarget.py` & `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/LightGBMClassifierMultiTarget.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/prediction_models/LightGBMRegressor.py` & `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/LightGBMRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/prediction_models/LightGBMRegressorMultiTarget.py` & `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/LightGBMRegressorMultiTarget.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/prediction_models/PyTorchMLPClassifier.py` & `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/PyTorchMLPClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/prediction_models/PyTorchMLPRegressor.py` & `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/PyTorchMLPRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/prediction_models/PyTorchTransformerRegressor.py` & `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/PyTorchTransformerRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/prediction_models/ReinforcementLearner.py` & `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/ReinforcementLearner.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/prediction_models/ReinforcementLearner_multiproc.py` & `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/ReinforcementLearner_multiproc.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/prediction_models/XGBoostClassifier.py` & `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/prediction_models/XGBoostRFClassifier.py` & `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostRFClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/prediction_models/XGBoostRFRegressor.py` & `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostRFRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/prediction_models/XGBoostRegressor.py` & `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/prediction_models/XGBoostRegressorMultiTarget.py` & `freqtrade-2023.5.1/freqtrade/freqai/prediction_models/XGBoostRegressorMultiTarget.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/tensorboard/TensorboardCallback.py` & `freqtrade-2023.5.1/freqtrade/freqai/tensorboard/TensorboardCallback.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/tensorboard/__init__.py` & `freqtrade-2023.5.1/freqtrade/freqai/tensorboard/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/tensorboard/base_tensorboard.py` & `freqtrade-2023.5.1/freqtrade/freqai/tensorboard/base_tensorboard.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/tensorboard/tensorboard.py` & `freqtrade-2023.5.1/freqtrade/freqai/tensorboard/tensorboard.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/torch/PyTorchDataConvertor.py` & `freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchDataConvertor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/torch/PyTorchMLPModel.py` & `freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchMLPModel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/torch/PyTorchModelTrainer.py` & `freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchModelTrainer.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/torch/PyTorchTrainerInterface.py` & `freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchTrainerInterface.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/torch/PyTorchTransformerModel.py` & `freqtrade-2023.5.1/freqtrade/freqai/torch/PyTorchTransformerModel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/torch/datasets.py` & `freqtrade-2023.5.1/freqtrade/freqai/torch/datasets.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqai/utils.py` & `freqtrade-2023.5.1/freqtrade/freqai/utils.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/freqtradebot.py` & `freqtrade-2023.5.1/freqtrade/freqtradebot.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/leverage/interest.py` & `freqtrade-2023.5.1/freqtrade/leverage/interest.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/loggers/__init__.py` & `freqtrade-2023.5.1/freqtrade/loggers/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/loggers/std_err_stream_handler.py` & `freqtrade-2023.5.1/freqtrade/loggers/std_err_stream_handler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/main.py` & `freqtrade-2023.5.1/freqtrade/main.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/misc.py` & `freqtrade-2023.5.1/freqtrade/misc.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/mixins/logging_mixin.py` & `freqtrade-2023.5.1/freqtrade/mixins/logging_mixin.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/backtest_caching.py` & `freqtrade-2023.5.1/freqtrade/optimize/backtest_caching.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/backtesting.py` & `freqtrade-2023.5.1/freqtrade/optimize/backtesting.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/bt_progress.py` & `freqtrade-2023.5.1/freqtrade/optimize/bt_progress.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/edge_cli.py` & `freqtrade-2023.5.1/freqtrade/optimize/edge_cli.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/hyperopt.py` & `freqtrade-2023.5.1/freqtrade/optimize/hyperopt.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/hyperopt_auto.py` & `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_auto.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/hyperopt_epoch_filters.py` & `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_epoch_filters.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/hyperopt_interface.py` & `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_interface.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_calmar.py` & `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_calmar.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown.py` & `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown_relative.py` & `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown_relative.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_onlyprofit.py` & `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_onlyprofit.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_profit_drawdown.py` & `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_profit_drawdown.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe.py` & `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe_daily.py` & `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe_daily.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_short_trade_dur.py` & `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_short_trade_dur.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino.py` & `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino_daily.py` & `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino_daily.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/hyperopt_loss_interface.py` & `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_loss_interface.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/hyperopt_tools.py` & `freqtrade-2023.5.1/freqtrade/optimize/hyperopt_tools.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/optimize_reports.py` & `freqtrade-2023.5.1/freqtrade/optimize/optimize_reports.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/optimize/space/decimalspace.py` & `freqtrade-2023.5.1/freqtrade/optimize/space/decimalspace.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/persistence/key_value_store.py` & `freqtrade-2023.5.1/freqtrade/persistence/key_value_store.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/persistence/migrations.py` & `freqtrade-2023.5.1/freqtrade/persistence/migrations.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/persistence/models.py` & `freqtrade-2023.5.1/freqtrade/persistence/models.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/persistence/pairlock.py` & `freqtrade-2023.5.1/freqtrade/persistence/pairlock.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/persistence/pairlock_middleware.py` & `freqtrade-2023.5.1/freqtrade/persistence/pairlock_middleware.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/persistence/trade_model.py` & `freqtrade-2023.5.1/freqtrade/persistence/trade_model.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plot/plotting.py` & `freqtrade-2023.5.1/freqtrade/plot/plotting.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/pairlist/AgeFilter.py` & `freqtrade-2023.5.1/freqtrade/plugins/pairlist/AgeFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/pairlist/IPairList.py` & `freqtrade-2023.5.1/freqtrade/plugins/pairlist/IPairList.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/pairlist/OffsetFilter.py` & `freqtrade-2023.5.1/freqtrade/plugins/pairlist/OffsetFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/pairlist/PerformanceFilter.py` & `freqtrade-2023.5.1/freqtrade/plugins/pairlist/PerformanceFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/pairlist/PrecisionFilter.py` & `freqtrade-2023.5.1/freqtrade/plugins/pairlist/PrecisionFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/pairlist/PriceFilter.py` & `freqtrade-2023.5.1/freqtrade/plugins/pairlist/PriceFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/pairlist/ProducerPairList.py` & `freqtrade-2023.5.1/freqtrade/plugins/pairlist/ProducerPairList.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/pairlist/RemotePairList.py` & `freqtrade-2023.5.1/freqtrade/plugins/pairlist/RemotePairList.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/pairlist/ShuffleFilter.py` & `freqtrade-2023.5.1/freqtrade/plugins/pairlist/ShuffleFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/pairlist/SpreadFilter.py` & `freqtrade-2023.5.1/freqtrade/plugins/pairlist/SpreadFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/pairlist/StaticPairList.py` & `freqtrade-2023.5.1/freqtrade/plugins/pairlist/StaticPairList.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/pairlist/VolatilityFilter.py` & `freqtrade-2023.5.1/freqtrade/plugins/pairlist/VolatilityFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/pairlist/VolumePairList.py` & `freqtrade-2023.5.1/freqtrade/plugins/pairlist/VolumePairList.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/pairlist/pairlist_helpers.py` & `freqtrade-2023.5.1/freqtrade/plugins/pairlist/pairlist_helpers.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/pairlist/rangestabilityfilter.py` & `freqtrade-2023.5.1/freqtrade/plugins/pairlist/rangestabilityfilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/pairlistmanager.py` & `freqtrade-2023.5.1/freqtrade/plugins/pairlistmanager.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/protectionmanager.py` & `freqtrade-2023.5.1/freqtrade/plugins/protectionmanager.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/protections/cooldown_period.py` & `freqtrade-2023.5.1/freqtrade/plugins/protections/cooldown_period.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/protections/iprotection.py` & `freqtrade-2023.5.1/freqtrade/plugins/protections/iprotection.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/protections/low_profit_pairs.py` & `freqtrade-2023.5.1/freqtrade/plugins/protections/low_profit_pairs.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/protections/max_drawdown_protection.py` & `freqtrade-2023.5.1/freqtrade/plugins/protections/max_drawdown_protection.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/plugins/protections/stoploss_guard.py` & `freqtrade-2023.5.1/freqtrade/plugins/protections/stoploss_guard.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/resolvers/__init__.py` & `freqtrade-2023.5.1/freqtrade/resolvers/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/resolvers/exchange_resolver.py` & `freqtrade-2023.5.1/freqtrade/resolvers/exchange_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/resolvers/freqaimodel_resolver.py` & `freqtrade-2023.5.1/freqtrade/resolvers/freqaimodel_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/resolvers/hyperopt_resolver.py` & `freqtrade-2023.5.1/freqtrade/resolvers/hyperopt_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/resolvers/iresolver.py` & `freqtrade-2023.5.1/freqtrade/resolvers/iresolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/resolvers/pairlist_resolver.py` & `freqtrade-2023.5.1/freqtrade/resolvers/pairlist_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/resolvers/protection_resolver.py` & `freqtrade-2023.5.1/freqtrade/resolvers/protection_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/resolvers/strategy_resolver.py` & `freqtrade-2023.5.1/freqtrade/resolvers/strategy_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/api_server/api_auth.py` & `freqtrade-2023.5.1/freqtrade/rpc/api_server/api_auth.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/api_server/api_backtest.py` & `freqtrade-2023.5.1/freqtrade/rpc/api_server/api_backtest.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/api_server/api_schemas.py` & `freqtrade-2023.5.1/freqtrade/rpc/api_server/api_schemas.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/api_server/api_v1.py` & `freqtrade-2023.5.1/freqtrade/rpc/api_server/api_v1.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/api_server/api_ws.py` & `freqtrade-2023.5.1/freqtrade/rpc/api_server/api_ws.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/api_server/deps.py` & `freqtrade-2023.5.1/freqtrade/rpc/api_server/deps.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/api_server/ui/fallback_file.html` & `freqtrade-2023.5.1/freqtrade/rpc/api_server/ui/fallback_file.html`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/api_server/ui/favicon.ico` & `freqtrade-2023.5.1/freqtrade/rpc/api_server/ui/favicon.ico`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/api_server/uvicorn_threaded.py` & `freqtrade-2023.5.1/freqtrade/rpc/api_server/uvicorn_threaded.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/api_server/web_ui.py` & `freqtrade-2023.5.1/freqtrade/rpc/api_server/web_ui.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/api_server/webserver.py` & `freqtrade-2023.5.1/freqtrade/rpc/api_server/webserver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/api_server/ws/channel.py` & `freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/channel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/api_server/ws/message_stream.py` & `freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/message_stream.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/api_server/ws/proxy.py` & `freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/proxy.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/api_server/ws/serializer.py` & `freqtrade-2023.5.1/freqtrade/rpc/api_server/ws/serializer.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/api_server/ws_schemas.py` & `freqtrade-2023.5.1/freqtrade/rpc/api_server/ws_schemas.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/discord.py` & `freqtrade-2023.5.1/freqtrade/rpc/discord.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/external_message_consumer.py` & `freqtrade-2023.5.1/freqtrade/rpc/external_message_consumer.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/fiat_convert.py` & `freqtrade-2023.5.1/freqtrade/rpc/fiat_convert.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/rpc.py` & `freqtrade-2023.5.1/freqtrade/rpc/rpc.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/rpc_manager.py` & `freqtrade-2023.5.1/freqtrade/rpc/rpc_manager.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/rpc_types.py` & `freqtrade-2023.5.1/freqtrade/rpc/rpc_types.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/telegram.py` & `freqtrade-2023.5.1/freqtrade/rpc/telegram.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/rpc/webhook.py` & `freqtrade-2023.5.1/freqtrade/rpc/webhook.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/strategy/__init__.py` & `freqtrade-2023.5.1/freqtrade/strategy/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/strategy/hyper.py` & `freqtrade-2023.5.1/freqtrade/strategy/hyper.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/strategy/informative_decorator.py` & `freqtrade-2023.5.1/freqtrade/strategy/informative_decorator.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/strategy/interface.py` & `freqtrade-2023.5.1/freqtrade/strategy/interface.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/strategy/parameters.py` & `freqtrade-2023.5.1/freqtrade/strategy/parameters.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/strategy/strategy_helper.py` & `freqtrade-2023.5.1/freqtrade/strategy/strategy_helper.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/strategy/strategy_wrapper.py` & `freqtrade-2023.5.1/freqtrade/strategy/strategy_wrapper.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/strategy/strategyupdater.py` & `freqtrade-2023.5.1/freqtrade/strategy/strategyupdater.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/templates/FreqaiExampleHybridStrategy.py` & `freqtrade-2023.5.1/freqtrade/templates/FreqaiExampleHybridStrategy.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/templates/FreqaiExampleStrategy.py` & `freqtrade-2023.5.1/freqtrade/templates/FreqaiExampleStrategy.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/templates/base_config.json.j2` & `freqtrade-2023.5.1/freqtrade/templates/base_config.json.j2`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/templates/base_strategy.py.j2` & `freqtrade-2023.5.1/freqtrade/templates/base_strategy.py.j2`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/templates/sample_hyperopt_loss.py` & `freqtrade-2023.5.1/freqtrade/templates/sample_hyperopt_loss.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/templates/sample_strategy.py` & `freqtrade-2023.5.1/freqtrade/templates/sample_strategy.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/templates/strategy_analysis_example.ipynb` & `freqtrade-2023.5.1/freqtrade/templates/strategy_analysis_example.ipynb`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/templates/strategy_subtemplates/indicators_full.j2` & `freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/indicators_full.j2`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/templates/strategy_subtemplates/strategy_methods_advanced.j2` & `freqtrade-2023.5.1/freqtrade/templates/strategy_subtemplates/strategy_methods_advanced.j2`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/util/binance_mig.py` & `freqtrade-2023.5.1/freqtrade/util/binance_mig.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/util/datetime_helpers.py` & `freqtrade-2023.5.1/freqtrade/util/datetime_helpers.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/util/periodic_cache.py` & `freqtrade-2023.5.1/freqtrade/util/periodic_cache.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/vendor/qtpylib/indicators.py` & `freqtrade-2023.5.1/freqtrade/vendor/qtpylib/indicators.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/wallets.py` & `freqtrade-2023.5.1/freqtrade/wallets.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade/worker.py` & `freqtrade-2023.5.1/freqtrade/worker.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade.egg-info/PKG-INFO` & `freqtrade-2023.5.1/freqtrade.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: freqtrade
-Version: 2023.5
+Version: 2023.5.1
 Summary: Freqtrade - Crypto Trading Bot
 Home-page: https://github.com/freqtrade/freqtrade
 Author: Freqtrade Team
 Author-email: freqtrade@protonmail.com
 License: GPLv3
 Project-URL: Bug Tracker, https://github.com/freqtrade/freqtrade/issues
 Classifier: Environment :: Console
```

### Comparing `freqtrade-2023.5/freqtrade.egg-info/SOURCES.txt` & `freqtrade-2023.5.1/freqtrade.egg-info/SOURCES.txt`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/freqtrade.egg-info/requires.txt` & `freqtrade-2023.5.1/freqtrade.egg-info/requires.txt`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/pyproject.toml` & `freqtrade-2023.5.1/pyproject.toml`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/setup.cfg` & `freqtrade-2023.5.1/setup.cfg`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/setup.py` & `freqtrade-2023.5.1/setup.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/commands/test_build_config.py` & `freqtrade-2023.5.1/tests/commands/test_build_config.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/commands/test_commands.py` & `freqtrade-2023.5.1/tests/commands/test_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/conftest.py` & `freqtrade-2023.5.1/tests/conftest.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/conftest_trades.py` & `freqtrade-2023.5.1/tests/conftest_trades.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/conftest_trades_usdt.py` & `freqtrade-2023.5.1/tests/conftest_trades_usdt.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/data/test_btanalysis.py` & `freqtrade-2023.5.1/tests/data/test_btanalysis.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/data/test_converter.py` & `freqtrade-2023.5.1/tests/data/test_converter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/data/test_datahandler.py` & `freqtrade-2023.5.1/tests/data/test_datahandler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/data/test_dataprovider.py` & `freqtrade-2023.5.1/tests/data/test_dataprovider.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/data/test_entryexitanalysis.py` & `freqtrade-2023.5.1/tests/data/test_entryexitanalysis.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/data/test_history.py` & `freqtrade-2023.5.1/tests/data/test_history.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/edge/test_edge.py` & `freqtrade-2023.5.1/tests/edge/test_edge.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/exchange/test_binance.py` & `freqtrade-2023.5.1/tests/exchange/test_binance.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/exchange/test_bitpanda.py` & `freqtrade-2023.5.1/tests/exchange/test_bitpanda.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/exchange/test_bybit.py` & `freqtrade-2023.5.1/tests/exchange/test_bybit.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/exchange/test_ccxt_compat.py` & `freqtrade-2023.5.1/tests/exchange/test_ccxt_compat.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/exchange/test_exchange.py` & `freqtrade-2023.5.1/tests/exchange/test_exchange.py`

 * *Files 1% similar despite different names*

```diff
@@ -629,42 +629,50 @@
     mocker.patch(f'{EXMS}._init_ccxt', MagicMock(return_value=api_mock))
     default_conf['exchange']['pair_whitelist'] = ['ETH/BTC']
     ex = Exchange(default_conf)
 
     assert ex.markets == expected_return
 
 
-def test_reload_markets(default_conf, mocker, caplog):
+def test_reload_markets(default_conf, mocker, caplog, time_machine):
     caplog.set_level(logging.DEBUG)
     initial_markets = {'ETH/BTC': {}}
     updated_markets = {'ETH/BTC': {}, "LTC/BTC": {}}
-
+    start_dt = dt_now()
+    time_machine.move_to(start_dt, tick=False)
     api_mock = MagicMock()
     api_mock.load_markets = MagicMock(return_value=initial_markets)
     default_conf['exchange']['markets_refresh_interval'] = 10
     exchange = get_patched_exchange(mocker, default_conf, api_mock, id="binance",
                                     mock_markets=False)
     exchange._load_async_markets = MagicMock()
-    exchange._last_markets_refresh = dt_ts()
+    assert exchange._last_markets_refresh == dt_ts()
 
     assert exchange.markets == initial_markets
 
+    time_machine.move_to(start_dt + timedelta(minutes=8), tick=False)
     # less than 10 minutes have passed, no reload
     exchange.reload_markets()
     assert exchange.markets == initial_markets
     assert exchange._load_async_markets.call_count == 0
 
     api_mock.load_markets = MagicMock(return_value=updated_markets)
     # more than 10 minutes have passed, reload is executed
-    exchange._last_markets_refresh = dt_ts(dt_now() - timedelta(minutes=15))
+    time_machine.move_to(start_dt + timedelta(minutes=11), tick=False)
     exchange.reload_markets()
     assert exchange.markets == updated_markets
     assert exchange._load_async_markets.call_count == 1
     assert log_has('Performing scheduled market reload..', caplog)
 
+    # Not called again
+    exchange._load_async_markets.reset_mock()
+
+    exchange.reload_markets()
+    assert exchange._load_async_markets.call_count == 0
+
 
 def test_reload_markets_exception(default_conf, mocker, caplog):
     caplog.set_level(logging.DEBUG)
 
     api_mock = MagicMock()
     api_mock.load_markets = MagicMock(side_effect=ccxt.NetworkError("LoadError"))
     default_conf['exchange']['markets_refresh_interval'] = 10
```

### Comparing `freqtrade-2023.5/tests/exchange/test_exchange_utils.py` & `freqtrade-2023.5.1/tests/exchange/test_exchange_utils.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/exchange/test_gate.py` & `freqtrade-2023.5.1/tests/exchange/test_gate.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/exchange/test_huobi.py` & `freqtrade-2023.5.1/tests/exchange/test_huobi.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/exchange/test_kraken.py` & `freqtrade-2023.5.1/tests/exchange/test_kraken.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/exchange/test_kucoin.py` & `freqtrade-2023.5.1/tests/exchange/test_kucoin.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/exchange/test_okx.py` & `freqtrade-2023.5.1/tests/exchange/test_okx.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/optimize/__init__.py` & `freqtrade-2023.5.1/tests/optimize/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/optimize/conftest.py` & `freqtrade-2023.5.1/tests/optimize/conftest.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/optimize/test_backtest_detail.py` & `freqtrade-2023.5.1/tests/optimize/test_backtest_detail.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/optimize/test_backtesting.py` & `freqtrade-2023.5.1/tests/optimize/test_backtesting.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/optimize/test_backtesting_adjust_position.py` & `freqtrade-2023.5.1/tests/optimize/test_backtesting_adjust_position.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/optimize/test_edge_cli.py` & `freqtrade-2023.5.1/tests/optimize/test_edge_cli.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/optimize/test_hyperopt.py` & `freqtrade-2023.5.1/tests/optimize/test_hyperopt.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/optimize/test_hyperopt_tools.py` & `freqtrade-2023.5.1/tests/optimize/test_hyperopt_tools.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/optimize/test_hyperoptloss.py` & `freqtrade-2023.5.1/tests/optimize/test_hyperoptloss.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/optimize/test_optimize_reports.py` & `freqtrade-2023.5.1/tests/optimize/test_optimize_reports.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/persistence/test_key_value_store.py` & `freqtrade-2023.5.1/tests/persistence/test_key_value_store.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/persistence/test_migrations.py` & `freqtrade-2023.5.1/tests/persistence/test_migrations.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/persistence/test_persistence.py` & `freqtrade-2023.5.1/tests/persistence/test_persistence.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/persistence/test_trade_fromjson.py` & `freqtrade-2023.5.1/tests/persistence/test_trade_fromjson.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/plugins/test_pairlist.py` & `freqtrade-2023.5.1/tests/plugins/test_pairlist.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/plugins/test_pairlocks.py` & `freqtrade-2023.5.1/tests/plugins/test_pairlocks.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/plugins/test_protections.py` & `freqtrade-2023.5.1/tests/plugins/test_protections.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/plugins/test_remotepairlist.py` & `freqtrade-2023.5.1/tests/plugins/test_remotepairlist.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/rpc/test_fiat_convert.py` & `freqtrade-2023.5.1/tests/rpc/test_fiat_convert.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/rpc/test_rpc.py` & `freqtrade-2023.5.1/tests/rpc/test_rpc.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/rpc/test_rpc_apiserver.py` & `freqtrade-2023.5.1/tests/rpc/test_rpc_apiserver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/rpc/test_rpc_emc.py` & `freqtrade-2023.5.1/tests/rpc/test_rpc_emc.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/rpc/test_rpc_manager.py` & `freqtrade-2023.5.1/tests/rpc/test_rpc_manager.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/rpc/test_rpc_telegram.py` & `freqtrade-2023.5.1/tests/rpc/test_rpc_telegram.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/rpc/test_rpc_webhook.py` & `freqtrade-2023.5.1/tests/rpc/test_rpc_webhook.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/strategy/test_default_strategy.py` & `freqtrade-2023.5.1/tests/strategy/test_default_strategy.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/strategy/test_interface.py` & `freqtrade-2023.5.1/tests/strategy/test_interface.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/strategy/test_strategy_helpers.py` & `freqtrade-2023.5.1/tests/strategy/test_strategy_helpers.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/strategy/test_strategy_loading.py` & `freqtrade-2023.5.1/tests/strategy/test_strategy_loading.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/test_arguments.py` & `freqtrade-2023.5.1/tests/test_arguments.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/test_binance_mig.py` & `freqtrade-2023.5.1/tests/test_binance_mig.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/test_configuration.py` & `freqtrade-2023.5.1/tests/test_configuration.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/test_directory_operations.py` & `freqtrade-2023.5.1/tests/test_directory_operations.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/test_freqtradebot.py` & `freqtrade-2023.5.1/tests/test_freqtradebot.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/test_indicators.py` & `freqtrade-2023.5.1/tests/test_indicators.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/test_integration.py` & `freqtrade-2023.5.1/tests/test_integration.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/test_main.py` & `freqtrade-2023.5.1/tests/test_main.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/test_misc.py` & `freqtrade-2023.5.1/tests/test_misc.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/test_plotting.py` & `freqtrade-2023.5.1/tests/test_plotting.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/test_strategy_updater.py` & `freqtrade-2023.5.1/tests/test_strategy_updater.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/test_timerange.py` & `freqtrade-2023.5.1/tests/test_timerange.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/test_wallets.py` & `freqtrade-2023.5.1/tests/test_wallets.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2023.5/tests/test_worker.py` & `freqtrade-2023.5.1/tests/test_worker.py`

 * *Files identical despite different names*

